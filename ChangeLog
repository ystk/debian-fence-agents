2017-01-16  marxsk  <mgrac@redhat.com>

	Merge pull request #103 from oalbrigt/pycurl-fix-StringIO-issues
	pycurl agents: fix StringIO issues

2017-01-13  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	pycurl agents: fix StringIO issues

2017-01-09  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Merge pull request #102 from ofaaland/b_powerman_path_fix
	fence_powerman: fix typo in option powerman-path

2017-01-06  Olaf Faaland  <faaland1@llnl.gov>

	fence_powerman: fix typo in option powerman-path
	References to dictionary options[] sometimes used key "powerman_path"
	and other times "powerman-path", resulting in references to keys that
	did not exist.

	This resulted in total failure of the fence agent.

	This commit makes the key used consistent.

2017-01-06  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Merge pull request #101 from oalbrigt/python3-only-build
	Fix to be able to build on Python 3 only systems

2016-12-23  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Fix to be able to build on Python 3 only systems

2016-12-22  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Merge pull request #98 from n3world/disableStderrLogging
	fencing: Add option to disable logging to stderr

2016-12-21  Nate Clark  <nate@neworld.us>

	fencing: Add --quiet option to disable logging to stderr

2016-12-13  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Merge pull request #87 from mbaldessari/fence_ironic
	Ironic fence agent

2016-12-12  marxsk  <mgrac@redhat.com>

	Merge pull request #100 from oalbrigt/travis-fix
	travis: update Python path

2016-12-12  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	travis: update Python path

2016-12-12  marxsk  <mgrac@redhat.com>

	Merge pull request #99 from MSSedusch/master
	remove getopt for new parameters for fence_azure_arm

	Merge pull request #97 from n3world/specifyLogCommand
	fencing: Specify command to be logged by run_command

	Merge pull request #96 from vuntz/fix-travis
	Fix travis issue in XML metadata introduced by 0f170a9

2016-12-06  Sebastian Dusch  <sedusch@microsoft.com>

	remove getopt for new parameters

2016-12-01  Nate Clark  <nate@neworld.us>

	fencing: Specify command to be logged by run_command
	Currently run_command special cases the logging of commands with ipmitool and removes everything
	between the flat -P and -p. Instead of special casing commands with ipmitool allow the caller to
	provide the command to log so that the command can do any necessary scrubbing of the message to be
	logged.

2016-12-01  Vincent Untz  <vuntz@suse.com>

	Fix travis
	Regression introduced in 0f170a937bd0944e172004dc30df2fc240d9ca20

2016-12-01  Andrew Beekhof  <andrew@beekhof.net>

	Merge branch 'master' of github.com:ClusterLabs/fence-agents

	compute: Fix debug message

2016-11-23  marxsk  <mgrac@redhat.com>

	Merge pull request #95 from memotype/master
	fence_vmware_soap: Suppress InsecureRequestWarning when ssl_insecure is given

2016-11-21  Isaac Freeman  <memotype@gmail.com>

	Suppress InsecureRequestWarning when ssl_insecure is given

2016-11-14  marxsk  <mgrac@redhat.com>

	Merge pull request #84 from jnpkrn/build-m4-macro-move
	build: fix possibly undefined macro AC_PYTHON_MODULE

2016-11-10  Jan Pokorný  <jpokorny@redhat.com>

	build: fix possibly undefined macro AC_PYTHON_MODULE
	As already mentioned 2 years back by Alan Evangelista[1], fence-agents
	project indeed uses a strange build setup, which furthermore makes it
	impossible to pass the configure stage successfully, at least with
	some combinations of the "autotools" programs' versions (e.g., as old
	ones as present in RHEL 6).

	Remedy is as simple as originally suggested, which also means m4
	directory no longer needs to be reinsured in autogen.sh (though it
	still is as a legacy), but special care must be taken with .gitignore
	and maintainer-clean-local target of the main Makafile.

	[1] https://www.redhat.com/archives/cluster-devel/2014-October/msg00161.html

2016-11-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Remove unused Makefile.am files
	Currently, we are using single Makefile.am in fence/agents directory.

2016-11-10  marxsk  <mgrac@redhat.com>

	Merge pull request #92 from MSSedusch/master
	fence_azure_arm: add fencing agent for Azure Resource Manager

	Merge pull request #93 from ofaaland/feature-powerman-upstream
	fence_powerman: Add powerman agent

2016-11-10  Andrew Beekhof  <andrew@beekhof.net>

	compute: Simpler check for nova force down compatibility

2016-11-09  Olaf Faaland  <faaland1@llnl.gov>

	feature powerman address review comments pass 2
	* Set default for powerman_path in configure

	* Remove unnecessary query after powerman --on or --off
	fence_action() automatically queries power status after a power_set
	function call, because many devices report success when the on/off
	actually failed.

	* Delay before checking powerman is executable
	Use the provided run_delay() function to determine when a delay is
	necessary.  Call it before testing that the powerman binary is
	executable.  The project's sanity tests depend on this to handle the
	missing dependency (powerman), within their testing environment.

2016-11-09  Sebastian Dusch  <sedusch@microsoft.com>

	fence_azure_arm: remove reboot action, remove sys.exit for setting powerstate, remove global compute_client and pass it as argument to functions

2016-11-09  Marian Krcmarik  <mkrcmari@redhat.com>

	compute: Ensure we can connect to nova when fixing the plug name

	compute: Correctly identify when the nodename already includes the supplied domain

	compute: correctly implement 'on' when the force-down API call is available

	compute: Use the best available nova API version

2016-11-08  Olaf Faaland  <faaland1@llnl.gov>

	feature powerman address review comments pass 1
	Removed static manpage which will be auto-generated from metadata
	Removed unnecessary run_delay() call in main
	Create option to set path to powerman binary
	Verify powerman binary is executable
	Removed redundant default ipport
	Removed unnecessary debug logging of raw arguments
	Removed unnecessary reboot function, implemented in a
	  way that made it no better than the one already
	  implemented within lib/fencing.py
	Return value of monitor action is 'error' if powerman not running

2016-11-08  marxsk  <mgrac@redhat.com>

	Merge pull request #88 from oalbrigt/fence_compute-fix-connectionerror
	fence_compute: fix ConnectionError by using full module name

2016-11-07  Olaf Faaland  <faaland1@llnl.gov>

	feature-powerman Add list support and verify power state after changes
	Add list support and change log level to error, for error messages users
	should be made aware of.

	When fencing or unfencing a node, verify the power state of the device
	with --query before returning.  Return code from the powerman "on" or
	"off" commands can be unreliable for some devices.

2016-11-07  Michael Kit Gilbert  <gilbert32@llnl.gov>

	feature-powerman add fence agent for powerman
	Add a fence agent for powerman, https://github.com/chaos/powerman

2016-11-07  Sebastian Dusch  <sedusch@microsoft.com>

	fence_azure_arm: move option definitions to define_new_opts

	fence_azure_arm: add fencing agent for Azure Resource Manager

2016-11-02  Michele Baldessari  <michele@acksyn.org>

	Ironic fence agent
	Introduce a fence agent that plugs into OpenStack's Ironic (Bare Metal
	as a service) service.

	Testing recap:
	1) With ironic services up and running
	1.1) Status
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o status -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Status: ON

	1.2) Power off
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o off -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Success: Powered OFF  // Machine confirmed to be off

	1.3) Power on
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o on -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Success: Powered ON

	1.4) Power on (when already powered on)
	fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o on -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Success: Already ON

	2) With ironic services down/in error
	2.1) Status
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o status -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Failed: Unable to obtain correct plug status or plug is not available

	2.2) Power off
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o off -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Failed: Unable to obtain correct plug status or plug is not available

	2.3) Power on
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o on -n 2b40a642-3d7b-4a43-b6a2-57a3967ebb1c
	Failed: Unable to obtain correct plug status or plug is not available

	3) Non existing VM
	$ fence_ironic -k $OS_AUTH_URL -l admin -p $OS_PASSWORD -o on -n foo
	Failed: Unable to obtain correct plug status or plug is not available

	4) Verified that password is never logged even when invoked with '-v'

	5) Tested list command
	$ fence_ironic -k http://192.0.2.1:5000/v2.0 -l admin -p 1ea6ac2d58b975455bf90eeb625ba57ac2c67766 -o list-status -C " "
	ffa9ff02-20f1-45f4-b44c-1276d8120827 control-0 ON
	79956ff7-8f9a-45a8-k90b-f711daf79bed control-2 ON
	2b40a642-3d7b-4a43-b6a2-57a3967ebb1c compute-0 ON
	70e07769-c4c5-4e0d-k134-41bca3f525d4 control-3 ON
	b1db4b9b-da1a-4f3b-k980-88251eb5bdcd control-1 ON

	Set up the fence agent like this:
	hostmap=$(nova list | grep ctlplane | awk -F\| '{print $3 ":" $2}' | tr -d ' ' | tr '\n' ' ')
	sudo pcs stonith create shooter fence_ironic auth-url=${OS_AUTH_URL} \
	  login=${OS_USERNAME} passwd=${OS_PASSWORD} tenant-name=${OS_TENANT_NAME} \
	  pcmk_host_map=\"${hostmap}\" op monitor interval=60s

2016-10-17  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_compute: fix ConnectionError by using full module name

2016-09-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvmip: Update XML metadata

	fence_zvmip: Default shell timeout was float instead of integer

	fencing: Add new types to RNG schema

	fencing: Add types 'integer/second' for validation and metadata

	fence_lpar: Handle exceptions when invalid output is read

2016-09-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: Add support for IVM

2016-08-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: Improve a method to obtain status
	On Cisco UCS there are two attributes which are important for obtaining
	correct power status of blade. One checks if slot is powered ON and other if
	the node is pulled off the blade.

2016-08-22  marxsk  <mgrac@redhat.com>

	Merge pull request #81 from oalbrigt/install-fix
	Fix install issue for symlinked agents

	Merge pull request #85 from oalbrigt/fence_mpath-unique-key-per-node
	fence_mpath: update unique key info to say that it's per node and not per node/device

2016-08-17  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_scsi: correct 'devive(s)' typo

	fence_mpath: update unique key info to say that it's per node and not per node/device

2016-08-15  Marek 'marx' Grac  <mgrac@redhat.com>

	build: Do not test paths in metadata

2016-07-13  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Python 2.6 compatibility

	Fix install issue for symlinked agents

2016-07-06  Andrew Beekhof  <beekhof@Andrew-MBP16.local>

	compute: Prevent use of undefined variable

2016-06-29  Marek 'marx' Grac  <mgrac@redhat.com>

	build: clean-up of CLEAN_TARGET_ADDITIONAL

	build: Do not fail if manual/ exists

2016-06-27  Marek 'marx' Grac  <mgrac@redhat.com>

	build: Properly handle fence_ack_manual

	build: Fix release scripts

	build: Check if pywsman is installed

2016-06-22  marxsk  <mgrac@redhat.com>

	Merge pull request #78 from oalbrigt/fence_compute-indent-fix
	fence_compute: fix indent issue

	Merge pull request #79 from oalbrigt/fence_apc-fix-connection-timed-out
	fence_apc: fix for connection timed out issue

2016-06-22  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_apc: fix for connection timed out issue

2016-06-16  marxsk  <mgrac@redhat.com>

	Merge pull request #73 from vvidic/master
	fence_sbd: fix return value of fence functions

2016-06-14  Andrew Beekhof  <andrew@beekhof.net>

	compute: Correctly handle installations without tagged flavours

2016-06-07  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_compute: fix indent issue

2016-06-06  marxsk  <mgrac@redhat.com>

	Merge pull request #74 from oalbrigt/parallel-build
	Parallel build

2016-06-02  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_pve: fix indentation

	Parallel build

2016-06-02  Valentin Vidic  <Valentin.Vidic@CARNet.hr>

	fence_sbd: return value of fence functions is bool

2016-05-11  Marek 'marx' Grac  <mgrac@redhat.com>

	Merge branch 'master' of https://github.com/ClusterLabs/fence-agents

2016-06-02  marxsk  <mgrac@redhat.com>

	Merge pull request #34 from aspiers/fix/typos
	Fix a couple of typos

	Merge pull request #48 from credativ/install-fence_zvm.h
	Install missing fence_zvm.h into release tarball

	Merge pull request #75 from xtavras/fence_pve_fix
	this fix allows to use dedicated user for fencing, not only root@pam

	Merge pull request #69 from oalbrigt/onoff-cycle-cleanup
	onoff/cycle cleanup

2016-06-02  Andrew Beekhof  <andrew@beekhof.net>

	compute: Allow evacuation to be disabled
	instance-filtering = false
	 - nothing happens

	instance-filtering = true and no flavors or images tagged
	- evacuate everything for compatibility with OSP 8

	instance-filtering = true and at least one flavor or image is tagged
	- evacuate only the instances derived from those flavors and/or images

2016-05-27  Andrew Beekhof  <andrew@beekhof.net>

	compute: Correctly enable filtering and fix related bugs
	Enable tag based filtering when any images or flavors are found with the
	'evacuable' tag.  Otherwise continue to evacuate all instances.

	Also fix a number of bugs in the code that determines which instances
	should be evacuated.

2016-05-25  Stanislav Kopp  <stanislav.kopp@native-instruments.de>

	this fix allows to use dedicated user for fencing, not only root@pam

2016-05-25  marxsk  <mgrac@redhat.com>

	Merge pull request #67 from oalbrigt/scsi-shouldnt-reference-dm
	Remove reference to /dev/dm-X devices

	Merge pull request #68 from oalbrigt/fence_ipmilan-warning-about-success-before-node-is-powered-off
	fence_ipmilan: add warning that cycle method can report success before node is powered off

2016-05-18  marxsk  <mgrac@redhat.com>

	Merge pull request #70 from oalbrigt/python3-support
	Python 3 support

2016-05-10  Valentin Vidic  <Valentin.Vidic@CARNet.hr>

	fence_sbd: fix return value of fence functions
	sbd command exits with 0 on success but fence functions
	should return True in this case

2016-05-10  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_compute: Python 3 support

	Merge remote-tracking branch 'upstream/master' into python3-support

2016-05-09  Andrew Beekhof  <andrew@beekhof.net>

	fence_compute: fix expected metadata

	fence_compute: improved handling of compute nodes with/without FQDNs

2016-04-28  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	Python 3 support

2016-04-20  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	onoff/cycle cleanup

	Remove reference to /dev/dm-X devices

	fence_ipmilan: add warning that cycle method can report success before node is powered off

2016-04-07  marxsk  <mgrac@redhat.com>

	Merge pull request #65 from oalbrigt/travis-openwsman-fix
	travis: fix for openwsman test

2016-04-06  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	travis: fix for openwsman test

2016-03-22  Andrew Beekhof  <andrew@beekhof.net>

	Merge pull request #37 from vuntz/compute-options
	fence_compute: Add --insecure and --region-name command line arguments

2016-03-17  Andrew Beekhof  <andrew@beekhof.net>

	fence_compute: additional debug logging for when things go wrong

	fence_compute: Correctly locate all instances to be evacuated

2016-03-14  marxsk  <mgrac@redhat.com>

	Merge pull request #47 from credativ/zvm-help
	Print fence_zvm --help to stdout and exit with status 0

	Merge pull request #63 from disco-stu/fence_ipdu-syspath
	fence_ipdu: fix hardcoded FENCEAGENTSLIBDIR.

2016-03-13  Adrian Vondendriesch  <adrian.vondendriesch@credativ.de>

	fence_ipdu: fix hardcoded FENCEAGENTSLIBDIR.
	FENCEAGENTSLIBDIR was hardcoded to "/usr/share/fence".

2016-03-03  marxsk  <mgrac@redhat.com>

	Merge pull request #49 from oalbrigt/fence_amt_ws
	fence_amt_ws: new fence-agent

2016-03-03  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_amt_ws: new fence-agent

2016-02-11  Adam Spiers  <aspiers@suse.com>

	fix "foce" typo

	fix "it's" typo

2016-02-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: Update XML metadata

	fence_cisco_ucs: Add --missing-as-off

	fence_cisco_ucs: Obtain 'status' from different attribute

2016-02-06  Christoph Berg  <myon@debian.org>

	Install missing fence_zvm.h into release tarball

	Print fence_zvm --help to stdout and exit with status 0
	This makes fence_zvm --help conform with the other fence agents
	behavior.

2016-02-01  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: Obtain status of device from different endpoint
	Resolves: rhbz#1298430

2016-01-28  marxsk  <mgrac@redhat.com>

	Merge pull request #40 from oalbrigt/fence_scsi-fix-typo-in-short-desc
	fence_scsi: fix "persistentl" typo in short desc

2016-01-28  Oyvind Albrigtsen  <oalbrigt@redhat.com>

	fence_scsi: fix "persistentl" typo in short desc

2016-01-27  marxsk  <mgrac@redhat.com>

	Merge pull request #39 from kwaping/add_doc_link
	docs: added link to cluster wiki in README

2016-01-27  Ollie Ready  <kwaping@users.noreply.github.com>

	docs: added link to cluster wiki in README

2016-01-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_compute: Fix indentation
	Mixed indentation is not allowed with 'python -tt'

2016-01-07  Vincent Untz  <vuntz@suse.com>

	fence_compute: Add --region-name command line argument
	Useful for multi-region setups.

	fence_compute: Add --insecure command line argument
	This makes it possible to have fence_compute work with OpenStack
	deployments with SSL certificates that can't be verified (can be the
	case in test systems).

2016-01-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvmip: Fix makefile to work with dist* targets

2016-01-05  Andrew Beekhof  <andrew@beekhof.net>

	Merge pull request #33 from beekhof/master
	Instance HA fixes/improvements

2016-01-04  Andrew Beekhof  <andrew@beekhof.net>

	fence_compute: Status wont work if the control plane is not yet up

2015-12-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Replace hard reboot with direct call to libc

	fence_ipmilan: 'diag' action should not require setting --method=cycle
	When action is 'diag', set --method to cycle automatically.

2015-12-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Fix typo in reboo_cycle

2015-12-09  Andrew Beekhof  <andrew@beekhof.net>

	fence_compute: Correctly find instances assigned to a named compute node

	fence_compute: Logging improvements

	fence_compute: Correctly find the UUID of instances to be evacuated

	fence_compute: Fencing should fail if instances cannot be evacuated

	fence_compute: Just pass the uuid to _server_evacuate

	fence_compute: Record error codes from the Nova API

	fence_compute: Simplify option passing to _host_evacuate()

	fence_compute: Use the non-deprecated form for --update

	fence_compute: Log exception details in debug mode

	fence_compute: Make the instance filtering logic optional

2015-12-08  Andrew Beekhof  <andrew@beekhof.net>

	fence_compute: Update expected metadata

	fence_compute: Update metadata

	fence_compute: Support a present-but-disabled mode

2015-12-03  Andrew Beekhof  <andrew@beekhof.net>

	fence_compute: Do not default to evacuating all instances if none are flagged

	fence_compute: Perform a real status operation in record-only mode

	fence_compute: Advertise ourselves as a fabric device to prevent reboot operations

	fence_compute: Match compute nodes as both FQDN and host names

2015-12-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Add action diag
	Previous version of fence_ipmilan (C-based) contains also action 'diag'. This commit adds this action to new fence agent.

	Resolves: rhbz#1286045

2015-12-02  marxsk  <mgrac@redhat.com>

	Merge pull request #32 from kwaping/readme_update
	README wording update

2015-12-01  Ollie Ready  <kwaping@users.noreply.github.com>

	README wording update

2015-11-19  Fabio M. Di Nitto  <fdinitto@redhat.com>

	Merge pull request #27 from aspiers/fix/evacute-typo
	fix 'evacute' typo

2015-11-18  Adam Spiers  <aspiers@suse.com>

	fix 'evacute' typo
	This requires the corresponding fix in NovaCompute and NovaEvacuate.

2015-11-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fix

	cleanup

	next

2015-11-12  Marek 'marx' Grac  <mgrac@redhat.com>

	refactor login

2015-11-09  Marek 'marx' Grac  <mgrac@redhat.com>

	it is working: apc, lpar4, blade, brocade

	working LPAR

2015-11-05  Marek 'marx' Grac  <mgrac@redhat.com>

	simplify

	autodetect: simplify

	Autodetect init

2015-11-04  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Log when cmd-line argument is not used
	Fencing library parse sys.argv[] but it is possible that not all of the arguments will be used. Left arguments are user's mistake but user has to know about it. Warning was added for these cases (usually multiple values for one paramater or parameter without leading --)

2015-10-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvm: Manual page for fence_zvm
	Normally, manual pages are generated directly from fence agent. In this case, we have manual page
	still in a static file.

	fence_zvm: Re-enable fence_zvm agent

	fence_ipmilan: Revert default value for --power-wait to 2 seconds
	Resolves: rhbz#273632

2015-10-23  marxsk  <mgrac@redhat.com>

	Merge pull request #26 from johnruemker/brocade-fix_get_power_status_return
	fence_brocade: Fix incorrect return when getting status for "on", "off"

2015-10-22  John Ruemker  <jruemker@redhat.com>

	fence_brocade: Fix incorrect return when getting status for "on", "off"

2015-10-19  marxsk  <mgrac@redhat.com>

	Merge pull request #25 from sbauza/instance_selectivity
	Allow to select which instances to evacuate

2015-10-14  Sylvain Bauza  <sbauza@redhat.com>

	Allow to select which instances to evacuate
	In order to select which instances could be evacuated automatically,
	the instance has to have either:
	 - a flavor where one extra spec key is "evacuate" with "True" as value
	 - an image where a metadata key is "evacuate" with "True" as value

	In case one instance is neither having a flavor or an image like that,
	the instance won't be evacuated.

2015-10-12  marxsk  <mgrac@redhat.com>

	Merge pull request #24 from sbauza/mark_host_down
	fence_compute: Set mark host down flag if possible

2015-10-12  Sylvain Bauza  <sbauza@redhat.com>

	Set mark host down flag if possible
	Since Nova API version 2.11, there is now a new novaclient tool
	that allows to bypass the servicegroup check and not wait for it
	to catch the right host liveness. Using it as a first try and if
	failing, fallbacking to the existing polling.

2015-10-12  marxsk  <mgrac@redhat.com>

	Merge pull request #22 from krig/fence_vbox
	fence_vbox: Add a fencing agent for VirtualBox

2015-10-12  Kristoffer Grönlund  <krig@koru.se>

	fence_vbox: Add a fencing agent for VirtualBox
	Adds a fencing agent for virtual machines managed by VirtualBox.

	Based on fence_virsh, tested with VirtualBox version 5.0.4 on
	openSUSE 13.2.

2015-09-30  marxsk  <mgrac@redhat.com>

	Merge pull request #21 from HideoYamauchi/master
	Low:The error output when operator failed in the practice of the command.

2015-09-30  Hideo Yamauchi  <renayama19661014@ybb.ne.jp>

	Low:The error output when operator failed in the practice of the command.
	When setting of Docker is necessary, a message of Docker is displayed by
	on commands.
	However, fence_docker does not display it.
	This patch displays a result when "Cannot parse json" error happened.

2015-09-25  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_docker: Add option to set Docker Remote API

	fence_scsi: Install fence_scsi_check_hardreboot

2015-09-25  marxsk  <mgrac@redhat.com>

	Merge pull request #20 from johnruemker/scsi-check_hardreboot
	fence_scsi: Offer hard-reboot option for fence_scsi_check script

2015-09-24  Adrian Vondendriesch  <adrian.vondendriesch@credativ.de>

	fence_sbd: Add a fencing agent for sbd
	Add a STONITH agent for SDB (STORAGE BASED DEATH).


	Add option --sbd-path & XML metadata

	Remove magic numbers

	--delay should work as expected

	one more magic number

	Use "method" from fencing library

	fence_sdb: rename parameter --sbd-devices

	Rename --sbd-devices to --devices. Other agents have identical parameters and
	call them "--devices". So keep this parameter equal over the different fencing
	agents.

	fence_sbd: Update fence_sdb xml data.

	Update fence_sbd xml meta data to catch up with the current state.

2015-09-24  John Ruemker  <jruemker@redhat.com>

	fence_scsi: Offer hard-reboot option for fence_scsi_check script
	The existing implementation of fence_scsi_check returns an error if any
	device is no longer registered properly, and this error return causes
	watchdog to use its custom procedure to reboot the host.  This procedure
	is prone to blocking, especially when GFS2 file systems are mounted or
	multipath devices are configured to queue indefinitely, so having the
	check be able to hard-reboot the host instead of returning a failure
	gives a means for avoiding these blockages.

2015-09-23  marxsk  <mgrac@redhat.com>

	Merge pull request #19 from johnruemker/scsi-reset_before_getkeys
	fence_scsi: Reset device prior to all uses of sg_persist

2015-09-22  John Ruemker  <jruemker@redhat.com>

	fence_scsi: Reset device prior to all uses of sg_persist
	Currently the agent will reset prior to several areas where it runs
	sg_persist, to clear out any "Unit Attention" conditions that could
	otherwise cause the sg_persist command to report failures.  However
	several paths remain that could fail if a "Unit Attention" condition
	exist, so we should reset before any use of sg_persist.

2015-09-10  Marek 'marx' Grác  <mgrac@redhat.com>

	fence_apc: Support for v6.x firmware
	There are no changes in interface, so it is enough to accept new version number.

	Login process over telnet has changed a bit and autodection of EOL did not work properly. Relevant part
	of changed so it work correctly when after empty 'User Name', the device ask for it again.

2015-09-07  marxsk  <mgrac@redhat.com>

	Merge pull request #14 from mbaldessari/amt_fix
	Fix AMT fence agent

2015-08-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ilo: If gnutls can not open connection than --tls1.0 is tried in second attempt
	Resolves: rhbz#1256902

2015-08-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_virsh: Fix --missing-as-off
	Patch 0aacfcf209c473ab4c1fff4de653a673b92484de was pushed unintentionally before tests were done.

	testing: Start using Travis CI

	fence_virsh: Add --missing-as-off option
	Resolves: rhbz#1254821

2015-08-17  Marek 'marx' Grac  <mgrac@redhat.com>

	testing: Improve tests for --delay
	(and fix fence_dummy that was broken)

	fence_mpath: Update XML metadata to match changes in --devices

	fence_mpath: --devices is required argument
	In the fence_scsi this argument is not required because it can be automatically determined.
	This is not yet valid for fence_mpath.

	fence_scsi: Watchdog script should pass on a system that is not configured

2015-08-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_mpath: Fix unfencing problems when /var/run/cluster is removed and monitor these files
	This patch solves same problem as 2f1be046c0c880ec14caff2193b4daa18bcecab7 and 5b3c2b26e5dfa4784d44ac875c7780495bacdde8
	for fence_scsi.

2015-08-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Actions 'list-status' and 'validate-all' were not documented in manual pages

2015-08-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Do NOT check if --plug is used together with --port-as-ip for stdin input
	On STDIN input it should be ignored as other unknown parameters.

2015-08-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Fence library should work correctly also when power state is None
	Previously, valid states ON/OFF were accepted and all other values were mapped to UNKNOWN. But if value is None then
	it is not possible to do state.upper() and fencing fails.

	Resolves: rhbz#1251491

2015-08-09  Michele Baldessari  <michele@acksyn.org>

	Fix AMT fence agent
	The 'amttool' command takes the AMT_PASSWORD environment variable.
	When amttool prompts for a confirmation the variable is read only
	by the left side of the pipe command:
	- Broken:
	$ AMT_PASSWORD='foobar' echo 'y' |  /usr/bin/amttool nuc2 powerdown
	401 Unauthorized at /usr/bin/amttool line 129.
	- Working:
	$ AMT_PASSWORD='foobar' sh -c "(echo 'y' | /usr/bin/amttool nuc2 # powerdown)"
	execute: powerdown
	result: pt_status: success

	A longer-term fix is to remove the amttool dependency and implement the
	calls directly via the python-openwsman package

2015-08-07  marxsk  <mgrac@redhat.com>

	Merge pull request #13 from GamerSource/united_fixes
	Default to SSL to comply with pve and fix typo

2015-08-07  Thomas Lamprecht  <t.lamprecht@proxmox.com>

	Default to SSL to comply with pve and fix typo
	SSL encrypted communication, so we set it as
	default. As pve generates a self signed certificate we set
	insecure ssl as default option. A unencrypted connection is rejected
	by the PVE proxy so it isn't needed as an option.
	Also a typo (opts instead of options) was corrected.

2015-08-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: update XML to conform --ip-as-port where both ip and port are optional
	These values are used in pacemaker to determine if arguments are specified.

	fence_rcd_serial: Add support for delay

	fence_rcd_serial: Fix Makefile to contain proper test args

	fence_dummy: Update XML metadata and fix its creation
	fence_dummy is special because 'port' in device_opt is removed at the run-time
	according to other option.

	fence_rcd_serial: Add regression XML tests

	fence_virsh: Update XML metadata to match df21ebbee6a328dcacdf60a65cf34e4742a73aa8

	fencing: When --port-as-ip is used both IP and plug should not be required
	Resolves: rhbz#1214522

	fence_rcd_serial: Fix & in documentation

2015-08-05  marxsk  <mgrac@redhat.com>

	Merge pull request #11 from sammcj/master
	fence_rcd_serial: update description, makefile & add circuit diagram

2015-07-28  Sam McLeod  <samm@infoxchange.net.au>

	update description, makefile & add circuit diagram

2015-07-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rcd_serial: Add new fence-agent to build system

2015-07-27  marxsk  <mgrac@redhat.com>

	Merge pull request #10 from sammcj/master
	New / re-write of the rcd_serial fence agent

2015-07-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Password was awaited twice in some cases when connecting via telnet
	Regression by commit 364de00cdd7619ad65f5eabdab2d8499d448045d

	fencing: If --port-as-ip is used then monitor action should be 'status', not 'list'

2015-07-23  Sam McLeod  <samm@infoxchange.net.au>

	update fence_rcd_serial.py from RH

2015-07-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add device_opt for no_on, no_off
	Useful for devices that can't do ON/OFF. Usually they can do reboot only

	fencing: reboot_fn should work also with no_status

	fencing: Monitor action should pass with "no_status"
	If fence device does not have multiple ports then 'status' action is doing during
	'monitor' action. If device has 'no_status' option then it is not possible to do
	the 'status' but monitor should not fail as this is expected.

	fencing: Do not add --port-as-ip when --ip is not present

2015-07-22  Sam McLeod  <samm@infoxchange.net.au>

	Add fence_rcd_serial

2015-07-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Monitor action checks also existence of files with SCSI keys

	fencing: Add option that forces ON even if machine is already ON
	This feature is required for fence_scsi when we have to do unfencing after reboot even
	if node was not fenced at all. Keys for SCSI are stored in /var/run/cluster and so they
	have to re-created.

2015-07-12  marxsk  <mgrac@redhat.com>

	Merge pull request #9 from disco-stu/master
	fence_virsh: escape "EXPECT" string.

2015-07-11  Adrian Vondendriesch  <adrian.vondendriesch@credativ.de>

	fence_virsh: escape "EXPECT" string.
	Escape EXPECT string to prevent nroff error "warning: can't find special
	character `EXPECT\'`"

2015-07-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Do not print password to debug info
	Resolves: rhbz#1241648

2015-07-01  Marek 'marx' Grac  <mgrac@redhat.com>

	tests: Update XML metadata for changed agents

2015-06-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_compute: Update version to be sync with out-of-tree tested versions

2015-06-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_compute: add support for recording fencing operations in attrd
	This is required to support multiple compute nodes failure at once
	with controller node failures happening at the same time.

	compute: add support for endpoint-type

	fence_compute: fix on-shared-storage option parsing

2015-06-18  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvmip: Update XML metadata with --missing-as-off

	fence_zvmip: Change used API methods
	* monitor -> check if authentication works instead of list
	* status -> check individual plug only

2015-06-17  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_hpblade: Add support for HP Integrity Superdome X (BL920s)

2015-06-03  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add verbose output also before command-prompt is found
	Previously, it was not possible to get information about connection (or error messages)
	before connection was established. After this patch, it is possible to see problems if
	verbose output is enabled.

2015-05-20  marxsk  <mgrac@redhat.com>

	Merge pull request #5 from credativ/fix-whitespace
	Fix bad whitespace in lpar, mpath and zvmip agents

	Merge pull request #6 from rtheys/rhevm
	fence_rhevm fixes

2015-05-19  Rik Theys  <Rik.Theys@esat.kuleuven.be>

	fence_rhevm: Fill in outlet status in get_list
	The outlet status was set to None for all outlets. This results in a
	traceback in fencing.py as it tries to execute the upper() function on
	the status. This is fine when the account that tries to access the data
	is an admin account as the list will be empty. If a UserRole user is
	used, the vm list is not empty and the error occurs.

	Fill in the status of each vm in the outlet status to prevent the
	traceback.

	fence_rhevm: Add Filter header
	oVirt users who only have the UserRole role don't have enough privileges
	to query the vm list, unless the Filter header is set to true.

	See rhbz#1102801 for details.

2015-05-18  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_compute: Fix status if node is off

2015-05-15  Christoph Berg  <myon@debian.org>

	Fix bad whitespace in lpar, mpath and zvmip agents

2015-05-14  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_compute: Fence agent for Nova compute machines
	Author: Andrew Beekhof

2015-05-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add warning if line on STDIN is ignored because of missing value

2015-05-06  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] Update makefiles so tests can be executed in parallel
	Previously, tests can not be executed in parallel because they were using simple temp file
	per one directory.

2015-04-27  marxsk  <mgrac@redhat.com>

	Merge pull request #4 from johnruemker/scsi-status_all_devices
	fence_scsi: status should return off if any device is off

2015-04-27  John Ruemker  <john.ruemker@gmail.com>

	fence_scsi: Status report "off" if any device is off during "on" action
	We need status to report "on" if any device is on most of the time so
	that stonith or other entities can know if a host is capable of
	accessing shared resources, but during an "on" action this is
	problematic because even if some devices are off, we will skip turning
	them on since we reported the status as on.  This changes the behavior
	to report "off" if any device is off, but only during "on" actions.

2015-04-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Introduce option --port-as-ip (port_as_ip on stdin)
	Pacemaker's mapping between fence devices and appropriate ports works fine. But if
	fence device is used only for single device (IPMI, iLO, DRAC, ...) then configuration
	is more complex. With this new option, user can use --plug/-n/port to specify IP address
	what simplify configuration.

	[refactor] Allowed values for options are now automatically added to manual page

	[refactor] Line wrapping in --help is done automatically

	[refactor] Remove "shortdesc" that changes regression tests

	[refactor] Remove "shortdesc" from option definition if it can derived automatically
	Previously, each "option" has also "shortdesc" argument that was used exclusively
	for purpose of XML metadata (and subsequentally also manual pages and user interface).
	This commit prepares code for automatic derivation and remove those shortdesc where results
	does not change XML metadata regression tests.

2015-04-22  marxsk  <mgrac@redhat.com>

	Merge pull request #3 from johnruemker/scsi-monitor
	fence_scsi: Add support for monitor action

2015-04-20  John Ruemker  <john.ruemker@gmail.com>

	fence_scsi: Add support for monitor action

2015-03-26  Marek 'marx' Grac  <mgrac@redhat.com>

	[test] Update XML metadata for SSL fence agents

	fence2rng.xsl: Correctly handle quotes in description

	[test] Test if XML metadata are valid after fence2rng.xsl

2015-03-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Un-set default cipher
	Previously, the default cipher was left to ipmitool, in one of latest releases we have changed it
	to cipher=0. This commit removes this default and uses --cipher for ipmitool only when explicitly
	set by user.

	Resolves: rhbz#1203877

	fence_bladecenter: Fix login process
	fence_bladecenter is specific because motd contains string "Last login:" which
	can be easily mishandled with "login:". This dual checking is included to properly
	work with CR/LF autodetection.

2015-03-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_amt: Password was not put correctly into environment

2015-03-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add support for --tls1.0
	HP iLO2 firmware 2.27 has broken implementation of TLS and SSLv3 is disabled by default.
	gnutls (3.4.x) has support to disable proper negotiation and use only TLS1.0 that works well.

	Option --tls1.0 (tls1.0 on stdin) was added to enable this feature and fence_ilo(2) works
	correctly also with this firmware.

2015-03-05  marxsk  <mgrac@redhat.com>

	Create README

2015-03-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Wrap line with actions in --help

2015-03-04  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add operation 'list-status'
	This new action will report output similar to 'list' with 3rd column that
	represents status of node = ON/OFF/UNKNOWN. Majority of relevant fence agent
	is supported.

	Exceptions are:
		'list' is not working at all
			fence_ovh, fence_scsi, fence_mpath
		'list-status' reports 'UNKNOWN' status all the time
			fence_lpar
			fence_ifmib
			fence_bladecenter
			fence_hds_cb
			fence_cisco_ucs
			fence_eaton_snmp
			fence_netio
			fence_rhevm

	fencing: Propagate 'list' only when it makes sense
	Previously, action 'list' was propagagated also for fence agents which
	work with only one machine, so list makes no sense. Return was always N/A.

	This was done together with simplification of removing duplicity code.

2015-03-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Operation 'validate-all' should not change default behaviour
	Previously included patch has issue for fence agents that have 'other_conditions=True'. In such
	case fence agent did not stop when problem was encountered even when validate-all action was not
	used.

	fencing: Add alias 'meta-data' as proposed in OCF standard
	Actions 'meta-data' is just an alias to 'metadata'.

	fencing: Add operation 'validate-all'
	Previously, user had to run fence agent in non-destructive mode to find out
	if parameters are correct or not. With this commit, the action 'validate-all'
	(required by OCF) is added and parameters that can be checked without connecting
	to real hardware are tested.

	As a bonus of this approach, if there are several problems, user will know all
	of them at once what is a benefit also for user interfaces.

	fence_kdump: Fix possible problems according to Coverity
	Previously, there was issue detected by Coverity. They do not matter too much
	because we care only about return value and it will not be 0 if program crash.
	But it is always better to have clean code, so fixing.

2015-02-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing_snmp: Path to snmp(walk|get|set) can be set at runtime

	fencing_snmp: Replace device_opt "community" with "snmp"
	Previously, all dependencies of SNMP fence agents were dependant on "community". What
	is quite confusing. This update makes all original depencies + "community" be dependant
	on "snmp".

	fence_kdump: [test] Update XML metadata pattern after adding "monitor"

	fence_kdump: Fix problem in metadata

2015-02-25  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_kdump: Add 'monitor' action which tests possibility of doing kdump on local node
	In case of fence_kdump we can not test if remote 'fencing device' is working because
	fence_kdump_send is started only after kernel crash. So, monitor action checks if LOCAL
	node can enter kdump. The test looks if crashkernel=.. occurs between boot arguments.

2015-02-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Default values of ipport in metadata
	Default values were correctly set but they were not used in metadata after
	previous patches.

2015-01-14  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: default values for ipport #2 (--ssl-insecure, SNMP agents)
	Previous patch of this problem:
		* did not solve problem was --ssl-insecure
		* did not work correctly with minimalist SNMP agent where snmp_version can not be set

	Problem found using unit-tests.

	[test] First attempt on unit-tests for fencing library
	Focus was on unit-testing parts responsible for setting default values as
	was reported in 575cbe08a6077ecc1512ceaecfc964378c1a11a6

	fencing: default value for ipport was not always correct
	Correction of metadata output lead to situation when default value of
	ipport was not properly set e.g. if --ssh was not default, it's value
	was ignored. This update, moves setting default value to proper function.

2015-01-08  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] Replace using $AWK for different use then awk binary

	fence_apc_snmp: New symlink fence_tripplite_snmp for already supported device

2015-01-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_mpath: Fix duplicate "getopt" which was not propagated anywhere
	Found by integrated tests.

	fencing: Validate if short "getopt" of available options is unique

	fence_zvm: Manual page is obsoleted because it is autogenerated now

	fencing: Short options can be misinterpreted
	If there are several entries in all_opt that have same short getopt. It
	is possible that they are handled incorrectly and they are stored under same
	key in 'options' variable.

	This update fixes this problem for cases when the other of all_opt entries should
	not be present at all. E.g. -d is used for vmware_type and snmp_version, and they are
	not allowed at same time.

2015-01-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvmip: Port fence agent to fencing library
	This rewrite adds a correct result codes, support for 'list' action and
	autogenerated manual page. The original code is still part of codebase as
	new agent requires additional testing.

2014-12-15  Marek 'marx' Grac  <mgrac@redhat.com>

	[refactor] Function  _get_opts_with_invalid_choices(...)

2014-12-08  Marek 'marx' Grac  <mgrac@redhat.com>

	[refactor] Function _parse_input_cmdline(...)
	Simplify and remove code for adding also short names to final dict. This is no
	longer needed and only long names are entered there.

	library: Properly escape XML also in getopt mixed=".."

	fence_emerson: Add power-wait=5seconds because device is too fast

2014-12-04  Marek 'marx' Grac  <mgrac@redhat.com>

	[refactor] simplifying function metadata() + fix XML for fence_cisco_ucs
	Two if-s where removed as they are no longer needed by fence agents. One of
	its impact was that two fence agents has changed their XML metadata. In case
	of fence_ovh it was because default value was set even when it should not be.
	And in the case of cisco_ucs, default was not propagated properly because
	it was empty string.

	fence_emerson: New fence agent for Emerson's devices MPX and MPH2
	Thanks to Emerson Network Power

	fence_eps, fence_amt: Fix invalid default port values

	[refactor] Function _update_metadata(..)

	[refactor] function process_input(..)

	[refactor] function metadata(..)

	[refactor] function check_input(..)

	[refactor] Functionality of fence_login(...) was too broad
	New 'private' functions were created for opening ssl connection, telnet,
	ssh with password and ssh with identity file

	[refactor] remove unused variable

2014-12-03  Marek 'marx' Grac  <mgrac@redhat.com>

	[refactor] Change definition of log_expect() method
	Previously, log_expect definition was:
	    def log_expect(self, options, pattern, timeout):

	but the 'options' where not used anywhere and if we will plan to use it in this method,
	we already have self.opt available. New method definition is:
	    def log_expect(self, pattern, timeout):

	the rest of this large patch is just removing of options as 1st argument of every call

	[refactor] Fix issues according to pylint

	[refactor] Fix issues according to pylint

2014-12-01  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ilo_ssh: Add XML regression test data

	fence_mpath: Do not run regression test on store_path value
	This is not possible because unlike the other paths this one
	is dependant on ./configure --prefix XXX. With this patch,
	line with value will be removed.

	fence_mpath: Update XML metadata

	fence_scsi: Update XML metadata

	fence_ilo_ssh: Create symlinks for fence_ilo3_ssh and fence_ilo4_ssh
	Resolves: rhbz#1121122

	fence_ilo_ssh: Create symlinks for fence_ilo3_ssh and fence_ilo4_ssh
	Resolves: rhbz#1121122

	fence_ilo_ssh: Change EOL to \r
	Previously, we have used \r\n that works fine with iLO3 with firmware >=1.50 but
	for iLO4 all firmware that we have tested works only with \r

	Resolves: rhbz#1121122

2014-11-27  Marek 'marx' Grac  <mgrac@redhat.com>

	[fencing] Character \x00 can't be inside syslog message

2014-11-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_bladecenter: Simplify login process
	Previously, unique regular expression was used what could cause problems in
	planned autodetection of fence agents.

	fence_cisco_ucs: protocol prefix of URL was not correctly set with --ssl-(in)secure
	Resolves: rhbz#1165591

	fencing: Fix problem with not validating SSL certificates
	In commit 809b909651118c06d2ab48d7911bbee2e512e478, --ssl-(in)secure options were
	added. With --ssl be equal to --ssl-secure this was not implemented properly.

	Resolves: rhbz#1162092

	fence_mpath: new fence agent for dm-multipath based on mpathpersist
	Previously, scenario with multipath and underlying SCSI devices was solved by using
	fence_scsi what works correctly but there are some limitation. The most important
	is that unfencing has to be done when all paths are available as it is executed only once.
	This new fence agent solve this situation properly as most of this situations are solved
	by mpathpersist which is part of dm-multipath.

2014-11-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: "order" value of *_path should be same as in library

	fencing: Introduce --gnutlscli-path --sudo-path --ssh-path and --telnet-path
	Previously, those four variables were set as global options. Proposed change
	unify the working with them as with standard options with appropriate default
	value (provided by autoconf).

	This patch is quite long because XML metadata has to be changed to contain those
	options were appropriate.

	fencing: Improve accessibility of possible connection (+telnet,+web)
	'web' was previously not set properly on each fence agent
	'telnet' is completely new option

	fencing: Some short options were not propagated, so they were removed
	In old versions, it was required to have short getopt options (-k, -x, ...) for
	each option available. This is not true for some time but these options
	were defined also for options were they were not really used and long options were
	the only presented.

	Main reason for removing this short options from specific options was that some
	of them were really overloaded.

	fence_scsi: Short getopt for logfile differs in help/getopt
	According to help text, user should use -a for setting logfile but
	this option means 'APTL flag", this patch fixes it to -f as was accepted
	also before.

	fencing: Stability of sort of items in XML metadata
	Previously, sorting was done only according to values in "order" but
	if several items have same "order" value then they were sorted same way
	only until something did not interfere it. In order to have XML metadata
	more stable, the secondary attribute for sorting - stdin name of attribute.

	Problem was visible only during regression testing of XML metadata as ordering
	did not usually impact applications that reuse it.

	The patch is long but the only real change is in lib/fencing.py.py, the
	rest is just reordering without further changes.

2014-10-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Available actions in --help where not always up-to-date
	Previously, we have different help text for action only for fabric fencing (no-reboot). But
	we have fence agents that do not have 'status' action e.g. fence_ovh. With this update,
	the help text is always accurate.

	fence_zvm: Add support for 'monitor'
	Author: Neale Ferguson

	[build]: Add build requirements to autoconf

2014-10-16  Marek 'marx' Grac  <mgrac@redhat.com>

	[test] Update XML metadata

	[build] During clean up stage remove also *.wiki files

	[build] Fix paths in process of building releases

	[build] fencing library: Add fence2wiki.xsl as XSL in Makefile.am

	[test] fence_ilo_ssh: Add required parameter for testing --delay

2014-10-15  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rhevm: Add support for cookies based authentication
	The first command is authenticated as usually but rest can be used without additional authentication.
	This is useful only for reboot or obtaining status of several nodes at once.

2014-10-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_pve: Add support for --ssl-secure and --ssl-insecure
	Resolves: rhbz#1151515

2014-10-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_wti: Fix invalid "eol"
	Fence agent for WTI does not use standard telnet login because it is possible that username/password are not
	required. EOL is set by fence_login() function that is not used, so we set it manually and replace
	obsolete combination of send (+eol) to correct send_eol()

	Resolves: rhbz#1148762

	fence_rsb: Fix 62d90e3a0827fcdc5be632bdf4103d3c08b39622
	Patch was not incorporated correctly from older version.

	Resolves: rhbz#1110428

2014-09-24  Marek 'marx' Grac  <mgrac@redhat.com>

	[doc] Improve wiki export

2014-09-22  Marek 'marx' Grac  <mgrac@redhat.com>

	[doc] Improve wiki export

	fence_apc: --shell-timeout was used instead of --power-timeout

2014-09-18  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] Unify make clean

	[build] Add XSLT for creating wiki

	[build] Create a new target for wiki export
	Create a list of arguments in wiki format

2014-09-17  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] fence_scsi_check is generated during build time

	fence_rhevm: Use https:// prefix also with --ssl-secure and --ssl-insecure

2014-09-15  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvm: Add support for 'on', improve documentation
	Author: Neale Ferguson

2014-09-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvm: Fixes for better upstream inclusion

2014-09-08  Marek 'marx' Grac  <mgrac@redhat.com>

	[clenaup] Fix whitespace convention issues

	fence_cisco_ucs & fence_vmware_soap: Logout has to be performed even when fencing fails
	Previously, logout was not performed in the case when fence agent was aborted e.g. timeout. What could
	lead to a situation when connections were not closed correctly. In the extreme case, it was not possible
	to log into device at all

	Resolves: rhbz#1111599

2014-09-03  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ilo_ssh: New fence agent for HP iLO3/4 via SSH
	Resolves: rhbz#1121122

2014-09-01  Marek 'marx' Grac  <mgrac@redhat.com>

	[tests] Update XML metadata of fence agents
	added --ssl-secure, --ssl-insecure

	fencing: Add new options --ssl-secure and --ssl-insecure
	These new options extends current --ssl (same as --ssl-secure). Until now certificate of the fence device
	was not validated what can possibly lead to attack on infrastructe. With this patch, user can decide
	if certificate should (--ssl-secure) or should not (--ssl-insecure) be verified.

	The default option is to validate certificate.

	Resolves: rhbz#1072564

2014-08-27  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] Fix automake files, so 'make distcheck' works

	fence_ilo_moonshot: Add current XML metadata to test suite

	fence_zvm: Add current XML metadata to test suite

	fence_zvm: Add support for "on" and "status"
	Developed by: Neale Ferguson

	fence_ilo_moonshot: New fence agent for HP Moonshot iLO
	Resolves: rhbz#1099551

	fence_apc_snmp: Add support for firmware 6.x
	Resolves: rhbz#1123897

	Fix usage of non-existent function

2014-07-14  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: 'nodename' should not be logged as ignored argument
	nodename is send by default, so there is not reason to log it.

2014-07-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Replace syslog.syslog() calls with new logging handler
	Original logging handler for syslog writes everything to a device but that
	way we will have incorrect source. New logging handler is created on top
	of standard old-style syslog library.

2014-07-01  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Monitor is not working correctly without 'list' or 'status'
	Action monitor either executes 'status' (without --plug) or 'list' (with --plug). But
	it is not required to have 'list' action. If they do not then 'monitor' has to be done
	in different way, e.g. login/logout.

	fence_brocade: Add support for 'list' action

	[build] Fix building of fence_scsi_check

	[build] Fix build system to cover tests properly

2014-06-26  Ondrej Mular  <omular@redhat.com>

	fence_docker: new fence agent for Docker containers
	With support for TLS authentication.

2014-06-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Fix problems with options without short getopt

	[build] Ensure that we are building in correct directory

2014-06-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Checking status of several slots was done incorectly
	Found-by: Ondrej Mular

2014-06-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rsb: Accept new prompt in parsing
	Resolves: rhbz#1110428

2014-06-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Remove unmaintained fence agents
	Following agents were removed:
	fence_baytech
	fence_bullpap
	fence_cpint
	fence_mcdata
	fence_rackswitch
	fence_vixel
	fence_xcat

	[testing] Add XML metadata for fence_scsi

	fencing: Fix problems when fence agent do not have --plug / -n
	Found during tests on fence_dummy

2014-06-04  Marek 'marx' Grac  <mgrac@redhat.com>

	[clean] set_multi_power_fn now also includes support for --retry-on
	Previously, the code was there multiple times.

2014-05-21  Marek 'marx' Grac  <mgrac@redhat.com>

	testing: Update XML metadata for fence_zvmip

	testing: fence_zvm agent is tested for working delay function
	also adds support for checking --delay for every C-based fence agent

	fence_zvm: Add support for --delay in fence_zvm
	Patch by: Neale Ferguson

2014-05-14  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvm: Add a zvmsys option to fence_zvm to support distributed z/VM systems
	Also emove spurious crlf in CRLF

	Author: Neale Ferguson

	fence_scsi: --delay should be applied before attempt to test available devices

	fence_scsi: Do not use SYMTARGET for fence_scsi_check
	SYMTARGET in Makefile.am should not be used becasue fence_scsi_check is not a
	fence agent and so the tests will fail.

2014-05-14  Ondrej Mular  <omular@redhat.com>

	fence_scsi: port to fencing library

2014-05-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_pve: Add testing arguments for --delay test

	fence_ovh: --delay should be applied before attempt to login

	fence_ovh: Fix problems according to patch in mailing list.

	testing: python agents are tested for working delay function

	[cleanup] Fix whitespace according to PEP8

	[cleanup] function array_to_dict() from agents to library

	[cleanup] '--action' should be normalized to lowercase at one place only

	[cleanup] Simplify 'if' statements to use 'not' and 'get'

2014-05-05  Ondrej Mular  <omular@redhat.com>

	fence_pve: new fence-agent for Proxmox VE
	Thanks to Frank Brendel (author of original perl fence_pve) for help with writing and testing this agent.

	fencing: added option "on_target"
	added option "on_target" for agents that need attribute "on_target" in metadata

2014-04-23  Marek 'marx' Grac  <mgrac@redhat.com>

	[cleanup] Create function fence_logout()
	This function replaces almost all logout functions. Exception is in
	fence_sanbox2 where two lines are required for exit.

	[cleanup] Remove unused import of modules

	[cleanup] Add broad exception specification for each except

	fencing: Add support for --delay for all python SNMP fence agents

	fencing: Add support for --delay for all python non-SNMP fence agents

	fencing: Introduce new device option 'no_status'
	Some fence agents are not able to obtain status e.g. fence_ovh or fence_kdump,
	with this patch this can be reflected in metadata. Also fix for fence_ovh.

	[cleanup] Removing unused part which was replaced by proper 'default' values for 'ipport'

	[cleanup] Remove method log_command() from FencingSnmp as it was replaced by logging.debug()

	[cleanup] Remove warning logging-not-lazy

2014-04-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Pexpect problems - missing return statement
	Previusly pexpect.send() returned value which was not used anywhere, with new version this is no
	longer true and our inherited class fspawn has to return proper values (length of the written string)

	fencing: Fix invalid parsing in XML metadata
	This error has no functional impact on fence agents integration.

	fencing: ipport defaults was set after defaults were used
	SNMP fence agents were influenced - introduced in 91dcb051959c5e70094cbb3c5b5243e4a328d8bc

	[cleanup] Replace vmware_log() with direct call of logging

	[cleanup] Remove additional parentheses

	[cleanup] Replace map/filter by list comprehensions

2014-04-14  Ondrej Mular  <omular@redhat.com>

	fence_amt: sending password over env

	fencing: added timeout and env parameters to run_command function
	Now, we can set enviromant variables and maximum execution time for subprocess.

2014-04-11  Marek 'marx' Grac  <mgrac@redhat.com>

	[cleanup] Cleaning in fence_raritan
	Previous set of patches was prepared without this new fence agent.

	fence_vmware: Invalid arguments for vmware_get_outlets_vi()
	Fence agent was not working correctly for VMWare ESX because function vmware_get_outlets_vi()
	was called with additional arguments.

	[cleanup] Define parent class even if it is object
	Resolve warning: old-style-class

	[cleanup] Add missing spaces

	fencing: Refactor access to 3rd-party binaries
	Previously, we had just one fence agent of that type that was ported to
	fencing library. Now, there are fence_amt and fence_ipmilan so it is possible
	to create a more generic version of such access.

2014-04-11  Ondrej Mular  <omular@redhat.com>

	fence_ipmilan: send empty password, if password is not entered
	Previously, agent stuck on password prompt from ipmitool, if password was not specified.

	Resolves: rhbz#1083600

2014-04-09  Marek 'marx' Grac  <mgrac@redhat.com>

	[cleanup] remove LOG_MODE_*
	These constants can be removed because they were replaced by logging.* subsystem.

	[cleanup] fence_wti: Fix variables that can be used before assignement

	fence_wti: Action 'list' prints also named groups
	Resolves: rhbz#1085887

	[cleanup] Fixing small issues created during cleaning phase

	[cleanup] Fix invalid names of variables

	[cleanup] Remove transfer script used in transition 3.x->4.x

	[cleanup] Remove unused arguments
	Arguments 'options' which will be used instead of global variables are left untouched
	so that this problem is visible.

	[cleanup] Remove snmp_define_defaults()
	This function is always called for SNMP fence agents so it is possible to run it automatically.

	[cleanup] Mark raw strings with r"" in fence_virsh

	[cleanup] Errors when encountering mixed space/tab in python

	[cleanup] Only symbols that should be used are exported from fencing_snmp library

	[cleanup] Mark raw strings with r""

	[cleanup] Only symbols that should be used are exported from fencing library
	Previously, all symbols were exported what ends with redefining some symbols. Currently, the
	wildcard (from fencing import *) imports only those that should be used. Rest of them make sense
	for some fence agents (e.g. TELNET_PATH if we are not able to use regular fence_login) but there
	are some symbols which have to be used before but they are not needed now. This will be solved later.

	[cleanup] Remove problems with redefining variables/functions

	[cleanup] Remove unused dependencies

	[cleanup] Split lines that were too long

	[cleanup] Remove unused variables

	[cleanup] Proper import of atexit
	Previously atexit library was imported only from the fencing library.

	[cleanup] Add missing spaces and fix tab/spaces indentation

	testing: Add regression tests for XML metadata of C fence agents

2014-04-07  Marek 'marx' Grac  <mgrac@redhat.com>

	testing: Add regression tests for XML metadata of python fence agents
	Previously, it was possible that XML metadata were changed unintentionally. This patch
	provides infrastructure and data from current release.

2014-04-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Replace printing to stderr with proper logging solution
	This patch replaces local solutions by standard python logging module. Levels of messages
	is not final, it just reflects the previous state. So, debug level is available only with
	-v / verbose option.

	fence_raritan: new fence agent for Raritan Dominion PX
	Written by David Smith <dsmith@mypchelp.com>

2014-03-21  Marek 'marx' Grac  <mgrac@redhat.com>

	[cleanup] Remove messages 'Due to limitations,binary dependencies ...'
	This message is no longer true as we ship subpackages for fence agents and users
	do not have to install all 3rd party sotfware.

	fence_wti: Respect --delay in telnet connection
	Previously --delay was respected only in ssh connection because fence_wti uses different login
	mechanism.

	Resolves: rhbz#1079282

2014-03-12  Ondrej Mular  <omular@redhat.com>

	fencing: fixed pexpect TypeError exception, when using identity file for login via ssh
	Previously, fence-agent failed to log in (ssh) using identity file. This caused fence-agent failure because of uncaught exception.

	Resolves: rhbz#1073947

2014-03-02  Marek 'marx' Grac  <mgrac@redhat.com>

	testing: Extend tests of using invalid keys for "options"
	Previously only keys that match [--.*] where considered because [-.*] should not be used in
	v4.x at all. Currently, tests where extended to find also these problems.

	Relevant: rhbz#1018780

2014-02-27  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_vmware_soap: fix short/long option parsing traceback

2014-02-26  Ondrej Mular  <omular@redhat.com>

	fencing: accept only options used in fence-agent
	In transformation from short options to long options, was used list of all options. That caused collision of options if there was 2 options with same short name, but only one was used in fence-agent.

	fencing: correct default values in manual pages for symlinks

2014-02-26  Fabio M. Di Nitto  <fdinitto@redhat.com>

	vmware_soap: drop warning from python suds when error occours
	prepatch:
	fence_vmware_soap -z -l test -p wrongpasswd -a blabla -n vm1 -o reboot -v
	No handlers could be found for logger "suds.client"
	Failed: The user does not have the correct privileges to do the requested action.

	postpatch:
	fence_vmware_soap -z -l test -p wrongpassed -a blabla -n vm1 -o reboot -v
	Failed: The user does not have the correct privileges to do the requested action.

	Based on https://fedorahosted.org/suds/wiki/Documentation
	logging must be configured and filter for CRITICAL since the harmless
	error is at INFO level.

2014-02-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	Allow ssl connections to fallback to SSL3.0 negotiation
	The preferred/default method is TLS1.x, but some old devices
	just can't deal with it.

	Add support for "notls" option that will force negotiation
	to use SSL3.0. Wherever possible you are adviced to upgrade
	your device firwmare.

2014-02-17  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] Remove nss/nspr checks from autoconf

	fence_vmware_soap: Unknown exception fixed
	Resolves: rhbz#1018780

	fence_ilo: Replacing nss_wrapper with gnutls-cli
	SSLv2 was disabled in nss package (rhbz#1001841), ilo2 now supports also SSLv3
	and it is possible to use standard tool for communication.

	fence_ipmilan: Mismatch between device options and getopt arguments (-L / -P)

2014-01-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_wti: Add support for firmware v1.40 (on MPC device)
	Previously, named groups were tested only on firmware v1.43 (on NPS device).

2014-01-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Do not output duplicities in metadata
	With DEPENDENCY_OPT it becomes possible that items in device_opt can occur multiple times easily as they
	are added automatically (e.g. 'password' imports also 'password_script'). This lead to a situation when
	eveyrything works but XML metadata contains this item multiple times and metadata can not be used properly
	by cluster stack.

2014-01-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_kdump: Add vendor-url to metadata
	Resolves: rhbz#1022529

	fence_scsi: Change path to corosync from /sbin to /usr/sbin
	/sbin is just a symlink to /usr/bin - so it does not impact functionality

2014-01-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Replace automatic key generation to work with corosync clusters instead of cman
	Resolves: rhbz#994466

	fencing: Fabric fence agents should have default action "off"
	Previously, when you have run fence agent without -o XYZ, reboot was performed. Fabric fence agents do not have them
	so fence agent fails. This update does not fix only this issue but also text --help and in manual pages.

	Resolves: rhbz#1021392

2014-01-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_vmware_soap: --delay is not respected
	Because fence agent do not use standard login process, support for the --delay has to be added.

2014-01-10  Ondrej Mular  <omular@redhat.com>

	fence_ipmilan: add long description

	fence_amt: add long description

	fencing: method cycle can be used with maximum 1 plug
	Checks input for invalid usage of cycle (method cycle and plug).

2014-01-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: auth type should not have default
	When auth type has a default value set to 'none' then autodetect of auth type is not
	done. If user want to user password, he had to enter -A password, with this patch this is
	not necessary (as in previous C-based implementation)

	fence_ipmilan: Improve readibility of verbose output

	fencing: Error messages should be send to STDERR by default
	Previously, it was sent to STDERR only when debug file was not set and --verbose was not set.

2014-01-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_amt: Adapt environment and build system to incorporate fence_amt

2014-01-06  Ondrej Mular  <omular@redhat.com>

	fence_amt: new fence agent for Intel AMT
	New fence agent for Intel AMT.

2014-01-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Remove old fence agent

	fence_ipmilan: Adapt Makefile from C to Python fence agent

	fencing: Fix replacement of path to ipmitool/amttool

2014-01-06  Ondrej Mular  <omular@redhat.com>

	fence_ipmilan: port to fencing library
	Port of fence_ipmilan to fencing library.

	fencing: add function is_executale
	New function is_executable added to fencing library.
	Function checks if path is reachable and executable.
	Used for example in fence_amt to check path to amttool.

2014-01-06  Bogdan Dobrelya  <bogdando@mail.ru>

	fence_apc_snmp: Add Tripplite PDU support
	Tested with Tripplite PDUMH20HVNET 12.04.0055 - SNMP v1, v2c, v3

2014-01-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Do not use public keys when identity-file is not defined
	Previously, fence agent (ssh) tried to use keys before it asks for password. This lead to a situation
	when fence agent did not work correctly as it was waiting for 'Password' which did not occur.

2013-12-19  Ondrej Mular  <omular@redhat.com>

	fencing: new option --method
	Add new option method --method for cycle reboot

2013-12-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_virsh: Add UUID support for fence_virsh
	UUID support for fence_virsh (libvirt) was added. The only function which has to be rewritted was
	get_power_status as currently, there is no easy way how to print (name, uuid and state) via virsh.

	This patch is based on one proposed by Bogdan Dobrelya for RHEL6.

2013-12-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add support for ipmitool/amttool binaries during autoconf
	Configuration of autoconf was extended to dynamically find ipmitool/amttool. If the binary is not found on
	the system then we will switch to default values (Fedora/RHEL). Path to binaries is exported and replaced in
	fencebuild using same processes as a version number or sbin/logdir.

2013-11-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add information about option that have to be selected from list to XML metadata

	fencing: Add support for options which should be selected from a list of values
	Previously, we have supported only strings and booleans; this is first patch that adds
	support for entering constrains like select a proper SNMP version from [1, 2c, 3].

2013-11-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: Remove debug info

	fence_drac5: Add support for Dell DRAC MC model

	fencing: Issue with login when autodetection of EOL is used
	When fence agent attempts to login to fence device it tries to find out proper EOL. During tests
	on the new fence device (Dell DRAC MC) we have found two minor problems which are fixed in this commit:

	1) Regular expression for expected login prompt was case sensitive previously

	2) Expectation that after pressing ENTER we will obtain sequence:
	  login prompt, password prompt, login prompt, password prompt, ...
	was found to be incorrect as this fence device shows password prompt only when login prompt was not empty

2013-10-30  Marek 'marx' Grac  <mgrac@redhat.com>

	[build] updates in build system to properly work with metadata.rng
	Minor updates were required to build a package without this patch you
	can do ./autogen.sh; ./configure; make - but not a build package process

2013-10-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rsb: Change in power status output
	Regular expression was extended to support newer version.

	Patch by: Christian Masopust

2013-10-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_wti: Add support for named groups
	On some WTI devices it is possible to name a group of devices by single names (e.g. 1,2 -> server). These
	groups can be used to operate all these plugs by single command.

	Patch by: Thibat Pouzet

	fence_xenapy: Fix invalid use of options
	Fixing typos (--passwd -> --password; --uid --> --uuid)

	fence_vmware: Option --vmware_type is not used correctly
	--vmware_type is defined but --vmware-type was used in source code.

	fence_drac5: Fix test used for Dell DRAC CMC
	In version 4.x the '--module-name' was renamed to standard '--plug'. This patch
	reflects it.

	testing: Check if fence agent uses only valid keys in options["--???"]
	Valid keys are defined in fencing library or fence agent itself. This check
	will be run at every build, so we should be protected against case when
	developer unintentionally use new key (e.g. typo). These type of bugs are
	usually not detected by static analyzers.

2013-10-14  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_vmware_soap: Correct error message when user does not have privileges
	Previously, when an user does not have privileges to reboot a virtual machine, the
	fence agent fails with python traceback. After applying this patch (by Shane Bradley),
	the fence_vmware_soap fails with human readable error message.

	Resolves: rhbz#1918263

2013-10-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add schema for fence agents metadata (relax ng)
	Add a metadata schema which reflects current state. In order to simplify it
	few minor changes were done to fence agents.

2013-10-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_zvm: Clean-up after replacing fence agent

	fence_vmware_soap, fence_ovh: Caching problem with SOAP library
	Both fence agents are built on top of SUDS library which creates a cache file. Unfortunately,
	it is not yet possible to completely move cache or remove it. Due to possible security issue (symlink
	vulnerability) we have decided to solve this problem as simply as possible. So '/tmp' was changed to an
	automatically generated temp directory which is removed at the exit of fence agent as we won't reuse it anyway.

	Resolves: rhbz#1014000

	fence_zvm: completely rewrited zvm fence agent
	Fence agent no longer requires package with s3270.

	Developed by Neale Ferguson <neale@sinenomine.net>

2013-09-30  Niels de Vos  <ndevos@redhat.com>

	fence_netio: new fence-agent for the Koukaam NETIO-230B PDU
	The Koukaam NETIO-230B is a power distribution unit with four normal
	(European) sockets. The device has a webui and a telnet interface. Each
	socket can be given a custom name, which is returned with '-o list'.

	Link to the device, its specifications and API:
	- http://www.koukaam.se/kkm/showproduct.php?article_id=1502

2013-09-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Add information about automatic "unfence" to metadata
	Resolves: rhbz#1012994

2013-08-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_bladecenter: Fix telnet login failure
	Problem occured due to fact that welcome message contains string which looks like login prompt.

	Resolves: rhbz#997416

	fence_brocade: Port fencing agent to fencing library
	Resolves: rhbz#641632 rhbz#642232 rhbz#841556

2013-08-28  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing_snmp: Fix 'KeyError --a' that results in traceback
	Resolves: rhbz#999146

2013-08-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Add documention of "delay" into manual pages
	Resolves: rhbz#912773

2013-08-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Fix error in XML metadata
	Resolves: rhbz#994186

2013-07-31  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ilo2: Unable to login when password contains "
	Resolves: rhbz#990537

2013-07-18  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Better description of lanplus parameter
	resolves: rhbz#981086

2013-07-17  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ovh: New fence agent for OVH
	Be aware that "off" command represents reboot into rescue mode

	fencing: fix attribute --login to --username
	Resolves: rhbz#984975

2013-07-10  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: New symlink fence_ilo4
	For HP iLO4, there is no need to have a power wait and only 'lanplus' option is required.

	Resolves: rhbz#870269

2013-07-01  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: --command-prompt option was useless because user cannot prepare list on command line
	User input is automatically translated into list.

	fencing: Add notice that command prompt is expected as python regex

	fence_na: Remove fence agent node assassin
	Fence agent temporary removed as requested by author because project
	is in "extended hiatus"

	http://www.redhat.com/archives/cluster-devel/2013-June/msg00183.html

2013-06-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_apc: Problem with <ENTER> prompt
	After introducing support for firmware 5.x, the length of command prompt regular expressions is not strictly equal to one.
	This patches solves this problem by moving '<ENTER>' prompt to first position (index 0), so we do not rely on length of
	command prompt.

2013-06-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_dummy: An option to add random delay to start of this fence agents
	Previously -R was used but this should be used for password script for SNMP, now -r is used.
	Functionality was added only now.

	fencing: Improve work with invalid power states
	Previously, status for N ports was OFF if all of these nodes where off
	and it differs when of these ports were ON. This did not work properly
	when fence agents responeded with 'unknown' values. This patches fixes
	this issue and if at least one value is non-OFF then status is not-OFF too.

	fencing: Actions to set power status are not working properly for fence agents without --plug
	The bug was introduced when support for multiple ports was added.
	    commit 0097e806545d722270b739f31a754d65994b18c9

	fence_dummy: Add a 'fail' test dummy agent

	fencing: Action 'monitor' is not working properly for fence agents without '--plugs'
	The bug was introduced when support for multiple ports was added.
	commit 0097e806545d722270b739f31a754d65994b18c9

2013-05-31  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Add "delay" option
	Adding "delay" option to fence_scsi.

	WARNING: we are using -H / delay= instead of "-f" as in fencing library because -f is already used in fence_scsi.

	Resolves: rhbz#912773

2013-05-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: Add 'unfence' to manual page
	Resolves: rhbz#887349

2013-05-24  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Validation if password/password_script or identity file is used was not processed
	Resolves: rhbz#959490

2013-04-17  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Monitor/list is not working correctly
	Bug was introduced with multiple plug support.

2013-03-06  Jan Pokorný  <jpokorny@redhat.com>

	fence2rng.xsl: parametrize and make more flexible
	The output is 1:1 to the previous version, but it is now easy to change
	base indentation level and internally, we use abstract blocks for tags
	instead of &lt;/&gt; kludge.  Also the unused macro-like template is
	removed.

	lib: remove static metadata from fence.rng.head
	Possible as:
	- rps10: droped in aa905c0bf7a717648b44069e4a192f7afe0cda61
	  (4 years back)
	- brocade, mcdata, sanbox2, bladecenter, bullpap, ipmilan:
	  generate metadata natively
	- vixel, egenera, xcat: ditto
	- na (Node Assassin): metadata enabled by previous commit

2013-03-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Install non-fence agents to libexec
	Binaries/scripts which are not fence agents should be installed to libexec directory.

2013-03-04  Marek 'marx' Grac  <mgrac@redhat.com>

	testing: Add test for multiple ports feature

2013-02-25  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Support multiple plugs for actions (e.g. --n 2,3,4)
	Previously, if you have a machine with two (or more) power lines you had to
	create a configuration in cluster.conf which was quite common a place for
	errors. Instead of pure "reboot" you had to use:
	1) port 1 off
	2) port 2 off
	3) port 1 on
	4) port 2 on

	With this patch you can use 'port 1,2 reboot'.

2013-02-18  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: All command prompt defaults should be list
	options["cmd_prompt"]["default"] have to be list, so we can use this option consistently in fencing library

	fencing: Fix indentation in --help message

	fencing: present default values for --ipport in --help
	Resolves: rhbz#895717

	fencing: Fix documentation for action 'monitor'

2013-02-13  Marek 'marx' Grac  <mgrac@redhat.com>

	COMPATIBILITY BREAK: remove --uuid (use standard -n / --plug instead)
	when --plug is UUID then it is automatically detected.

2013-02-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_apc: Add support for firmware 5.x
	New major version of firmware is now supported.

	Resolves: rhbz#886614

	testing: Add verbose mode to testing library

	testing: Add test suite for fence_drac on Dell DRAC IV

	COMPATIBILITY BREAK: remove support for Dell DRAC III and older
	Support for older DRAC devices was removed and fence agent was ported to fencing
	library. fence_drac should be now used only for Dell DRAC IV.

	fence agents: Fence agents errors are logged to syslog
	Related: rhbz#879761

2013-02-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Testing tool and dummy fence agent
	New testing tool for repeating sequences of action on given devices is ready. It should
	improve testing process of fence agents and simplify it. So more volunteers can test their
	devices.

	New fence agent "dummy" is used for testing fencing library as it does not require
	any hardware/software.

	fence_virsh: Replace constant (1) with variable from --power-wait

2013-02-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: Fix traceback when hostname cannot be resolved to IP address

	fence_cisco_ucs: fence agent does not respect "delay" attribute
	Resolves: rhbz#896603

	fence_vmware_soap: Fix previous patch - fix traceback when hostname cannot be resolved
	Previous patch was not exactly copied from another branch.

	fence_vmnware_soap: Fix traceback when hostname cannot be resolved to IP address
	Resolves: rhbz#902404

2013-02-04  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: Text in help is changed from foo=<value> to foo=[value]
	Unlike previous patch, this focus on fixing specif fence agents.

	fencing: Text in help is changed from foo=<value> to foo=[value]

	COMPATIBILITY BREAK: remove -q / quiet
	This option was never widely used because fence agents are quite quiet by default.

	COMPATIBILITY BREAK: replace udpport with ipport, make ipport dependent on ipaddress

	COMPATIBILITY BREAK: Remove obsolete options from STDIN
	For historical reasons and backward compatibility we supported these options
	blade -> port
	option -> action
	fm -> port
	hostname -> ipaddr

	These options were not in documentation and are completely removed now.

	COMPATIBILITY BREAK: fence_rsb replace -n / telnet_port with standard --ipport / ipport
	telnet_port has same functionality as ipport and -n is usually used for port number/UUID

	COMPATIBILITY BREAK: fence_lpar replace --n / --partition / partition with standard -n / --plug / port

	COMPATIBILITY BREAK: fence_drac5 replace --m / --modulename / modulename / module_name with standard -n / --plug / port
	This change apply to you only if you use fence agent against DRAC CMC, other DRACs are bound to one machine, so they
	do not use this option at all. Device option no_port (no port is needed) was added, previously modulename was optional
	and this is not true with 'port' option by default.

	COMPATIBILITY BREAK: remove option -T / --test / test
	Option -T was not used in all fence agents and its functionality differs. If you want to know if
	your fence device is working correctly use '-o monitor / --action monitor / STDIN: action=monitor'.

2013-01-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: Fix 'list' operation
	Device option 'separator' is set automatically when 'port' occurs but currently drac5 do not
	use 'port / -n' but 'module_name / -m'.

	fence_drac5: Fix regression on Dell CMC and Dell DRAC5
	Standard EOL for agents connecting via ssh is CR/LF.
	Some Dell devices represents CR/LF as double-enter what creates a problem in parsing of output.

	This patch adds a check for double-enter. This can be detected in function which power on/off machine
	because 'get power status' was run before and if we can find a line without any command we know that
	there is a double-enter problem.

	Resolves: rhbz#904195

	Resolves: rhbz#904195

2012-11-25  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: Option 'partion' is moved to fence_lpar
	This option was not part of patch a60ed3ca6fa0f63dfb09b46d99c2a281e2eed63e because it will be replaced
	by standard --port / plug option

	fencing: Do not check IP address if fence agent does not need any.

	fencing: Fix usage of UUID if option --port/plug is not defined.

	fencing: Move options which are used only once to appropriate fence agent
	@note: Fence agents which are going to removed/replaced were not fixed

	fencing: Add new option --ssh-options
	All fence agents which supports ssh connection can use
	--ssh-options / ssh_options to change default ssh parameters
	(different cipher, config file, ...)

2012-11-24  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Fix minor inconsistencies
	* integer instead of string
	* missing long options for option (--partition)

	fence_ilo_mp: Remove dependant device options like in rest of fence agents

	fencing: Improve XML metadata output
	Problem occurs when special characters are part of default values.

	fence_cisco_ucs: Simplify code by using rstrip()

	fence_lpar: Typo in definition of 'managed' option

	fencing: Operation 'reboot' is not working because fence_fabric was wrongly used
	Bug was introduced when doing change to fabric_fencing and list of available actions.

	fencing: Replace all short (getopt) options in code by their long variants
	Short (getopt) arguments are supported as before but all internal structures now
	should use their long variants. This makes code more readable and we should more
	easilly avoid problems when overloading short getopt on command line (e.g. -d).

2012-11-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Replace common options with more flexible mechanism
	Before this patch we had an option do add set of device options to all fence agents.
	e.g. device needs password, device needs ip address, ...

	This patch makes it more flexible as we can in addition do also options which depend on parent.
	e.g. if device needs password, then password script can be also used
	e.g. if device needs IP address, we can force it to use either IPv4 or IPv6

	fencing: UUID can be entered also as port number (-n / --plug / port)
	UUID is automatically detected using uuid library and we do not need
	a special option/argument for it anymore. (--uuid is still supported)

2012-11-08  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi: change on_target metadata attribute
	This patch simply changes the on_target metadata attribute to use
	value of "1" instead of "true".

2012-11-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_hds_cb: Push exception handling to fencing library
	Exception handling of network failures should be handled in fencing library. Old fence agents are already
	ported to this new behaviour.

	fence_hds_cb: Port fence agent to longopts

	fence_hds_cb: Style clean-up

2012-11-08  Matt Clark  <mattjclark0407@hotmail.com>

	Fixed date of copyright. Copy paste error.

	New fencing script for Hitachi compute blade 2000
	This script uses the system console functionality of the Hitachi compute
	blade 2000 systems to fence a node. Status, list, on, off and reboot
	have all been implemented. Can use SSH or telnet as provided by the
	underlying fencing.py library.

2012-11-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: Transfer SNMP fence agents to long-opts + transfer script

	fencing: Simplify exceptions catching when closing connection
	When we are closing connection we do not care about exceptions. For example
	if action 'exit' failed, fencing is succesful anyway because our goal was to fence machine.

	fence agents: Transfer non-SNMP fence agents to long-opts

	fencing: Add support for usage of longopt keys in options
	This way we can make code more readable options["--power-timeout"] instead options["-g"].
	This code was created manually to support both short and long options but fence agents will
	be moved to long-options automatically.

2012-11-07  David Vossel  <dvossel@redhat.com>

	fence_scsi: support unfence action in Pacemaker
	Add attribute to fence_scsi's metadata that indicates that on action
	must be performed on local node. Also allow metadata action via stdin.

2012-11-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: Exceptions (EOF/TIMEOUT) should be handled in fencing library, not in every fence agent
	Basic exception which can happends during get/set/list should be handled in fencing library and not in
	every fence agent. This patch simplify code of fencing agents which uses pexpect and pycurl.

	code cleanup: Fix warnings according to pylint and typos
	* remove unused 'global'
	* typos
	* start with renaming global variables from foo to FOO (python convention)

	code cleanup: Fix warnings according to pylint
	* use of possibly unitialized values
	* redefining built-in functions
	* unused block of code

	code cleanup: Fix minor warning according to pylint
	* space / tab issue
	* missing space after operators
	* additional semicolons
	* unused import of modules
	* unused variables

	fence_ipmilan: Fix manual page for HP iLO3, HP iLO4

2012-10-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fabric fence agents: Fix dealing with enable/disable and support on/off options for fabric fence agents

	fence-agents: Use default values for device options instead of per-agent solutions
	    Majority of these changes concern:
	    * (-x / ssh) to be turn on by default
	    * command prompt default which differs across fence agents

	fence_cisco_ucs: Incorrect timeout was used during login
	Previously, login command was bound with shell_timeout instead of login_timeout.

	fence-agents: Extend set of default device options
	There are device options which are common for every fence agent. This feature was introduced before
	but only new features were added. This patch removes common features from individual fence agents and
	adds it to the common set in fencing library.

2012-10-25  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_na: Add support for XML metadata output
	Adding a skelet for XML metadata output so fence_na can be used with corosync.

	Resolves: rhbz#864028

2012-10-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rhevm: fix typo in RE
	Resolves: rhbz#863568

2012-10-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rhevm: Support new API used in RHEV-M 3.1
	Resolves: rhbz#863568

2012-09-27  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_vmware_soap: Faster fencing, fix crash on VM without valid UUID
	Improve speed of fencing by removing requests for attributes that are not needed. This change is significant
	when there are hundrens of VM on vSphere server. On the systems with <10 VM improvement is still about 20%.

	This patch also fixes situation when there are VM which do not have valid UUID. This can happend when P2V (physical
	to virtual machine process) failed.

	Patch was proposed by: Rodrigo A B Freire

	Resolves: rhbz#836654

2012-09-18  Ryan O'Hara  <rohara@redhat.com>

	Add metadata to list of accepted actions.
	Resolves: rhbz#825667

2012-08-09  Masatake YAMATO  <yamato@redhat.com>

	fence_kdump: Typo in fence_kdump_send man page.
	Reviewed-by: Ryan O'Hara <rohara@redhat.com>

2012-08-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_virsh: Support for using sudo for running virsh
	Based on patch from Niels de Vos (in bugzilla)

	Resolves: rhbz#632851

2012-08-02  Fabio M. Di Nitto  <fdinitto@redhat.com>

	eaton_snmp: add tested models

2012-08-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_eaton_snmp: Fix default power-wait option value, remove support for -n switch:port
	This patch fixes default power-wait value to two seconds and removes support for notation
	-n switch:port which is obsolete and is being removed from last fence agents.

2012-07-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ilo2 was not correctly cleaned by Makefile
	Related: rhbz#800650

	Add fence agents specific for HP iLO2, iLO3, IMM and iDrac
	These fence agents runs 'standard' fence agent (fence_ilo, fence_ipmilan) with correct timeout options, encryption, snmp_version, ... Originally they were supposed to be symbolic links but this approach is not recommended so they regular files.

	Resolves: rhbz#800650

2012-07-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipdu: Minor fixes to fence agent
	* replace code to use 'default' value
	* remove code for backward compatibility with old options (-n switch:port)

	Resolves: rhbz#741985

2012-07-23  Lon Hohberger  <lhh@redhat.com>

	Add iPDU fencing agent for model 46M4002
	Resolves: rhbz#741985

2012-07-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: Some agents do not support action=metadata on STDIN
	Resolves rhbz#837174

2012-06-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix dist_man_* vs man_*
	those man pages should be generated at build time and not part
	of the release tarball

2012-05-31  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_hpblade: Fence agent for HP BladeSystem
	New fence agent for HP BladeSystem enclosures. Be aware that you will have to set -c / cmd_prompt as it vary a lot.

	Resolves: rhbz#818337

2012-05-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	test commit

2012-05-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: autodetect of EOL in fence agents
	Fence agents diffes in EOL they accept. EOL \r\n is quite universal but in some cases
	it is translated to \n\n what makes login process impossible to complete as it ends like
	(capitals are fence agent response)

	Login: USER\n
	Password: \n

	Login: PASSWORD\n

	Until now there was a device option that handles that login_eol_lf but we found out that there are few
	APC devices which does not work correctly with \r\n and needs \n. So we have to autodetect it, this feature was
	added to standard library. As it can also helps with common problem when you have to write exactly
	conn.send("message" + "\r\n"). Method conn.sendline("") uses EOL according to platform, so we have decided to create
	new method conn.send_eol("message") which uses correct EOL. We need conn.sendline in communication with other local
	application so we should not reuse it for this purpose.

	Resolves: rhbz#810949

	fence agents: Fix unique attribute for agents which are not based on fencing library
	Resolves: rhbz#822507

2012-04-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_brocade: support option action on STDIN, originally only operation was supported
	Resolves: rhbz#804805

2012-03-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Fix typo
	Resolves: rhbz#806912

	fence_ipmilan: Using "delay" option
	Delay option is not correctly tested in fence_ipmilan.

	Resolves: rhbz#804169

	fence_ipmilan: return code can be invalid when using -M cycle
	Resolves: rhbz#806897

	fence agents: Attribute unique should be set to 0 (false) by default
	Resolves: rhbz#806883

2012-03-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: Using "delay" option can ends with timeout problems
	Resolves: rhbz#804169

2012-02-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: power_wait timeout is not used for power off operation
	Patch proposed by Vlastimil Holer.

	Resolves: rhbz#787706

	fence_rhevm: Incorrect status detected when VM is not in up/down
	For fencing purposes we have to focus on getting OFF status
	when machine is really 100% down, conditions for ON status are much simplier
	(as fact that machine is has power does not mean that it works). This patch
	specify condition for OFF status - in fact only 'Down' is accepted now

	Resolves: rhbz#769681

	fencing: Missing password is not reported properly
	When username is entered and password is missing then it is possible
	that fence code will end with exception.

	Resolves: rhbz#785091

2012-01-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_vmware_soap: Support for 100+ VM in VMWare
	In previous version, we did not try to get all results for VM. This
	updated version fixes this issue by using proper SOAP API

	Resolves: rhbz#735797

	fence_ipmilan: Possible buffer overflow
	Problems found by Coverity Scan.

	Resolves: rhbz#756315

2011-12-19  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi: remove unlink of fence_scsi.dev file
	This patch removes the call to unlink the fence_scsi.dev file during
	unfencing (action=on). Instead of unlinking the file, check to see if
	the current device is already in the fence_scsi.dev file before writing
	it to the file. Note that since this file exists in /var/run/cluster
	directory, it should be removed on reboot.

	Resolves: rhbz#741339

2011-12-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rackswitch: Add metadata generation for C-based fence agents
	This should be part of previous patch: fence_rackswitch: Add metadata output for fence_rackswitch agent

	Resolves: rhbz#714841 (partial)

	fence_rackswitch: Add metadata output for fence_rackswitch agent
	Adding this feature allow us to generate manual pages directly from XML,
	so both GUI tools and manual pages can see same feature.

	Makefile for fence_ipmilan is modified because it can reuse same snippets

	Resolves: rhbz#714841 (partial)

	fence_vmware_soap: Support for alias names as ports
	Extending fence agent to support (-n / port) can use alias names of VM.
	They can be obtained using 'list' action. This feature won't work correctly
	if you have several VM with same name, in that case you should use either
	full path or UUID.

	Resolves: rhbz#715107

	fence_rsb: Fence agent ported to fencing library
	Fence agent was rewritten to use fencing library. Main benefits are
	support for ssh connection, XML metadata, automatic man page generation.

	Resolves: rhbz#742003

	fencing-agents: Add metadata output for fence agents in perl
	Fencing agents written in PERL usually did not have option to print
	XML metadata about its feature. Adding this feature also allow us
	to generate manual pages directly from XML, so both GUI tools and manual
	pages can see same feature.

	Resolves: rhbz#714841 (partial)

2011-09-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: is not parsing args with passwd_script option in cluster.conf
	Resolves: rhbz#740484

2011-09-19  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi: fix simultaneous unfence operations
	This patch fixes an issue where multiple nodes attempt to unfence at
	the same time and fail when attempting to create a reservation. Each
	node checks to see if a reservation exists, and if not, it will attempt
	to create one. The problem occurs when multiple nodes see that no
	reservation exists and attempt to create one.

	This patch checks the return code of do_reserve. If this call fails,
	check again to see if a reservation was created by another node, in
	which case there is no error.

	Resolves: rhbz#738384

	Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>

	fence_kdump: fix potential null dereference
	If strchr returns NULL while parsing options from stdin, continue
	without handling the option. This should prevent possible null
	dereference.

	rhbz#734429

	Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>

2011-09-15  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: fence_ipmilan exposes user password on verbose mode
	In verbose mode password is replaced by '[set]'

	Resolves: rhbz#732372

2011-09-01  Marek 'marx' Grac  <mgrac@redhat.com>

	Merge branch 'master' of http://git.fedorahosted.org/git/fence-agents

2011-08-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: make sure fence_kdump man pages are in the release tarball

2011-08-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rhevm: REST API URL needs to be updated to /api
	Resolves: rhbz#731166

2011-08-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rhevm: change "UP" status to "up" state as the REST-API has changed
	Resolves: rhbz#731166

2011-08-15  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: drac5 firmware does not close ssh session correctly
	Attempt to close connection right after sending 'exit' command does
	not close session correctly.

	Resolves: rhbz#718924

2011-08-02  Lon Hohberger  <lhh@redhat.com>

	fence_kdump: Fix metadata
	Having duplicate "verbose" parameters is not valid.

	Reviewed-by: Ryan O'Hara <rohara@redhat.com>

2011-07-29  Ryan O'Hara  <rohara@redhat.com>

	fence_kdump: change default timeout back to 60
	After more testing, the time between when the fence_kdump agent begins
	listening for a message and the time that it receives a message appears
	to be approximately 43-45 seconds. The default timeout of 60 seconds
	should be sufficient. Users that wish to wait more than 60 seconds can
	increase the timeout via the "timeout=<time>" option.

	fence_kdump: Fix logging
	Change the log_debug and log_error macros. For fence_kdump, also write
	to syslog.

	fence_kdump: remove binary files from git

2011-07-28  Ryan O'Hara  <rohara@redhat.com>

	fence_kdump: Increase default timeout to 120
	The default timeout value of 60 seconds appears to be to short, so we
	should increase the default timeout value to 120 seconds. This is the
	time that the fence_kdump agent will wait for a message before returning
	failure.

2011-07-26  Ryan O'Hara  <rohara@redhat.com>

	fence_kdump: remove FENCE_KDUMP_MSGV2
	FENCE_KDUMP_MSGV2 is not used at this time, so remove it.

	fence_kdump: include ctype.h
	Add ctype.h to avoid implicit declaration of isspace function.

	fence_kdump: fix compiler warnings
	Change 'inline void' function to 'static inline void' to avoid compiler
	warnings.

2011-07-26  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: add extra check required for fence_kdump

2011-07-26  Ryan O'Hara  <rohara@redhat.com>

	Updated to include new fence_kdump agent.

	Merge branch 'master' of ssh://git.fedorahosted.org/git/fence-agents

	fence_kdump: New fence agent for use with kdump
	The fence_kdump agent provides a way to detect a failed node that has
	enterted the kdump crash recovery service.

2011-07-26  Kristoffer Knigga  <kris@knigga.com>

	ipmilan: Allow privilege selection
	In some cases, it's desirable to limit the rights to an iLO
	user in order to mitigate the fact that the login information
	is stored as plaintext in the cluster configuration.

	Unfortunately, ipmitool and fence_ipmilan do not work in this
	configuration.

	   # /usr/bin/ipmitool -I lanplus -H '10.1.9.40' \
	     -U 'fence' -P 'fencepost' -v chassis power status
	   RAKP 2 message indicates an error : unauthorized role requested
	   Error: Unable to establish IPMI v2 / RMCP+ session
	   Unable to get Chassis Power Status

	It turns out that dialing back the permissions on a user in iLO
	changes its privilege level, in this case from administrator to
	operator.  ipmitool defaults to administrator if nothing is
	specified, hence the error.  If the correct privilege level is
	given to ipmitool the command works:

	   # /usr/bin/ipmitool -I lanplus -H '10.1.9.40' \
	     -U 'fence' -L 'OPERATOR' -P 'fencepost' -v chassis power status
	   Chassis Power is on

	This patch adds the 'privlvl' option to fence_ipmilan, allowing
	administrators to change the privilege level in the cluster
	configuration.

2011-07-22  Lon Hohberger  <lhh@redhat.com>

	Add rha:name and rha:description tag to RelaxNG XSL
	Resolves: rhbz#698365

	Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>

2011-07-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: Incorrect output of 'list' operation on Drac 5
	Previously (due to other bug) fence agents operation 'list' was not
	working properly. After fixing that issue, drac5 returned empty line
	instead of N/A as an output for 'list'. This happends because fencing
	library does not have support for situations when for one fence agents
	there are fence devices that supports / not supports 'list' option.

	Resolves: rhbz#718194 (regression introduced by previous patch)

2011-07-05  Arnaud Quette  <aquette.dev@gmail.com>

	eaton_snmp: add support for Eaton Switched ePDU

2011-07-01  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_bladecenter: Reboot operation did not work correctly with --missing-as-off
	This patch adds a correct handling of situation where prompt was not changed
	as expected (means blade is not available)

	Resolves: rhbz#689851

	fence_drac5: Fix support for Dell DRAC CMC
	Fix operation 'list' for Drac CMC and typo that causes python traceback

	Resolves: rhbz#718194

2011-06-27  Fabio M. Di Nitto  <fdinitto@redhat.com>

	relaxng: drop static agents definitions
	GNBD: obsoleted
	fence_scsi/fence_virt/fence_xvm are now autogenerated

	relaxng: drop <grammar> definition

	relaxng: ship bits required to build the schema at runtime

2011-06-27  Lon Hohberger  <lhh@redhat.com>

	Make fence_ack_manual 'usage' more accessible

2011-05-24  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: allow selection of agents to build and fix configure help output

2011-05-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_rsa: readd test info

	build: add missing file from tarball release

2011-05-11  Cedric Buissart  <cbuissar@redhat.com>

	ipmilan help: login same as -l
	In the ipmilan help message, 'login' is the same as -l (and not
	-u)

2011-05-11  Fabio M. Di Nitto  <fdinitto@redhat.com>

	Fix file permissions

2011-05-11  Matt Clark  <mattjclark0407@hotmail.com>

	Cleanup of fence_xenapi patches. Added copyright information to doc/COPYRIGHT. Fixed static reference to lib directory in fence_xenapi.py. Fixed static reference to RELEASE_VERSION and BUILD_DATE in fence_xenapi.py.

	Clean up of fence_xenapi patches. Moved XenAPI.py to lib directory and added to Makefile.am.

	Updated to include xenapi script in Makefile.am.

	Updated to include xenapi script.

	New fencing script for Citrix XenServer and XCP.
	Fencing script that uses the XenAPI to allow remote switch, status and list of virtual machines running on Citrix XenServer and Xen Cloud Platform hosts.

2011-04-04  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Correct return code for diag operation
	Return code for diag operation should be 0.

	Replaces commit 8a97abd04b8492310c1095413c5cf26bbf98e395

	"diaf" != "diag"

	Resolves: rhbz#655764

2011-04-04  Lon Hohberger  <lhh@redhat.com>

	Revert "fence_ipmilan: Correct return code for diag operation"
	This reverts commit 8a97abd04b8492310c1095413c5cf26bbf98e395.

2011-04-04  Marek 'marx' Grac  <mgrac@redhat.com>

	bugfix uuid

	library: Add support for URL session instead of hostname
	Fence agent can choose if they prefer to set address to fencing device
	as hostname/ip address or URL.

	fence_ipmilan: Correct return code for diag operation
	Return code for diag operation should be 0.

	Resolves: rhbz#655764

	fence_ipmilan: returns incorrect status on monitor op if chassis is powered off
	There is a bug in fence_ipmilan agent: it exits with result code 2 on
	"monitor"/"status" command if chassis is powered off. Instead it should return
	0 because "monitor" command should return fence device status, not chassis
	status.

	Reported and patch proposed by Vladislav Bogdanov

	Resolves: rhbz#690735

	fence_cisco_ucs, fence_rhevm: Problems with SSL support
	Both of these agents are using pycurl. This library has different default
	setting across various distributions, so it is better to set SSL options
	directly.

	Resolves: rhbz#691392

	fence_vmware_soap: New fence agent for VMWare using SOAP API
	This fence agent depends on package python-suds (https://fedorahosted.org/suds/)
	which provides interface to SOAP

	Resolves: rhbz#634567

	library: Add support for UUID (-U / --uuid / uuid)
	Fence agents can use --uuid as a replacement for --port. This is very
	useful in a case of virtual machines that have both UUID and name.

	Patch proposed by Matt Clark

2011-03-25  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: Fix for support for sub-organization
	Resolves: rhbz#678094

2011-03-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: Support for sub-organization
	Added new option --suborg where you can enter suborg path (e.g. org-myorg/org-sub).
	Unlike in the other cases we do not automatically add prefixes as there can be more
	levels of suborganizations.

	Resolves: rhbz#678094

2011-03-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rhevm: Update URL to RHEV-M REST API
	Resolves: rhbz#681674

2011-03-18  Lon Hohberger  <lhh@redhat.com>

	fence-agents: Accept other values for "true"
	Resolves: rhbz#679502

2011-03-15  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi: grep for keys should be case insensitive
	When checking that a key is or is not registered for a device, the key
	comparison should be case insensitive. Using sg_persist to query for
	registered keys will always give lowercase characters for hexadecimal
	keys, so registering key 'A' would appear to fail since it would not
	match 'a'.

	Resolves: rhbz#653504

	fence_scsi: fix typo when opening logfile
	There is a typo in the code that opens the logfile. The logfile should
	be opened in append mode. This was fixed in RHEL6 quite some time ago,
	but for whatever reason didn't get pushed into upstream.

2011-03-15  Jim Ramsay  <jim_ramsay@dell.com>

	Allow fence_scsi to use any valid hexadecimal key
	The check for a non-zero key is using perl's implicit string-to-integer
	conversion that only works on base 10 digits, which means that any key
	starting with at least one digit [1-9] will come through as okay, but
	any key starting with [A-F] will evaluate as 0 and fail the test.

	An explicit conversion to integer via hex() is the solution.

	I hit this in a cluster with a cluster ID of 43316 == 0xA934 and scsi
	fencing configured, where starting the cman service would always fail at
	the "Unfencing self" step.


	Resolves: rhbz#653504

2011-03-11  Arnaud Quette  <aquette.dev@gmail.com>

	eaton_snmp: fix list offset

2011-03-09  Brandon Perkins  <bperkins@redhat.com>

	Fence_rhevm needs to change "RUNNING" status to "UP" status as the REST-API has changed.
	Resolves: rhbz#681669

2011-03-02  Fabio M. Di Nitto  <fdinitto@redhat.com>

	Fix .gitignore a bit more

	build: update .gitignore

	build: plug in fence_scsi_check.pl and ship it in sharedir/cluster/

2011-03-01  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi_check: watchdog script for fence_scsi
	This fence_scsi_check watchdog script will check to see is the local
	node's key is registered with any devices. If the key is registered with
	at least one device, the script will return 0. If none of the devices
	have the node's key registered (ie. it has been fenced), the script will
	return 2 and node will reboot via watchdog.

	Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>

	fence_scsi: create /var/run/cluster if necessary
	Before writing to fence_scsi.key or fence_scsi.dev, check to see if
	/var/run/cluster directory exists. If not, create it.

	fence_scsi: write devices to tmp file on unfence
	When unfencing occurs (action=on), write list of devices that were
	successfully registered to /var/run/cluster/fence_scsi.dev file. This
	file will be used by the optional watchdog script. Note that the devices
	are not added to the tmp file until the verification step.

	fence_scsi: move key file to /var/run/cluster
	Since the contents of /var/run/cluster/ directory are cleared on each
	reboot, move the fence_scsi.key file to that directory. This is useful
	for watchdog checks as a means to avoid watchdog reboots when a node has
	not yet unfenced or unfencing fails.

2011-02-28  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix build dependecy
	when editing a file, the corresponding agent was not being regenerated
	because the make dependency was missing.

	build: fence_ipmilan does not need PYTHONPATH to generate manpage

	build: make ready for watchdog integration script

2011-02-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_eaton_snmp: fix port number handling
	snmp port enumration starts at 0 while all other interfaces start at 1.

	Make the numbering consistent between configuration, devices and UIs.

2011-02-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_wti: Unable to parse output when splitted into several screens (2/2)
	Minor changes to previous patch. Power ON/OFF now works as expected

	Resolves: rhbz#678522

	fence_wti: Unable to parse output when splitted into several screens
	Parsing of listing that consists of several screens added.

	Resolves: rhbz#678522

2011-02-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rsa: Better error handling
	In some special cases (reason is not known yet) fence agent for RSA fails to
	get status because it can't find pattern 'Power: (.*)'. After applying this
	patch agent will end with proper error message instead of python backtrace.

	Resolves: rhbz#652619

2011-02-08  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: cleanup configure.ac
	drop reference to corosync that's not required to build anymore
	add entries from autoscan

	Update COPYRIGHT file
	bump years to 2011

	add fence_eaton_snmp information

	fix email address to avoid autospam

	drop fence_xvm bits since the agent has been dropped ages ago

2011-02-07  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi: properly log errors for all commands
	There are a number of places in fence_scsi that call sg_persist commands
	via Perl's qx command. If an error occurs, the script simply dies and
	reports the name of the subroutine that the script died in. This can be
	improved by replacing the die call with log_error, such that any errors
	get properly written to the logfile, if any. This patch also logs the
	error code returned from the failed command.

	This patch also redirects stderr to /dev/null for all commands executed
	via qx.

	Reviewed-by: Lon Hohberger <lhh@redhat.com>

	fence_scsi: verify that on/off actions succeed
	This patch adds code to verify that both "on" and "off" actions are
	successful. This is needed because there seem to be some arrays that
	do not report an error even when no registration was created, etc.

	These verification steps takes places after the action has been
	performed successfully. If an error was encountered while performing
	either an "on" or "off" action, fence_scsi will exit and no verification
	will take place. Failure to verify that an action was successful for any
	device will result is failure.

	For the "on" action, do_verify_on will check that the key was
	successfully registered with each devices and that a reservation exists
	on each device.

	For the "off" action, do_verify_off will check that the key was removed
	from each device and that a reservation exists on each device.

	Resolves: rhbz#644385

	Reviewed-by: Lon Hohberger <lhh@redhat.com>

	fence_scsi: always do sg_turs for dm-mp devices
	This patch fixes a with the original patch posted last week. Before
	attempting to register with a device, we should call sg_turs on the
	device. If that device is a dm-multipath device, we should call sg_turs
	on all the paths. This can be done by simply moving the call to do_reset
	to do_register and do_register_ignore.

	Also, the patch adds a call to do_reset before doing a "status" action.
	If a node has been fenced and then proceeds to check its status, it will
	be in "unit attention" state.

	Resolves: rhbz#640343

	Reviewed-by: Lon Hohberger <lhh@redhat.com>

	fence_scsi: always do sg_turs before registration
	If a node has been fenced, or its key has been forcibly removed from
	device(s) by another node, the victim will see "unit attention" from the
	devices if/when it attempts to re-register. This error is normally
	reported just once, but will cause registration to fail. We can safely
	avoid this by calling sg_turs prior to each attempt to register with a
	device.

	Resolves: rhbz#640343

	Reviewed-by: Lon Hohberger <lhh@redhat.com>

	fence_scsi: fix regular expression for grep
	When fence_scsi checks to see if a specific keys is registered for a
	specific device, it uses grep to look through a list of all registered
	keys. The existing regular expression was not specific enough, and could
	result in false positives. This patch fixes the problem by using anchors
	to make the regular expression more specific.

	Resolves: rhbz#670910

	Reviewed-by: Lon Hohberger <lhh@redhat.com>

	fence_scsi: identify dm-multipath devices correctly
	Previously, fence_scsi would only identify /dev/dm* devices as being
	multipath devices. This prevented the use of "friendly" dm-multipath
	names (eg. /dev/mapper/mpath1). Since fence_scsi can now be passed
	devices to operate on, it should be able to handle "friendly" names,
	too. This patch fixes the problem by getting the absolute path of the
	device at registration time.

	Resolves: rhbz#644389

	Reviewed-by: Lon Hohberger <lhh@redhat.com>

2011-02-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix make dist target
	this also addresses the issue of a dirty tarball being distributed

2011-02-03  Fabio M. Di Nitto  <fdinitto@redhat.com>

	Fix build for distributions that don't use bash as default shell

2011-01-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_eaton_snmp: New fence agent for Eaton devices
	Fence agent for Eaton Managed ePDU (http://www.epdu.com).
	Developed by Arnaud Quette <aquette.dev@gmail.com>

2011-01-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ipmilan: Fix manual page to describe usage with HP iLO 3
	Resolves: rhbz#648892

	fence_ipmilan: Add "diag" option to support "ipmitool chassis power diag"
	Resolves: rhbz#655764

2010-11-28  Digimer  <digital.mermaid@gmail.com>

	fence_na: Updated node_assassin to v1.1.6. Fixed a few bugs and cleaned up the configuration file and docs to be more neutral and professional.

2010-11-09  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: allow autoreconf from tarball release

2010-11-08  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: enable publishing

	build: workaround python path madness

	build: add automatic versioning and release script

2010-11-05  Fabio M. Di Nitto  <fdinitto@redhat.com>

	overall cleanup and make ready for release

2010-10-25  Marek 'marx' Grac  <mgrac@redhat.com>

	library: Metadata are not correct if agent does not support on/off
	Metadata actions are generated according to option io_fencing. Currently
	only fence_sanbox is affected as fence_ifmib accepts both enable/disable
	and on/off (so io_fencing is not used)

	Resolves: rhbz#623266

	fence_eps: Fix parameters missing in metadata
	fence_eps contains a parameter which is not defined in fencing library.

	Resolves: rhbz#618703

	fence_egenera: Missing -u / user in manual page
	Resolves: rhbz#635824 (partially)

2010-10-13  Christine Caulfield  <ccaulfie@redhat.com>

	fence-agents: Add power_wait to fence_ipmilan
	Previous patch used power-wait which was inconsistent with
	the rest of the fencing agents.  Also, help information
	for the new option was missing.

	Resolves: rhbz#548575

2010-09-24  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_cisco_ucs: New fence agent for Cisco UCS

	fence_rhevm: New fence agent for RHEV-M REST API

2010-09-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	Add fence_na to the build

2010-09-07  Madison Kelly  <mkelly@alteeve.com>

	Added detail to Node Assassin fence agent (fence_na) copyright.

2010-09-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_na: add copyright/author information

	fence_na: fix last installation bits required to work in our build env

	fence_na: generate files based on configure invokation

	fence_na: import files pristine from upstream

2010-08-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Method to cause one node to delay fencing - ipmilan
	Resolves: rhbz#614046

	fencing: Method to cause one node to delay fencing - drac, egenera
	Manual pages were updated too as they are not generated automatically
	for these agents.

	Resolves: rhbz#614046

2010-07-30  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: make "port" a synonym of "module_name" for drac5
	Resolves: rhbz#619776

2010-07-28  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Not all parameters appear in metadata
	Resolves: rhbz#618703

	fencing: Method to cause one node to delay fencing [2]
	Option was not correctly showed in metadata

	Resolves: rhbz#614046

	fencing: Method to cause one node to delay fencing
	Resolves: rhbz#614046

2010-07-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_ilo: will throw exception if user does not have power priviledges
	User will receive error message instead of python traceback

	Resolves: rhbz#615255

2010-07-09  Guido Günther  <agx@sigxcpu.org>

	fence_rsb: Raise exceptions not strings
	otherwise we'll see in python 2.6

	Traceback (most recent call last):
	  File "<stdin>", line 1, in <module>
	TypeError: exceptions must be old-style classes or derived from BaseException, not str

	Resolves: rhbz#612941

2010-07-05  Ryan O'Hara  <rohara@redhat.com>

	Fix open flags so that logfile won't be truncated each time we open it.
	rhbz#608887

2010-07-05  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_apc: fence_apc fails for some port numbers
	Problem is that string we parse looks like:
	'Press Enter to continue ...\r 23-bar1 ON' and we did not expect text
	message before our line.

	Resolves: #606297

	fence_wti: support non-default TCP ports
	WTI do not use standard process to login so it needs special patch
	(based on the code in library)

	Resolves: rhbz#593726

	fence_wti: Add direct support for WTI VMR
	Add a new command prompt for WTI VMR devices

	Resolves: rhbz#578617

2010-04-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	update fence_ack_manual man page

	lpar: fix spacing

	ipmilan: build man page at build time

	fence: fix make distcheck build out of tree

	fix fail to build from previous merges

	fence_scsi: import man page from STABLE3

2010-04-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Creating manual pages fails when default value is a list
	Problem was concatenating string + list in python. Lists can't be
	entered using command line or stdin.

	Resolves: rhbz#583019

	fence_ilo_mp: Proper error message instead of python traceback
	Fencing agent for iLO MP did not have proper exception handling.

	Resolves: rhbz#583017

	fence_egenera: log file path should be absolute not relative

	fencing: Add vendor URL to man pages

2010-04-20  Ryan O'Hara  <rohara@redhat.com>

	New fence_scsi with config options.

2010-04-20  Lon Hohberger  <lhh@redhat.com>

	config: Fix fencing attribute requirements
	There is no easy way to satisfy a "required" attribute
	being present in more than one location.  Specifically, with
	fencing devices, a required run-time parameter may appear
	in one of three possible locations in cluster.conf.

	Because this is difficult to detect, all fencing attributes
	are now optional from the schema's perspective.

	fence-agents: Tweak translator output

	fence: add fence agent -> rng generator

2010-04-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Invalid initialization of default value for retry-on option
	Problem introduced by:

	commit 45ed9fd03c0718252f2ae418ffa7161198aa4688
	Author: Marek 'marx' Grac <mgrac@redhat.com>
	Date:   Fri Nov 6 14:13:02 2009 +0100

	    fencing: New option --retry-on <N>

	fencing: New option --retry-on <N>
	New firmware (v1.70+) for ilo2 is much slower then before. Option --retry-on=X (on stdin retry_on=X)
	is introduced and it attempts to send power on command to machine and wait for results X times.
	Default for fence agents is 1 so they won't be affected; fence_ilo default value is 3.

	Resolves: #bz507514 (timeout options are needed before applying this patch separately)

2010-04-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_sandbox2: add short and long description for man page generation

2010-04-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: long description added

	fencing: short description of fence agent added

	fencing: fix fence_a, fence_l, ...
	Removing last 3 characters is okay for testing (fence_lpar.py) but not
	for production (fence_lpar -> fence_l)

	fencing: Typo meta-data -> metadata

	fence_ipmilan: metadata should be in expected format
	Metadata format fixed, added information getopt/default/... We will have to
	add short/long description but we don't have it anywhere yet.

2010-04-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_ipmilan: allow metadata invocation without other parameters

	fence_ilo: do not import unrequired modules

	fence agents automatic man page generation
	first import from STABLE3 branch

	fence-agents: fix build with locales other than C
	Resolves rhbz#583948

2010-04-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_wti: Remove ipport option
	WTI devices do not support change of default TCP/IP ports so this option
	is useless. It is not working correctly as there is a separate login
	process for WTI devices.

2010-03-16  Jan Friesse  <jfriesse@redhat.com>

	fencing: SNMP fence agents don't fail
	Net-SNMP command-line utilities have interesting "feature"
	causing too short pass-phrase (shorter then 8 characters)
	write error but sadly, not return error code. In such case,
	fencing can be considered successful even if it is not.

	Patch fixes this by:
	- Pass v3 options only for v3 mode
	- Search for Error string in snmpcmd output

2010-01-12  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: update copyright year across the board

	fence agents: drop build date
	generated at build time

2010-01-06  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence lpar: fix quoting

2009-12-22  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: fence_rsa fails to login
	New version/firmware have new login screen which was not supported. Also it
	is slower, so default timeout for login-timeout is set to 10 seconds.

	fencing: Add support for identity files
	Some fence agents contains support for ssh but did not support identity
	files.

2009-12-21  Lon Hohberger  <lhh@redhat.com>

	fence-agents: Add missing state handling to fence_virsh
	Resolves: rhbz#544664

2009-12-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Version information not shown
	Option '-V' (get version info) is not working because attributes where
	not properly named, so they result in empty strings.

	fencing: Change default timeout values for LPAR and IPMI

2009-12-08  Ryan O'Hara  <rohara@redhat.com>

	New fence_scsi with config options.

	Remove fence_scsi_test.

2009-12-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fence: RSB fence agents changed interface a bit
	RSB changed so it don't print 'CLOSING CONNECTION' and 'Power status:' was
	changed to 'Power status :'

	Resolves: bz#545054

2009-12-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_xvm(d): obsolted by fence-virt

2009-11-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: relax autotools requirement

2009-11-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Unable to power on machine after applying patch
	Problem introduced by:

	    commit 45ed9fd03c0718252f2ae418ffa7161198aa4688
	    Author: Marek 'marx' Grac <mgrac@redhat.com>
	    Date:   Fri Nov 6 14:13:02 2009 +0100

	        fencing: New option --retry-on <N>

	fencing: Invalid initialization of default value for retry-on option
	Problem introduced by:

	commit 45ed9fd03c0718252f2ae418ffa7161198aa4688
	Author: Marek 'marx' Grac <mgrac@redhat.com>
	Date:   Fri Nov 6 14:13:02 2009 +0100

	    fencing: New option --retry-on <N>

2009-11-10  Jan Friesse  <jfriesse@redhat.com>

	fence: Fix fence_ipmilan read from unitialized memory
	Newly introduced option -M added one read from unitialized
	memory. This patch initialize memory to 0.

2009-11-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fence: Broken device detection for DRAC3 ERA/O
	Resolves: bz#489809

2009-11-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: fence_bladecenter needs longer timeout
	Fence bladecenter needs longer power_wait 5 -> 10 seconds. Found during
	tests for RHEV-H

	Resolves: #bz526806

	fencing: New option --retry-on <N>
	New firmware (v1.70+) for ilo2 is much slower then before. Option --retry-on=X (on stdin retry_on=X)
	is introduced and it attempts to send power on command to machine and wait for results X times. Default for
	fence agents is 1 so they won't be affected; fence_ilo default value is 3.

	Resolves: #bz507514 (timeout options are needed before applying this patch separately)

2009-10-29  Jan Friesse  <jfriesse@redhat.com>

	Fence agents: Fix traceback when using any SNMP agent
	Main problem was hidden in forgotten "self" in
	fencing_snmp caused by commit:

	Author: Marek 'marx' Grac <mgrac@redhat.com>
	Date:   Fri Oct 9 13:36:25 2009 +0200
	fencing: Timeout options added

	RHBZ#531724

2009-10-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_sanbox2: Update build system
	Change from perl to python code needs change in Makefile.

	fencing: Correct exit codes for status operation
	According to standard operation status should return 0 (if ON) and 2 (if OFF).
	In all other cases if operation was succesfull then agent return 0.

	fence_rackswich: Accept unknown options without value

2009-10-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Accept unknown options from standard input
	libefence added new option 'nodename' to every query, as most of the agents
	does not need such feature, we will ignore it. Unknown options from STDIN where
	handled differently before.

	New policy: fence agent should accept unknown args from STDIN. It can print on STDERR
	warning that it is ignoring that option.

2009-10-14  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: New option '--missing-as-off' to return OFF is machine is missing
	If a blade is not present (i.e. removed for maintenance), the fence_bladecenter
	cannot check the state as it is reported empty.

	Resolves: bz#248006

	fence_ilo_mp: Add support for iLO2 with firmware v1.70
	Existing fence agent for iLO is no longer working correctly with new
	firmware 1.70+. Fortunately only minor adjustement was needed for ilo_mp
	to support also these devices.

2009-10-13  Lon Hohberger  <lhh@redhat.com>

	fence_xvmd: Allow interface assignment in cluster.conf

2009-10-09  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Timeout options added
	Fencing agents based on fencing library have new set of timeout options.
	They are highly advanced so read documentation at
	http://sources.redhat.com/cluster/wiki/FenceTiming

	fence_sanbox2: Typo correction

	fence_sanbox2: Support operation 'list' for sanbox2

2009-10-09  Jan Friesse  <jfriesse@redhat.com>

	fencing_snmp: Fix exception caused by older commit
	This patch fixes exception in FA caused by change in fencing library:

	"fence agents: Option for setting port for telnet/ssh/ssl used
	by fence agent"

	RHBZ#527844

2009-10-07  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_sanbox2: Re-implemenatition based on fencing library
	Resolves: bz#512947

2009-10-07  Jan Friesse  <jfriesse@redhat.com>

	fence_vmware: VIX API fix, ESX 4.0.0, helper more verbose
	- patch fixes exception in case user use VIX API
	- fence agent is now tested against ESX 4.0.0 and vCenter 4.0.0
	- fence_vmware_helper is more verbose in case some Perl module
	  is missing (prints Perl error message)

2009-10-02  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi: man page contains invalid "-s" option
	Resolves: bz#515731

2009-09-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac: Split fence agents drac/drac5 to separate directories
	Fence agents fence_drac/fence_drac5 were only one that resides in same
	directory. This patch creates new directory drac5/ were fence_drac5 was
	moved.

	fence_apc: fence_apc fails to fence node - Unable to obtain plug status
	New firmware allows new ouput:

	 1- Outlet 1:1  shell-01                ON        Graceful Shutdown

	Resolves: bz#517860

2009-08-27  Jan Friesse  <jfriesse@redhat.com>

	fence: Support for power cycle in fence ipmi
	Default behaviour (off/get status/on) doesn't work on
	some IPMI implementations, because chasiss power off will
	turn off IPMI management card. Next power on cannot be
	done automatically. But it looks, like chassis power cycle
	is supported and do what we need -> reset machine.

	Patch add support for -M (method) option, which can have
	values:
	- onoff - default old behaviour
	- cycle - use new power cycle

	rhbz#482913

2009-08-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Fencing fails when using implicit connection method other then telnet
	Bug was introduced with ipport option where port number was set before
	-x/-z was set. It did not affect those who use -x / -z.

2009-07-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix fence_ilo_mp and add files to EXTRA_DIST

	fence agents: drop unrequired and wrong copyright statement

2009-07-30  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: #508722 - Fence agent for HP iLO 2 MP
	New fence agent for HP iLO2 MP used in Blade Servers. It uses SMASH
	interface over telnet/ssh. fence_ilo uses RIBCL over SSL what is not
	supported on these machines.

2009-07-28  Ryan O'Hara  <rohara@redhat.com>

	BZ 512998 - Add comment about fence_scsi limitations.

2009-07-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: fence agents fails with pexpect exception
	bz#501586 - 2nd patch

2009-07-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing.py: Adds device option login_eol_lf
	This option is used for login method using telnet. By default most of the fence agents
	work with username\r\n but on some devices (e.g. HP iLO MP, sanbox2) it is interpreted
	as there is empty password.

2009-07-20  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: #512343 - Fencing fails if telnet/ssh is not available

2009-07-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: option -x for ssh was required
	Option -x is no longer required for LPAR. It is turned on automatically. This
	should not change behaviour of fence agent as -x was required before and no
	other access to LPAR/HMC is supported.

	fencing: Metadata suitable for automatic man pages generation
	Information about individual options are extended so they are more suitable
	for creating better metadata. We can use them to produce fresh manual pages.
	Metadata have to be formatted using XSLT processor (e.h. xsltproc) using
	template ra2man.xsl in lib/

	Example:
	fence_lpar -o metadata | xsltproc ra2man.xsl - | nroff -mandoc > z
	man ./z

	@note:
	If the default value is array then only string 'list of values' is rendered.
	As currently it is not possible to enter arrays from getopt/stdin.

2009-06-30  Steven Dake  <sdake@redhat.com>

	fence: Fix missing case in switch statement
	Resolves: https://bugzilla.redhat.com/show_bug.cgi?id=500567

2009-06-26  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing: Create function that prints documentation
	This have to be moved because we need access also to agent specific values as they
	will be presented as defaults in metadata.

	fence_wti: Fence agent for WTI ends with traceback when option is missing
	Login name/password are NOT required for WTI, so they have to be checked after
	login/password is encountered. Please enter the commit message for your changes.

	bz#508262

2009-06-24  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence manual: remove hardcoded use of /var

2009-06-23  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: convert to autoconf/automake/libtool
	requires:
	 - autoconf  2.63b
	 - automake  1.11
	 - libtool   2.2.7a
	 - pkgconfig 0.23
	 - m4        1.4.13

	build: enable fence_xvm by default
	Historically building fence_xvm was complex and required xen libs
	that are architecture specific.

	fence_xvm has long dropped libxen in favour of libvirt that's been
	ported and build on all architecture and it's part of all distribution.

	Drop the special casing in the build system.

2009-06-19  Marek 'marx' Grac  <mgrac@redhat.com>

	fence agents: Option for setting port for telnet/ssh/ssl used by fence agent
	On some fencing devices there is possibility to change default port where
	ssh/ssl/telnet/... is listening. There is new option 'ipport' (getopt: -u)
	which can be used for this purpose. It is probable that it will make option
	'udpport' (also -u; currently used in SNMP based agents) obsoleted in one
	of the next versions.

	Resolves Red Hat Bugzilla: #506928

2009-06-12  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: #504705 - fence_lpar: lssyscfg command on HMC can take longer than SHELL_TIMEOUT
	The lssyscfg command issued to the HMC by fence_lpar to get the status of the
	LPAR can take longer than SHELL_TIMEOUT, 3 seconds.  This results in fencing
	failures which could be avoided if fence_lpar waited longer for the HMC to
	respond to the command.

2009-06-08  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_agents: #501586 - fence agents fails with pexpect exception
	try / except added to every fence agent where we try to exit using 'logout' functions.
	This happends after fencing was succesfull so it should not be a problem if it fails.

2009-05-29  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: #502674 - fence_lpar can't log in to IVM systems
	Added new command prompt used on IVM systems

2009-05-21  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_apc: #501586 - fence_apc fails with pexpect exception

2009-05-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: #496724 - support for modulename in drac5 agent

2009-05-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_scsi_test: #499871 - fence_scsi_test.pl does not check for sg_persist in the path

2009-05-05  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence agents: fix warnings spotted by paranoia cflags

2009-05-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence: drop obsoleted fence_manual man page
	BZ #456505

	build: fix doc Makefile to stub targets

	misc: drop obsoleted bits

	build: fix install target for SBINSYMT.

2009-05-04  Marek 'marx' Grac  <mgrac@redhat.com>

	fencing.py: #498329 -  fence_drac5 help output shows incorrect usage

2009-04-24  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_drac5: #462390 - Support Dell M600 Blade Chassis
	Agent for drac5 was extended to support M600. Detection of model is done automatically.

2009-04-22  Jan Friesse  <jfriesse@redhat.com>

	fence: Make SNMP v3 default for fence_intelmodular
	Since Intel Modular firmware update version 2.7, SNMP v2 write
	support is removed and replaced by SNMP v3 write support (big
	thanks to Matthew Kent for point to this).

	This patch makes SNMP v3 default and changes man page to reflect
	that.

	fence: Change force_ipvX to inetX_only
	Patch changes long option and XML option in cluster.conf from
	force_ipvX to inetX_only. It's because force something doesn't
	sound very nice. Short option -4/-6 still works.

	Idea of inetX_only is taken from wget, so users shouldn't be
	confused.

2009-04-09  Lon Hohberger  <lhh@redhat.com>

	fence: Add -U option to fence_xvmd.8

2009-04-03  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rsa: fix problem with ssh on some machines
	We need to ignore configuration file.

2009-04-01  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix nss_wrapper Makefile
	Cleanup unrequired bits and respect search orders for includes and libraries

2009-04-01  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_rsa: New fence agent for rsa with ssh support
	Fence agent is based on fencing library.

2009-03-31  Lon Hohberger  <lhh@redhat.com>

	fence_xvmd: Support FENCE_XVMD_DEBUG env. variable

	fence: Fix fence_xvmd log message
	Missing trailing newline.

	fence: Make fence_xvmd bind correctly
	If no interface is selected when using ipv4,
	go back to binding to 'any' address.

2009-03-27  Lon Hohberger  <lhh@redhat.com>

	fence_xvmd: Make -L imply -X.
	Obvious change: local only should imply no-cluster
	mode.

2009-03-26  Jan Friesse  <jfriesse@redhat.com>

	fence: Add support for IPv4/IPv6 forcing
	Support is added for agents written in Python, which
	uses standard fencing library and connecting
	by SNMP/nss_wrapper or SSH.

	Sadly telnet distributed with Fedora/RHEL doesn't
	has support for forcing IPv4/IPv6 connection, so
	it's impossible to implement this feature for agents
	using it.

	fence_nss_wrapper: Fix minor polling bug and force wrapper to build
	We need build wrapper in any case, because it's ilo
	dependency.

	Polling had little problem, which DIDN'T affect ilo fence
	agent.

2009-03-25  Jan Friesse  <jfriesse@redhat.com>

	fence_agents: Replaced telnet_ssl by fence_nss_wrapper
	Fence_nss_wrapper is drop-on replacement of telnet_ssl.
	This is hobbit like tool with support for NSS (SSL)
	connection.

	In contrast of old tool, this has many advantages:
	- Support for IPv6 (user can force IPv4)
	- Use polling instead of active waiting (non-blocking
	socket + sleep)
	- It's based on NSS (future of Fedora SSL)
	- Support for service names (not used in agents)

2009-03-24  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build/init: install/create common dirs
	a bunch of directories need to be created either at install time
	or by init scripts for the stack to operate properly.

	Make sure that the basic is all there from upstream.

2009-03-23  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_apc: #491640 -  APC Fence Agent does not work with non-admin account
	APC Fence agent does not work with non-admin account with firmware v3.5.x

2009-03-23  Jan Friesse  <jfriesse@redhat.com>

	fence: Fix configure script (hardcoded fenceagentslibdir path)
	This fix change hardcoded default value of variable
	fenceagentslibdir from /usr/share/fence to
	{prefix}/share/fence.

2009-03-22  Jan Friesse  <jfriesse@redhat.com>

	fence_snmp_*: Add missed sys.path.apend to SNMP agents
	If fencing.py and fencing_snmp.py is not installed in
	Python's search path, Python based fence agent will fall.
	This was (sadly) the case of SNMP based agents.

	This patch add sys.path.append to start of file, so
	everything should work now.

2009-03-20  Lon Hohberger  <lhh@redhat.com>

	fence: Fix fence_xvm[d] man pages

2009-03-16  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_agents: #487501 - Exceptions in fencing agents
	Fixing previous patch

2009-03-16  Jan Friesse  <jfriesse@redhat.com>

	fence_ipmilan: Fix metadata generation
	This patch changes unique value in metadata from 0 to 1.

2009-03-13  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_agents: #487501 - Exceptions in fencing agents
	Several of new fencing agent does not work when bad options are entered (bad
	password, non-existent outlet number, ...). This is not a problem. Unfortunately
	python exceptions are thrown and we don't care about catching
	them. Such output is very usefull for debugging (as people tends to send it)
	but it will be better if the user will see that the error is in the input data.

	Only bigger change is in APC. In other cases only catching exception was added.

2009-03-13  Jan Friesse  <jfriesse@redhat.com>

	fence_ipmilan: Added list, monitor and metadata operations
	List operation doesn't make big sense, but it's here.
	Monitor is basically only status operation.
	Metadata prints standard XML (same as fence_xvm) with
	agents metadata.

2009-03-12  Lon Hohberger  <lhh@redhat.com>

	fence: Make fence agent metadata valid XML
	This is needed by XSLT programs to transform the metadata
	to other formats (i.e. man pages, RelaxNG blobs, etc.)

2009-03-12  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: drop mibdir as it's now unrequired
	fence_apc_snmp has been rewritten and there is no more need
	to ship mib files.

2009-03-11  Jan Friesse  <jfriesse@redhat.com>

	fence_apc_snmp: Rewrite of agent under Python unified library
	Main functionality should be kept and has some new
	features, like list, metadata, and specially support
	for SNMP v3 with all authentification/privacy methods.

	fence_ibmblade: Rewrite of agent under Python unified library
	Main functionality should be kept and has some new
	features, like list, metadata, ...

	fence_intelmodular: Rewrite of agent under Python unified library
	Main functionality should be kept (thanks Matthew for
	testing), and has some new features, like list, metadata, ...

2009-03-06  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_egenera: Allow fence_egenera to specify ssh login name
	- bz #488958 - this patch should be shipped in 5.3 (closed errata)
	    but was not included
	- warning: -l is not used for login name but for lpan; so -u is used

2009-03-05  David Teigland  <teigland@redhat.com>

	fence_scsi: remove scsi_reserve and scsi_reserve_notify
	The fence_scsi agent itself does this stuff now with unfencing.

2009-03-05  Ryan O'Hara  <rohara@redhat.com>

	Add support for unfence operation.

2009-03-05  Jan Friesse  <jfriesse@redhat.com>

	fence_rps10: Removed RPS-10 agent
	WTI RPS-10 was serial port communication based PDU.
	It was able serve for only 2 nodes cluster and
	WTI don't longer sell it.

	So rest in piece RPS-10.

2009-03-04  Jan Friesse  <jfriesse@redhat.com>

	fence_ifmib: Brand new implementation of this agent
	Current version of agent is using unified Python library.
	Main new features:
	- Support for list/monitor action
	- Support for metadata
	- Support for SNMP v1/2c/3 (old has only 2c)
	- Port can be entered not only as ifIndex, but port name
	as well (ex. fc1/1).

	To update, user needs change ifindex parameter to much
	common port parameter.

	fence_mcdata: Fix unexpected port state Current versions of fence_mcdata wait for "Blocked: (true|false)", but newer models (like Sphereon 4500) return "Blocked:  (Blocked|Unblocked)" on the port show command.
	The attached patch adds the necessary bits to make the
	script recognize that it has indeed done the request action.

	This patch long lives in RHEL 4 branch, but never
	arrived to RHEL5/master/STABLE2/STABLE3.

	RHBZ#470983

2009-03-03  Jan Friesse  <jfriesse@redhat.com>

	fence_cisco_mds: Fix port handling
	Old code calls cisco_port2oid function in case, when
	no port was entered (list/monitor action). Another
	bug was bad call of fail_usage.

	fence_*.py: Fix no fencing.py based scripts to force stdout close
	This feature is advise from Jim Meyering. On the beginning
	of script, we register end callback, which close stdout and
	show error, if this wasn't successful.

2009-03-02  Jan Friesse  <jfriesse@redhat.com>

	fence_cisco: Added fence agent for Cisco MDS 9124/9134
	Agent uses SNMP, so Python fencing_snmp library is included
	in this patch too. This library uses fencing.py library,
	and add option to write small agents using SNMP. Library
	contains class FencingSnmp, designed to be instanciate and
	passed in agent's call of fence_action. After that, developer
	has in conn variable this object, and can call functions
	set/get/walk.

2009-03-01  Lon Hohberger  <lhh@redhat.com>

	fence-agents: Revert change to 'required' for 'action' operation

	fence-agents: Just print; no need for a buffer in fence_xvm

	fence-agents: Make fence_xvm's metadata not crash XML parsers

2009-02-27  Fabio M. Di Nitto  <fdinitto@redhat.com>

	ifmib: fix copyright attribution

	copyright: allow non-redhat-copyright in fence agents
	The build system was simply stupid. Fix that to allow
	proper copyright attribution.

2009-02-27  Jan Friesse  <jfriesse@redhat.com>

	fence_*.py: Fix Python (fencing.py based) scripts to force stdout close
	This feature is advise from Jim Meyering. On the beginning
	of script, we register end callback, which close stdout and
	show error, if this wasn't successful.

	fence_*.pl: Fix Perl scripts to force stdout close
	This feature is advise from Jim Meyering. On the beginning
	of script, we register end callback, which close stdout and
	show error, if this wasn't successful.

2009-02-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: stricter install invokation
	make install fails in shell loops to detect errors.

2009-02-23  Jan Friesse  <jfriesse@redhat.com>

	fence_vmware: Changed long option for datacenter Long options are mostly in format very-long-word. vmware_datacenter uses same format for stdin and for long option. Now long option is vmware-datacenter.

2009-02-20  Lon Hohberger  <lhh@redhat.com>

	fence: Make fence_xvm -o metadata work

2009-02-20  Jan Friesse  <jfriesse@redhat.com>

	fence: add missing man pages
	Ported from STABLE3.

	fence_vmware: Fix VMware helper script to force stdout close
	This feature is advise from Jim Meyering. On the beginning
	of script, we register end callback, which close stdout and
	show error, if this wasn't successful.

2009-02-19  Jan Friesse  <jfriesse@redhat.com>

	fence_vmware: Fix process of special characters (like ')
	This is only one agent using pexpect.run function (powerful
	replacement for popen function). It is able to parse strings
	in very shell way (so string closed in ' or " is  processed
	with spaces). Problem is, if user has password/user name/...
	with this characters.

	Patch fixing bug by adding quote_for_run function, which just
	replace every ' by '\''. So to pexpect.run is passed right
	string.

2009-02-18  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: #485065 Typo
	Change 4 to "4" as python needs

2009-02-16  Marek 'marx' Grac  <mgrac@redhat.com>

	bladecenter & wti: Fix operation 'list'
	Operation 'list' requires 'separator' on device's option list. Otherwise it
	would not set 'separator' and 'list' will fail with python backtrack

	fence_lpar: Fix 'list' operation for HMC v3

	fence_lpar: #485065 Add support for HMC v3
	New options for LPAR agent: (-H; hmc-version) and (-c; command-prompt). HMC version
	have to be set because v3 and v4 are not compatibile. It is possible to auto-detect
	version (lshmc -V) but this is quite slow to do it in each fencing operation. Default
	value is '4' because we don't want to change previous behaviour. It does not mean
	that it should not work with HMC v5, v6 - we just need to mark them.

	Command prompt option was set to default value but missing in device's options. Older
	LPAR has different prompt so it was added to default one. If you wish to add your own
	prompt that remember that $ has to be written as '\$'.

2009-02-11  Marek 'marx' Grac  <mgrac@redhat.com>

	fence_lpar: #481566 - properly report status on systems in Open Firmware

	fence_wti: #481664 -  fence_wti is unable to connect to (password-less) fencing device
	Login mechanism was completely rewritten so now we support no-loginname, no-password and
	possibly any other configuration.

2009-02-09  Jan Friesse  <jfriesse@redhat.com>

	fence_ipmi: Increased number of retries to action This patch is originally provided by Kris Lindgren. It increases number of retries to 7 and make time between operation and status shorter. It makes more calls, if IPMI seems not to react.

2009-02-06  Jan Friesse  <jfriesse@redhat.com>

	fence_ipmilan: Better name for unused variable in expect.c Foo variable name is not very descriptive.

2009-02-05  Jan Friesse  <jfriesse@redhat.com>

	fence_ipmilan: Cygwin doesn't like NULL in times function
	Times function was used with NULL parameter. On Linux everything
	worked, but Cygwin doesn't like this (returned value was -1). This
	patch add foo_tms, which is argument for times. This shouldn't hurt
	anything, but makes Cygwin happy.

2009-01-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: update copyright file

2009-01-21  Marek 'marx' Grac  <mgrac@redhat.com>

	intelmodular: rename fence agent
	There was a conflict between real name and its usage in Makefile

	intelmodular: Add Intel Modular Server fencing agent based on ibmblade fence
	Support for new fencing device.
	Posted by Matthew Kent.

	fencing.py: long options correction
	Minor problem with long options, posted by Matthew Kent

2009-01-21  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: scan for fence agents only when required to do so

2009-01-19  Jan Friesse  <jfriesse@redhat.com>

	fence: vmware helper better handling power on/off errors
	Because of nature of VMware cluster, there may be situation,
	when VMware cluster itself start fenced virtual machine before
	our agent. Without this patch, this leads to error. Now, only
	warning is produced, but return code of helper is still 0.

2009-01-15  Jan Friesse  <jfriesse@redhat.com>

	fence_vmware: Improve speed for status operation => whole fencing
	Before this patch, agent used for implementation of get status
	list operation. This is nice in code, but because list operation
	on ESX with many (200+) registered VMs takes very long (21+ sec),
	whole fencing (3x21+off/on) can take even longer.

	Some minor remove of residuum from old vmware_vi, in helper is
	removed too.

2009-01-14  Jan Friesse  <jfriesse@redhat.com>

	fence: Fix bad name for vmware helper
	This patch remove residuum of old vmware_vi, where
	helper was named fence_vmware_vi_helper. New correct
	name is fence_vmware_helper.

2009-01-13  Jan Friesse  <jfriesse@redhat.com>

	fence: Added change needed for previous patch.
	This patch deletes old VMware device options and defines
	new.

	fence: Fusion of vmware_vi and vmware_vmrun into one agent
	It's really sad to have 3 different agents for one type of
	device. This patch deletes old ssh based vmware agent, and
	replace it with fusion of vmware_vi and vmware_vmrun.

	This solution is cluster aware and able to fence VMware
	ESX/ESXi/VC/Server 1/Server 2 (see man page). Only one
	disadvantage against old agent is, that user must install
	VI Perl or VIX API to every node which do fencing. I hope
	it's only small price for all benefits user will get.

2009-01-12  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: Update copyright for 2009
	also purge non-relevant part of the COPYRIGHT file.

2009-01-09  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence_scsi: improve init script
	based on Marian Marinov submission for gfs2 init script,
	simplify the init script distro overrides to make the script
	easily readable again and also easier to write.

	Set also a secure PATH.

2009-01-08  Jan Friesse  <jfriesse@redhat.com>

	fence: Fix virsh agent and ssh_options in case of ssh private key
	Virsh agent should use --noprofile and --norc when invoking bash, because
	in other case, all PS1 setting doesn't make any sense.

	fencing.py.py library have two branches for invoking ssh command. One
	case is without ssh private key and other is with it. Case without
	private key process ssh_options agent key, but other branch not.
	This patch fixes that and now both branches behave correctly.

2009-01-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	split tree into separate projects

	new fence-agents master test commit

2009-01-05  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Make API calls work on an inquorate system

	cman: fix error checking in testcmanquorum1

	cman: more corosync changes

	cman: Make new services compile with latest corosync

2009-01-05  Fabio M. Di Nitto  <fdinitto@redhat.com>

	config: time to say goodbye to ccsd
	remove all legacy code that won't be released from master anymore

	qdisk: fix mkqdisk output
	we killed output to std* by default in logging. we can't use log*print*
	anylonger for this operation. Switch back to printf.

2009-01-02  Christine Caulfield  <ccaulfie@redhat.com>

	cman: let 'cman-tool leave -w' wait even if shutdown has already started

	cman: Return an error if 'cman_tool leave' is attempted during shutdown
	There were some occasions when 'cman_tool leave' simply returned success
	even though shutdown had already started. This fixes those.

	cman: make 'cman_tool leave -w' wait until cman has shut down
	Once we get a sucessful return from cman_try_shutdown there still
	might be a delay before cman actually shuts down because
	the LEAVE messages need to be sent around the ring.

	cman_tool now waits until it can no-longer contact cman if -w is
	given on the command-line.

2008-12-23  David Teigland  <teigland@redhat.com>

	dlm_tool: change to new debugfs scan
	The rsb addr was added to the output.

2008-12-22  Bob Peterson  <rpeterso@redhat.com>

	gfs: improve gfs_fsck rindex repair code
	bz 442271 - GFS: gfs_fsck bugs found in rindex repair code

	This patch makes improvements and fixes some bugs in gfs_fsck's
	rindex repair code.  Basically, if RGs are damaged, especially
	in the third section (i.e. RGs added by gfs_grow) it did not
	properly locate the RG boundaries.  Also, if the rindex was
	completely zeroed out, it did not recover it in cases where
	the file system had been extended.

2008-12-19  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: restore original behaviour when building groupd
	fix small regression introduced when merging pacemaker build patches

2008-12-19  Christine Caulfield  <ccaulfie@redhat.com>

	cman: fix cman_tool join return code
	Tha last checkin broke the cman_tool return code. The FORKED and SUCCESS
	messages could (and in a normal run often would) be returned as part
	of the same pipe read.

2008-12-18  Christine Caulfield  <ccaulfie@redhat.com>

	cman: drastically improve startup errors
	cman_tool join has a nasty habit of just exiting with
	"corosync failed to start" or some such unhelpful error message.

	This patch improves on these by trapping the corosync exit code and
	attempting to interpret it for the user.

2008-12-17  David Teigland  <teigland@redhat.com>

	dlm_tool: lockdebug using new debugfs file
	A new dlm patch adds a new debugfs file that shows more
	info about rsb/lvb/lkb structs.  dlm_tool lockdebug <name>
	will use this new file, if available, and display the
	new info in a format similar to the original format.

2008-12-17  Christine Caulfield  <ccaulfie@redhat.com>

	cman: add cman3 services
	These services are corosync plugins and libraries that implement the 'old'
	cman functions in a more standard manner. The quorum plugin is a generic
	quorum provider that uses the CMAN (openVMS) algorithm to provide quorum and
	adds the hooks for a quorum device. With a compilation flag it can be made
	wire-protocol compatible with the 'old' cman plugin.

	The new cman service provides everything else that iold cman providef that's
	not related to quorum and is intended as a backwards-compatibility layer.

	The libcman part is not yet complete so I'm not going to replace the existing
	'daemon' directory here just yet, also I don't think it's ready to be built as
	standard with the rest of the tree. This is more of a statement of intent
	than working code ;-)

	Signed-Off-By: Chrissie Caulfield <ccaulfie@redhat.com>

2008-12-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	ccsd: port to logthread infrastructure
	Several changes across the whole tree to use logthread instead of logsys.

	libccsconfdb: do not allow logfile_priority to override debug.
	debug output is generally more important than logfile_priority.

	logthread: filter messages to stderr to respect logging priorities

	dlm_controld: stop linking against logsys
	Remove leftover linking bit from Makefile.

2008-12-16  Bob Peterson  <rpeterso@redhat.com>

	Make gfs2_freedi delete indirect blocks with height >= 2
	bz 474707 - GFS2: gfs2_convert not freeing blocks when removing file with height >=2

	Before this patch, the libgfs2 function gfs2_freedi would only
	free indirect blocks from an inode at height==1.  If an inode
	grew to a height of 2 or more, some blocks would not be freed
	when they should have been.  This patch allows it to free all
	indirect blocks at all heights.  In the case of the bugzilla,
	the users would run gfs2_convert on a gfs file system and
	afterward, gfs2_fsck would find a number of blocks that should
	have been freed, but were not.

2008-12-15  Bob Peterson  <rpeterso@redhat.com>

	Remove splice_read file op for jdata files.
	bz 436811 - Some files with inherit_jdata flag will not allow reads from apache

	The splice_read op is supported for normal files but not
	journaled files.  Rather than return a bad return code
	when invoked, this removes the splice_read op from the
	file ops for jdata files.  That enables callers to find
	an alternative method of accessing the jdata file rather
	than failing the operation.

2008-12-15  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix fence_scsi installation bits

	build: fix typo and get rgmanager to build again

2008-12-15  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Support for 'metadata' option for fencing agents / default values
	Fencing library now understand new 'metadata' action which shows
	available commands (for use on stdin). Output should be compatibile
	with stonith agents. Currently it is just partial (parameters only).
	We will extend it according to what we really needs. It should be
	possible to use these metadata for building UI. Device options now
	contains 'short description' and earlier option 'order' was added so we
	can set the correct orded (it will be same as in --help).

	Default values are now stored in fencing library as they are used for
	metadata generating. Fence agent can set their default settings to all_opt.

	There is a bit of redundancy ('required') because we will check it later.
	But I was not able to describe requirements without using not-naive schema.

2008-12-12  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Part 2 - flip logging function name

	rgmanager: Fix up logging, part 1
	* Let clulog report the parent resource-agent
	* Use ccs_read_logging API
	* Don't break old configs using rm/@log_level or log_facility

2008-12-12  Bob Peterson  <rpeterso@redhat.com>

	Grab hold of journal-turned-RG buffers so they're not freed.
	bz 471618

	This is addendum patch 3 for bug 471618.  The problem is, we
	weren't making a claim on buffers that used to be for the journals
	under GFS, but now are RG space for GFS2.  So the buffer may go away
	especially when running gfs2_convert on a file system that's full.
	When the buffers are released at the end, they may not really
	exist any more, which caused a segfault.  Grabbing hold of the
	buffer ensures they won't go away, so freeing them will work as
	normal.

2008-12-12  Lon Hohberger  <lhh@redhat.com>

	fence_xvm: Use new logging config parameters

	logthread: Add missing prototype

	logthread: Make multiple init/exit calls work
	* This patch allows a user to call logt_init()/logt_exit()
	as much as is needed.

	* A new function, logt_reinit() is added for convenience.
	This function uses values previously supplied to the
	logt_init() function to reinitialize the log system.  This
	can be done post-fork, for example.  Note: you MUST call
	logt_init() and logt_exit() before logt_reinit() can be
	used.

2008-12-12  Christine Caulfield  <ccaulfie@redhat.com>

	cman: fix memory leak
	This is a very small memory leak but it could add up in some
	very long-lived processes that send a lot of messages.

2008-12-12  David Teigland  <teigland@redhat.com>

	dlm_controld/gfs_controld: read lockless resources from ckpts
	When we mount and read plock state from a checkpoint, we can't
	ignore zero-size checkpoint sections, because we need to add
	the resource along with its owner from the section id.  What
	should be skipped are zero-length section id's.

	dlm_controld/gfs_controld: dump unused resources
	Unused/cached resources have owner state that's useful to
	see in the debug dump.

	dlm_controld/gfs_controld: fix plock rate limiting
	When the plock rate limiting code enabled locking after disabling
	it, it would be immediately disabled again.  So, once plocks were
	disabled due to the rate limit, they would never be processed again.

2008-12-11  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Fix license for follow-service.sl

2008-12-11  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Make cman-preconfig reload <totem> too
	When reload is called we now create a new totem key for corosync. I have
	a patch for corosync that will allow dynamic configuration
	of totem parameters.

	cman: Make cman the quorum provider for corosync
	cman now plugs into the Quorum API for corosync and tells it
	(and any interested subsystems) whether the cluster has quorum.

2008-12-10  Bob Peterson  <rpeterso@redhat.com>

	mkfs.gfs2 hangs with many journals
	bz 471618

	This is the addendum 2 patch for bug #471618.  There are
	two fixes: (1) switches the order back to normal (reverse)
	when freeing buffers.  This ensures the oldest buffers are
	freed before the more recent, which is what we want and
	how it was originally.  (2) The get_first_leaf and
	get_next_leaf code were making the faulty assumption that
	the buffers they're searching will be in memory.  That may
	not be the case, especially if the buffer order is incorrect
	(as in fix (1)).

	Use jbsize for height computations on journaled files.
	bz 475488

	This is an addendum patch for bug #471618.
	Without this patch, users may encounter an infinite loop
	in mkfs.gfs2 if the number of journals causes the block
	size to be exceeded for the per_inode system directory.
	For a block size of 1K, specifying five journals on
	mkfs.gfs2 will cause this problem.  For a default 4K block
	size, you would likely need 17 journals to get the hang.

2008-12-10  David Teigland  <teigland@redhat.com>

	dlm_controld/gfs_controld: plock config paths
	In cluster2 where plocks are done by gfs_controld, plock config options
	are under <gfs_controld/>.  In cluster3 plocks are done by dlm_controld
	(and gfs_controld for back-compat), and plock config options are under
	<dlm/> (or <gfs_controld/>).  Make both gfs_controld and dlm_controld
	look for plock config options under both <gfs_controld/> and <dlm/>.

2008-12-10  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Include follow-service.sl in the install

2008-12-10  Mark Grimme  <grimme@atix.de>

	rgmanager: Add follows-service script

2008-12-10  Mark Hlawatschek  <hlawatschek@atix.de>

	rgmanager: Update SAPInstance / SAPDatabase to current versions

2008-12-09  Lon Hohberger  <lhh@redhat.com>

	rgmanager: make dtest compile

2008-12-09  Jan Friesse  <jfriesse@redhat.com>

	fence: VMware VI better handling of "strange" names
	Patch solving situations when user enter machine
	name with \t in name. Output of helper is now in DSV
	format.

	fence: VMware VI helper path fix
	Fix localtion of VMWare VI helper in main agent.

2008-12-09  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: install fence_vmware_vi_helper in sbindir

	build: don't set exec bit on built files.
	this should be done by install.

	build: install fence_vmware_vi bits in the appropriate locations
	no changes to the fencebuild.mk script were required afterall.

2008-12-09  Jan Friesse  <jfriesse@redhat.com>

	fence: Added fence agent based on VMware VI API
	Why another VMware agent? Because VI API is only one
	really cluster aware (this means, it is only one ready
	to distinguish between datacenters, folders, ...).

2008-12-09  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix fence agents man page Makefile
	remove duplicate entry and sort alphabetically.

2008-12-08  Steven Whitehouse  <swhiteho@redhat.com>

	cman: loading lock_dlm module should be optional in initscript
	Loading the lock_dlm module should be optional since it is optional
	in the kernel configuration, and in the future we intend to merge
	it into gfs2 itself.

2008-12-08  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix dlm_controld makefile
	clean a bit the ifdef enable_pacemaker and fix an object entry.

	dlm_controld: include saAis from openais
	the duplicate version in corosync has been correctly revomed
	from the tree. Use the right one.

	libccs: build with latest corosync
	replace saAis.h with corotype.h and SA_AIS_OK with CS_OK.

2008-12-05  David Teigland  <teigland@redhat.com>

	gfs_controld: use new uevent strings
	Use the new uevent strings when available, otherwise fall back to
	using sysfs files.

	(Fixes and some minor munging to Steve's initial patch.)

2008-12-04  David Teigland  <teigland@redhat.com>

	dlm_controld/gfs_controld: plock dump display resource owner
	When plock ownership is enabled, it's important to see which
	node is the resource owner.

	gfs_controld/dlm_controld: fix lock syncing in ownership mode
	bz 474163

	Locks that are synced due to a resource being "un-owned"
	were having their read/write mode reversed on the nodes
	being synced to.  This causes the plock state on the nodes
	to become out of sync, and operate wrongly.

2008-12-03  Nicolas MONNET  <nicolas.monnet@ingenico.com>

	rgmanager: Make postgres-8.sh use su instead of sudo
	Resolves part of #462910

2008-12-03  Jan Friesse  <jfriesse@redhat.com>

	fence: Set binary on telnet connections
	Resolves: #469066

2008-12-02  Andrew Beekhof  <abeekhof@suse.de>

	dlm_controld: pacemaker build
	stuff to build pacemaker version of dlm_controld

2008-12-01  Bob Peterson  <rpeterso@redhat.com>

	Fix many bugs with gfs2_convert.
	bz 471618 - GFS2: gfs2_convert is broken

	Functional changes to the code are as follows:

	1. Original problem is fixed

	The original problem reported in the bug was caused because
	there is a fundamental shift of indirect block pointers between
	GFS1 and GFS2.  For indirect blocks, GFS1 added 64 bytes of
	reserved space after the gfs meta header.  GFS2 did not.  That
	meant GFS1 could hold fewer pointers than GFS2 on the same block.
	The meant code had to be added to gfs2_convert to shuffle all
	the pointers around to their corresponding gfs2 locations.
	This was not a simple calculation because of sparse files.  For
	example, with a 1K block size, if you do:

	dd if=/mnt/gfs/big of=/tmp/tocompare skip=496572346368 bs=1024 count=1

	the resulting metadata paths will look vastly different for the
	single block of data:

	height    0     1     2     3     4     5
	GFS1:  0x16  0x46  0x70  0x11  0x5e  0x4a
	GFS2:  0x10  0x21  0x78  0x05  0x14  0x78

	It is relatively easy to calculate the new metapath, but you
	can't just shuffle a pointer from its old location to its new
	location because the destination slot might be used for a
	different source slot.  In the example above, we couldn't just
	move the pointer at height 3 from offset 0x11 to another block
	at offset 0x05 because there might already be a pointer at 0x05
	being used for something else.

	To complicate matters, we could not just assign new blocks and
	copy the data because we should be able to run on a "full" file
	system.  So I had to write a complex new function called
	adjust_indirect_blocks along with several support functions.
	Someone else might be able to write a function to get the job
	done simpler, but at least this one works for both sparse and
	fully-packed metadata trees of several heights.  It basically
	formulates in memory a metadata tree for all the data blocks,
	clears out all the metadata buffers, and lays them all back down
	again according to the new layout.

	2. Improved error checking

	I added some badly needed error checking.  That's because I was
	running into problems and wanted to eliminate the possibility
	that errors were occurring, but not being reported.

	3. Improved progress reporting

	With a large number of resource groups, I saw long periods of
	time where the program would just sit for five minutes.  I was
	afraid that the tool had hung, so I kept breaking in with gdb
	to check on the tool's progress.  But if I'm that concerned
	about what it is doing when it's quiet, so too will be the
	customers who are anxiously trying to watch its progress.  So I
	added periodic reports of progress through the RGs when converting
	inodes, and also an occasional "." when the RGs themselves are
	being analyzed and/or manipulated.

	Same goes for writing out the new gfs2 journals.  The journals in
	gfs2 are quite different and we need to write them out entirely,
	all 128MB.  That takes a fair amount of time going through the
	functions in buf.c.  So I added a new message when each journal is
	written, so that the code doesn't appear stuck for a long period
	of time.  This could still use some improvement, but it's better.

	I also modified the progress messages to make them more clear.
	For example, the message "Removing obsolete gfs1 structures"
	sounded to me like it could cause alarm or panic to a customer.
	So I rephased it to "Removing obsolete GFS1 file system
	structures".

	4. Journal size was not being preserved

	In testing, I discovered that if the source file system had 32MB
	journals, the reformatted GFS2 file system had 128MB.  I decided
	that's not good and decided to fix it.  That is especially
	important if the file system is "full" to begin with because we
	can't add more blocks.

	5. Fixed a segfault dealing with buffer management.

2008-12-01  Christine Caulfield  <ccaulfie@redhat.com>

	cman: make it compile with latest corosync
	corosync_tpg_handle was renamed to cs_tpg_handle for some reason.

	cman: Don't crash cman_tool nodes -a
	cman was returning a success status but no data if the node id
	passed to cman_get_node_addrs isn't currently in the cluster.

2008-12-01  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence: install virsh fence agent man page

2008-11-27  Steven Whitehouse  <swhiteho@redhat.com>

	GFS: Send useful information with uevent messages
	In order to distinguish between two differing uevent messages
	and to avoid using the (racy) method of reading status from
	sysfs in future, this adds some status information to our
	uevent messages.

	This patch makes the same changes as the recent GFS2 patch.

2008-11-26  Steven Whitehouse  <swhiteho@redhat.com>

	GFS: Send sensible sysfs stuff
	The fix to make gfs1 send the info that we need to process
	the uevents which it generates.

2008-11-25  David Teigland  <teigland@redhat.com>

	group_tool: fix dump
	dumping the groupd debug buffer broke a while back due
	to not reading the correct buffer size

	gfs_controld: cannot connect to dlm_controld error
	Log an error message stating the reason for failing to start
	when it cannot connect to dlm_controld.

	fenced/dlm_controld/gfs_controld: improve groupd waiting
	When polling groupd for the group_mode during startup, wait longer
	(30 sec) if we're getting an EAGAIN response from groupd, meaning
	groupd is still working on it.  Wait for only 5 sec if we can't
	connect to groupd at all, which probably means it's dead.

	groupd/fenced/dlm_controld/gfs_controld: get logfile from ccs
	ccs_read_logging bug has been fixed, let it set logfile again.

	libccs: fix ccs_read_config
	The helper function for reading a string needs to memset
	the destination buffer to zero even when there's no new
	string to copy to it.  The result of this was most obvious
	by the random data it would copy into the logfile name.

2008-11-25  Jan Friesse  <jfriesse@redhat.com>

	fence: Add libvirt (virsh) based agent
	Following agent is very different in way how it works from
	our xvm fence agent. This agent connects via ssh to dom0
	and there run virsh, which performs required action.

	rhbz#472785

2008-11-25  David Teigland  <teigland@redhat.com>

	dlm_controld: recv error checking
	in process_uevent wasn't looking at errno.

2008-11-25  Steven Whitehouse  <swhiteho@redhat.com>

	gfs_controld: recv error checking
	in process_uevent wasn't looking at errno.

2008-11-25  Jan Friesse  <jfriesse@redhat.com>

	fence: fix IPMI over lan to support ciphersuite select
	If user select lanplus as IPMI protocol, ipmitool
	automatically select cipher type 3. This patch add
	possibility to select another type of cipher. New -C
	parameter is directly passed as -C parameter to ipmitool.

	rhbz#447497

2008-11-24  David Teigland  <teigland@redhat.com>

	groupd/fenced/dlm_controld/gfs_controld: log logging settings
	Put the logging settings in the debug log.

	ccs_read_logging() is corrupting the logfile parameter, so temporarily
	pass it a junk buffer.

	liblogthread: do nothing without init
	If logt_init() hasn't been called, or if logt_exit() has been called,
	do nothing with a logt_print() or a logt_conf().

	fenced: log protocol message type
	in debug logs instead of "unknown".

	fenced/dlm_controld/gfs_controld: error handling in groupd detection
	If daemon is supposed to get group mode from groupd and can't, then
	exit with a failure.  Also, retry groupd detection whether we get
	-EAGAIN back from groupd, or fail to get a version from groupd.

	fenced/dlm_controld/gfs_controld: log exiting message only once
	The "cluster is down, exiting" message should only be logged once
	by a daemon.

	groupd: libcpg mode can skip some more libgroup stuff
	In confchg for the "groupd" cpg, we should exit earlier when in
	libcpg mode instead of going through pointless libgroup steps.

2008-11-24  Lon Hohberger  <lhh@redhat.com>

	qdisk: Allow old logging style until next release

	qdisk: More misc cleanups.
	* Nuke README; information that used to be there is in
	  qdisk.5 anyway
	* Nuke crc32.c and put the wrapper function in disk.c since
	  that is the only place it is used.

	qdiskd: Misc. cleanups, esp. loop cleanups in main.c
	Also use the ../../common/liblogthread API for now at
	least until logsys v2 stabilizes

2008-11-24  Ryan O'Hara  <rohara@redhat.com>

	Fix check_mount to correctly test if device is mounted/busy. Attempt to open the device with O_EXCL flag. If errno is EBUSY, the device is busy/mounted. (BZ 240584)

2008-11-21  David Teigland  <teigland@redhat.com>

	groupd/fenced/dlm_controld/gfs_controld: startup info messages
	When each daemon starts have it log an INFO message showing its name
	and version.  Also, have groupd consistently log and INFO message showing
	the the compat mode that's been selected.

2008-11-21  Lon Hohberger  <lhh@redhat.com>

	liblogthread: work with stderr etc
	v*printf can't be used twice between va_start and va_end, so this patch
	does the following:

	* call vsnprintf once
	* fputs() to stderr
	* send to _logt_print for queueing if needed

2008-11-21  Benjamin Marzinski  <bmarzins@redhat.com>

	gfs-kernel: workaround for potential deadlock. Prefault user pages
	The bug uncovered in 461770 does not seem fixable without a massive
	change to how gfs works.  There is a lock ordering mismatch between
	the process address space lock and the glocks. The only good way to
	avoid this in all cases is to not hold the glock for so long, which
	is what gfs2 does. This is impossible without completely changing
	how gfs does locking.  Fortunately, this is only a problem when you
	have multiple processes sharing an address space, and are doing IO
	to a gfs file with a userspace buffer that's part of an mmapped gfs
	file. In this case, prefaulting the buffer's pages immediately
	before acquiring the glocks significantly shortens the window for
	this deadlock. Closing the window any more causes a large
	performance hit.

2008-11-21  David Teigland  <teigland@redhat.com>

	groupd/fenced/dlm_controld/gfs_controld: don't retry ccs_connect
	These daemons had an infinite loop around ccs_connect() in setup_ccs().
	This would cause the daemon to hang if corosync/cman crashed between
	setup_cman() and setup_ccs().

	ccs_connect shouldn't need to be retried anyway since cman and ccs are
	now unified and we do the necessary waiting for cman (and therefore ccs)
	to be ready in setup_cman().

2008-11-21  Fabio M. Di Nitto  <fdinitto@redhat.com>

	cman: reenable stderr output in notifyd

	build: fix fence_node Makefile
	Add missing include dir and linking dir for liblogthread

2008-11-20  David Teigland  <teigland@redhat.com>

	fence_node: use logthread
	instead of logsys, and init the lib (and its thread) after calling
	into libfence which forks/execs (complicating running threads).

2008-11-20  Andrew Beekhof  <abeekhof@suse.de>

	dlm_controld: add pacemaker support
	Adds code for dlm_controld to run under pacemaker instead of cman.
	Does not include any of the build-related changes.

2008-11-20  David Teigland  <teigland@redhat.com>

	groupd/fenced/dlm_controld/gfs_controld: log macros
	Restore the original method of creating the debug string with a
	time stamp that's used for the memory debug buffer and stderr.
	The call to logt_print can just use the fmt/args directly; using
	the temp debug string is pointless.

2008-11-20  Jan Friesse  <jfriesse@redhat.com>

	fence: fix IPMI man page
	Documented timeout (-t) option.

2008-11-20  David Teigland  <teigland@redhat.com>

	liblogthread: add LOG_MODE_OUTPUT_STDERR
	When set, logt_print() always prints whatever it gets to stderr.
	It's really out of place in this library, please feel free to not
	use it and print to stderr yourself.

2008-11-20  Jan Friesse  <jfriesse@redhat.com>

	fence: fix IPMI spawn /bin/bash rather than /bin/sh
	It's not guaranteed, that /bin/sh will be symlink to
	shell, which is bash (or ksh) compliant, so it's better
	to use /bin/bash.

	fence: fix IPMI typo in help
	Help contained description of -i option with comment,
	that this option is deprecated and you should use -i. This
	is nice recursion, but there should be -a.

	This fixes BZ #210687

	fence: fix IPMI parameters containing special characters
	IPMI fence agent works by spawn a /bin/sh and ipmitool.
	If host name/password or any other command line argument
	included special shell characters (like $, ", ', ...) shell
	will try to substitute. This is not allowed behaviour and
	this patch fix it.

	Should fix BZ #447964

2008-11-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	cman: make init script stop cmannotifyd

	build: allow system to use zlib in non standard paths

	build: fix missing ${logtlibdir} for linking

	cman: port notifyd to new logthread api
	temporary disable output to stderr.

2008-11-19  David Teigland  <teigland@redhat.com>

	gfs_controld: new logging stuff
	Changes per recent discussion on cluster-devel mailing list.

	dlm_controld: new logging stuff
	Changes per recent discussion on cluster-devel mailing list.

	liblogthread: improve thread handling
	Found cleaner way of starting and stopping thread; just
	a more correct way of handling things overall it appears.

	groupd: new logging stuff
	Changes per recent discussion on cluster-devel mailing list.

	fenced: new logging stuff
	Changes per recent discussion on cluster-devel mailing list.

	liblogthread: time stamp when entry is added
	instead of when the thread does the write.

	liblogthread: new options
	Changes per recent discussion on cluster-devel mailing list.

	libccs: update ccs_read_logging
	Changes per recent discussion on cluster-devel mailing list,
	largely related to debug and logfile_priority.

2008-11-19  Lon Hohberger  <lhh@redhat.com>

	qdisk: Remove antique #ifdefs for old kernel-mode CMAN

	qdisk: Update man page.  Nuke crc32 code and use zlib.
	* Show which options may be reconfigured while qdiskd is
	running (either from a cman config update callback or using
	kill -HUP).
	* Shipping our own crc32 algorithm is a waste of code space.

	qdisk: Make online reconfig actually work

	rgmanager: make max_restarts work w/o restart_expire_time

	qdiskd: Process reconfiguration events from CMAN

	qdiskd: Always use O_NONBLOCK when writing to status_file

2008-11-19  Jan Friesse  <jfriesse@redhat.com>

	fence: IPMI over lan timeout adjusted and configurable
	This patch adjust timeout to default value 10s which
	should be enough for most today IPMI implementations.
	It also removes retries, because this job is done
	by fenced.

	Because some devices still need longer timeouts,
	timeout is adjustable by parameter -t (or timeout for stdin
	and XML configuration).

	This should fix BZ: 401481, 276541 and 452894

2008-11-19  Christine Caulfield  <ccaulfie@redhat.com>

	cman: fix signatures of cman_get_privdata & cman_set_privdata
	They do NOT take a pointer to a handle.

2008-11-19  Fabio M. Di Nitto  <fdinitto@redhat.com>

	xmlconfig: major rework
	cleanup completely our dependency on xpath.

	use XML internal data structure to get objects and keys associated to
	objects.

	speed up the whole config load time a lot.

	remote completely all exception handling that's now done using xml data
	instead.

	considerably reduce the amount of memory required to load the config.

	cleanup other bits (drop unrequired includes and invoke some XML cleanup
	code).

2008-11-18  Steven Whitehouse  <swhiteho@redhat.com>

	mount.gfs2: Remove unused ondisk2.c file
	Just removing an unused file

	libgfs2: Remove unused #defines
	Getting rid of some unused stuff.

2008-11-18  Fabio M. Di Nitto  <fdinitto@redhat.com>

	gnbd: remove from cluster project
	GNBD is now officially a separated project.

	Code for master branch can be found here:
	http://git.fedorahosted.org/git/gnbd.git

	build: change error string

2008-11-17  David Teigland  <teigland@redhat.com>

	fenced/dlm_controld/gfs_controld: config update reread
	Reread some daemon config options from ccs when we get
	a config-update callback.

2008-11-17  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Avoid status checks during reconfiguration
	Ignore queued status checks if a configuration update
	is pending.  Basically, a queued status check during
	reconfiguration could get a status check done before
	the update is complete, causing an erroneous service
	restart.

2008-11-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: allow libs to have indipendent sonames
	by defining SOMAJOR and/or SOMINOR within the library Makefile, we can
	now override global setting.

	This can be useful if we need to bump the API/ABI of one single library.

2008-11-14  Lon Hohberger  <lhh@redhat.com>

	rgmanager: make clulog accept "-" as the first char in messages
	Resolves:
		https://bugzilla.redhat.com/show_bug.cgi?id=471431

2008-11-14  Bob Peterson  <rpeterso@redhat.com>

	GFS2: gfs2_edit savemeta doesn't work with GFS
	bz 471239

	This patch fixes several problems when saving and restoring
	GFS and GFS2 metadata when the block size is not the default
	of 4K.  Some of the problems fixed:  (1). GFS and GFS2 have
	different starting offsets and lengths for indirect block
	pointers.  This required a number of code adjustments.
	(2). The journal index information is kept differently in GFS,
	so I had to change how the journal index buffers were managed.
	(3). The GFS dinode structure is slightly different from GFS2
	and that was throwing off calculations because the di_height
	value was in the wrong location.  Smaller block sizes made it
	worse (more blocks and a bigger height required for the same
	information).  (4) GFS1 indirect pointer blocks look like
	metadata whereas GFS2's do not.  As a result, gfs2_edit was
	improperly truncating those blocks for GFS1 (trying to avoid
	capturing user data versus metadata).

2008-11-13  David Teigland  <teigland@redhat.com>

	group_tool: show groupd compat info
	Show the groupd compatibility mode in output of group_tool ls.

	Suggest 'group_tool ls' if compat mode is 1 and daemons were
	queried (with -a) instead of groupd.

	Suggest 'group_tool ls -a' if compat mode is 0 and groupd was
	queried (without -a) instead of the daemons.

	fence_tool: refuse to leave if dlm lockspaces exist
	We already checked for mounted gfs/gfs2 filesystems and refused to
	leave if any were found.  We should also refuse to leave if any
	dlm lockspaces exist.

	dlm_controld: clear plock syncing flags
	When a bunch of nodes all join a new lockspace together, no one will
	have any plock state, and no one will do a checkpoint to sync plock
	state to others.  We just need to recognize when that happens and
	clear the need_plock and save_plock flags; the routine that completes
	the syncing process won't ever run to do it.

2008-11-13  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Put init_resource_groups prototype in one place

	rgmanager: Remove polling code; misc cleanups
	Fix some uninitialized variables & function prototype
	mismatches.

2008-11-12  Marek 'marx' Grac  <mgrac@redhat.com>

	[fence] Extension to fence agent for LPAR/HMC with 'list'/'monitor' operation

	[fence] Extension to fence agent for BladeCenter with 'list'/'monitor' operation

	[FENCE] Support for long options (eg. --ssh, --help)
	This patch adds a support for long options (using standard getopt) to all fence
	agents. Names of long options are not stable, so it is possible that they will change
	before merging to other branches.

2008-11-11  Fabio M. Di Nitto  <fdinitto@redhat.com>

	config: fix loading of multiple objects with no subojects
	libxml returns a different value for <foo/> depending if foo has
	child entries or not.

	Use a bit of string magic to use the return value always in the same
	way.

	libfence: use ccs_connect instead of force_connect.
	force_connect without arguments is the same as ccs_connect.

	ccs_connect in 3.0 does not depend on quorum anylonger like it used
	to and it will allow connection as soon as cman/corosync is up and
	running.

2008-11-10  David Teigland  <teigland@redhat.com>

	libfence: no logging
	Libraries shouldn't do logging, and the two calls to syslog here
	are not essential.

	libfence: remove ccs reconnect code
	ccs no longer has the problem of connections timing out.

2008-11-10  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Handle notifications from cman for config updates
	Without this patch, rgmanager spins because it doesn't know
	how to handle CMAN_REASON_CONFIG_UPDATE.  This fixes it.

	rgmanager: Fix debug build error

2008-11-10  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: respect build: respect EXTRA_CFLAGS in cobj.mk

2008-11-10  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Use CCS again instead of building everything NO_CCS

	rgmanager: Enable stderr logging when run in foreground

2008-11-10  Fabio M. Di Nitto  <fdinitto@redhat.com>

	libccs: cleanup
	fix return code

	init var

	fix comments

	rgmanger: fix build system
	Make rgmanger build again.

	Install clurgmgrd compat symlink.

2008-11-10  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Rename clurgmgrd -> rgmanager
	End the madness.

	rgmanager: Nuke clurmtabd since it's not used/needed

2008-11-10  Christine Caulfield  <ccaulfie@redhat.com>

	cman: replace high_nodeid with votes in transition message
	This is for forward-compatibility with future quorum service. high_nodeid
	was never used so I've use that slot for votes and incremented the minor
	number so we know what's going on.

	This patch is already in STABLE2

2008-11-08  Lon Hohberger  <lhh@redhat.com>

	liblogthread: Fix sefault if fopen() fails for any reason

2008-11-07  Lon Hohberger  <lhh@redhat.com>

	fence: Fix bug in make_args()
	A bug in make_args() caused it  to always return an error code,
	even if we formulated a perfectly good set of arguments.

	Basically, eventually ccs_get_list returns -1 when all items are
	exhausted, so the check at the bottom of the function would free
	any arguments we had (correctly) set up and return an error code,
	thereby avoiding actually calling the agent.

2008-11-07  Ryan McCabe  <rmccabe@redhat.com>

	libfence: whitespace cleanup

2008-11-07  Lon Hohberger  <lhh@redhat.com>

	qdisk: fix block size check
	When using device="" instead of label="", this check was causing
	qdiskd to incorrectly exit.

	Resolves: #470533

	[fence] Make fence_xvmd "reboot" work with newer versions of libvirt

2008-11-07  Jan Friesse  <jfriesse@redhat.com>

	fence: New fence agent for VMware using vmrun command.
	This agent is based on other idea, than previous one and works on
	VMware ESXi (previous one didn't).

	Main idea of previous agent was connect to ESX via ssh and there run
	vmware-cmd command. This command looks deprecated and maybe will not
	available in next version of ESX. ESXi have bigger problem, because
	ESXi doesn't have ssh administration console.

	This agent will directly connect to VMware via native API and doesn't need
	ssh allowed on ESX host. Problem is, that you must install vmrun command
	by hand (available from VMware web pages as installer) on every node you want
	to do fencing of VMware guest machines.

2008-11-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: fix kernel module install dir to respect DESTDIR
	Either this, or another invokation to KBUILD. This is faster :)

	init scripts: major rework to make them distro agnostic
	- adapt build system to generate init scripts on the fly to respect some
	  installation paths

	- create top level headers to set vars and defaults for/from each
	  distribution.

	- remove absolute path calls to standard distribution tools (pidof,
	  kill, etc).

	- replace few functions from /etc/init.d/functions with local ones when
	  those ones are not available.

	- rework the output redirection across board to fix several race
	  conditions during normal operations.

	- fix some statements that are now invalid in bash3.

	- fix cman status to skip ccsd if it's not being selected specifically.

	- standardize LOCK_FILE all over.

	- fix killing process for qdisk and rgmanager to use standard distro
	  tools.

	- substitute "action" with normal rtrn parsing in gfs and gfs2 init
	  scripts.

	- fix clulog usage in rgmanager init script.

	- generally avoid to fork external process to gather return statuses.

	All of the above tested on Fedora 10, Debian and Ubuntu.

2008-11-06  Abhijith Das  <adas@redhat.com>

	gfs-kernel: Bug 466645 - reproduceable gfs (dlm) hanger with simple stresstest
	GFS used to attempt to prefetch inode/iopen locks in readdir
	in the anticipation that stats will be called on the dirents
	returned. Running a simple 'find' without stat, resulted in
	wasteful prefetching and poor performance to the point that
	it seemed like find was hanging the system.

	This patch performs prefetch on a directory's inodes based
	on a stat-rate. i.e the rate at which stats are performed on
	the dirents returned by readdir. If there are a significant
	number of stats being performed, we enable prefetching.
	Otherwise, readdir is performed without prefetches.

2008-11-06  Ryan O'Hara  <rohara@redhat.com>

	BZ 453429: Fix conditional check of $OCF_RESKEY_migration_mapping to be double quoted.

2008-11-05  David Teigland  <teigland@redhat.com>

	dlm_controld: join should return error without fence domain
	If there's no fence domain, and a process tries to join a lockspace,
	we should return an error from join_lockspace.

	dlm_controld: fix the recent realloc fix in deadlock code
	It was just dropping the newly allocated memory on the floor.
	Now just use malloc to make it more obvious what's happening.

	dlm_controld: enable calls into deadlock code
	for handling a confchg during a deadlock cycle.
	Also remove some old compat code.

2008-11-05  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: prefer init scripts generated in the objdir rather than source
	This avoids a simple problem of building arch foo in objdir and arch bar
	in srcdir. Preferring objdir will make sure always to install the
	correct ones.

2008-11-04  David Teigland  <teigland@redhat.com>

	gfs_controld: simplify misc device handling and fix plock dump
	These are two things that went into dlm_controld but not into the
	duplicated code in gfs_controld.

	. depend on udev to create misc devices, so we remove a ton of
	  complicated code that manages device nodes

	. fix plock dump, the dump size was never being set so the dump was
	  always zero length

2008-11-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	ccs: simplify libccs reload code
	simple refactoring to make it simpler to plug into other functions.

	remove unrequired special casing.

	ccs: libccs implement reload operations

2008-11-04  Jan Friesse  <jfriesse@redhat.com>

	fence: Fix operation 'list' and 'monitor' for LDOM and ePowerSwitch
	This two fence agents had same method for getting power status
	and getting outlets. In method was simple checking, which
	operation should be processed, but main fencing library doesn't
	set this option to 'status' in case of powering outlet on or off.

	This led to bad behaviour in case of on, off and reboot operation.
	Operations status, list and monitor wasn't affected.

2008-11-04  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Tidy some english phrases and typos

2008-11-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	cman notifyd: export quorum information on statechange

2008-11-04  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Some edits to the cmannotifyd man page

2008-11-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	cman notify: wait for forked process to terminate..
	.. and leave zombies around the system..

	cman notify: fix a few bits in the shell area
	Fix cman_notify NOTIFYDIR typo.

	Fix cman_notify log redirection.

	Fix cman_notify_template.sh log redirection.

	cman notify: add logging to cman_notify
	save information on what we are doing when executing scripts.

	cman notify: add script template to doc/
	This is a very simple template that can be generically useful
	to write notification snippets.

	cman notify: add note to man page

	cman notifyd: add man page

2008-11-03  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence scsi: plugin reload notification script into cmannotifyd

	cman notify: update init script
	start/stop/start for cmannotifyd

	cman notification: add shell and build infrastructure
	install cman_notify script in sbindir (this will be invoked by
	cmannotifyd.

	cman_notify.in: similar to debian run-parts and to fedora run-parts,
	executes scripts within a directory (CONFDIR/cman-notify.d).

	update build snippets to install and uninstall from cman-notify.d

	cman notify: add call back to external script
	fix also a bug in byebye_cman and add some debugging output.

	cman: add new daemon for notification to custom bits
	this is just the usual cluster daemon template.

	logthread: fix usage of syslog(3)
	and also fix a build warning.

2008-11-03  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Add some more comments about shutdown

2008-10-31  Abhijith Das  <adas@redhat.com>

	gfs-kernel: bz466677 - fault in posix_lock_file() - "gfs_controld" responds to orphaned "plock_xop" request - suspected cause is patch for Bug 196318
	gfs_lock() doesn't handle F_CANCELLK correctly (command not implemented).
	This patch implements the F_CANCELLK command in gfs_lock().

2008-10-31  Fabio M. Di Nitto  <fdinitto@redhat.com>

	rgmanager: Fix smb.sh shell scripting

2008-10-31  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Some fixes for configless running
	Create /cluster if it doesn't exist (and don't bother trying to
	copy any subkeys into CONFIG_PARENT_OBJECT).

	Also don't reload keys if we are running configless.

2008-10-31  Fabio M. Di Nitto  <fdinitto@redhat.com>

	groupd: handle cman config update notifications
	allow at least logging to be reconfigured runtime

	gfs_controld: handle cman config update notifications
	allow at least logging to be reconfigured runtime

	dlm_controld: handle cman config update notifications
	allow at least logging to be reconfigured runtime

	cman: update man page for reload operations

	cman: implement and simplify configuration reload operations

	cman: implement reload operations for cman-preconfig
	add first cut for reload operations.

	cman: make cluster_parent_handle function specific
	this avoids different problems at reload time, like holding a reference
	to an object that does not exist anymore.

2008-10-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	gfs2: randomize creation of temporary directories for metafs mount more
	a07d8d56e945a265f3da2857ad1316f49c4ae157 didn't add enough security to
	the whole random mount point.

	This change:

	- introduces a better randomness in mount_gfs2_meta by using mkdtemp
	  (this is a required change for security reason).
	- the use of mkdtemp makes the whole dir_exists code unrequired (hence
	  removed by the patch).
	- we force each tool to create its own meta mount. This fixes any
	  possible race conditions between tools (and thanks to the use of mkdtemp
	  that will guarantee the creation of a unique mount point). It also makes
	  find_gfs2_meta function unrequired (hence removed by the patch).
	- cleanup struct gfs2_sbd of unrequired fields.
	- cleanup the cleanup_metafs code path.
	- cleanup exit path from mount_gfs2_meta.
	- simplify code around different tools by using mount_gfs2_meta only.
	- turn lock_for_admin static.

	rgmanager: randomize svclib_nfslock temp dir
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Randomize temp dir via mktemp.

	rgmanager: randomize smb.sh temp file
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Randomize temp files via mktemp.

	misc: fix mktemp usage

	rgmanager: randomize oracledb.sh temp file
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Randomize temp files via mktemp.

	rgmanager: randomize SAPDatabase temp file even more
	ad4d9bd9216d6fa259118017bac8b5c032b7b3b9 didn't introduce enough
	security.

	Switch to mktemp(1).

	rgmanager: randomize ASEHAagent temp files even more
	f8943d17d4c108d44af7a42ad0fd646d4e75990e didn't didn't introduce enough
	security.

	Switch to mktemp(1).

	rgmanager: move state dump file where it belongs
	commit bde3b975fc4caffaa2aabd82d7d3cda8f4432f6a did try to mitigate a
	possible DoS in the wrong way.

	Move the file where it belongs instead. rgmanager is a "long time"
	running daemon and the pid is known upfront making the old fix
	pointless.

	gfs2: randomize file for savemeta operations even more
	15f9eb851b8924271095b159b2d077a9a0595cd5 didn't introduce enough
	security.

	Switch to mkstemp(3) and cleanup unrequired code as a consequence.

	gfs2: randomize debugfs mount point even more
	18b24ae55c3e4abdc256a3b6c4f15ae0116a0f14 didn't introduce enough
	security.

	Switch to mkdtemp(3) and cleanup unrequired code as a consequence.

	ccs: cleanup ccs_read_logging
	simplify the code a lot based on Dave implementation.

	use a buffer for file instead of passing pointers around. Makes life
	easier.

	move all common stuff (yes-no / on-off / get string) into their own
	functions.

2008-10-30  Marek 'marx' Grac  <mgrac@redhat.com>

	[fence] WTI should not power on/off plug if it is unable to get status
	Fix #468904 - I have to remember difference between and/or

	[fence] WTI should not power on/off plug if it is unable to get status
	Fix #468904. On some WTI devices plugs are numbered as 1,2,3 and on the others as
	A1,A2,...B1,.... Both types accept numbers (A1 = 1, B1 = [number of last A] + 1).
	Power on/off works with numbers but if we want to parse status of plug then
	we have a problem. This patch is a general solution (fencing library) because
	it tests value of get_status() which have to be on/off otherwise we exit with
	new error code.

2008-10-29  David Teigland  <teigland@redhat.com>

	fenced/dlm_controld/gfs_controld: query thread mutex
	should be held around some places it wasn't and can be released
	in some other places it wasn't.

2008-10-29  Fabio M. Di Nitto  <fdinitto@redhat.com>

	xmlconfig: fix buffer overflow when reading huge config files
	it was possible to overflow a buffer when adding more than 52 entries
	within the same xml block:

	<block>
	 <entry1...
	 <entry2...
	 ....
	 <entry53.. <-
	</block>

	fix the overflow by turning the whole allocation dynamic rather than
	static. This will allow only limits imposed by the system memory.

	ccsais: fix buffer overflow when reading huge config files
	it was possible to overflow a buffer when adding more than 52 entries
	within the same xml block:

	<block>
	 <entry1...
	 <entry2...
	....
	 <entry53.. <-
	</block>

	fix the overflow by increasing the limit to 1024 and fail to start if
	we hit the limit.

	ccs: add ccs_read_logging
	this function is a simple wrapper to gather all logging configuration
	from one central place since this code is replicated already N times
	across the tree.

	the function should always be invoked with the selected default values
	and it will apply overrides from the config (if available and if
	possible).

	you are responsible for freeing char **file when changed via
	cluster.conf.

	build: use standard syslog priority name rather than corosync
	this allow us to use external logging entities and retain compatibility

2008-10-28  David Teigland  <teigland@redhat.com>

	gfs_controld: move log_error message
	Limit the error message to the case that shouldn't happen.  It was being
	printed in cases that can happen during normal operation.

2008-10-28  Fabio M. Di Nitto  <fdinitto@redhat.com>

	common: plug liblogthread in the system
	add toplevel common/ infrastructure for bits that needs to be built
	before anything else and that they are "common" to several daemons.

	code that lands in here should not depend on anything else in the tree.

	plug liblogthread into common/ and the build system.

	ccs: libccs major rework pass 5
	lindent the code....

	ccs: remove duplicate entry in internal header file

	ccs: libccs major rework pass 4
	move all helper functions at the top of libccs, and the public API at
	the bottom.

	make _ccs_get static

	ccs: libccs major rework pass 3
	split fullxpath code into fullxpath.c

	ccs: libccs major rework pass 2
	split xpathlite code into xpathlite.c

	add ccs_internal.h to define internal API.

	ccs: libccs split ccs_lookup_nodename into extras.c
	extras.c will collect wrappers for libccs that do not provide
	libccs core functionalities.

	ccs: libccs major rework pass 1
	return real ccs_handles instead of fake ones. This will allow
	one application to have more than one concurrent connection to ccs.

	reinstante tracking as it was provided in the past by ccsd.

	move almost all global variables into function specific ones.

	make ready for splitting xpathlite and fullxpath into their own files.

	make ready to split xpathlite parsing into separate functions.

	make ready to split helper functions to access confdb into its own file.

	make it easier to debug by storing info into the objdb.

	cman: add /libccs/@next_handle support
	next_handle will be atomically incremented by corosync to return
	ccs_handle down the pipe.

	We create it in cman-preconfig to avoid an "init" race in libccs.

2008-10-27  David Teigland  <teigland@redhat.com>

	groupd/fenced/dlm_controld/gfs_controld: init logging after fork
	Initializing logging creates threads which is complicated by forking.
	Move logging init after fork, since we don't use it until then anyway.

2008-10-27  Jan Friesse  <jfriesse@redhat.com>

	fence: Operation 'list' and 'monitor' for Alom, LDOM, VMware and ePowerSwitch
	None of this devices returns alias with list operation,
	because it doesn't make any sense (LDOM, VMware) or it
	isn't possible to get that information (ePowerSwitch).

	fence: Fix -C switch description in Python library
	Separator between -C and description was tab key. It looked
	very bad in console, because -C description was not aligned
	with other descriptions.

2008-10-27  Fabio M. Di Nitto  <fdinitto@redhat.com>

	ccs: implement config reload in legacy ccs
	add reload operation to legacy ccsais config plugin.

	xmlconfig: remove debugging fprintf

2008-10-24  David Teigland  <teigland@redhat.com>

	dlm_controld: fix plock dump
	The size of a plock dump was always zero so nothing would be sent.

2008-10-23  Marek 'marx' Grac  <mgrac@redhat.com>

	[fence]     Operation 'list' and 'monitor' for WTI IPS 800-CE
	This should work also on other WTI devices but currently I don't have
	any other.

	[fence]	Operation 'list' and 'monitor' for iLO, DRAC5 and APC
	Operation for listing available outlets works also for single-unit
	fencing devices and returns N/A (can be changed to anything else). Option
	'monitor' can be used for monitoring health of the fencing device. It
	does not output anything and will perform operation 'list' (on multi-port devices; ef. APC) or operation 'status' (on single-port devices; eg. iLO).

2008-10-23  Jan Friesse  <jfriesse@redhat.com>

	fence: Fixed case sensitives in action parameter.
	Some agents use case sensitive action parameter. This patch
	makes that agents case insensitive and fix their man pages
	to reflect this change.

2008-10-22  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager (HALVM): Stop dumping debug output to /tmp
	Remove some left-over debugging

2008-10-22  Jan Friesse  <jfriesse@redhat.com>

	fence: Added support for no_password in fence agents library and fence_eps.
	Some fence devices don't need login name and password for fencing (this
	is generally bad idea, but ePowerSwitch 8M+ is good example).

2008-10-22  Christine Caulfield  <ccaulfie@redhat.com>

	cman: fix two_node startup if -e is specified
	two_node startup could fail because the vote_sum variable isn't calulated
	if expected_votes is specified on the command-line.

	Now we always iterate the nodes list to get the vote_sum.

2008-10-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	libgfs2: randomize creation of temporary directories for metafs mount
	by using a static path to /tmp, the operation can fail in different
	ways.

	randomize the path a bit by using the invoking pid. This will also allow
	multiple simultaneous invokation of mount_gfs2_meta on different
	mountpoints.

	Similar to 18b24ae55c3e4abdc256a3b6c4f15ae0116a0f14 there is a small
	race condition in this implentation.

	Implementation:

	- Fix return info from find_gfs2_meta to set TRUE when we find a
	  mountpoint in gfs2_sbd struct.

	- Add metafs_created_mount to gfs2_sbd struct to propagate info if we
	  did create the mount point or not.

	- Randomize sdp->metafs_path with pid info.

	- Remove the metafs_path mount point if we did create it.

	rgmanager: randomize SAPDatabase temp file
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Mitigate the issue by randomizing the temp files with pid.

	build: reinstate targets in rgmanager metadata check

	rgmanager: move oracledb.sh log files where they belong
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Move the log files to LOGDIR where they are expected to be. LOGDIR
	is generally owned by root and doesn't allow normal users to play with
	it.

	rgmanager: move nfsclient.sh cache files where they belong
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Move the cache files to /var/cache/cluster that's owned by root and
	doesn't allow normal users to play with it.

	rgmanager: move fs.sh log file where they belong
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Move the log files to LOGDIR where they are expected to be. LOGDIR
	is generally owned by root and doesn't allow normal users to play with
	it.

	rgmanager: randomize ASEHAagent temp files
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Mitigate the issue by randomizing the temp files with pid.

2008-10-22  Jim Meyering  <jim@meyering.net>

	handle some malloc failures
	"Fabio M. Di Nitto" <fabbione@fabbione.net> wrote:
	> Merged into master branch. I had some issues to get them in the tree
	> so the SHA1 are different from your original posting but it's all
	> there.

	Thanks, Fabio.
	Here's a tiny adjustment:

	>From 01c30afac0bf97d84df11cc32773304a99613a08 Mon Sep 17 00:00:00 2001
	From: Jim Meyering <meyering@redhat.com>
	Date: Mon, 13 Oct 2008 15:22:55 +0200
	Subject: [PATCH] adjust a diagnostic

	* group/dlm_controld/deadlock.c (add_waitfor): Tweak diagnostic.

2008-10-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	rgmanager: randomize file for automatic data dump
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Mitigate the issue by randomizing the output file with pid.

	gfs2: remove unused define

	gfs2: randomize file for savemeta operations
	by using a static path to /tmp, the operation can be used to trigger
	a local DoS by a normal user.

	Mitigate the issue by randomizing the output file when none is
	specified.

	gfs2: randomize debugfs mount point
	by using a static path to /tmp, the operation can fail in different
	ways.

	randomize the path a bit by using the invoking pid. This will also allow
	multiple simultaneous invokation of lockdump operations.

	There is still a small window for a race where one gfs2_tool invokation
	has created the mount point, the second one finds the mount point, the
	first one succeed in an umount and the second one will not be able to
	access the data. This is a very unlikely condition to happen and it's
	not mission critical so we can live with it.

	fence: update man page for fence_apc
	we don't save logs there anymore

2008-10-21  Jan Friesse  <jfriesse@redhat.com>

	[fence] Fixed man pages makefile, so fence_eps.8 is now installed.

	[fence] Fence agent for ePowerSwitch 8M+ (fence_eps)
	bz 467112

	Fence agent for ePowerSwitch 8M+ works only on 8M+ device, because
	this is only one with hidden page (this feature has to be allowed,
	otherwise agent will not work) feature support.

2008-10-21  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: fix gfs2_edit build
	broken by wrong copyright update commit

2008-10-21  Jim Meyering  <meyering@redhat.com>

	add comments marking unchecked strdup calls
	* config/tools/ccs_tool/editconf.c (add_fence_args):

	Remove unused local variable, buf,
	* gfs2/edit/savemeta.c (save_inode_data): ...along with malloc and free.

	add comments marking unchecked malloc calls
	* gfs/gfs_fsck/super.c:
	* gfs/libgfs/fs_dir.c:
	* gfs/libgfs/inode.c:
	* gfs/libgfs/super.c (ji_update):
	* gfs2/edit/hexedit.c (display_indirect):
	* gfs2/edit/savemeta.c (gfs1_rindex_read):
	* gfs2/fsck/initialize.c (init_system_inodes):
	* gfs2/libgfs2/super.c (rindex_read):
	* group/daemon/app.c:
	* group/daemon/cpg.c (deliver_cb):
	* group/daemon/joinleave.c (new_node):
	* group/daemon/main.c (do_get_groups, do_send):
	* group/dlm_controld/plock.c (unpack_section_buf):
	* group/gfs_controld/plock.c (unpack_section_buf):
	* src/daemons/clurmtabd_lib.c (rmtab_insert):
	* src/daemons/dtest.c (dtest_shell, main):

	remove dead code (useless test of memset return value)
	* gfs/gfs_fsck/block_list.c (block_list_create): memset can't fail.
	There are many more like this.

	* gfs/gfs_fsck/inode.c (check_inode): handle failed malloc

	* fence/agents/xvm/ip_lookup.c (add_ip): Handle malloc failure.

	don't dereference NULL upon failed realloc
	* gfs/tests/filecon2/filecon2_server.c (main): Fix typo (s/sock/ssin/)
	that would make a failed realloc cause a NULL dereference.
	* gnbd/tools/gnbd_export/gnbd_export.c (execute_uid_program):
	Diagnose a failed realloc.
	* group/dlm_controld/deadlock.c (add_waitfor): Handle failed realloc.

2008-10-21  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: cleanup copyright.... again

2008-10-20  Simone Gotti  <simone.gotti@email.it>

	[rgmanager] Fix fuser parsing on later versions of psmisc
	Description of problem:

	fuser from rhel5 has different output respect the one from rhel4 so fs.sh needs
	a little change.

	Looks like the 2 differences are:

	*) mountpoint has an ending colon
	*) Everything except the pid file is printed to sdterr instead of stdout

	Bugzilla #467686

2008-10-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	rgmanager: fix build after port to logsys

2008-10-20  Abhijith Das  <adas@redhat.com>

	gfs-kernel: bz 458765 - In linux-2.6.26 / 2.03.06, GFS1 can't create more than 4kb file
	Temporary workaround fix to make gfs1 work properly
	in upstream kernels until we do it the right way by
	using the new aops write_begin/write_end instead of
	the prepare_write/commit_write interface that we
	currently use.

2008-10-17  Marek 'marx' Grac  <mgrac@redhat.com>

	[fence] Operation 'list' for APC fence agent
	Operation 'list' return list of available outlets (with aliases) or name
	of virtual machines. This patch includes changes for fencing library and
	changes for APC fence agent. There is third argument for fence_action()
	that is None by default so we don't have to change other fence agents that
	do not have support for this operation, yet. In some cases we can overload
	get_power_status() as we just need to cache result in other cases it will
	be completely separate function (eg. 'xm list').

	@note: Current implementation for APC will list just outlets on one device.
	If we have more than one switches (MasterSwitch) we will see outlets just
	on this device.

2008-10-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence egenera: fix logging file
	Move log file where it belongs with all the others.

	Addresses: CVE-2008-4192

2008-10-15  Lon Hohberger  <lhh@redhat.com>

	[fence] Fix fence_xvmd trying to read wrong args from ccs

2008-10-14  David Teigland  <teigland@redhat.com>

	fenced/dlm_controld/gfs_controld: modify a debug message
	show the cg seq number in the wait_messages debug line to make
	it clear which cg it's counting messages for

	gfs_control: improve ls output
	copy what was done with fence_tool and dlm_tool.

2008-10-14  Christine Caulfield  <ccaulfie@redhat.com>

	cman: fix a couple of unhandled malloc failures
	Thanks to Jim Meyering for the patches.

2008-10-14  Abhijith Das  <adas@redhat.com>

	gfs-kernel and mount.gfs2: GFS ignore the noatime and nodiratime mount options
	Since the vfs moved the MS_NOATIME, MS_NODIRATIME flags
	from the superblock to the vfsmount structure (MNT_NOATIME,
	MNT_NODIRATIME, which are not accessible to gfs), gfs no
	longer knows when to enable/disable atime updates and the
	atime_quantum stuff is broken in the sense that it doesn't
	respect the noatime and nodiratime flags.

	This patch attempts to fix this by creating a gfs-specific
	mount option gfs_noatime and having the mount.gfs helper
	pass it along when the user specifies noatime or nodiratime
	in the command line. It's not the ideal way to fix it, and
	it is a bit ugly.

	Revert "gfs-kernel: bz457473 - GFS ignore the noatime and nodiratime mount options"
	This reverts commit 324a4ffc12821ddde1f583a214e98ba9c8c2540c.

2008-10-10  David Teigland  <teigland@redhat.com>

	dlm/fence: daemon fixes and tool improvements
	fence_tool/dlm_tool: improve info in ls output
	fenced/dlm_controld: fix confchg/message processing, must be done after
	each individual confchg/message
	dlm_controld: fix fencing checks which weren't happening
	dlm_controld: improvements to recovery debug messages

2008-10-10  Steven Whitehouse  <swhiteho@redhat.com>

	libgfs2: Add support for UUID generation to gfs2_mkfs
	Uses /dev/urandom to create 16 byte UUIDs for GFS2 filesystems
	at mkfs time. Backwards and forwards compatible with all
	GFS2 filesystems. You'll need a set of kernel headers with
	the new field defined in order for this feature to be
	enabled. Bugzilla #242690

2008-10-09  Marek 'marx' Grac  <mgrac@redhat.com>

	[RGMANAGER] - Fix #462910 postgres-8.sh and metadata fixes

2008-10-08  David Teigland  <teigland@redhat.com>

	daemons/tools: misc minor cleanups and improvements
	fenced/fence_tool: fix and improve output of ls
	daemons: don't attempt cpg exit cleanup after cluster goes down
	daemons: fix lazy memset size args to avoid mistakes
	dlm_controld: clean up daemon cpg on exit

	fence_tool/dlm_tool/gfs_control: remove error message
	for the 'ls' command when the daemon isn't running.

2008-10-06  Ryan McCabe  <rmccabe@redhat.com>

	cman: Fix typo that caused start-up to fail
	"/usr/sbin/cman_tool" should be "/sbin/cman_tool"

2008-10-06  Abhijith Das  <adas@redhat.com>

	gfs-kernel: bz457473 - GFS ignore the noatime and nodiratime mount options
	This patch corrects noatime support in GFS. It works by ditching the special casing which we had previously and using the support already in the VFS layer.

	The problem which this solves was introduced a while back when noatime became a per-vfsmnt flag rather than a per-sb flag. GFS was still assuming that this flag would be passed to the fs, whereas in reality it was being horded by the vfsmnt code and not being passed to the fs.

	As a result of this patch, GFS will not only obey the noatime flag correctly, but also relatime and these will also be supported per-vfsmnt rather than on a per-sb basis as before.

	This fixes bz #457473

2008-10-02  Abhijith Das  <adas@redhat.com>

	gfs-kernel: GFS: madvise system call causes assertion
	Since the madvise system call was enabled by the patch to bug 429343, it's
	possible for a inode glock holder to never get dequeued through gfs_readpage.
	This causes an assertion (bug 464837)

	GFS: fsid=cl102a:gfs1.1: warning: assertion "(gh->gh_flags & LM_FLAG_ANY) ||
	(tmp_gh->gh_flags & LM_FLAG_ANY)" failed
	GFS: fsid=cl102a:gfs1.1: function = add_to_queue
	GFS: fsid=cl102a:gfs1.1: file =
	/builddir/build/BUILD/gfs-kmod-0.1.23/_kmod_build_/src/gfs/glock.c, line = 1418
	GFS: fsid=cl102a:gfs1.1: time = 1222739610

	This patch reverts the patch to bz 429343. Don't log any warnings/errors and
	simply return ENOSYS when you arrive at gfs_readpage without the inode glock
	held. (madvise syscall case)

2008-10-02  Bob Peterson  <rpeterso@redhat.com>

	gfs-kmod: GFS corruption after forced withdraw
	bz 452274

	GFS file systems were being corrupted because some of the
	functions in log.c were writing to the journal after the
	file system had been withdrawn.

2008-09-29  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi: correctly declare key_list
	The key_list hash was not being declared in the get_key_list
	subroutine, which was causing problem with the scope of the
	variable. In short, Perl assumes that the scope of an undeclared
	variable is global. This caused the contents of the has to remain
	unchanged. (BZ 462628)

	fence_scsi: improve logging for debugging
	Using the -v (verbose) option will print more information that it
	previously did. Output will also be easier to understand, which
	should help track down any problems that might occur.

2008-09-29  rohara  <rohara@spartan.(none)>

	scsi_reserve: add restart option
	Added restart option to scsi_reserve init script. Using this option
	will result is re-registering with all devices. It will not remove
	any existing registrations, since doing so would be dangerous. In
	short, it is nearly identical to calling the script with the "start"
	option. (BZ #455330)

	fence_scsi.pl: check if nodeid is zero
	If the nodeid we get from the XML query of cluster.conf is zero,
	then either the node does not exist in the cluster of the nodeid
	is not set. Each case is invalid, so report an error and exit.

2008-09-29  Ryan O'Hara  <rohara@redhat.com>

	cman: allow custom xen network bridge scripts
	This patch allows users to define custom scripts for Xen network
	bridging. Previously, the name of the Xen network bridge was
	hard-coded in the cman init script. Users that wish to use custom Xen
	network bridge script should define NETWORK_BRIDGE_SCRIPT in
	/etc/sysconfig/cman. This script must exist in the /etc/xen/scripts
	directory. Users must also update the /etc/xen/xend-config.sxp file
	accordingly.

2008-09-26  Lon Hohberger  <lhh@redhat.com>

	rgmanager: don't change the build target just yet

	rgmanager: make clulog build even though it's incomplete

	group: Allow group_tool ls <name> <level> to be scriptable
	* Returns 1 if the group is not found or found and not joined
	* Returns 0 if the group is found and joined

	This is needed to solve rhbz 459754.

	rgmanager: First pass at port to logsys
	logging.c is from group/*_controld with a few mods
	clulog (command line utility) is not done yet.

2008-09-26  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #290231 - "Switch (optional)" param does not default to "1" and program fails
	    Bug itself was almost corrected in new fence agent but unfortunately '1' was
	    entered as number not as string. Python can not do int + string and agent fails.

2008-09-25  David Teigland  <teigland@redhat.com>

	fenced/fence_tool: improve list info
	Add wait condition to the output, and make the current victim
	visible for the full duration of fencing.

2008-09-25  Bob Peterson  <rpeterso@redhat.com>

	GFS: gfs_fsck invalid response to question changes the question
	bz 463817 -  gfs_fsck can't decide which bitmap to fix

	When the gfs_fsck ran into a problem and asked whether to fix
	it, if the users gave an invalid response, the block referenced
	in the question would become a random number.  That's because in
	function "query" it was parsing the arguments once, using
	the va_start function, but after the arguments have been parsed,
	it's left in an invalid state.  The proper thing to do is to
	call va_start for each time we need to parse the arguments.

2008-09-25  David Teigland  <teigland@redhat.com>

	fenced: add protocol negotiation
	Same as dlm_controld and gfs_controld, but without the kernel protocol.

	dlm_controld: add protocol negotiation
	Exact copy from gfs_controld.  Also fix a check in gfs_controld.
	The kernel proto checking is not yet linked to the actual kernel version.

2008-09-25  Jan Friesse  <jfriesse@redhat.com>

	fence: New fence agent for Logical Domains (LDOMs)
	It's tested on LDOM 1.0.3. Because interface is backward
	compatible, it will work with 1.0, 1.0.1 and .2 too.
	It's tested with bash and csh shells on host machine.

2008-09-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	dlm/fence/gfs: fix daemon spinning 100% due to memory corruption
	This is more a workaround than a real fix.

	When building with -O0, arg list to pthread_create is somehow corrupted
	(I suspect a gcc bug here as the problem doesn't show with any other -O
	levels), and data passed down to process_query are invalid.

	Stop passing arguments via pthread_create.

	Add simple sanity check and fallback in process_queries on accept() call
	that was the main cause of the spin.

2008-09-24  David Teigland  <teigland@redhat.com>

	gfs_controld: add protocol negotiation
	For both daemon and kernel protocols, although the kernel protocol is
	not connected in any way to the actual kernel version yet.

2008-09-24  Lon Hohberger  <lhh@redhat.com>

	cman: Don't let qdiskd update cman if the disk is unavailable
	rhbz#460937

	cman: Fix broken qdisk main.c patch reverted with scandisk merge
	Re-fixes 442541

	rgmanager: Resolve hostnames->IPs and back when checking NFS clients
	Also enable caching for improved performance in services
	with lots (hundreds) of individual mounters

	Bugzillas #246668 & #455324

	rgmanager: Make clustat and clusvcadm work faster
	rhbz#461956

	rgmanager: Implement enforcement of timeouts on a per-resource basis
	Set "__enforce_timeouts" to "1" in the resource tree in order to
	enable this behavior (e.g. not the global resources list).

	rhbz #455326

	rgmanager: Clean up build
	General build cleanups.  Also fixes small bug in
	check_rdomain_crash().

	rgmanager: make status poll interval configurable
	This allows administrators to define an alternate poll
	interval; the default is 10 seconds.  This has no functional
	change unless an administrator sets:

	   <rm ... status_poll_interval="X"/>

	rgmanager: Fix up clusvcadm.8 manual page to show -M option
	rhbz#460032

	rgmanager: Wait for fence domain join to complete
	rhbz 459754, take 3

	rgmanager: Permit careful restart w/o disturbing services
	... e.g. for upgrades of rgmanager in-place for example.

	Note: Requires service-freeze patch

	Example use:
	 * Manually freeze all services on a node.
	 * Stop rgmanager (service rgmanager stop)
	 * Upgrade rgmanager package
	 * Manually start rgmanager from the command line
	   'clurgmgrd -N'

	rgmanager: Detect restricted failover domain crash
	Mark service as 'stopped' when it is 'running' but the
	node is down.  rhbz #435466

	rgmanager: Make freeze/unfreeze work with central_processing
	Part 2 of 2 for rhbz 448046

2008-09-24  Bob Peterson  <rpeterso@redhat.com>

	GFS2: gfs2_fsck: fix segfault while running special block lists.
	bz 463588 - GFS2: gfs2_fsck segfaults when extended attributes are on the file system

	The gfs2_fsck tool was running special block lists with
	osi_list_foreach but then it was sometimes deleting the
	entries from the lists.  Therefore it should have been using
	osi_list_foreach_safe instead.

2008-09-24  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: cleanup ifdefs around RELEASE_VERSION
	RELEASE_VERSION is always set at build time now. Make it consistent
	across the whole tree.

	fence: install fence_alom man page
	update build to install fence alom man page

	fence: update alom description
	add CMT version information in the alom header

2008-09-24  Lon Hohberger  <lhh@redhat.com>

	cman: show '-d' option in mkqdisk -h and mkqdisk.8
	rhbz 459678

2008-09-22  Jan Friesse  <jfriesse@redhat.com>

	Fence: Added fence agent for Sun Advanced Lights Out Manager (ALOM)
	Because of strange behavior of ALOM SSH, which behaves more like
	telnet, fencing.py library is changed too. There is new option
	telnet_over_ssh (accessible only from source code of agent), which
	supports this behavior.

	fence: Fix fence agent for VMware ESX.
	Added support for identity_file.

2008-09-19  David Teigland  <teigland@redhat.com>

	gfs_controld: ignore uevents after first_done
	Ignore extraneous uevents after we see first_done; it's cleaner that way.
	Munging more debug messages to improve reading/debugging.

	gfs_controld: withdraw and recovery fixes
	Add handling for withdraw to new code, along with fixes to related
	recovery code.

2008-09-19  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Clean shutdown_con if the controlling process is killed.
	If a shutdown is initiated by a process that is then killed, the
	shutdown_con isn't cleared. So if another process replies to the
	shutdown request cman could segfault.

2008-09-17  David Teigland  <teigland@redhat.com>

	dlm_controld: ignore old plock dev when using new one
	Don't require /dev/misc/lock_dlm_plock to exist when we've
	found /dev/misc/dlm_plock.

2008-09-17  Abhijith Das  <adas@redhat.com>

	Revert "gfs-kernel: bz298931 - GFS unlinked inode metadata leak"
	This reverts commit b32003be3784835ca1e79a490e052210303268ac.

2008-09-16  Jan Friesse  <jfriesse@redhat.com>

	fence: Fix fence agent for VMware ESX.
	Use dynamic import path and RELEASE_VERSION variable.

	cman: Removed old Perl version of VMware fence agent, so new version is built.

2008-09-15  Chris Feist  <cfeist@redhat.com>

	cman: fixed makefiles to actually install the vmware manpage

2008-09-15  Christine Caulfield  <ccaulfie@redhat.com>

	cman: rename 'move' functions to 'copy'
	After some though I decided that removing the original config tree
	was unhelpful. And so I've also renamed the functions that do
	the copy to 'copy_' from 'move_* for clarity.

2008-09-12  Abhijith Das  <adas@redhat.com>

	gfs-kernel: bz298931 - GFS unlinked inode metadata leak
	Have inoded reclaim metadata from x rgrps at a time

	The tunable max_rgrp_free_mdata is the maximum number of rgrps
	to free unused metadata from during each cycle of inoded.
	Default is 5.

	libgfs2:  Bug 459630 -  GFS2: changes needed to gfs2-utils due to gfs2meta fs changes in bz 457798
	The changes to the gfs2meta component of gfs2 (through bz 457798) do not
	require any major changes to gfs2_utils except this one liner. We now use the
	gfs2 mount point rather than the device to mount the meta fs.

2008-09-11  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #460054 - fence_apc fails with pexpect exception
	In some special unspecified cases it is possible that
	connection will be closed before we run close(). This is not
	a problem because everything is checked before.

2008-09-11  Christine Caulfield  <ccaulfie@redhat.com>

	config: Get rid of files I committed accidentally.
	You know my opinion of git.

	cman: Copy "service" keys down to corosync
	Allow the user to specify multiple <service> keys
	in cluster.conf, to include extra services.

	config: Allow multiple top-level keys
	XML & CCS config stopped reading top-level objects if it came
	across a duplicate. This was due to a break where a continue should
	have been.

2008-09-11  Jan Friesse  <jfriesse@redhat.com>

	fence: Fence agent for VMware ESX
	Another fence agent for VMware ESX which is written in Python using our fencing
	library. Old agent (written in Perl) segfaulted in my test environment. This
	agent is tested on VMware ESX 3.5 and Server 1.0.7.

	bz 251048

2008-09-10  Christine Caulfield  <ccaulfie@redhat.com>

	cman: honour the dirty flag on a node we haven't seen before
	The dity-node code used to check if a node had been down before
	honouring the dirty flag, this was to prevent nodes already in the cluster
	from kicking each other out at a transition.

	This had the problem that it could not detect if a new node joined that already had state (eg a new cluster started up in a split network).

	So, now we also check the 'first_trans' flag in the transition message so
	that we know when the node has newly joined a multi-node cluster.

	For more information see bz#460909

2008-09-10  Bob Peterson  <rpeterso@redhat.com>

	GFS2: sync buffers to disk when rewriting superblock
	bz 461290

	GFS2: mount during fsck protections not working.
	When gfs2_fsck is run, it is supposed to rewrite the locking
	protocol in the superblock to "fsck_xxxx" (e.g. "fsck_dlm")
	to prevent all cluster nodes from mounting the file system
	while gfs2_fsck is running.  The data was being written out,
	but the buffers were not synched to disk.  That created a
	timing window where processes could still mount the file
	system.  This was uncovered by the gfs2_fsck_stress test.
	This fix syncs the buffers to disk before continuing.
	Note that this still does not prevent users from running
	gfs2_fsck on file systems that are still mounted, but that is
	the way it has always been in the past.

2008-09-09  David Teigland  <teigland@redhat.com>

	gfs_controld: fix and implement remount
	Fixes problem with remount request mount.gfs was making; it wasn't
	specifying the locktable, causing a segfault.

	Implement the remount routines in the new cpg mode.

2008-09-08  David Teigland  <teigland@redhat.com>

	gfs_controld: ignore second leave
	When mount(2) fails we often get two leave requests.  The second
	can be ignored, don't log an error message.

	mount.gfs: fix mount error handling
	When mount(2) fails, mount.gfs tells gfs_controld to leave the cpg.
	libgfscontrol requires the leave call to specify the locktable, which
	mount.gfs wasn't setting, causing it to segfault.

2008-09-08  Satoru SATOH  <satoru.satoh@gmail.com>

	fence: Add network interface select option for fence_xvmd
	 1. fence_xvmd selects wrong network interface to listen on if host has
	    multiple interfaces and target interface is not for default route.
	    As a result, fence_xvmd does not repond to fence_xvm's request.
	 2. fence_xvmd cannot start if default route is not set.

	 Ex: fence_xvmd -I <interface_name>

	Signed-Off-By: Satoru SATOH <satoru.satoh@gmail.com>
	Signed-Off-By: Lon Hohberger <lhh@redhat.com>

2008-09-05  David Teigland  <teigland@redhat.com>

	fence_tool/dlm_tool/gfs_control: improve ls output format
	Improve the output formatting of 'ls' list operations to make
	the info easier to view.

	libdlm: /dev/misc/dlm-control created by udev
	Remove code that creates the dlm-control device. Depend on udev
	to create it like we do for other devices.

	dlm_controld/gfs_controld: handle merge of cpg partition
	Uncomment the code that handles stateful cpg's merging together.
	(Same as previous fenced commit.)

	Also make same changes to debug output as previous fenced commit.

	fenced: handle merge of cpg partition
	Uncomment the code that handles stateful cpg's merging together.
	The daemon ignores "start" messages from new (to it), stateful
	(non-zero started_count), cpg members.  Because the ignored messages
	are used as a barrier, the ignored (disallowed) nodes must be removed
	(the nodes killed) for domain processing to continue.

	Also, set the cman dirty flag so cman will create disallowed nodes
	if stateful/dirty clusters merge.  This is necessary to avoid skipping
	fencing of a node after it's merged (the is_cman_member checks).

	Also improvements to various log_debug statements.

2008-09-05  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Initialise variable
	Actually, I thought the loader was supposed to do this...

2008-09-03  David Teigland  <teigland@redhat.com>

	fenced: joining daemon cpg to bypass fencing
	When the fenced daemon starts, it checks for uncontrolled instances
	of gfs/dlm, and if none are found, it joins a special "daemon" cpg (not
	the fence domain cpg).  This join simply tells fenced on other nodes
	that the new node is in a cleanly reset state and they can skip fencing
	it if it's currently a victim.

	Currently, fencing is skipped if the victim just joins the cluster, but
	this is not sufficient since a node can join the cluster with uncontrolled
	gfs/dlm instances (it still needs to be fenced).

	In cluster2, the groupd cpg filled the role of this new fenced cpg in
	advertising the clean/reset state of a node.

2008-09-03  Bob Peterson  <rpeterso@redhat.com>

	Changes needed to stay current with libvolume_id.

	Changes needed to stay compatible with libvolume_id.

2008-09-03  Christine Caulfield  <ccaulfie@redhat.com>

	config: Remove stray fprintf Signed-off-by: Christine Caulfield <ccaulfie@redhat.com>

	config: fix ldap load bug caused by new objdb ordering in corosync
	The LDAP loader assumed the old obdb behaviour that objects entered into
	the appeared in reverse order. This is no longer true - they are in
	the same order they were created. So this fixes LDAP to match this
	assumption.

	cman: cope better with malformed config files
	A config file with

	 <clusternodes>
	   <clusternode/
	 ... valid nodes entries
	 </clusternodes>

	would fool cman into not finding the nodename, even though it exists.
	This fixes that.

	cman & config: Move special cases out of config modules
	It was previously the job of the config modules to move
	items like <totem>, <logging> etc from under <cluster> and into the
	root of the tree so that corosync could find them. This is
	obviously absurd.

	So I've made cman-preconfig do this now. This means that the
	config modules do only what they should do, read in the
	config tree as they see it into objdb. Any other new
	keys we need to add to /cluster that actually apply to corosync
	can be added in one place.

2008-09-03  Chris Feist  <cfeist@redhat.com>

	fence: fixed a fence storm with fence_egenera
	4.8 - bz#437867
	4.7.z - bz#459501

	Committed on behalf of Jim Parsons (jparsons@redhat.com)

2008-09-02  Lon Hohberger  <lhh@redhat.com>

	cman: Fix qdiskd file descriptor leak
	Patch from Sean E. Millichamp <sean at bruenor dot org>
	rhbz#460645

2008-08-28  Bob Peterson  <rpeterso@redhat.com>

	GFS2: Make gfs2_fsck accept UNLINKED metadata blocks
	bz 460327

	Originally, GFS2 did not use a block type of 2 in the bitmaps,
	so it was considered invalid.  However, GFS2 now uses that
	block type to indicate unlinked metadata blocks.  This allows
	for cases where an inode is unlinked on one node while still
	open on another node.  This fix changes gfs2_fsck so that it
	ignores these blocks (eventually the file system will reclaim
	them) rather than reporting them as errors.

2008-08-28  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Allow a recently left node to join cleanly.
	If a node leaves cleanly and then joins within the corosync totem timeout
	then odd things can happen and the nodeslist can get inconsistent.

	With the rest of the cluster stack on top this is probably quite hard to
	do I suspect.

2008-08-28  Fabio M. Di Nitto  <fdinitto@redhat.com>

	ccs: deal with xml file format special case
	when talking about specific xpath queries, writing:
	<clusternode name="node4" votes="1" nodeid="4"><fence>..

	is not the same as writing:
	<clusternode name="node4" votes="1" nodeid="4">
	 <fence>

	fix memory overflow in both ccsd and xmlconfig. It is impossible to
	exploit this overflow for anything useful since it's used at the very
	beginning of the  startup process when literally nothing is running
	and it causes the XML parser to crash.

	ccsd did never show this issue because it was using a pre-allocated
	buffer and it was always big enough to hold the data (even when we were
	writing more than our calculated size).

	xml on the other side, always need to allocate.

	rgmanger: fix handling of VIP v6
	when using ip to handle ipv6 address, we need to speficify netmask on
	add and remove operations, the same way is done in ipv4 code.

	Fix bugzilla: #459582

	libdlm: major cleanup
	Move libaislock to contrib/ as it was not built within libdlm for ages.

	Simplify libdlm/Makefile (first pass) and adapt the build system to cope
	with %_lt.o.

	Fix make/libs.mk to deal with multiple objects linked in a shared
	library.

	misc: init scripts clean up
	after discussion on cluster-devel mailing list, each init script should
	include /etc/sysconfig/$init_script_name.

	change all init scripts to source /etc/sysconfig/cluster for backward
	compatibility and then source /etc/sysconfig/$init_script_name to give
	priority to proper config file.

	remove also warnings about obsolete scripts.

	ccs: libccsconfdb header cleanup
	remove unrequired headers and make sure to use only corosync includes to
	build. Nothing in libccs uses openais services.

2008-08-27  David Teigland  <teigland@redhat.com>

	init.d/cman: use fence_tool -m for two node clusters
	bz 460190

	Use the new fence_tool -m option in the cman init script for two node
	clusters.  This delays fence_tool join when both nodes aren't members.
	The delay allows initial cluster partitions (due to badly configured
	network/switches) to converge before starting fencing.

	fence_tool: new option to delay before join
	bz 460190

	Certain network/switch settings cause nodes to form partitioned clusters
	when they start up.  Add code to better cope with these initial partitions.
	The network partitions are a particular problem for two_node clusters where
	a node has quorum when it starts up on its own.

	This adds a new fence_tool option -m, e.g. fence_tool join -m <seconds>.
	It causes fence_tool to delay the join by up to <seconds> to allow all
	nodes in cluster.conf to become cluster members.

	This allows openais on the nodes to all see each other before starting
	the fence domain. So we join the domain *after* the nodes merge into a
	single cluster.  If we joined the domain *before* the cluster partition
	merged, then nodes end up being fenced unnecessarily.  (This is a similar
	idea to post_join_delay; a delay that gives us time to determine that a
	node in an unknown state is actually ok and doesn't require fencing.)

	groupd: fix daemon quit on SIGTERM
	The daemon can quit immediately on SIGTERM if running in LIBCPG mode,
	without checking for groups.  (The placeholder groups for blocking old
	cluster2 groupd's get in the way of checking gd_groups.)

2008-08-27  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #237266 - LPAR/HMC fence agent
	Minor fix (thanks to brking@us.ibm.com) in get_power_status(). If the state is
	not 'Running' then it is considered off, originally function returns undefined
	value in specific cases (like panic on machine - 'Error').

	[FENCE] Fix #448043 - Update man pages for fence agents
	Manual pages for APC, BladeCenter, iLO and WTI where updated mostly with
	information about using ssh and passwords (-x, -z, -i, -S).

2008-08-27  Fabio M. Di Nitto  <fdinitto@redhat.com>

	config: make more functions static
	no need to export internal functions.

	build: fix clean target of contrib section
	make sure we can always clean when building outside the source tree.

	cman: init script best to require $time
	I was getting some weird OOPS when using dlm based applications
	on one of the nodes. After a long debugging session it turns out
	that the node had a clock skew of several minutes.

	Depend on $time to be executed before we start to soften the problem
	by syncing date on all nodes.

2008-08-26  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: bump library soname to 3.0
	Our shared library API can now be considered stable.

	By no means the code is bug free or feature complete but it is one step
	forward towards 3.0 release.

2008-08-26  Christine Caulfield  <ccaulfie@redhat.com>

	cman: return the correct length of a message
	When I converted to corosync somehow the length of the header
	didn't get subtracted from the total message length as it
	was passed down the stack. This fixes that.

2008-08-25  David Teigland  <teigland@redhat.com>

	gfs_controld: ignore dlm uevents
	Some people use "gfs" or "gfs2" as the name of the fs, which results
	in dlm lockspaces named the same, and we want to ignore dlm uevents
	for those.

2008-08-22  Lon Hohberger  <lhh@redhat.com>

	rgmanager: Ancillary fix for rhbz #453000
	See: https://bugzilla.redhat.com/show_bug.cgi?id=453000#c6

2008-08-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: add --without_config build option
	disables the building of all config/ subsystem.

	at the same time remove some old references of without_ccs from top
	level configure

	build: rename --enable_xen to --enable_virt
	xvm supports all virtualization implementations that libvirt supports
	and those are more than just xen.

2008-08-21  David Teigland  <teigland@redhat.com>

	fenced: add skip_undefined option
	bz 459127

	New fenced config option <fence_daemon skip_undefined="1"/>
	would cause fenced to not do startup fencing of nodes with zero
	defined fence methods.

	The primary use for this option would be asymmetric cluster configs
	(http://sources.redhat.com/cluster/wiki/asymmetric_cluster_config)
	where client/small/spectator nodes do not join the fence domain
	and have no fencing configured.  The problem we have is that even with
	no fencing configured, and not joining the fence domain, other
	nodes may attempt (and fail) to fence these client nodes during
	startup fencing.

2008-08-20  David Teigland  <teigland@redhat.com>

	dlm_controld: isolate cman and fence code
	in member_cman.c, so that alternative code can be compiled instead.

2008-08-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	misc: remove exec bits from different files
	use python setup.py instead of invoking ./setup.py.

	build: plugin askant in our build system
	add contrib/askant/Makefile

	remove lib and inc sections from setup.py and drive them
	from askant/Makefile instead.

	build: add contrib/Makefile
	start plugging askant into contrib

	build: create contrib/ top level section
	now that the project is more open to the community, create
	a top level contrib section where to add community contribution.

	change build system to cope with it and make it disabled by default.

	add option --enable_contrib to top level configure

	move askant into contrib/

2008-08-20  Andrew Price  <andy@andrewprice.me.uk>

	askant: Import askant into tree
	Askant is the beginnings of a file system performance analysis tool. This commit
	imports it into the cluster tree.

	Ref: https://bugzilla.redhat.com/show_bug.cgi?id=239656

2008-08-20  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Return quorum state in a STATECHANGE notification
	This should remove a potential race condition where quorum changes
	after the message is received.

	cman: add cman_tool -A to disable load of openais services
	I have moved the loading of openais services to the control of
	the openaisserviceenable configuration module (as it knows better
	which services are available). Loading of this module, and
	consequently the rest of the openais services is now controlled
	by the -A switch.

	openais services are enabled by default. -A disables them.

2008-08-19  David Teigland  <teigland@redhat.com>

	groupd: remove detection of uncontrolled kernel dlm and gfs
	since the dlm_controld and gfs_controld daemons now do that.

	fenced: kill the cluster on misbehaving nodes
	Kill cman on other nodes where the fenced process fails.

	gfs_controld: kill the cluster on misbehaving nodes
	Kill cman on other nodes where the gfs_controld process fails.
	Shutdown cman locally if we find uncontrolled filesystems at startup.

	dlm_controld: open dlm-monitor misc device
	if it exists, as it will in future kernels.  This allows dlm-kernel
	to detect if dlm_controld fails, and stop lockspaces in response.

	Also rework/simplify handling of all misc devices; depend on udev
	to create the device nodes.

	Adds /dev/misc/dlm-monitor to the dlm's udev config file.

2008-08-19  Fabio M. Di Nitto  <fdinitto@redhat.com>

	qdisk: fix sysfs path diving

2008-08-15  Fabio M. Di Nitto  <fdinitto@redhat.com>

	qdisk: allow scan of sysfs to dive into first level symlinks
	Some kernels populate /sys/block with symlinks when others don't.

	Allow sysfs to dive into symlinks at the top level to handle both.

	libccs: add support for /child::*[%d]/ for xpathlite
	xpathlite did not understand the concept of child::*[%d]
	within a path (ex: /cluster/rm/child::*[1]/@name).

	This operation is required by rgmanager to load the service tree.

2008-08-14  David Teigland  <teigland@redhat.com>

	gfs_controld: fix fs_notify during recovery
	Wasn't processing mountgroup again after an initial failed fs_notify,
	so no retry was happening.  Also, the process_mountgroup check was
	wrongly skipping the apply_changes phase sometimes at the very start
	because there was no change struct yet, which would cause a segfault.

	dlm_controld: fix nodeid in fs_result
	was copying the wrong value so nodeid returned was zero

	dlm_controld: kill the cluster on misbehaving nodes
	Kill cman on other nodes where the dlm_controld process fails.
	Shutdown cman locally if we find uncontrolled lockspaces at startup.

2008-08-14  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: define legacy_code=1 on clean target
	make sure to always clean everything around even when switching to/from
	legacy_code

	ccs: move ccs/daemon to config/daemons/ccds and mark it legacy code
	remove support for --without_ccs. ccs is now fully obsoleted and you
	need to specify --enable_legacy_code to build it.

	adapt top level Makefile to deal with cluster/ccs removal.

	fix build dependencies around cman/lib that's now required before
	config: target.

	move ccsd man page in config/daemons/man.

	ccs: move ccsais plugin to config/plugins/ccsais and mark it legacy code

	ccs: move libccscompat into config/libs and mark it legacy code

	config: move generic documenation and man pages to config/man

	ccs: move comm_headers.h to ccs/daemon
	comm_headers.h defines the protocol to talk to ccsd.

	move it to daemon and fix inclusion paths for the users.

	ccs: move debug.h to ccs/daemon
	ccsd is the only user for debug.h. No need to keep it in a generic
	include dir.

	ccs: libccscompat don't include unrequired header
	libccscompat doesn't require debug.h

	cman: switch default config parser to xmlconfig

	config: move ccs/ccs_tool to config/tools/ccs_tool
	ccs_tool is now a generic tool for handling configuration.

	Move it to a proper location.

	cman: make ccsd startup optional and allow override of config loader
	implement support for CONFIG_LOADER envvar to select what config parsers
	should cman use.

	start ccsd only of we explicity select ccsconfig CONFIG_LOADER.

	perform basic sanity check for other loaders into init script.

	add some documentation on what loaders are available.

2008-08-14  Christine Caulfield  <ccaulfie@redhat.com>

	cman: Silence some compiler warnings.
	This only show up with some compiler versions, but I don't like
	compiler warnings!

	cman" load openais services by default
	For compaibility with cluster2 we load a default set of openais
	services with cman/corosync.

	You can disable these by setting <cman disable_openais="0"/>
	and adding your own services as needed.

2008-08-13  David Teigland  <teigland@redhat.com>

	dlm_controld: fs_register and fs_result fixes
	dlmc_fs_register now returns -EALREADY if the name is already registered.
	dlmc_fs_result now returns the nodeid in the field already provided.

2008-08-13  Christine Caulfield  <ccaulfie@redhat.com>

	cman: fix objdb-destroying typo
	object_find_destroy is NOT spelled object-destroy!

	cman: Fix find_handle leak Signed-off-by: Christine Caulfield <ccaulfie@redhat.com>

2008-08-13  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: bump kernel requirement to 2.6.27
	gfs-kernel module now needs 2.6.27.

2008-08-12  Abhijith Das  <adas@redhat.com>

	gfs-kernel: bug 450209 - addendum to previous patch. Removes extraneous lock_dlm_plock.c
	I accidentally added this file to the patch I posted earlier to this bug. It's just
	an extra file at this point; Makefile doesn't even compile it. This commit removes it.

	gfs-kernel: Bug 450209: Create gfs1-specific lock modules + minor fixes to build with 2.6.27
	gfs1 has its own lock modules now and is no longer dependent on gfs2.ko
	or lock_nolock.ko or lock_dlm.ko.

	This commit contains the lock modules patch and the following fixes to
	make gfs1 build with Steve's git tree.

	- change all instances of <asm/semaphore.h> to <linux/semaphore.h>
	- change all calls to permission() to inode_permission()
	- change all calls to remote_llseek() to generic_file_llseek_unlocked()

	I have been able to successfully compile with the patch against Steve's git
	tree, insmod the gfs.ko module, and mount a nolock filesystem using it. I don't
	have a cluster running upstream bits, so I couldn't test the module in a
	cluster.

2008-08-12  David Teigland  <teigland@redhat.com>

	gfs_controld: queries in libgroup mode
	Most of the query info doesn't apply when running in LIBGROUP mode,
	but some of the basic info can be provided.

	libdlm: handle truncated device names
	When lockspace names are over 15 characters long, they result in a
	device name that's over 19 characters long, e.g. dlm_0123456789ABCDEF.
	Sysfs truncates device names at 19 characters, so the device name for
	this lockspace is /sys/class/misc/dlm_0123456789ABCDE, which udev also
	uses to create the device node, /dev/misc/dlm_0123456789ABCDE.

	So, when libdlm waits for udev to create the device node, it needs to look
	for this truncated name.  It then creates and removes symlinks with the full
	lockspace name.

	Joel Becker identified the problem and came up with this solution.

2008-08-12  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: add support for corosync
	rename aisexecbin to corosyncbin

	add options for corosyncincdir and corosynclibdir and propagate them
	across all Makefile

2008-08-12  Christine Caulfield  <ccaulfie@redhat.com>

	cman (mainly): use corosync
	This patch changes cman to use corosync, the new split-up version
	of openais. It's mainly name changes, and changes to accommodate
	the new corosync API.

	It also changes the includes of other services from openais/ to corosync/
	though I can't guarantee I've caught all of them.

2008-08-11  Fabio M. Di Nitto  <fdinitto@redhat.com>

	libccs: add support for /child::*[%d]/ for xpathlite
	xpathlite did not understand the concept of child::*[%d]
	within a path (ex: /cluster/rm/child::*[1]/@name).

	This operation is required by rgmanager to load the service tree.

	rgmanager: unbreak locking in clulib
	commit 1edb73bd098500d459c16797da2377a59f1ef180 introduced a set of
	checks for read/write operations.

	the error checks in cman.c where wrong and caused endless loops in
	rgmanager startup.

	fix those checks by making them "dumb" since we don't really care
	about the result of the operation directly, but other bits of code
	will take care of those.

2008-08-08  David Teigland  <teigland@redhat.com>

	dlm_controld: queries in libgroup mode
	Most of the query info doesn't apply when running in LIBGROUP mode,
	but some of the basic info can be provided.

	fenced: finishing off query stuff
	various loose ends

	group_tool: use mode from groupd
	to determine whether it should query groupd (old mode) or query
	the individual daemons (new mode).

2008-08-08  Bob Peterson  <rpeterso@redhat.com>

	mkfs.gfs2: should have an optional fs size parm
	bz 450764

	This patch fixes two problems with the previous patch for
	an optional "blocks" parameter to mkfs.gfs2.  The bugs
	are: (1) If the blocks specified is too big, it gave a wrong
	message.  This fixes the message and prints out what the
	numbers are (to help the user get it right).  (2) If the
	number of blocks was specified, the device size was reported
	incorrectly.

2008-08-08  David Teigland  <teigland@redhat.com>

	dlm_tool: handle all join flags
	Add the ability to set all join flags, and print the flags being
	used when dlm_tool join is run.

	libdlm: remove device node creation/removal
	It's unnecessary as udev has been doing it for quite a long time.
	(Doing this ourselves also won't work correctly in the future with a
	pending dlm patch that will allow multiple creates and only the final
	release actually releases the lockspace.)

2008-08-08  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Re-fix permissions bits broken in last commit
	Remove execute flag from file permissions.

	[rgmanager] Fix resource agent metadata and un-break 'make check' target

2008-08-08  Fabio M. Di Nitto  <fdinitto@redhat.com>

	config: fix objdb2xml filtering
	ais/corosync has a set of extra information on the toplevel
	tree that includes <service service_id="" handle=""
	that contains values for service_id and handle that cannot
	be converted into XML data.

	We were filtering for <service to avoid importing non-compliant data
	but that was catching also /cluster/rm/service making it impossible
	to use rgmanager.

	Change the filter to match explicitly for service_id and handle.

2008-08-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	cman: make sure not to umount configfs when there are other users
	Fix bugzilla: #457991

	build: fix ccs_test symlink install target
	previous target was copying the whole ccs_tool into ccs_test again.

	ccs: turn more ccs_tool code into legacy code
	the update functionality connects to ccsd that is now legacy code.

	filter this out when build normal ccs_tool.

2008-08-06  David Teigland  <teigland@redhat.com>

	gfs_controld: register with dlm_controld earlier
	dlm_controld now allows us to register interest in a lockspace
	before the lockspace is created, so do it right away instead of
	after mount(2) completes, which has the potential of being too late.

	dlm_controld: allow early fs_register
	fs_controld daemons need to register their interest in a lockspace
	during startup before they've actually joined the lockspace, which
	means we need to record the registration before the lockspace exists
	and then set the registered flag when it's created.

2008-08-05  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: properly respect non standard libdir and incdir
	We allow users to set libdir and incdir to non standard locations.
	Those values need to be propagated properly within the build system
	to have a higher priority than system locations but lower than
	specific paths.

	qdisk: port to new logsys api
	switch to new logsys api and fix a bug where debug output was always
	enabled.

2008-08-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	ccs: move to the new logsys init API
	Change ccs daemon to use the new logsys API.

2008-08-04  Christine Caulfield  <ccaulfie@redhat.com>

	cman: tidy objdb_get_int
	Make objdb_get_int take a default value tat gets filled in then there
	is no value in the objdb. This tidies the situation hugely as well
	as fixing bugs that arose because of the ambiguous nature of the
	function's returned values.

2008-08-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: drop "all" dependency from install: targets
	this change should address the last problem reported by
	Joel.

	build: fix several issues related to install and build targets
	Several users have been reporting issues building and installing
	our source from an nfs mount.

	There are two related issues in this scenario (P = Problem):
	P1) nfs servers often drops root privileges to nobody (very often required
	    for install:)
	P2) our build system had issues in the past with linking against static
	    libraries.

	the combination of the two ends with a user "nobody" trying to link
	one of our tools at install time and of course it fails because the
	nfs server would refuse "nobody" to access a directory/file that
	the user owns.

	We address this issue by doing a set of simple changes around
	(A = Action):

	A1) Remove all PHONY targets so that at install time we do not re-link
	    bits that are already updated.

	A2) Introduce a more detailed dependecy tracker for static libraries by
	    using LDDEPS var within the affected Makefiles. This replaces the
	    requirement of PHONY targets in A1).
	    Note: changes to header files are already tracked by .d files,
	    LDDEPS tracks changes to the binaries.

	A3) Make sure that all target that requires static libs are updated to
	    use LDDEPS.

	Extra benefits from this change (B = Benefit):

	B1) no relink at install time.

	B2) install target does not require any devel library installed on the
	    target system because of B1

	B3) install target can be executed in parallel from several machines.
	    For example when installing on N machines from the same nfs share.
	    This was an issue before because of a race condition now fixed by B1.
	    (two or more machine could try to link the same binary at the same
	    time and fail)

	The only con is that A2 requires a bit more manual work on tracking
	linking against static libraries, but the changes in that area are
	not frequent enough to hold this fix.

2008-08-01  Ryan O'Hara  <rohara@redhat.com>

	ip.sh: add sleeptime parameter
	Allow user to specify amount of time to sleep after removing
	and IP address ('stop' command). The sleeptime parameter is
	specified in number of seconds. Default is 10 seconds.
	Setting sleeptime to zero will result in no sleep.

2008-08-01  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence: remove unrequired headers from rackswitch
	also fix a fauilure to build with 2.6.27 kernel headers

2008-08-01  Christine Caulfield  <ccaulfie@redhat.com>

	cman: exit if configuration check fails.
	The error return from read_cman_config wasn't being
	checked, so configuration errors could cause
	segfaults later on in startup.

	cman: Revert dirty patch
	Revert patch 288ab73e51f51ce174f51dc2fc67c6dd1fe03e85 as it's
	dangerously wrong and based on several misunderstandings.

	see bz#443358 for mroe information

2008-07-31  David Teigland  <teigland@redhat.com>

	fence_tool: add domain member checks
	using libfenced library.  Also clean up the code and logic for waiting
	and timeouts.

2008-07-31  Christine Caulfield  <ccaulfie@redhat.com>

	qdisk: fix compile error when building without debug.

2008-07-31  Fabio M. Di Nitto  <fdinitto@redhat.com>

	bindings: fix CCS.pm doc
	purely cosmetic change to doc file.

	build: fix bindings build when using external object tree
	Stop symlinking files that are generated on the fly in objdir.

	Propagate Makefile.bindings into objdir.

2008-07-31  Bob Peterson  <rpeterso@redhat.com>

	gfs2_edit: Improved gfs journal dumps
	bz 450004

	This patch adds three important improvements to journal dumps:

	1. It now recognizes and dumps GFS1 log descriptor continuation
	   blocks and dumps them correctly.
	2. It now prints a marker where the journal wrapped so you
	   can locate the most recently added entries easily.
	3. The absolute block number of the journal block is now
	   printed with the entries (in addition to the journal offset).
	   This makes it easier to find the correct journal block you
	   need to see.

2008-07-30  David Teigland  <teigland@redhat.com>

	gfs_controld: use group_mode detection
	The new default is to use group mode detection from groupd.
	This is -g2 (command line) or <group groupd_compat="2"> (cluster.conf).

	dlm_controld: use group_mode detection
	The new default is to use group mode detection from groupd.
	This is -g2 (command line) or <group groupd_compat="2"> (cluster.conf).

	fenced: use group_mode detection
	The new default is to use group mode detection from groupd.
	This is -g2 (command line) or <group groupd_compat="2"> (cluster.conf).

	groupd: detect group_mode
	command line -g2, or cluster.conf <group groupd_compat="2"/>

	If old cluster2/RHEL5 nodes are in the cluster, cluster3 nodes will
	adopt the groupd compatibility mode to interoperate with them (this
	is the compat mode you get directly with -g1 or groupd_compat="1").

	If no cluster2/RHEL5 nodes are in the cluster, cluster3 nodes will
	use the new group mode that doesn't go through libgroup, and is not
	compatible with cluster2/RHEL5 nodes (this is the non-compat mode
	you get directly with -g0 or groupd_compat="0").

	This new mode (groupd_compat="2") is the default to favor the case of
	rolling cluster2->cluster3 upgrades, where cluster2 nodes and cluster3
	nodes need to interoperate in a single cluster for a limited time.  After
	all cluster2 nodes have been upgraded to cluster3, groupd_compat="0" can be
	added to cluster.conf the next time the entire cluster is taken down.

	It is still best to set groupd_compat="0" in cluster.conf for:
	. new clusters that don't require compatibility with cluster2 nodes
	. old clusters that are taken offline while the nodes are all upgraded
	  from cluster2 to cluster3

2008-07-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	init: standardize init scripts to /etc/sysconfig/cluster
	Allow users to set everything from one single external config file
	rather than several.

	Retain backward compatibility by sourcing the old files and warning
	about the change.

	If a config option is present in both old and new file, the value from
	the new file will be used.

	misc: clean up "char const *" vs "const char *"
	this is cosmetic from a C point of view, but the perl xs preprocessor
	complains about it.

	while at it, clean up the typemap file that can be empty now.

	build: clean up perl bindings build system
	create a generic make/binding-passthrough.mk to use Makefile.bindings
	because the final Makefile is create by perl

	create a generic make/perl-binding-common.mk to include basically all
	targets that can be shared by different bindings

	simplify bindings/perl/Makefile to use only binding-passthrough.mk

	create bindings/perl/ccs/Makefile.bindings to use bindings
	infrastructure

	generate CCS.pm and META.yml from respective .in files to change data at
	build time (for example release version)

2008-07-29  Fabio M. Di Nitto  <fdinitto@redhat.com>

	bindings: improve Cluster::CCS description
	improve Cluster::CCS description

	bindings: add first cut of perl Cluster:CCS
	Add new perl binding for libccs.

	This is a first version and while the code works fine, the build system
	and many other details are still not clean.

	Revert "test commit"
	This reverts commit 900bca2d2bc1f03d22623ea5cbc4329d7f0799b9.

	test commit
	test commit

2008-07-29  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Display the node's votes in cman_tool status
	I'm not sure how this one slipped the net.

	[CMAN] pass COROSYNC_ env variables to the daemon
	cman_tool makes its own environment for the aisexec daemon to
	use but some newer config modules like to have configuring environment
	variables. So now cman_tool passes down all environment variables
	starting with COROSYNC_ down.

	To make this work, I've also changed the plugins that currently
	take environment variables to name them COROSYNC_.

	Yes, I know we're not using corosync yet, but this is just
	one less thing we;ll need to remember to change next week or
	whenever.

2008-07-29  Fabio M. Di Nitto  <fdinitto@redhat.com>

	config: allow users to override default config file in xmlconfig
	By setting CLUSTER_CONFIG_FILE either in the enviroment it is possible
	to use an alternate cluster.conf.

2008-07-28  Ryan O'Hara  <rohara@redhat.com>

	cman: fix typo (#!/bin/bash) from previous commit
	Line 0 of the cman init script was #!/BIN/BAsh?

	cman: add option to init script to prevent joining the fence domain
	New sysconfig variable FENCE_JOIN will control whether or not the
	node joins the fence domain. This variable can be set to either
	value "yes" or "no". When FENCE_JOIN is set to "no", the init script
	will not attempt to join the fence domain. Any other value is
	equivalant to "yes", in which case the init script will attempt to
	join the fence domain. (BZ #455598)

2008-07-28  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Fix overridden node names
	cman-tool join -n <nodename> was failing because it assumed
	an old object context. It now uses the nodeslist functions
	I wrote for the purpose.

2008-07-28  Fabio M. Di Nitto  <fdinitto@redhat.com>

	rgmanager: init script does not need network config
	rgmanager init LSB header already express the requirement for network
	via Required-Start: cman that in chain Required-Start: $network.

	Lack of network will not start cman and as consequence rgmanager.

	cman: init script should not user cluster.conf directly
	fence_xvmd function needs to query the config to know if the daemon
	should start or not.

	switch an xmllint call to a ccs_tool query and remove hardcoded
	dependency on cluster.conf

2008-07-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	rgmanager: fix clean target
	stub clean target in init script Makefile

2008-07-25  Ryan O'Hara  <rohara@redhat.com>

	gfs_mkfs: change the way we check to see if a device is mounted
	New method will attempt to open device with O_EXCL flag. If open()
	responds with EBUSY, mkfs will die. This indicates that the device
	is either mounted or part of a LVM volume. (BZ #426298)

2008-07-25  Bob Peterson  <rpeterso@redhat.com>

	gfs2_edit: was parsing out gfs1 log descriptors improperly
	GFS2 log descriptors have 8 bytes per entry which represents
	a block number.  GFS1 log descriptors have a small structure
	that is 16-bytes, the first 8 bytes of which is the block.
	So gfs2_edit was mistaking the extra 0x00000000 for a GFS2
	end-of-block marker when it shouldn't have.  This fixes it.

	gfs2_edit: Ability to enter "journalX" in block number.
	With gfs2_edit, you can position to the "block #" field and
	press <enter>, then enter a block number to jump to.
	You may also enter a keyword, like "root" to jump to the
	root directory, "rindex" to jump to the rindex, etc.
	Most keywords worked, but you could not enter "journal0"
	to jump to the first journal until this fix made it possible.

2008-07-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	fence: port scsi agent to use ccs_tool query and drop XML::LibXML requirement
	The new ccs_tool query is able to answer to the queries from
	fence_scsi*.

	Drop the need of XML::LibXML.

	Use ccs_tool query directly.

	Abstract from the need of parsing cluster.conf that is not the
	authoritative config file anymore.

	Drop unrequire check_config_nodes that's already embedded in the need of
	cman to run this code.

	fence: simplify init script
	fence_scsi needs cman to run. Verify that cman is running
	as first thing, before querying for config information that
	are now stored in cman/aisexec.

	cman already guarantees that all nodes have a nodeid. Drop
	this redundant check.

	rgmanger: remove check on cluster.conf from rgmanager init script
	cluster.conf is not the only authoritative configuration file anymore.
	LDAP and others could be in place.

	Remove the check and allow rgmanager to start.

	Revert "rgmanger: remove check on cluster.conf from rgmanager init script"
	This reverts commit 691c72052655c0f7c8142c35145237e122ae6b86.

	Revert "fence: simplify init script"
	This reverts commit 6a0647657348dd732615b7a0b7d6aad89c85b93a.

	Revert "fence: port scsi agent to use ccs_tool query and drop XML::LibXML requirement"
	This reverts commit e968098fa53e14d1cc9e60c42a4102674ecb51d2.

2008-07-25  Andrew Price  <andy@andrewprice.me.uk>

	fence: port scsi agent to use ccs_tool query and drop XML::LibXML requirement
	The new ccs_tool query is able to answer to the queries from
	fence_scsi*.

	Drop the need of XML::LibXML.

	Use ccs_tool query directly.

	Abstract from the need of parsing cluster.conf that is not the
	authoritative config file anymore.

	Drop unrequire check_config_nodes that's already embedded in the need of
	cman to run this code.

	fence: simplify init script
	fence_scsi needs cman to run. Verify that cman is running
	as first thing, before querying for config information that
	are now stored in cman/aisexec.

	cman already guarantees that all nodes have a nodeid. Drop
	this redundant check.

	rgmanger: remove check on cluster.conf from rgmanager init script
	cluster.conf is not the only authoritative configuration file anymore.
	LDAP and others could be in place.

	Remove the check and allow rgmanager to start.

2008-07-24  Lon Hohberger  <lhh@redhat.com>

	[qdisk] Make stop_cman="1" work if heuristics fail during initialization
	Bugzilla #455865

2008-07-24  Andrew Price  <andy@andrewprice.me.uk>

	[GFS2] libgfs2: Build with -fPIC
	Build libgfs2 with -fPIC to enable linking on x86_64 and others.

2008-07-24  Bob Peterson  <rpeterso@redhat.com>

	gfs2_fsck dupl. blocks between EA and data

	RGRepair: Account for RG blocks inside journals

	Better error reporting in gfs2_fsck

	Shrink memory 3: smaller link counts in inode_info

	Shrink memory 2: get rid of 3 huge in-core bitmaps

	Shrink memory 1: eliminate b_size from pseudo-buffer-heads

	Deleted unused function print_map

	Fix some bad references to gfs_tool and gfs_fsck

	gfs_fsck crosswrite for block number sanity checking

	Speed up userspace bitmap manipulation code.

2008-07-24  Fabio M. Di Nitto  <fdinitto@redhat.com>

	build: update .gitignore
	Add some more files we can ignore

2008-07-23  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Cleanup groupd makefile

2008-07-23  Ryan McCabe  <rmccabe@redhat.com>

	fence: update apc snmp agent
	Pushing update to fix bz447414 for jparsons

2008-07-22  David Teigland  <teigland@redhat.com>

	groupd: use logsys
	Add logsys usage and configuration, following fenced pattern.

2008-07-22  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Add optional save/restore to vm resource
	This patch adds optional save/restore support to virtual machines.
	Patch Federico Simoncelli federico dot simoncelli at gmail dot com

2008-07-22  David Teigland  <teigland@redhat.com>

	dlm_controld/gfs_controld: add logging.c file
	which I forgot to add in previous commits.

2008-07-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Cleanup linking order for logsys
	Collect all openais libs into their own LDFLAGS entry

	Linking to logsys requires pthread

	[FENCE] Fix fence_apc_snmp logging
	Move log file together with all the others when invoked in verbose mode.

	[BUILD] Fix LOGDIR usage
	LOGDIR was duplicate of logdir. Remove the duplication and use logdir as
	it should be.

	Also add logdir info to fencebuild, required for fence_apc_snmp

	[FENCE] Sync fence_apc_snmp from RHEL47 branch

2008-07-22  Bob Peterson  <rpeterso@redhat.com>

	Print log header flags for gfs journals.

2008-07-21  David Teigland  <teigland@redhat.com>

	gfs_controld: use logsys
	Add logsys usage and configuration, following fenced pattern.

	dlm_controld: use logsys
	Add logsys usage and configuration, following fenced pattern.

	fenced: munge logging
	to prepare for copying it to the other daemons.

2008-07-18  David Teigland  <teigland@redhat.com>

	fenced: complete messages copy start messages
	use the same formats and functions for handling "complete" messages

	dlm_controld: improved start messages
	Copy the improved start/sync message formats from fenced/gfs_controld,
	which allows the messages to be extended in the future without breaking
	compatibility.

	fenced: debug logsys options
	Enable/disable logsys debugging in the following ways, in order of priority:
	. command line -L [0|1]
	. environment variable FENCED_DEBUG_LOGSYS [0|1]
	. cluster.conf logging/logger_subsys/debug [off|on]
	. cluster.conf logging/debug  [off|on]

	fenced: munge config option code
	to match the code in other daemons.

	fenced: improved start messages
	Copy the improved start/sync message formats back from gfs_controld,
	which also makes it simple to sync fencing history to new nodes.

	gfs_controld: close dlm_controld connection
	when we get a poll error from it

2008-07-18  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Fix logrotate snippet filename

	[BUILD] Fix ccs_tool linking dir order

2008-07-17  David Teigland  <teigland@redhat.com>

	gfs_controld: byte swap ids earlier
	before they are used in match_change.

2008-07-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[RGMANGER] Fix call to ccs_tool

	[RGMANAGER] Port ccs_get to proper ccs_tool output

	Revert "[RGMANAGER] Use proper ccs_tool query output"
	This reverts commit 2eaca4f9e31409f110ae318d1f192673dd744e33.

	[CCS] Inflict hopefully last compat issues love to ccs_t*

	[BUILD] Fix ccs_tool/ccs_test build with new compat code

	[RGMANAGER] Use proper ccs_tool query output

2008-07-17  Christine Caulfield  <ccaulfie@redhat.com>

	[CCS] Make ccs_tool/ccs_test more consistent
	After much chatter, these tools are more consistent.

	ccs_test exists for old and new code, and always returns the
	old format output.
	ccs_tool query always returns new format output and the -c
	flag has been removed.

2008-07-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Fix race condition in oldconfig update/execution

2008-07-17  Christine Caulfield  <ccaulfie@redhat.com>

	[CCS] Set return status on failure

	[CONFIG] Add some more errnos to libccsconfdb

2008-07-17  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[RGMANAGER] Port smb resource agent to ccs_tool
	Fix also a wrong arg in get_service_ip_keys in config-utils.sh.in

2008-07-16  David Teigland  <teigland@redhat.com>

	gfs_controld: add missing endian conversion
	for id_info structs in start messages

	gfs_controld: change start message from new members
	Have new nodes include an id struct for all members so we have the
	extra verification step when matching start messages to changes.

2008-07-16  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[RGMANAGER] Port all resource agents to new ccs interface

	[CCS] Kill obsolted ccs_test

2008-07-16  Christine Caulfield  <ccaulfie@redhat.com>

	[CCS] add -c flag to ccs_tool query
	The -c (compat) flag displays the query results in the
	same format emitted by the old "ccs_test" tool.

2008-07-16  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Fix doc install target when building objects outside source tree

	[BUILD] Fix ccs.h include path

	[BUILD] Add ccs_test replacement when building legacy_code

	[BUILD] Implement --enable_legacy_code in the build system

	[CCS] Fix LEGACY_CODE ifdef

2008-07-16  Christine Caulfield  <ccaulfie@redhat.com>

	[CCS] Fold ccs_test into ccs_tool and tidy
	Move all the code from ccs_test into ccs_tool and make it
	switch depending on argv[0]. Also add ccs_tool query that
	does full XPath queries on confdb.

	When build with LEGACY_CODE set ccs_tool will behave as it
	used to, talking to ccsd. Without that it will use the
	new confdb system and assume that ccsd is NOT used for
	distribution of cluster configurations.

2008-07-15  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Don't use logsys in config modules.

	Revert "[CMAN] Don't use logsys in config modules."
	I'm not sure how those deletes got in there, sorry

	This reverts commit 41e7b5a1db20a86d6f5306afeab89944f44bc7b2.

	[CMAN] Don't use logsys in config modules.
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules
	I must not use libraries in config modules

	[CCS] Set errno when an error occurs.
	Set errno to the error code to be consistent with other libraries.

2008-07-14  David Teigland  <teigland@redhat.com>

	dlm_controld: set id before recovery
	The lockspace id needs to be set in the kernel before starting recovery
	in the kernel, which depends on a valid id.

	fenced: fix logsys define
	name is LOG_MODE_FILTER_DEBUG_FROM_SYSLOG

	fenced: enable new logsys mode flag
	since it's been commited to openais svn

2008-07-14  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Remove some spurious prints
	They were left in after debugging.

2008-07-14  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Fix build with newer toolchain

2008-07-14  Fabio M. Di Nitto  <fabbione@cerberus.int.fabbione.net>

	[BUILD] Clean extra kernel modules files

2008-07-11  David Teigland  <teigland@redhat.com>

	groupd: sync daemon setup/structure with others
	This daemon is defunct, but will continue to exist for back compat cases,
	so put code in sync with other daemons.

	fenced: tune logsys settings
	put errors in fenced.log (in addition to syslog) by default
	keep debug out of syslog by default (commented out pending openais commit)

2008-07-11  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Create and install logrotate file
	With daemons writing their own log files, we want to rotate them
	properly.

	Add logrotate snippet in doc/ for who wants to do it manually

	Install it in logrotate dir (you will need to rerun configure for this
	to be set properly)

	Adapt build system to propagate info around

2008-07-10  David Teigland  <teigland@redhat.com>

	fenced/dlm_controld: fix quorum waiting
	Fix how fenced and dlm_controld check for quorum, and how they verify
	that quorum is adjusted for all the necessary failures.

	Fix how dlm_controld creates configfs entries for existing cman members.

	fenced/dlm_controld/gfs_controld: ccs/cman setup
	Consistently set up and clean up ccs and cman.

2008-07-10  Christine Caulfield  <ccaulfie@redhat.com>

	[CONFIG] Add a man page for confdb2ldif
	and make the program do as the man page says.

2008-07-10  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Plug confdb to ldap tool

2008-07-10  Christine Caulfield  <ccaulfie@redhat.com>

	[CONFIG] rename ldap config generator
	Rename loadldap to confdb2ldif. This more accurately
	expresses what the program does. I've also added a comment
	to the generated ldif file.

2008-07-10  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CONFIG] Fix loadldap include

2008-07-09  David Teigland  <teigland@redhat.com>

	gfs_controld: add journal for new node
	Wasn't adding a journal struct for a new node.

	gfs_controld: add query code
	Also let group_tool query new daemons.

2008-07-09  Christine Caulfield  <ccaulfie@redhat.com>

	[CONFIG] Add ldap loader
	Add a new tool to load an existing cluster config into LDAP. This
	is as incomplete as the schema at the moment, but it will allow
	you to add nodes and some very basic fencing devices.

	It uses libconfdb so it can migrate either a running system
	or a cluster.conf file.

2008-07-07  David Teigland  <teigland@redhat.com>

	gfs_controld: support queries from gfs_control
	through libgfscontrol

	fenced: link with liblogsys
	Makefile was missing -llogsys and had duplicate -lcpg

	fenced/fence_node: use SYSLOGLEVEL
	cluster config setting instead of logsys definitions.

2008-07-07  Christine Caulfield  <ccaulfie@redhat.com>

	 [CONFIG] Add some more ldap comments
	    Show what sort of cluster.conf file, the ldap example maps onto.
	    Fix some schema errors.

2008-07-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Fix logging file query
	This fix the config key from filename to logfile as it is supposed to
	be.

	I misread the openais documentation on this specific bit and ended using
	filename instead of logfile.

2008-07-04  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Remove some redundant code.

2008-07-03  David Teigland  <teigland@redhat.com>

	fence_node: use simple logsys api
	instead of the macros.

	fenced: use logsys
	- Setup ccs connection once at the start and keep it open.
	- Read logging configuration from ccs.
	- Replace calls to syslog with calls to logsys.
	- Direct debug statements to logsys.
	- cman setup uses cman_is_active
	- cman setup retries cman_init and cman_is_active

2008-07-03  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Fix logging options
	Fix up the logging for the cman plugin so that it consistently
	honours both settings in cluster.conf and 'cman_tool join -d'.

	This has exposed a couple of bugs in openais which should be
	addressed shortly.

2008-07-03  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Update .gitignore

	[BUILD] Add make oldconfig target
	configure invokation now creates a .configure.sh script file at the top
	level of the tree. It contains a shell script to reproduce the last
	invokation of configure and it allows to add extra config parameters.

	Note that .configure.sh is updated each time you invoke configure.

	Add also a make oldconfig that will execute the script.

	[MISC] Use default configured SYSLOGLEVEL across the tree

	[BUILD] Allow users to configure default built-in syslog level

	[BUILD] Fix telnet_ssl build

	[BUILD] Fix install of telnet_ssl

2008-07-02  Lon Hohberger  <lhh@redhat.com>

	[fence] Make fence_xvm[d] use normal log levels
	It used LOG_NOTICE for info-level and LOG_INFO
	for debug-level notices due to noise from logsys
	which has now been resolved in the trunk of
	openais.

2008-07-02  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Bug #448822: fence_ilo doesn't work with iLO
	New fencing agent for iLO used ssh/telnet to connect, but unfortutely
	there is a problem with power off. This is why we need to use SSL connection
	and RIBCL commands. As there is no (?) telnet with ssl connection in RHEL we
	need one to be able to use same infrastructure as in other agents. This agent
	was not tested with RIBCL version < 2.0 (these part where just ported from the
	old perl fencing agent)

	@todo: we have to put telnet_ssl.py somewhere, I'm not sure where

2008-07-02  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Only do timestamp check for older nodes.
	6.1.0 nodes set the dirty flag, so there's no point
	in checking the join timestamp as it just propogates
	the potential problems that the dirty flag was meant to fix.

2008-07-01  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Add a config update callback

2008-07-01  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Documentation cleanup
	Move all licence and copyright bits into doc/

	Add doc/Makefile and use DOCS= infrastructure to install all
	documentation.

	[BUILD] Install ldap schemas and example in document directory

	[BUILD] Add install/uninstall snippets for documents

	[BUILD] Fix docdir default path

	[BUILD] Allow configuration of docdir

2008-06-27  Lon Hohberger  <lhh@redhat.com>

	[fence] Fix XVM's debug.c default

	[fence] Port XVM to logsys
	* For full debugging,
	* Intentionally does not use LOG_DEBUG (yet) because of
	  the amount of noise generated in doing so; but full
	  "debugging" is available:
	   * use debug="10" in cluster.conf, or
	   * -dddddddddd on the command line.

2008-06-27  Christine Caulfield  <ccaulfie@redhat.com>

	[CONFIG] Improve LDAP error reporting
	and tidy up the include list too.

	[CONFIG] Make ldap put totem in the right place
	This is a bit of a hack for the moment, but it puts the totem
	and logging keys back into the right place in objdb.

	It also tidies the code a little, ready for later work.

2008-06-27  Benjamin Marzinski  <bmarzins@redhat.com>

	[gnbd-kernel] bz 442606: Switch gnbd to use deadline scheduler by default.
	GNBD was hanging under load with O_DIRECT. GNBD needs to block in its
	request function.  This causes some problems with the anticipatory scheduler,
	which GNBD was using by default. To avoid these, this fix makes gnbd use the
	deadline scheduler by default.

2008-06-27  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Add configure options for libldap
	required by config/plugins/ldap/

2008-06-26  David Teigland  <teigland@redhat.com>

	fenced: revert logsys commits
	[FENCE] Start porting fenced to logsys
	cf4c7ebac813b0b607acf6cf74bbdddfc8cfb12a

	[FENCE] Make fenced ready to load logsys config
	c54c56c5a09f98547ceda3bc5fa9afa28b354480

	[FENCE] Move logsys configuration calls where they belong
	18e085596bb8844f74689a92662f2e5e9166836b

	[FENCE] Allow fenced to configure logsys
	da704715c606c9c01637ae53d79f8dec6a8b0389

	[FENCE] fenced: separate concept of fork and debugging
	95a5c6b13294742956b13070ebc4f4513278255f

2008-06-26  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Fix erroneous broadcast matching in ip.sh
	* This fixes an issue where rgmanager removes the
	  wrong address because the IP matches the broadcast
	  address of the interface.
	* Red Hat Bugzilla #453000

2008-06-26  Christine Caulfield  <ccaulfie@redhat.com>

	[CONFIG] Add ldap configurator
	This is an openais configuration plugin to read the cluster config
	from an LDAP server. A schema file is included that provides just
	enough information to get a cluster running, more will follow.

	There is also an example ldif file to show how to load the information
	into the database.

	The defaults are slightly odd at the moment, I'll fix those as it develops
	and document how to override them. In the mean time see the top of the
	source code.

2008-06-26  Lon Hohberger  <lhh@redhat.com>

	[fence] fence_xvmd: Add KVM support; misc cleanups.
	* WARNING WARNING WARNING: Changes the default URI to
	  KVM.  You must specify uri="xen:///" in cluster.conf
	  to use Xen now (or -U xen:/// on the command line)
	* fence_xvmd -h now displays appropriate cluster.conf
	  related help information.
	* This commit simply fixes authorship of the previous
	  patch; apparently git lets you commit as root even
	  if a different user checked it out...

	Revert "[fence] fence_xvmd: Add KVM support; misc cleanups."
	This reverts commit beeb2070953548ecf38751294e5371a668f73ee2.

2008-06-26  root  <root@localhost.localdomain>

	[fence] fence_xvmd: Add KVM support; misc cleanups.
	* WARNING WARNING WARNING: Changes the default URI to
	  KVM.  You must specify uri="xen:///" in cluster.conf
	  to use Xen now (or -U xen:/// on the command line)
	* fence_xvmd -h now displays appropriate cluster.conf
	  related help information.

2008-06-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CONFIG] Fix several bugs in XML parsing implementations

	[CONFIG] Add cluster.conf direct loader
	This pluing allows to load cluster.conf directly into the objdb
	for configuration.
	With this plugin there is no need to have ccsd running.

	To use:

	make sure that all nodes have the same cluster.conf

	form the cluster with:

	cman_tool <usual_options> -C xmlconfig join

	[CONFIG] Make sure to reset xml index in not in list mode

	[CCS] Remove duplicate header

	[FENCE] fence_tool: document "ls"

	[GFS2] hexedit does not need syslog

	[FENCE] fenced: update man page

	[CMAN] Remove unrequired includes

	[FENCE] fence_node: use logsys for logging to syslog

	[CCS] Use common syslog facility

	[FENCE] fenced: separate concept of fork and debugging
	allow fenced to fork when debugging is set from the configuration
	or the system will hang at boot.

	[FENCE] Allow fenced to configure logsys

	[QDISK] Set debug from syslog_level only when requested
	Make also sure to set val to NULL after some operations.

	[CCS] Set debug from syslog_level only when requested

	[FENCE] Move logsys configuration calls where they belong

	[FENCE] Make fenced ready to load logsys config

	[FENCE] Start porting fenced to logsys

2008-06-24  David Teigland  <teigland@redhat.com>

	gfs_controld: basic fixes
	Fix leave/unmount; weren't calling the function.
	Fix match_change for messages from new nodes that don't contain
	info for all members.

2008-06-24  Bob Peterson  <rpeterso@redhat.com>

	gfs2_fsck fails: Unable to read in jindex inode.

2008-06-23  David Teigland  <teigland@redhat.com>

	dlm_controld/gfs_controld: minor fixes
	dlm_controld shouldn't close libdlmcontrol connections that are
	meant to be persistent.

	gfs_controld shouldn't call start_kernel every time through
	process_mountgroup() after it's completed.

2008-06-23  Bob Peterson  <rpeterso@redhat.com>

	savemeta was not saving gfs1 journals properly.

2008-06-23  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Logging: optimizing query sequence
	Query for debug info only if nothing is specified on the command line.

	[QDISK] Port qdisk to the new logsys config interface
	NOTE: this commit also retain backward compatibility with
	the old logging config options but warns the users
	that they are depracated.

	[CCS] Fix debug override from command line vs config

	[CCS] Always check for debug setting as first thing
	This allow us to enable and read debugging output as soon
	as possible.

	[BUILD] Fix new gfs_controld Makefile

2008-06-20  David Teigland  <teigland@redhat.com>

	gfs_controld: new version
	Uses libcpg directly instead of libgroup/groupd, like we've already
	done for fenced and dlm_controld.

2008-06-20  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Make rgmanager check pbond links correctly
	Rgmanager doesn't check pbond links (bonded links when Xen
	networking is used) correctly.  This patch fixes it.

	Patch from John Ruemker.

2008-06-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[QDISK] Major clean up
	Kill lots of dead and unused code around.

	Switch whatever possible into static functions.

	[QDISK] Init logsys later in the process

	[QDISK] Clean handling of debug envvar

	[QDISK] Remove duplicate debugging configuration

	[QDISK] get_config_data cleanup
	get_config_data does not need cluster name.

	change invokation from ccs_force_connect to ccs_connect.
	ccs_force_connect returns only when connection is succesful
	and can sit there forever.
	With the new libccs, if we are connected to cman, we can be
	100% sure that we will be able to do a ccs_connect.

	[QDISK] Make get_config_data static

	[QDISK] Fix debug type

2008-06-20  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] use list_iterate_safe when removing nodes

2008-06-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[QDISK] Fix build with new openais logsys

	[CCS] Convert ccs logsys config to the ais format

	[CCS] Fix improper log level on debugging information

	[CCS] Improve logsys init order
	If we can init and config from a real config file, do that
	and start logging immediatly.

	If we cannot, fall back to default and start logging.

	[CCS] Add cosmetic CCSENTER/EXIT for simple xml queries

	[CCS] Shrink more common code for internal xml queries

	[CCS] Init logsys as early as possible
	If we have an on-disk copy of cluster.conf we will use it
	as early as possible to configure logsys.

	If you are unlucky to have none, logsys will use built-in
	defaults and then switch to configured setting after we
	will get one from the network.

	[CCS] Remove LOG_MODE_DISPLAY_DEBUG from logsys settings

	[CCS] Remove duplicate code and make it common
	We are about to perform many queries to configure logging.

	Collect common code in one static function and switch
	set_ccs_logging to use it, by sharing the same XML context.

	[CCS] Fix a few logsys configuration bits
	Make sure to set debug = 1 when debugging is enabled via envvar.

	Delay logsys flush to catch a few more bits and allow us to
	configure properly.

	[CCS] Fix priority setting

	[CCS] Add missing CCSEXIT call

2008-06-20  Benjamin Marzinski  <bmarzins@redhat.com>

	[gnbd-kernel] bz 449812: disallow sending requests after a send has failed.
	This fix adds a "corrupt" flag to the gnbd device structure. This flag is
	cleared when a new socket connection is opened to the server. It is set
	whenever a send fails.  After this all future sends will fail, and the receiver
	process will stop accepting replies as soon as it notices the flag.

2008-06-19  Benjamin Marzinski  <bmarzins@redhat.com>

	gnbd-kernel: Fix receiver race
	It is possible to have the gnbd receiver process finish and end a request before
	the sending process has finished using the request structure.  This can cause a
	kernel panic.

	This fix adds a waitqueue (tx_wait) and a pointer to the request currently
	being send (current_request) to the gnbd device structure.  current_request is
	set before any request is sent to the server. When the send is complete, it is
	cleared and the wait_queue is woken.  A new function, wait_for_send() is called
	whenever it is possible for a call to gnbd_end_request() to interleave with a
	send. It waits on the waitqueue if the request about to be ended is currently
	being sent.

	Conflicts:

		gnbd-kernel/src/gnbd.c

2008-06-18  Bob Peterson  <rpeterso@redhat.com>

	452004: gfs: BUG: unable to handle kernel paging request. This is a gfs crosswrite from gfs2, to be included with 446085 in RHEL5.

2008-06-17  Lon Hohberger  <lhh@redhat.com>

	Ancillary NOCLUSTER mode fixes for fence_xvmd

	Ancillary NOCLUSTER mode fixes for fence_xvmd

	Fix #362351 - make fence_xvmd work in no-cluster mode
	Conflicts:

		fence/agents/xvm/fence_xvmd.c
		fence/agents/xvm/options.c

2008-06-16  James Parsons  <jparsons@redhat.com>

	Fix for 251358

2008-06-13  Bob Peterson  <rpeterso@redhat.com>

	Fix 32-bit warning in super.c.

2008-06-13  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CCS] Fix build warnings on sparc

2008-06-12  Bob Peterson  <rpeterso@redhat.com>

	Fix gfs_fsck build warnings

	Fix gfs_tool build warnings

	Ignoring gets return value in gfs_mkfs

	Fix gfs_debug build warning

	Fix build warnings from libgfs

2008-06-12  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Fix some compiler warnings on 64 bit systems

2008-06-12  Bob Peterson  <rpeterso@redhat.com>

	Fix another compiler warning for 32-bit arch.

2008-06-12  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[QDISK] Add better support for Xen virtual block devices
	This change allows to detect Xen virtual disks directly
	into sysfsattrs.disk without the need of an external filter.

	[GFS2] Add missing include and fix build warning

2008-06-12  Bob Peterson  <rpeterso@redhat.com>

	Fix build warnings in gfs2-utils.

2008-06-11  Bob Peterson  <rpeterso@redhat.com>

	Added an optional block-size to mkfs.gfs2

2008-06-10  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Add another exception to COPYRIGHT

	[MISC] Remove old copyright

	[MISC] Add original author for cman/qdisk/disk.c

	[MISC] Remove osl-2.1 exception from README.licence

	[GFS] Remove obsoleted gfs_edit in favour of gfs2_edit

2008-06-09  Bob Peterson  <rpeterso@redhat.com>

	Fix compiler warning.

	Ability to specify starting block or structure with -s

	Allow keywords in block number input

2008-06-09  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Relicence rgmanager/src/resources/oracledb.sh under GPLv2+
	There was no reason for this file to have a different licence.
	This kills the last exception in the tree (licence wise).

	[MISC] Whitespace cleanup

	[BUILD] Fix file permissions all around
	Let make/install.mk to take care of the install permissions.

	Don't mangle with tree permissions at all.

	[MISC] Update top level copyright file
	Add 2 missing exceptions and fix a typo

	[GNBD/FENCE] Move fence_gnbd agent where it belongs

2008-06-08  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Prepare infrastructure for perl/python bindings

2008-06-06  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Tree cleanup
	Remove all dead code that has not been updated in ages
	or doesn't build and nobody knows what it is.

	This can be restored at a later stage from stable2 branch
	if required.

	[MISC] Cleanup licence, copyright and header duplication
	Add toplevel README.licence that explain what is what.

	Add copy of GPL-2 and LGPL-2.1 (as pointed by README.licence).

	Add toplevel COPYRIGHT that reports exact details of each file in the
	tree including authors.

	Cleanup all the headers around > 10K lines less of stuff to carry around
	and mind for cleanup.

	[MISC] Add top level licence files
	This is in preparation of a major file cleanup across
	the whole tree.

	[MISC] Remove obsolete and empty files

	[BUILD] Collapse common library makefile bits in libs.mk
	Almost all libraries we build share the same Makefile bits:

	- Collapse them in one location.
	- Make it smarter to switch a library from shared to static and viceversa.
	- Convert all possible libs to use the new system.

	Fix libdlm linking order.

	Standardize invokation to AR.

	[BUILD] Switch libdlmcontrol back to shared library

2008-06-05  Marek 'marx' Grac  <mgrac@redhat.com>

	Fixes #445662: names of resources with spaces are mishandled

2008-06-04  Bob Peterson  <bob@ganesha.peterson>

	Updates to gfs2_edit man page for new option.

	Make gfs2_edit more friendly to automated testing.

	Fix gfs2_edit bugs with non-4K block sizes

2008-06-04  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CMAN] Bump library version
	In preparation for 3.0 and to allow landing of perl/python
	bindings we need to set this to 3 to differentiate from stable2.

2008-06-04  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix: 447378: fence_apc unable to connect via ssh to APC 7900
	Increased timeout from SHELL_TIMEOUT to LOGIN_TIMEOUT in login function.

2008-06-03  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CONFIG] Add full xpath support to libccs

	[MISC] Make several API's private again
	A bunch of API's have been exported and made public by mistake.

	libdlmcontrol, libfenced and libgfscontrol are now private again
	and no shared libraries are available.

	Make sure to uninstall the shared libraries from your system
	as they are not used anylonger.

	NOTE: make sure to clean your tree before you git pull and
	then re-configure (optional to get rid of old build variables).

2008-06-02  Mark Hlawatschek  <hlawatschek@atix.de>

	mount.gfs2: skip mtab updates
	Skip updates to /etc/mtab when it's a link to /proc/mounts (which is the
	case for shared root gfs, for example.)

	bz 318271 (RHEL5)

2008-06-02  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #446995: Unknown option
	Previous patch worked just for command line and there was a problem with
	stdin argument. Typo fixed.

2008-05-29  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Fix mount.gfs2 build
	Remove unrequired SHAREDOBJS since there is only one target.

	Fix CFLAGS to use gfscontrolincdir.

	Statically link mount.gfs2 with libgfscontrol. While this is absolutely
	ugly, it is the best way to prevent a few tons of other problems.

	[BUILD] gfs2 requires group to build

	[BUILD] Change build system to cope with new libgfscontrol
	NOTE: you will need to rerun configure to set the new variables

	[GROUP] libgfscontrol: fix build with gcc-4.3

	[GFS] remove symlink to umount.gfs2
	umount.gfs2 is gone with commit d33f4f1df3e8f84603418d0192c1af18794d3136

2008-05-28  David Teigland  <teigland@redhat.com>

	gfs_controld: restructuring
	- copying the code structure/organization of dlm_controld
	- isolate the cluster2 code from what will be the cluster3 code
	- add libgfscontrol and gfs_control
	- use libgfscontrol between gfs_controld and mount.gfs
	- eliminate umount.gfs, no longer used

	gfs_controld: move recover.c
	Move recover.c into cpg-old.c in preparation for new version.

	gfs_controld: rename files
	Renaming files in preparation for new version.

2008-05-28  Ryan McCabe  <rmccabe@redhat.com>

	libfence: update copyright notice
	- Clarify copyright notice so that GPLv2 is specified explicitly.

	libfence: handle EINTR correctly
	- Handle EINTR correctly
	- String cleanups

	fence: fixes and cleanups to fencing.py library
	- Do not report failure if a node is successfully powered off,
	  but fails to power on.

	- Change 'pass' to 'continue' so that comments and blank lines
	  from stdin are ignored.

	- Use the full path to ssh and telnet when executing the binaries.

2008-05-26  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Add fence_lpar fencing agent to the build system

2008-05-23  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE]: Fix #237266: New fence agent for HMC/LPAR

2008-05-23  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CONFIG] Fix lots of bugs in libccsconfdb
	Add tokenizer to split xpath queries into tokens.....

	Make some functions static since they are not exported.

	Simplify path_dive and get_data to use tokens.

	Cleanup comments.

	Implement a lot more error checking and be extremely picky
	on how queries are requested.

	Fix some string handling to avoid data corruption in result generators.

2008-05-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CCS] Use absolute path for queries
	* It is more efficient
	* It is a well-defined location

2008-05-22  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Use /cluster/rm instead of //rm
	 * It is more efficient
	 * It is a well-defined location

2008-05-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Plugin the new shiny fence_ifmib agent

	[FENCE] Fix ifmib README to report the right fence agent

	[FENCE] Fix copyright header for fence_ifmib manpage

2008-05-22  Ross Vandegrift  <ross@kallisti.us>

	[FENCE] Add fence_ifmib new agent
	Many thanks to Ross Vandegrift for this submission.

2008-05-21  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #447378 - fence_apc unable to connect via ssh to APC 7900
	Problem was that even with ssh itself it was really painfull to log into
	this device (15 - 40 seconds). After specifying cipher and protocol we can
	login and check status in time comparable to others.

2008-05-21  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[GFS2] Use proper include dir for libvolume_id

	[BUILD] Fix install permissions
	Virtually every distro was complaining about scripts
	permissions. Clearly we were doing it wrong. Fix them all.

	[BUILD] Fix rg_test linking
	rg_test does not need libccs

	[BUILD] Fix dlm_controld linking
	dlm_controld does not require linking with libdlmcontrol.

	Merge branch 'master' of ssh://sources.redhat.com/git/cluster

	[BUILD] Fix build order
	group needs cman and not just config to build

2008-05-20  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Don't busy-loop if we can't get a node name
	And remove a spurious error message.

2008-05-20  Bob Peterson  <rpeterso@redhat.com>

	bz 446085: Back-port faster bitfit algorithm from gfs2 for better performance.

2008-05-20  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Fix live migration option (broken in last commit)

	[rgmanager] Apply patch from Marcelo Azevedo to make migration more robust
	* Adds a mapping of cluster nodes to private hostnames for migration
	  paths
	* Makes migration status reporting more robust

2008-05-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Update copyright

2008-05-20  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #446995: Parse error: Unknown option 'switch=3'
	Support for APC MasterSwitch was added (it worked in original fencing
	agent). Option 'switch' on STDIN didn't have a getopt alternative, so
	'-s <switch-id>' was added. Plug number notation <switch>:<plug> works
	as before. Original behaviour for missing switch number does not change.
	If there is just one MasterSwitch then we will set it up otherwise error
	is returned.

2008-05-20  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Fix sparc #ifdef according to the new gcc tables

2008-05-19  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #248609: SSH support in Bladecenter fencing (ssh)
	Complete ssh support for Bladecenter. You can use password or private key
	(identity_file on STDIN; -k in getopt) to login to system. This patch contains
	complete infrastructure (usable also by other agents).

2008-05-19  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[GFS] Sync with gfs2 init script

	[INIT] Do not start services automatically
	Apply Fedora policy to not start services automatically
	to our init scripts.

	[GFS] Fix comment

2008-05-19  Bob Peterson  <rpeterso@redhat.com>

	Replace put_inode with drop_inode

2008-05-16  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Stop using DEVEL.DATE library soname
	Start using the official sonames also for development trees.
	release version is there to catch the same information.

	[CCS] Make a bunch of functions static

	[CONFIG] Add missing Makefiles

	[CONFIG] Create config/ subsystem
	Move libccsconfdb to config/libs/
	Move ccs_test to config/tools/

	top level Makefile:
	 - use config/ subsystem
	 - reorder build dependencies
	 - ccs is now on its own

	configure:
	 - change default location for libccs

	Update Makefiles to cope with new locations

	[BUILD] Free toplevel config/ dir

	[BUILD] Add --without_kernel_modules configure option
	Allow users to disable build of kernel modules.

2008-05-15  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager/lvm.sh:  HA LVM wasn't working on IA64
	switch:
	 $(find /boot/*.img -newer /etc/lvm/lvm.conf)
	to:
	 $(find /boot -name *.img -newer /etc/lvm/lvm.conf)

	Could be better still if there was a way of knowing which
	initrd we used when booting...

2008-05-14  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[DLM] Remove unused header file

2008-05-14  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix typo in name of the exceptions in fencing agents
	Exceptions should be pexpect.EOF, pexpect.TIMEOUT (not pexcept.*). This
	problem only occured in set_status(). Function get_status() contains
	correct exceptions.

2008-05-14  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[FENCE] Rename bladecenter as it should be .pl -> .py

2008-05-14  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix problem with different menu for admin/user for APC
	In APC user/admin can see a different menu and they have to use different sequence
	of keystrokes to access Outlet Controls. Previously only support for user was
	provided.

	[FENCE] Fix name of the option in fencing library
	We were testing for option 'plug_no' but in every other file we have 'port'.

2008-05-14  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CMAN] Fix path to cman_tool

2008-05-13  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Cast some love to init scripts
	- Fix LSB headers
	- Use standard templates
	- Align runlevels
	- Add service dependencies
	- Fix subsystem usage

	[BUILD] Move fencelib in /usr/share
	Python bytecompiled objectes are arch indipendent. Move
	the whole thing where it belongs.

2008-05-13  David Teigland  <teigland@redhat.com>

	dlm_controld: use started_count to detect remerges
	Count then number of times the dlm has been started locally and
	include the count in the start messages sent to begin each change.
	I think this should work to detect remerges after transient
	partitions.  For now it just logs a warning; after observing how
	it works we can use it to ignore remerged nodes.

	dlm_controld/gfs_controld: ignore write(2) return value on plock dev
	bz 446128

	When plocks originate from nfs clients, the kernel mistakenly
	returns 0 instead of the number of bytes written to the plock
	device on write(2).  Don't spam /var/log/messages with errors
	reporting a bad return value from write(2).

2008-05-13  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[RGMANAGER] ^M's are good for DOS, bad for UNIX
	aka: don't edit shell scripts with notepad. thanks.

	[GFS] Make gfs build with 2.6.26 (DO NOT USE!)
	put_inode has been removed from the main kernel. gfs1 needs
	a full porting and review. This commit allows only to build
	the module but it will NOT work.

	[GNBD] Update gnbd to work with 2.6.26

	[BUILD] Require 2.6.26 kernel to build

2008-05-12  David Teigland  <teigland@redhat.com>

	dlm_controld: remove unworking re-merge detection
	Comment out the code that's supposed to detect when nodes are being
	remerged after a transient partition; it's not smart enough yet.

	dlm_tool: refine list output

	dlm_controld: dlm_tool query fixes
	Various fixes to make queries, e.g. dlm_tool ls, show the right info.

2008-05-09  David Teigland  <teigland@redhat.com>

	dlm_controld: options to disable fencing/quorum dependency
	There may be cases where someone wants to use the dlm without
	a recovery dependency on fencing and/or quorum.

	dlm_controld: fix waiting for removed node
	When a node is removed by leaving (not failing), don't wait
	for it to be removed by cman/quorum, since it won't be.

2008-05-09  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] fix cman_tool join -X
	Even when state with cman_tool -X, the preconfig stage tried to lookup
	the node in the objdb (which is empty!) and fails if it was not found.

	The "aisexec" object did not exist so the username was not stored.

2008-05-09  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Fix #441582 - symlinks in mount points causing failures

2008-05-08  David Teigland  <teigland@redhat.com>

	daemons: queries
	Completing list command for fence_tool and dlm_tool.

2008-05-08  Marc - A. Dahlhaus  <mad@wol.de>

	[MISC] Add version string to -V options of dlm_tool and group deamons

2008-05-07  David Teigland  <dct@localhost.localdomain>

	daemons: mostly daemonization stuff
	- do lockfile before daemonizing
	- use daemon(3)
	- openlog even if not forking
	- other little odds and ends

2008-05-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Fix some gfs2 build warnings

	[BUILD] Fix install when building from a separate tree

2008-05-07  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] make qdisk compile on i386
	The combination of -Werror and an attempt to print a size_t on several
	architectures was causing it not to build on i386.

	The cast isn't ideal, but it's only a log message.

2008-05-07  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Fix even more build errors with Fedora default build options
	... and more to come

	[MISC] Fix more build errors with Fedora default build options
	NOTE: some bits are absolutely not required but we still
	add them to shut up the warnings.

	[MISC] Fix build errors with Fedora default build options

	[BUILD] Allow users to set path to init.d
	Almost all distributions use /etc/init.d but some still use
	the legacy path to /etc/rc.d/init.d.

	Allow builders to set the path instead of using some manual
	workarounds to do later fixup.

2008-05-06  David Teigland  <teigland@redhat.com>

	dlm_tool: add libdlmcontrol query commands
	Basic code for ls, dump, plocks, not yet tested.

	dlm_controld: code for info/debug queries

2008-05-06  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] Fix #435154: Support for 24 port APC fencing device
	Fixed in the new version of python fencing agent. But there was still a problem
	because there is major change of interface between firmware v2.7.x and v3.5.x.
	After this patch both types of firmware version should work.

2008-05-06  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Fix localhost checking that I broke last week.

2008-05-05  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[CMAN] Set default syslog facility at build time

	[CCS] Fix build with gcc-4.3

2008-05-02  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CCS] Detach dependency on ccsd to run the cluster
	The old static libccs is now called libccscompat and should not be used
	by anything outside ccs/. Note that the headers and the library are not
	installed, nor configure knows about it. All application paths that require
	compat are made static and non-configurable.

	Allow ccsais and ccs_tool to use libccscompat.

	Stop linking ccsd with libccs. It was not required before either.

	Add new shared library called libccs that uses aisexec confdb directly.
	The new libccs retains API compatibility with the old library so it was
	possible to "unplug" the old and "plug" the new one in one go. All the
	applications in the stack are now quering aisexec db directly.

	NOTES:
	 - the new library does not emulate all the libccscompat calls as some
	   of them are not used anywhere but this is not a problem since libccs
	   was static. We are shipping it now shared and we a new soname.
	 - the library implements only a small subset of xpath to query the aisexec
	   config db.

	Port ccs_test to use the new libccs and drop all calls that are not used anywhere.

	Set new default ccsincdir and ccslibdir to ccs/libccsconfdb in configure.

	NOTE to developers: you will need to rerun configure.

	[CMAN] Do not query ccs as it might not be the right config plugin

2008-05-01  David Teigland  <teigland@redhat.com>

	dlm_controld: filling out code
	Filling in various unfinished bits, fixing up wrong/inconsistent
	header length (also in fenced).

2008-05-01  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Remove external dependancies from config modules
	This remove the external depandancies from the aisexec config
	modules because they break all sorts of things.

	Instead of logging errors, they return them back to the caller - this removes
	the dependancy on logsys.
	Also, I've remove the totemip function calls and replaced them with
	usable subsets in the config code itself.

	The cman and ccs config plugins now work with testconfdb in
	standalone mode.

2008-04-30  David Teigland  <teigland@redhat.com>

	libdlmcontrol: filling out code

2008-04-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	libdlm: fix libdlmcontrol in Makefile

2008-04-30  David Teigland  <teigland@redhat.com>

	dlm_controld: fix build problems in previous commit

2008-04-30  Marek 'marx' Grac  <mgrac@redhat.com>

	[FENCE] SSH support using stdin options
	STDIN options have to be name=value even if they are just boolean. These options
	are taken from cluster.conf so they have to be XML-like.

2008-04-30  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Change build system to cope with new libdlmcontrol

2008-04-29  David Teigland  <teigland@redhat.com>

	libdlmcontrol: new lib interface to dlm_controld
	Adds all the structure, most of the calls do nothing yet.

	libdlm: use linux/dlm.h from 2.6.26-rc
	Use new linux/dlm.h (which inclues dlmconstants.h) to give us
	DLM_LOCKSPACE_LEN.

	fence_tool: fix list command

2008-04-28  David Teigland  <teigland@redhat.com>

	fence: fence_tool list and fenced_domain_nodes()
	Let fence_tool query fenced for domain state.
	Change fenced_domain_members() to fenced_domain_nodes()
	to query for nodes other than members.

2008-04-28  Lon Hohberger  <lhh@redhat.com>

	[cman] Close sockets in error state in gfs_controld / dlmtest2 / groupd test

2008-04-28  Marek 'marx' Grac  <mgrac@redhat.com>

	[RGMANAGER] Fixed typo in mysql.metadata
	Changed httpd to mysqld

2008-04-28  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CMAN] Setup logging file
	Align cman logging options with the other subsystems and
	set logging file to LOGDIR "/cman.log".

	It is still possible to disable the feature by using the
	standard to_file: no config option (default to yes).

2008-04-26  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[BUILD] Fix build order. Gotta love circular build depends...

2008-04-25  David Teigland  <teigland@redhat.com>

	fenced: allow queries during fencing; group queries
	Put mutex unlock/lock around fencing steps that take a while so that the
	query thread won't be blocked.  Fill in query info for libgroup mode.

	fenced: process queries in a thread
	Add a thread for responding to the new libfenced queries, since fenced
	blocks for long periods when fencing nodes.

	fence: using new libs
	Filling out various incomplete parts, making use of the new interfaces.

2008-04-25  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[RGMANAGER] Fix uninstall target

	[FENCE] Enable new fence agents by default
	Remove enable_fence_experimental_agents configure option in favour of
	"crack_of_the_day"

	Rename files around as agreed with Marek.

	[GROUP] Apply patch to make gfs_controld work with 2.6.26

	[BUILD] Fix fence lib install target

	[BUILD] Fix kernel check for good
	Use the top level Makefile of the source tree rather than
	random includes that keeps changing.

	[BUILD] Fix building with separate object dir

	[BUILD] Deal with new libfenced
	configure, make/defines.mk.input:
	  - add fencedincdir and fencedlibdir options for the shared library.
	  - set default for fenceincdir and fencelibdir to ./fence/libfence (renamed).

	fence/Makefile:
	  - build the shared lib.

	fence/fence_node/Makefile, fence/fence_tool/Makefile:
	  - use fencedincdir and fencedlibdir.
	  - add build-dep on the shared library.

	fence/fenced/Makefile:
	  - update depends on libfence (renamed).

	fence/libfenced/Makefile:
	  - use path to source instead of direct include to fenced.

	fence/lib:
	  - renamed to fence/libfence.

2008-04-24  David Teigland  <teigland@redhat.com>

	fenced: new libfenced interface
	A new library, libfenced, is used to communicate with fenced.  Previously,
	programs would each open fenced's local socket and write/read strings.

	dlm_controld: build plock code
	Building this requires 2.6.26-rc kernels because of linux/dlm_plock.h.
	Once built, dlm_controld is backward compatible, and will process plocks
	from earlier kernel versions.

2008-04-24  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CCS] Allow ccsd logging level and facility to be set by cluster.conf
	This change allow to set log_level and log_facility for the ccs subsystem
	within cluster.conf.

	Here is a config example:

	<?xml version="1.0"?>
	<cluster name="test" config_version="1">
	  <ccs log_facility="local6" log_level="debug"/>
	....

	[CCS] Document -d (debugging) switch

	[CMAN] Use build/user defined default logging facility

	[CMAN] Convert qdiskd to use logsys

2008-04-23  David Teigland  <teigland@redhat.com>

	fenced: more new devel
	New stuff still under development, lots of various things fixed,
	reworked, changed.

2008-04-23  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[CCS] Switch to use user selected logdir and syslogfacility

	[BUILD] Allow users to set default log dir and syslog facility

	[BUILD] Fix install/uninstall targets for fence/agents/lib

	[BUILD] Deal with the new libfence properly
	configure, make/defines.mk.input:
	  - rename fencelibdir to fenceagentslibdir to avoid name space collision.
	  - add fenceincdir and fencelibdir options for the shared library.

	make/fencebuild.mk, make/install.mk, make/uninstall.mk, fence/agents/apc/apc.py,
	fence/agents/bladecenter/bladecenter.py, fence/agents/drac/drac5.py,
	fence/agents/ilo/ilo.py, fence/agents/lib/Makefile, fence/agents/wti/wti.py:
	  - rename fencelibdir to fenceagentslibdir.

	fence/Makefile:
	  - build the shared lib.

	fence/fence_node/Makefile, fence/fenced/Makefile:
	  - use fenceincdir and fencelibdir.
	  - add build-dep on the shared library.

	fence/fence_tool/Makefile:
	  - remove obsolete depends target.

	fence/fenced/fd.h:
	  - include "libfence.h" to fix implicit declaration when building fenced.

	fence/lib/Makefile:
	  - build also static version of libfence.
	  - move ldflags at the end of the linking invokation call.

2008-04-22  David Teigland  <teigland@redhat.com>

	fenced: new version
	In the same theme as the new version of dlm_controld.
	- uses libcpg directly without libgroup (use the -g0 option)
	- runs in backward compat mode by default, using libgroup to interact
	  with old groupd/fenced (-g1 option)
	- move code that runs agents (agent.c) into libfence

2008-04-22  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager/lvm.metadata: Fix parameter description fields
	Descriptions were never properly updated after creation.

2008-04-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[MISC] Update Red Hat main copyright file

	[MISC] Update copyright headers

	[CCS] Convert to logsys

	[CCS] libraries should never log

2008-04-22  Benjamin Marzinski  <bmarzins@redhat.com>

	The gnbd kernel module on 64 bit architectures didn't handle ioctls from 32 bit userspace processes. Now it does. Resolves: bz #440454
	Also, I was getting an error because on ppc64, the manual definition of O_DIRECT
	in gnbd/server/device.c was incorrect. I switched to defining _GNU_SOURCE, which
	should mean that O_DIRECT will be automatically defined.

2008-04-22  Lon Hohberger  <lhh@redhat.com>

	Remove clushutdown man page references from clusvcadm.8; resolves #324151

2008-04-22  Fabio M. Di Nitto  <fdinitto@redhat.com>

	[rgmanager] Remove obsolete clushutdown utility
	Merge from RHEL5 branch.

2008-04-21  Andrew Price  <andy@andrewprice.me.uk>

	[GFS2] gfs2_edit: Remove duplicate linux_endian.h
	gfs2/edit/linux_endian.h is an exact duplicate of gfs2/include/linux_endian.h
	and can be removed as gfs2/include/linux_endian.h is picked up instead.

2008-04-21  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Disallow a new dirty node from joining the cman cluster
	Patch from David Robinson, bz#443358

2008-04-18  Bob Peterson  <rpeterso@redhat.com>

	bz295301: Need man page for gfs_edit

2008-04-18  Lon Hohberger  <lhh@redhat.com>

	[fence] Close file descriptors that are in invalid/error states
	If poll was returning with a file descriptor noted as active,
	but with the POLLERR/POLLNVAL flags set (but not POLLIN or
	POLLHUP), fenced and groupd would enter a tight spin loop.

	This fixes that condition.

2008-04-16  Abhijith Das  <adas@redhat.com>

	gfs2_tool: Fix build warnings in misc.c bz 441636
	gfs2_tool used to include both linux/fs.h and sys/mount.h that caused some symbols to be defined twice and hence caused some build warnings. This patch removes #include linux/fs.h and moves all the required definitions from there to a new local header file iflags.h.
	This patch also removes the SYSTEM and DIRECTIO flags as they are not used anymore.

2008-04-16  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[GFS2] Fix build warning

2008-04-16  Andrew Price  <andy@andrewprice.me.uk>

	[GFS2] Remove unrequired header file
	"grep -nr 'list\.h' gfs2/" found that this file was not included anywhere and
	removing it does not stop any of the gfs2 utils from building so it seems that
	it can be removed.

2008-04-16  David Teigland  <teigland@redhat.com>

	gfs_controld: retry recovery for withdrawn journal
	bz 442451

	This is unfortunate, but seems to be the best solution available.  The
	problem, described more fully in the bz, is that when gfs_controld tries
	to do recovery on a journal for a withdraw, the withdrawing node may not
	yet have cleared its dlm locks.  This means the journal lock may still be
	held by the withdrawing node, causing all the recovering node(s) to fail
	acquiring it, and no one does the recovery.  The solution is for all
	recovering nodes to retry recovery of a withdrawn journal until they
	succeed (only the first to get the journal lock will actually recover
	it, the others will see it's recovered and report success.)

2008-04-16  Lon Hohberger  <lhh@redhat.com>

	[fence] Preliminary TPS/NBB/NPS support in new WTI agent.

2008-04-16  Fabio M. Di Nitto  <fabbione@daitarn-fedora.int.fabbione.net>

	[RGMANAGER] Fix build with gcc4.3

	[BUILD] Fix clean target
	Make sure to remove also Module.markers files created by Fedora 9 kernel build
	system.

2008-04-16  Christine Caulfield  <ccaulfie@redhat.com>

	[FENCE] Make it build with gcc 4.3
	fence_tool.c also needs <limits.h>

	[MISC] Make it build with gcc 4.3
	A few files now need to include <limits.h> and cman
	was using an illegal access into the sockaddr_in6 structure.

2008-04-16  Fabio M. Di Nitto  <fabbione@fabbione.net>

	Revert "gfs2_tool: Fix build warnings in misc.c bz 441636"
	This reverts commit d2a926d2122c23e6175a62326b5e2b421b842a93.

2008-04-16  jparsons  <jparsons@redhat.com>

	Bump MAX_DEVICES in fenced from 4 to 8
	Addresses request in rhbz#284701

2008-04-16  David Teigland  <teigland@redhat.com>

	gfs: don't cancel glocks when writing to hidden file
	bz 438268

	When glock.c sees the PRIORITY flag, it cancels any outstanding
	glocks prior to doing the lock request.  lock_dlm also uses the
	PRIORITY flag to give give granting priority to the lock in the
	dlm.  Both of these are necessary when the PRIORITY glock is used
	for recovery, but only the second is wanted (neither is really
	needed) when writing to a hidden file.  A new GL_NOCANCEL_OTHER
	flag, combined with PRIORITY, is used to tell glock.c to not do
	the cancels.

2008-04-15  David Teigland  <teigland@redhat.com>

	dlm_controld: max name length sanity
	Define MAX_LS_NAME 64, and note that it should match MAX_LOCKSPACE_LEN in
	dlmconstants.h.  Including linux/dlm.h directly is difficult because some files
	need to include libdlm.h which doesn't combine nicely with linux/dlm.h.

	libdlm: max name length sanity
	Attempting to bring some sanity to handling of max lockspace name length
	and max resource name length.  A new kernel patch creates single authoritative
	definitions in linux/dlmconstants.h:

	define DLM_LOCKSPACE_LEN       64
	define DLM_RESNAME_MAXLEN      64

	These definitions are copied in libdlm.h so that user apps don't need to
	include the kernel header.  libdlm itself uses the dlmconstants.h
	definitions, and now checks both resource and lockspace name params against
	these definitions before calling into dlm-kernel.  dlm-kernel checks each
	of the input names against these definitions when creating a new rsb or ls.

2008-04-15  Bob Peterson  <rpeterso@redhat.com>

	bz438762: gfs_tool: Cannot allocate memory

2008-04-15  Andrew Price  <andy@andrewprice.me.uk>

	[GFS2] gfs2_fsck: Fix operation on 'ptr' may be undefined warnings
	Occurrences of *ptr++ in fs_recovery.c made gcc throw up "operation on 'ptr'
	may be undefined" warnings. This patch disambiguates those occurrences.

2008-04-15  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[GROUP] Fix building with standard kernels
	> From: David Teigland <teigland@redhat.com>
	> Subject: [Cluster-devel] kernel for building master

	> This commit assumes dlm kernel changes that are only available in
	> linux-next or linux-mm (linux/dlm_plock.h).  This goes against our aim to
	> keep master building against -rc kernels by default, so the following
	> patch disables the relevant part for now.  Fabio has said he may turn this
	> ifdef into something more sophisticated.

	Apply patch from David to allow dlm_controld to build again
	against vanilla kernels.

	Change the patch to use the EXPERIMENTAL_BUILD infrastructure.

	Cleanup a couple of typos from the patch.

	[BUILD] Set automatically cflags when building experimental bits

	[BUILD] Fix typo

	[BUILD] Add --enable_crack_of_the_day configure option
	This option should NEVER be used lightly and it's there as facility
	for developers that need/want to commit experimental code that,
	for one reason or another, is not ready for general use or it depends
	on other code that is not available mainline yet.

2008-04-14  Bob Peterson  <rpeterso@redhat.com>

	bz425421: gfs mount attempt hangs if no more journals available

2008-04-14  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[GFS2] Fix build warning

2008-04-14  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Save the new expected_votes when a node is removed
	When a node leaves the cluster using 'cman_tool leave remove' it reduces
	the quorum of the cluster to accomodate the loss of the node. Unfortunately
	the following transition messages raise quorum back to its original value
	again because of the bug fix for bz#308581, so it appears that the
	remove hasn't worked.

2008-04-13  Bob Peterson  <rpeterso@redhat.com>

	bz440896/440897 GFS: gfs_fsck should repair gfs_grow corruption (see bug #436383)

2008-04-11  David Teigland  <teigland@redhat.com>

	dlm_controld: quorum checking
	Fill out the quorum dependency checking, and refine structure of the
	fencing and fs dependency checking which don't actually work yet.

	dlm_controld: new version
	- uses libcpg directly without libgroup (use the -g0 option)
	- takes over plock handling from gfs_controld
	- interacts with fenced and fs_controld to coordinate recovery (todo)
	- runs in backward compat mode by default, using libgroup to interact
	  with old groupd/dlm_controld (-g1 option)
	- plan to add a new default -g2 option that will detect old groupd's in
	  the cluster and only run in old mode if any exist

2008-04-11  Abhijith Das  <adas@redhat.com>

	gfs2_tool manpage: Updates to the manpage for bz441636

	gfs2_tool: Fix build warnings in misc.c bz 441636
	gfs2_tool used to include both linux/fs.h and sys/mount.h that caused some symbols to be defined twice and hence caused some build warnings. This patch uses linux/ext3_fs.h instead of /linux/fs.h and uses EXT3_XXX_FL inode flags instead of the respective FS_XXX_FL flags.
	This patch also removes the SYSTEM and DIRECTIO flags as they are not used anymore.

2008-04-11  Bob Peterson  <rpeterso@redhat.com>

	Fix some compiler warnings in gfs2_edit

	gfs2_edit was not recalculating the max block size after it figured that out.

	Fix gfs2_edit print options (-p) to work properly for gfs-1 rgs and rindex.  Also fixed rgflags option for gfs1.

	Fix savemeta so it saves gfs-1 rg information properly Also add savergs option to facilitate rg-only repairs.

2008-04-09  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[KERNEL] Update modules to build with 2.6.25
	Update clean target to cope with a new file that Kbuild creates at build time.

	Bump minimum kernel requirements to 2.6.25.

	Port modules to new kobj api.

2008-04-09  Christine Caulfield  <ccaulfie@redhat.com>

	Remove references to broadcast. Remove references to CCSD.
	Fix entry for nodeid which seems to have got split up!

2008-04-09  Ryan O'Hara  <rohara@redhat.com>

	BZ 441323 : Redirect stderr to /dev/null when getting list of devices.

2008-04-09  Chris Feist  <cfeist@redhat.com>

	Added back in change to description line to make chkconfig work properly.

2008-04-09  Ryan O'Hara  <rohara@redhat.com>

	BZ: 373491, 373511, 373531, 373541, 373571, 429033 BZ: 373491, 373511, 373531, 373541, 373571, 429033
	- Prevent "reservation conflict" messageswhen scsi_reserve starts.
	- Leave the fence domain if scsi_reserve fails to register with any device.
	- Improve logging in scsi_reserve script.
	- Use "locking_type = 0" for all lvm commands (ie. vgs).
	- Fix SCSI reservations scripts to handle LVM mirrors and stripes.
	- Not an error if fence_scsi attempts to remove a non-existent key from a
	  device.

	BZ 248715 - Use cluster ID and node ID for key rather than IP address.

2008-04-09  Ryan McCabe  <rmccabe@redhat.com>

	fix bz277781 by accepting "nodename" as a synonym for "node"

2008-04-09  Ryan O'Hara  <rohara@redhat.com>

	Fix help message to refer to script as 'fence_scsi_test'.

	Attempt to register the node in the case where it must perform fence_scsi fencing but is not registered with the device(s) that must be fence. With SCSI persistent reservations, in order to do a "preempt and abort" (which we are using to fence a node), the node doing this operation must be registered with the device. This fix will check to see the the node that is performing the fencing is registered with the device(s). If it is not, then it attempts to register with the device(s) so that it can then continue with the fence operation normally. Note that this situation should never happen, especially if things are configured properly.

	Allow 'stop' to release the reservation if and only if there are no other keys registered with a given device. Prior to this fix, if was not possible for 'scsi_reserve stop' to unregister/release on the node that was holding the reservation.

	Record devices that are successfully registered to /var/run/scsi_reserve.

	Rewrite of get_scsi_devices function. It is no longer possible to use lvs to get a list of cluster volumes (and underlying devices) at fence time. For this reason we must "keep state" by recording which devices we register with at startup. The init script (scsi_reserve) will record each device it successfully registered with to a file (/var/run/scsi_reserve). Then, and fence time, the fence_scsi agent will unregister each device listed in the state file.

	Fix success/failure reporting when registering devices at startup. If our node (key) is already registered with a given device, do not report failure since this is misleading.

	Replace /var/lock/subsys/${0##*/} with /var/lock/subsys/scsi_reserve.

	Fix split calls to be consistent. Remove the optional LIMIT parameter.

	Fix code to use get_key subroutine. Fix sg_persist commands to specify device via -d parameter.

	Remove "self" parameter. This was used to specify the name of the node performing the fence operation, and was passed to the agent. This is no longer used. Instead, we get the name of the local node in the agent by parsing the output from 'cman_tool status'.

	Fix unregister code to report failure correctly.

	Variable should be quoted in conditional statement.

2008-04-09  Fabio M. Di Nitto  <fabbione@fabbione.net>

	Revert "fix bz277781 by accepting "nodename" as a synonym for "node""
	This reverts commit 57a07697afeb2e5d3bb2a4220e844bcdc44598cb.

	Revert "Fix help message to refer to script as 'fence_scsi_test'."
	This reverts commit e9b17a088668ceaba5c6ea35f8d22ec2613cfe96.

2008-04-08  Andrew Price  <andy@andrewprice.me.uk>

	[[BUILD] Warn and continue if CONFIG_KERNELVERSION is not found
	Currently the configure script assumes that CONFIG_KERNELVERSION is defined in
	autoconf.h. This patch handles the case where it isn't defined there.

2008-04-08  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[BUILD] Fix clean target for experimental fence/agents/lib

2008-04-07  Abhijith Das  <adas@redhat.com>

	gfs2_tool manpage: gfs2_tool counters doesn't exist anymore.
	This patch reflects the removal of the 'counters' command from gfs2_tool. bz 438759

	gfs-kernel: fix for bz 429343 gfs_glock_is_locked_by_me assertion
	This assertion shows up when gfs_readpage gets called without the inode glock
	being held through the madvise syscall when the kernel attempts to readahead.

	This patch unlocks the page, locks the inode glock and returns
	AOP_TRUNCATED_PAGE.

	I had to change gfs_glock_is_locked_by_me() to return the holder if glock is
	held or NULL otherwise (instead of the TRUE/FALSE integer value it used to
	return earlier).

	I also added a new GL_READPAGE flag. If we need to get an inode glock in
	gfs_readpage(), this flag is set on the holder. We must not unlock another
	holder that we might have had on the glock before we entered gfs_readpage;
	checking for this flag before unlocking ensures that.

2008-04-05  Abhijith Das  <adas@redhat.com>

	gfs2_tool: remove 'gfs2_tool counters' as they aren't implemented anymore
	gfs2 doesn't implement counters anymore so we remove them. BZ 438759 came up
	because we gfs2 stopped implementing counters.

	Conflicts:

		gfs2/tool/Makefile

2008-04-03  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager/lvm.sh:  Minor comment updates
	Just moving/expanding some comments.

2008-04-02  Bob Peterson  <rpeterso@redhat.com>

	Resolves: bz 436383: GFS filesystem size inconsistent

2008-04-02  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager/lvm.sh: change argument order of shell command
	Nice to have output redirect at end of line... cosmetic
	change only.

2008-04-01  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager/lvm.sh:  Fix bug bz242798
	Allow a machine to fence itself in the event that it
	cannot deactivate logical volumes.  (The user must
	explicitly enable this option.)  This is useful in cases
	where one machine in the cluster looses connectivity to
	its resources, but the others don't.  The machine fences
	itself and the service moves to another machine.

2008-04-01  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[FENCE] Make sure to version and copyright all built files
	Like all fence agents, those info can be useful. Store them
	in the modules even if only the libs print them out.

	[FENCE] Fix fencelib to pring version and copyright

	[BUILD] Enable build and install of experimental fence agents

	[BUILD] Royal cleanup of the fence agents build system
	Collapse fenceperl and fencepy into fencebuild.

	fencebuild now use a much simpler and slightly more clever
	shell script scripts/fenceparse instead of scripts/define2var
	that was no longer used anywhere in the tree.

	update all the fence/agents/ Makefile to use fencebuild.mk.

	make fencebuild understand more than one target at a time.

	[FENCE] Remove obsoleted fence_apc perl implementation

	[FENCE] Move apc_snmp README where it belongs

	[FENCE] Move apc_snmp README where it belongs

	[BUILD] add enable_experimental_fence_agents configure option

	[BUILD] Add fencelibdir support
	The new fence agents share a common python library.

	Make it's location configurable at build time (default to /usr/lib/fence).

	Update all targets required to handle it.

	Update the agents accordingly.

	NOTE: you will need to re-run configure to propagate the new configuration
	option. The new agents are not used/build/installed yet. This will happen
	shortly.

	NOTE to packagers: the new library depends on pexpect.

	[BUILD] Fix fenceperl and fencepy make snippets to allow multiple targets

2008-03-31  Lon Hohberger  <lhh@redhat.com>

	[CMAN] Make cman init script start qdiskd intelligently
	Resolves qdiskd/cman start ordering so gfs file systems
	are mounted reliably in 1-node+qdisk boot situations.

	Revert "[CMAN] Make cman init script start qdiskd intelligently"
	This reverts commit 2b6e388e72e6a35f2133c98a714dc49ab747cf80.

	Need review.

	[CMAN] Make cman init script start qdiskd intelligently
	Resolves qdiskd/cman start ordering so gfs file systems
	are mounted reliably in 1-node+qdisk boot situations.

2008-03-29  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[BUILD] Remove extra debugging entry

	[FENCE] apc_snmp: allow paths to snmp binaries to be configurable

	[FENCE] Enable fence_apc_snmp
	Separate fence_apc_snmp from apc in its own directory.

	Update the build system to understand --mibdir and propagate it
	down to fence_apc_snmp and the install targets.

2008-03-28  Marek 'marx' Grac  <mgrac@redhat.com>

	fence/agents:	Add obsolete options
	Added obsolete/dual options like hostname/ippaddr, action/option. These
	options are either translated to new or they are not used anymore/yet in
	new agents (eg. version of firmware).

	fence/agents:	WTI agents merged
	Fencing devices from WTI can use password or login/password for loging in.
	This patch merge two fencing agents together so it will be same as old agent.

	fence/agents:	New fencings agents
	There are new fencing agents based on a new library. They need a 'pexpect' package. If it is possible there is support for both telnet and ssh. In this patch there are agents for: APC, BladeCenter, Drac 5, ILo and WTI. It is possible that backward compatibility is broken (to be fixed).

2008-03-28  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[CMAN] qdisk: add credits to Joel

	[CMAN] Do not duplicate entries in the objdb
	A dump-db did show duplicate entries of logging and totem
	because we were not looking for previous entries correctly.

	Make sure to reset to the proper handle before searching.

2008-03-27  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[CMAN] Fix config handling
	Some objects were not relocated properly and it was breaking
	logging among other bits.

2008-03-26  Jonathan Brassow  <jbrassow@redhat.com>

	rgmanager/lvm.sh: Fix bug 438816
	Missing VG name parameter to 'vgchange --deltag' call
	caused tag to be remove from all VGs, not just the
	intended one.

	Thanks to Simone Gotti for the patch.

2008-03-26  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[BUILD] Fix man page install permission
	Man pages were installed -m755 that is wrong. Install them
	as -m644 as it should be.

2008-03-25  Bob Peterson  <rpeterso@redhat.com>

	Update to prior commit for bz431945: I forgot that STABLE2 does not have a diaper device.

2008-03-24  Lon Hohberger  <lhh@redhat.com>

	[cman/qdisk] Fix type pun errors in proc.c

2008-03-24  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[BUILD] Set -MMD as default CFLAGS
	Enable non-system header files dependency tracking by using -MMD
	in combination with -include .d files.

	This change will allow developers to edit an header file
	and simply fire a make to rebuild all the objects that are affect
	by the header change.
	Before this change a make clean and make were required to propagate
	the header change.

	NOTE to developers: you will need to rerun a configure to set
	-MMD in the default CFLAGS. All directories that builds objects
	now have a bunch of extra .d files that can be safely ignored
	as they are automatically generated and ignored by git.

	[BUILD] Update .gitignore for .o and .d files

2008-03-21  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[BUILD] Fix handling of version and libraries soname
	The overall handling of release_major/minor/micro was wrong
	and it was discovered only after the first STABLE2 release.

	This change obsoletes release_major/minor/micro and introduces
	3 new configure options: release_version, somajor and sominor.
	And add options to make/official_release_version.

	somajor/sominor should only be numbers (no sanity check is performed)
	and they can either be specified when invoking configure (both must
	be present at the same time and they will override official_release_version)
	or in make/official_release_version as:
	SONAME "2.2"
	If not specified anywhere they will be generated as before.

	release_version can now be a random string that will be shown
	when asking for tool versions. When specified from the configure
	it will override the one specified in make/official_release_version
	as previously documented (ex: VERSION "2.02.01").
	If not specified anywhere it will be generated by somajor.sominor.

	NOTE to developers: you will need to rerun configure to regenerate
	make/defines.mk.

	NOTE to packagers: sorry about this intrusive change but the problem
	was noticed too late. Removing --release_major/minor/micro from your
	configure invokation should be enough and usually those values should be
	set by upstream. While we provide an easy option to override values,
	please try to keep them consistent with upstream for easy tracking of bugs
	vs released versions.

	NOTE to release manager: make/official_release_version is not tracked
	in git and should now contains 2 keywords to work properly (order is not
	important).

	[CMAN] Fix building when -DDEBUG is not specified

	[CMAN] Drop dependency on libdevmapper

2008-03-20  Lon Hohberger  <lhh@redhat.com>

	[cman] Apply missing fix for #315711

	[cman] Make mkqdisk print all device paths

	[cman] Fix qdisk Makefile / disk_util merge bugs

	[cman] Merge scandisk & fixes from RHEL5 branch
	Scandisk replaces the old scanning of /proc/partitions with
	a flexible library created by Fabio M. Di Nitto

	Fixes from the RHEL5 branch include:
	 * ability to use block devices with >512 byte sector size
	 * bug causing infinite "Node X is undead" messages

2008-03-20  Christine Caulfield  <ccaulfie@redhat.com>

	[DLM] Mention lidlm_lt in the man page

2008-03-20  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Remove unused lockspace.c file

2008-03-19  Joel Becker  <joel.becker@oracle.com>

	libdlm: Don't pass LKF_WAIT to the kernel
	libdlm is passing LKF_WAIT to the kernel.  In the kernel, the unlock
	path strictly audits flags, and errors on this unknown (to the kernel)
	flag.  The correct answer is to keep the flag in userspace.

2008-03-19  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Fix #432998
	Fix a bug causing incorrect return codes during service stop operations

2008-03-19  Bob Peterson  <rpeterso@redhat.com>

	Merge branch 'master' of ssh://sources.redhat.com/git/cluster into master.bz431945

	Resolves: bz 431945: GFS: gfs-kernel should use device major:minor

	Resolves: bz 421761: 'gfs_tool lockdump' wrongly says 'unknown mountpoint' re HP cciss RAID array

2008-03-19  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] valid port number & don't use it before validation
	cman_send_data didn't validate the port number. This was
	not a great problem, but it was slightly silly.

	cman_start_recv_data used the port number before validation
	in a debug message, this could crash the server if debug
	is enabled and a very large port number was passed in.

	[CMAN] Don't declare a variable in the middle of a block
	Later gccs seem to allow this behaviour (and leaving it like
	that was a mistake on my part) but I've moved the declaration
	of 'qm' back to the start of the block for normality's sake.

2008-03-18  Christine Caulfield  <ccaulfie@redhat.com>

	[CMAN] Limit outstanding replies
	This commit imposes a limit on the number of outstanding replies
	that a connection can have. This is to prevent a DoS attack that
	causes cman to eat all available memory by sending lots of requests
	and not reading the replies.

	The deafult is 128, it can be set in cluster.conf as
	<cman max_queued="1000"/>

	[CMAN] Free up any queued messages when someone disconnects
	When a client disconnects we need to go through the list of
	queued replies to get rid of any that have not been collected.

	[CMAN] Make cman cope with the new objdb structure
	Now the /cluster bits are held on the objdb below "cluster"
	we need to look for everything (well, nearly everything)
	under there.

	Also add a 'cman_tool dump-db' command which is only built
	in DEBUG mode.

	[CCS] Fix the config loader for good
	We were removing the "/cluster" top level domain to allow /cluster/totem
	and other random ais bits to be at the top level of the objdb since
	aisexec expects to find them there.
	This is not clean in several way because it would break queries like:
	/cluster/child::* by returning a bunch of top levels objdb that are
	internal to aisexec and we don't want to expose to everybody.
	This is achieved by doing a few tricks here and there.. best would be
	to allow objdb symlinking.
	First we load the special bits for aisexec at the top level by using
	the right path within the xml config and then we load (again) the whole
	configuration.
	The final result will have some duplicates entries but for now we can
	live with that. The overhead is minimal.

2008-03-14  Bob Peterson  <rpeterso@redhat.com>

	Resolves: bz 435917: GFS2: mkfs.gfs2 default lock protocol differs from man page

2008-03-14  David Teigland  <teigland@redhat.com>

	libdlm: fix lvb copying
	When a program does a lock operation that reads an lvb, libdlm
	copies the lvb data from a bogus location instead of from the
	proper offset in the buffer it just read.  The location of the
	lvb data is calculated wrongly due to a missing cast.

2008-03-13  David Teigland  <teigland@redhat.com>

	dlm_tool: print correct rq mode in lockdump
	The rq mode in a lockdump was incorrectly showing up as NL for
	granted locks instead of IV (invalid).

2008-03-13  Christine Caulfield  <ccaulfie@redhat.com>

	[DLM] Don't segfault if lvbptr is NULL
	Calling dlm_lock* with  LKF_VALBLK and sb_lvbptr set
	to NULL could cause libdlm to segfault.

	Now it returns -1/EINVAL

2008-03-11  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Set cloexec bit in msg_socket.c
	Resolves Red Hat bugzilla #433313.  Rgmanager did not
	have the close on exec bit set for any sockets it was
	managing, causing problems with SELinux

	[rgmanager] Make ip.sh check link states of non-ethernet devices
	Resolves: Red Hat Bugzilla #331661

2008-03-11  David Teigland  <teigland@redhat.com>

	groupd: purge messages from dead nodes
	bz 436984

	In the fix for bug 258121, 70294dd8b717de89f2d168c0837c011648908558,
	we began taking nodedown events via the groupd cpg, instead of via the per
	group cpg.  Messages still come in via the per group cpg.  I believe that
	that opened the possibility of processing a message from a node after
	processing the nodedown for it.

	In Nate's revolver test, we saw it happen; revolver killed nodes 1,2,3,
	leaving just node 4:
	1205198713 0:default confchg left 3 joined 0 total 1
	1205198713 0:default confchg removed node 1 reason 3
	1205198713 0:default confchg removed node 2 reason 3
	1205198713 0:default confchg removed node 3 reason 3
	...
	1205198713 0:default mark_node_started: event not starting 12 from 2

2008-03-11  Lon Hohberger  <lhh@redhat.com>

	[rgmanager] Don't call quotaoff if quotas are not used

	[CMAN] Fix "Node X is undead" loop bug
	This was caused by an improper assignment to ps_incarnation
	after a node decides to evict another node.  The fix
	is to simply make the internal (memory) assignments before
	calling qd_write_status()

2008-03-11  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[CCS] Fix possible memory corruption on double free

2008-03-10  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[CCS] Cleanup duplicate vars from previous commit

	[CCS] Fix xml -> objdb config import

2008-03-08  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[BUILD] Allow release version to contain padding 0's

2008-03-07  Fabio M. Di Nitto  <fabbione@fabbione.net>

	Add toplevel .gitignore
	Ignore: make/defines.mk

	[CCS] Upload all subsystem configs into objdb
	By adding the the whole cluster.conf to the objdb, we can start moving
	all the subsystems away from using ccs directly and ask cman for config bits.

	[BUILD] Fix configure script to handle releases
	Add concept of release_micro value used only for RELEASE_VERSION.

	Attention packagers: release_micro is a mandatory value.

	Add support for encoding release versions in the tarball by adding
	a file at release time:

	cluster/make$ cat official_release_version
	VERSION "2.2.10"

	will automatically set the release to 2.2.10 with library sonames to 2.2

	NOTE: manual values will always override whatever is set by default.

2008-03-04  Lon Hohberger  <lhh@redhat.com>

	[fence] Make fence_xvmd support reloading of key files on the fly.

	Merge branch 'master' of ssh://lhh@sources.redhat.com/git/cluster

	Add / fix Oracle 10g failover agent

	Update changelog

	Add Sybase failover agent

2008-02-29  Ryan McCabe  <rmccabe@redhat.com>

	Merge branch 'master' of ssh://sources.redhat.com/git/cluster

	Feeling pedantic. More spelling fixes.

2008-02-29  Lon Hohberger  <lhh@redhat.com>

	Merge branch 'master' of ssh://lhh@sources.redhat.com/git/cluster

	Fix #435189 - fenced override doesn't allow rgmanager to recover because it doesn't tell cman that fencing was completed.

2008-02-29  Ryan McCabe  <rmccabe@redhat.com>

	Merge branch 'master' of ssh://sources.redhat.com/git/cluster

	Fix a few misspellings

2008-02-28  Christine Caulfield  <ccaulfie@redhat.com>

	Initialise votes to 0
	The code in get_cman_join_info() expects the local variable 'votes'
	to be initialised to zero, but it wasn't being.

	Fix multicast display in 'cman_tool status'
	Due to misreading of a man page, inet_pton was being called
	incorrectly and not returning a valid sockaddrin[6].

2008-02-27  Fabio M. Di Nitto  <fabbione@fabbione.net>

	[CMAN] Move ccs config ais module into ccs/ccsais

2008-02-27  Ryan McCabe  <rmccabe@redhat.com>

	Fix bz434790

2008-02-27  Christine Caulfield  <ccaulfie@redhat.com>

	Merge branch 'cman3'

	[CMAN] Remove deleted nodes from our list
	Detect nodes that have been deleted from CCS and remove them from our list
	if they are dead.

	[CMAN] Don't ignore cman_tool version
	the processing of the 'cman_tool version' command updates the
	config_version variable immediately rather than waiting for
	the message to come back. Because of this, when the message
	/does/ come back it gets ignored because cman thinks it
	already has the latest config!

	The solution is, of course, not to update the config version
	until we receive the RECONFIGURE message.

2008-02-26  Lon Hohberger  <lhh@ayanami.boston.devel.redhat.com>

	* Make fence_ack_manual.sh accept -n * Ensure fence_rps10 defaults to reboot * Make clustat not display estranged nodes which are now offline

2008-02-25  Lon Hohberger  <lhh@ayanami.boston.devel.redhat.com>

	Correct incorrect netmask handling in ip.sh

2008-02-22  Chris Feist  <cfeist@redhat.com>

	Test git commit.

	Removed newline.

	Test git commit.

	Added date.  (test git commit)

2008-02-22  Christine Caulfield  <ccaulfie@redhat.com>

	cman3 commit
	Separates out ccs interaction from cman itself, so we can replace
	the configuration back-end easily.

2008-02-21  David Teigland  <teigland@redhat.com>

	updates

2008-02-20  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Sync missing commit from RHEL5 branch:
	Dmitry Monakhov from OpenVZ linux kernel team reports about wrong locking
	order in gfs_get_parent(). Patch submitted by Vasily Averin (vvs@sw.ru)
	under Red Hat bugzilla 400651

2008-02-18  ccaulfield  <ccaulfield>

	Allow unnamed parent objects. This fixes a bug where <fence> entries appeared under the top-level rather than the clusternode.

2008-02-15  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix http://bugs.debian.org/465790

2008-02-12  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Clean up qdisk man page.
	-\fB...>\fP is not a keyword (starts the line with .)

	make the man page more consistent with use of />

	Man page cleanup.
	.SP is not a keyword. Change it to .SH.

	Cleanup man page.
	Lines starting with "." are man keywords. Just a plain space in front
	to make it clean.

	Stop linking against unrequired libraries.
	A lot of small tools were linking against a bunch of libraries for no reasons.
	Clean them up as much as possible as static linking is not spotted automatically.

	Problem spotted by some Debian automatic test tools and reported by
	Frederik Schüler <fs at debian.org>

2008-02-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Implement a nicer way of getting the quorum disk information. The libcman API remains the same but the connection to cman itself works using the normal GETNODE call.

2008-02-06  Jonathan Brassow  <jbrassow@redhat.com>

	- Bug 431705: HA LVM should prevent users from running an invalid setup (2) - better checking for improper setup -- this time for presence of fail-over VG in the volume_list

	- better checking for improper setup -- this time for presence of fail-over VG in the volume_list

2008-02-04  Patrick Caulfield  <pcaulfie@redhat.com>

	Change a log_printf() into a syslog() so that the die message always arrives in the log.

2008-01-30  Lon Hohberger  <lhh@redhat.com>

	Fix short read handling in read_pipe

	Make fenced's override wait time configurable.

	Make default TTL 4 instead of 2 per Fabio's recommendation (e.g. RFC2608).  Make TTL configurable in cluster.conf/command line for fence_xvm.

2008-01-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Oops. a bit too much cman3 fell into that last checkin

	Improve startup error checking and logging.

2008-01-30  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Whitespace cleanup

	Remove unrequire functions. This follow gfs2 changes

	Bugzilla 227892:
	* Warn people about the RG corruption and request a gfs_fsck
	* Upon error detection, perform a minimum error data collection

	Port forward patch from RHEL5 branch to HEAD.

	Original author: Wendy Cheng <wcheng@redhat.com>

	Red Hat bugzilla 244343:
	GFS supports two modes of locking - lock_nolock for single node filesystem
	and lock_dlm for cluster mode locking. The gfs lock methods are removed from
	file operation table for lock_nolock protocol. This would allow VFS to handle
	posix lock and flock logics just like other in-tree filesystems without
	duplication.

	Port forward patch from RHEL5 branch to HEAD.

	Original author: Wendy Cheng <wcheng@redhat.com>

2008-01-28  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove obsolete file

	Bump kernel check to 2.6.24

	Fix build warning

	Remove unused variable

	fix gfs for the removal of sendfile and helper functions
	Sendfile and helper functions have been removed in 2.6.24.  Migrate
	to using splice_read and generic_file_splice_read helper function.

	Update gfs to cope with 2.6.24 export op changes and other bits

	EXPORT_SYMBOL(xtime) has been removed in 2.6.24.
	Let's use the exact same value (tv_nsec) just from another source.

	Update gnbd kernel modules to build with 2.6.24

2008-01-26  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 223660: man gfs2(8) refers to the gfs2_mkfs manpage

2008-01-25  Lon Hohberger  <lhh@redhat.com>

	Fix qdiskd master abdication logic (#430264)

	Fix #430272, #430220

2008-01-24  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 429633: gfs_tool doesn't recognize GFS file sytem

2008-01-24  Benjamin Marzinski  <bmarzins@redhat.com>

	Fix for bz #426291.  gfs_glock_dq was traversing the gl_holders list without holding the gl_spin spinlock, this was causing a problem when the list item it was currently looking at got removed from the list.  The solution is to not traverse the list, because it is unncessary. Unfortunately, there is also a bug in this section of code, where you can't guarantee that you will not cache a glock held with GL_NOCACHE.  Fixing this issue requires significantly more work.

2008-01-24  Lon Hohberger  <lhh@redhat.com>

	Unblock signals after fork() so heuristics using signals don't hang

2008-01-21  Lon Hohberger  <lhh@redhat.com>

	Fix ccs connect error handling

2008-01-21  Jonathan Brassow  <jbrassow@redhat.com>

	- ccs library now checks for bad file descriptors as input

2008-01-21  David Teigland  <teigland@redhat.com>

	bz 429546
	Fix an alignment problem with ppc64.  Things work if we do the
	byte-swapping on the original structure and then copy it into the
	final buffer, instead of copying first and then trying to do the
	byte-swapping at an offset within the send buffer.

2008-01-21  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Add fake support for -r option at umount so we don't fail if gfs2 is not umounted by it's init script.

2008-01-18  Lon Hohberger  <lhh@redhat.com>

	fix 429248

2008-01-18  Abhijith Das  <adas@redhat.com>

	fix for bz333961 - adds support for -n and -f mount options

	lon's patch removes 'Domain-0' check which was breaking xvm because cman starts before xend. patch also allows you to put NODENAME in /etc/sysconfig/cluster

2008-01-17  David Teigland  <teigland@redhat.com>

	odds and ends not commited

2008-01-17  Lon Hohberger  <lhh@redhat.com>

	file oracledb.sh was initially added on branch RHEL5.

2008-01-16  Lon Hohberger  <lhh@redhat.com>

	Fix #60 error in #428346 bug

2008-01-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Zero namelen when doing an unlock. On 32/64 bit systems it can make a horrible mess otherwise.

2008-01-15  Ryan McCabe  <rmccabe@redhat.com>

	Allow "option=(on|off|reboot)" (currently only fence_ilo takes "action")

2008-01-15  Robert Peterson  <rpeterso@redhat.com>

	Fixup contributed by Andy Price.

2008-01-14  David Teigland  <teigland@redhat.com>

	fix %llx printf warnings using (unsigned long long)

2008-01-14  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Allow the resource to run on Debian/Ubuntu systems without manual patching, by checking for the apache2 daemon if httpd is not available.
	Replace =~ '^/' sintax with less bash dependent version.

	Use grep -E instead of -P as perl regexp support is not built on all distros.

2008-01-11  Jonathan Brassow  <jbrassow@redhat.com>

	- Bug #428448 - HA LVM service fails to relocate when I/O is running
	Was failing to add new tag when relocating.

2008-01-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Add command-line override for 2node mode. Because of the way cman re-reads CCS it is quite possible to start up a cluster in 2 node mode manually, then add a third node via CCS (I think)

2008-01-10  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Whitespace cleanup

	Fix alignment issues in rgmanager. This makes it possible to run rgmanager on sparc.
	Patch by Lon. Tested by both of us on x86, x86_64, parisc, ia64, sparc.

2008-01-09  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 426670: GFS2: man page for gfs2_tool has commented lockdump section

2008-01-09  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix mkdir invokation to not fail when dir already exists

2008-01-08  Lon Hohberger  <lhh@redhat.com>

	Roll back previous patch to ip_lookup.c

	Fix build problem reported by Chris Feist

2008-01-08  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix "off the source tree" install. This was a small regression introduced with the /etc/cluster/cluster.conf configure bits.

2008-01-07  Lon Hohberger  <lhh@redhat.com>

	Figure out where slang is installed.

	Correct signed vs. unsigned comparison on sparc64

2008-01-07  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	makes it possible to change the default configuration file by setting --confdir (default to /etc/cluster) and --conffile (cluster.conf).
	NOTE: manpages with hardencoded /etc/cluster/cluster.conf are not updated.
	      If you dare to change these defaults you know what you are doing.

	NOTE to developers: you will need to re-run ./configure to set the new vars.

2008-01-04  Jonathan Brassow  <jbrassow@redhat.com>

	- a regression...  When tagging at the LV-level, the script should complain if there is more than one LV / VG.

2008-01-04  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix clean target. core files have pid attached to them.

2008-01-03  Jonathan Brassow  <jbrassow@redhat.com>

	lvm resource script now allows multiple LVs per VG as long as they move together (exist on the same machine).

	s/validate/verify/

	BUG 427377 HA LVM now allows multiple LVs/VG as long as they move together
	Package builder, please note the addition of 3 new files.

2008-01-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Get rid of redundant totemip_parse() call. This was in a bad place and could cause aisexec stalls and disallowed nodes, particularly at startup.

2008-01-03  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix buffer align. So far this one makes the entire stack run on sparc up to fenced.

2008-01-02  Lon Hohberger  <lhh@redhat.com>

	Fix endian issue on big-endian arches

2008-01-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Use define CMAN_NAME for the purpose for which it was intended

	Lets see if I can do this commit properly... Fix swab of an int to be swab32 rather than swab16

2008-01-02  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Cleanup manpages to work with whatis.
	Patch from Frederik Schüler <fs at debian.org>

	Add interpreter to ocf-shellfuncs.
	Patch by Frederik Schüler <fs at debian.org>

2008-01-02  Patrick Caulfield  <pcaulfie@redhat.com>

	totempg_ifaces_get() always copies INTERFACE_MAX addresses so make sure we alloate enough space for them all.

2007-12-31  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	aisexec config parser expects error_string to be set also when we successfully read the configuration.

2007-12-30  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix error reporting to aisexec.
	aisexec expects an error_string string set by config_read if config_read fails.
	The lack of error_string is not checked by aisexec that will segfault.

	Set error_string properly and clean up the old errorstring that is not used.

	Fix building when -DDEBUG is defined.

	Fix build with -DDEBUG

2007-12-24  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Once again change ifdef to fix fail to build on hppa/parisc

	Fix all: target.

2007-12-22  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix gnbd build dependencies. For too long we did rely on gnbd/Makefile to build in the right order but single builds were broken.

	Fix fence build dependencies. For too long we did rely on fence/Makefile to build in the right order but fence_tool and fence_node were just broken.

	Fix a few regressions introduced by the big Makefile clean up:
	- restore all: target as default. Libraries need a small special casing in the
	  include / target order due to var expansion.

	- fix udev uninstall target: typo in make/uninstall.mk and requires (for sake
	  of simplicity 51-dlm.rules in /lib instead of /script.

	- gfs/Makefile and fence/agents/Makefile don't need passthrough.mk.

	- Fix uninstall of symlinks.

	- Fix uninstall of rgmanager resources.

	Collapse all install: and uninstall: targets in make/install.mk make/uninstall.mk
	Change almost all Makefile's to use them.

	Convert to use make/clean.mk

	Remove unrequired distclean targets

2007-12-21  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Collapse all common clean: target bits into make/clean.mk generalclean: target.
	Update all relevant makefile's to use generalclean.

	Required by this change:

	all TARGETS need to be defined before sourcing *.mk files to allow
	simpler var expantions.

	update all makefiles as a consequence

	apply alpha sort :)

	Remove obsolete and unused Makefile

	Install forgotten dlm man pages.

	Collaps all man Makefile's common snippets into man/man.mk
	Change all man Makefile's to use it.

	From now on it will be enough to source make/man.mk and add a TARGET=
	with the man page.

	A long time ago we did start collecting common Makefile snippets in one location.
	This time we shrink all common objects rules in make/cobj.mk

	Use newly defined $(OBJDIR) to source .mk files snippet. This reduced the hardcoded paths in Makefiles to one to include defines.mk and makes it easier to change stuff across the tree in one shot.

	Fix clean target

	Minor objdir rework to extend flexibility.
	the first shot of objdir implementation implied that you did:

	cd cluster
	./configure --objdir... etc.
	cd /path/to/objdir
	make

	now you can:

	mkdir objdir
	cd objdir
	/path/to/configure
	make

	NOTE: in this case you don't need to specify objdir. it will be automatically
	      set up for you.

	As a nice side effect you can also be anywhere on the fs and do:

	/path/to/configure --objdir=/path/to/obj
	cd /path/to/obj
	make

	and it will work.

	Fix 2 corner cases when setting up the objdir:
	- do not symlink symlinks.. this allows to setup multiple objdirs within the
	source tree.

	- do not copy/symlink defines.mk from other trees or bad thing happens.

2007-12-20  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	* globally rename BUILDDIR to SRCDIR to reflect what it really is.
	* top level configure:
	 - add --objdir=/path option (default to current tree - it does not change
	   current behaviour if not specified and different from current tree)
	 - add a perl subroutine to handle symlinks
	 - check and setup /path
	 - switch all libdirs to use the objdir directly
	 - propagate objdir to make/defines.mk

	NOTE: those changes require 2 perl modules that should be available everywhere: Cwd 'abs_path'; and File::Basename;.

	NOTE2: you will need to rerun ./configure after applying the patch.

	* make/defines.mk.input:
	 - suck in OBJDIR from top level configure
	 - define THISDIR as a relative path from the top level.
	   For example: if PWD /usr/src/cluster/cman/lib, THISDIR will contain
	   cman/lib.
	 - define S as full path to SRCDIR/THISDIR/

	* all Makefiles:
	 - convert includes path to use $(S) and always point to the source as
	   defined in make/defines.mk.
	 - fix all object generation targets to use $(S).
	 - fix all install targets to $(S) where required.

	* Random cleanup:
	 - ccs/daemon/Makefile: do not kill files that are not around.
	 - dlm/tool/Makefile: use ${dlmincdir} and $(SRCDIR)/group/dlm_controld/
	   instead of relative paths and do not include itself as there are no
	   header files. Also use ${dlmlibdir} for linking.
	 - fence/Makefile: change build order as this is required to avoid extra
	   hacks due to shared C files around.
	 - gfs/gfs_fsck/Makefile: fix symlinking to be relative and not absolute
	   or the symlink is useless.
	 - gfs2/fsck/Makefile: likewise.
	 - gfs2/mkfs/Makefile: likewise.
	 - gnbd/utils/Makefile: create bits. This is to avoid even more hacks than
	   fence/Makefile to cope with shared objects. One day we will need to
	   review all of this.

	Cleanup leftovers from the very old build system. We were using a very complex way to set release_major and release_minor because in the old system it was not possible to set them directly from ./configure.
	Remove the old cruft since ./configure can now take those values directly in
	input.

2007-12-19  Lon Hohberger  <lhh@redhat.com>

	Allow soft dependencies when central_processing is enabled

	Fix #254111 - when stopping a service using a shared GFS resource, it umounts it even if other services are using it.

	fix typo in clusterfs.sh

2007-12-19  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix extracflags and extraldflags to be recognized as options or configure will fail.

2007-12-14  Lon Hohberger  <lhh@redhat.com>

	Fix misc central events bugs.

	Add return value for inability to run due to exclusive flag being present

2007-12-14  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Make sure we invoke virConnectOpen with a proper URI. NULL is deprecated in libvirt and we have no control over distro defaults that might not be xen:///.
	Patch by Soren Hansen <soren at ubuntu.com>

2007-12-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Allow rrp_mode to be overridden in cluster.conf

	Fix altname option

2007-12-12  Lon Hohberger  <lhh@redhat.com>

	Misc. minor central processing bugfixes

	Add missing ds.h

2007-12-11  Ryan O'Hara  <rohara@redhat.com>

	Fix issue with endian conversion that caused problems for mixed architecture nodes on same subnet. Need to correct swap byte ordering of comm_header_t structure before copying into buffer and when dereferencing.

2007-12-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Some small fixes to the networking param code, thanks to Fabio on IRC

	Set networking parameters suitable for running DLM over sctp

	Tidy comments

2007-12-10  Lon Hohberger  <lhh@redhat.com>

	Fix type-punned errors on i386

2007-12-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Add multi-path capability. Each address we get from cman is now passed into the DLM.
	It's still incumbent on cluster.conf to set the transport to sctp.

2007-12-07  David Teigland  <teigland@redhat.com>

	new plock ownership related stuff

2007-12-07  Lon Hohberger  <lhh@redhat.com>

	Make S-Lang library & include paths configurable.
	NOTE: You MUST rerun configure after applying this
	      update or rgmanager will no longer build.

2007-12-06  Lon Hohberger  <lhh@redhat.com>

	Fix format warnings on newer GCC

	Add missing sets.h

2007-12-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Add option to disable kernel_check.
	From Soren Hansen:
	"It's handy to be able to
	disable the new kernel version check if we don't actually have the
	kernel headers around, but know that the proper stuff is around when
	it's needed."

2007-12-05  Lon Hohberger  <lhh@redhat.com>

	Preliminary GFS2 support in clusterfs.sh

2007-12-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Print votes of quorum device in cman_tool status

2007-12-04  Lon Hohberger  <lhh@redhat.com>

	Merge force-unmount from RHEL5 branch for netfs.sh script

2007-12-04  Ryan O'Hara  <rohara@redhat.com>

	BZ 323111 Remove permission() checks from xattrs ops.

2007-11-30  Lon Hohberger  <lhh@redhat.com>

	Add centralized S/Lang event script engine v0.8.1

	Merge from RHEL5 branch, pass 3

	Merges from RHEL5 branch - round 2.

	Merges from RHEL5 branch - round 1.

2007-11-30  David Teigland  <teigland@redhat.com>

	change some log messages

2007-11-29  David Teigland  <teigland@redhat.com>

	Testing revealed a couple more races I hadn't expected.

2007-11-29  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 325151: GFS2: gfs2_fsck changes to system inodes don't stick

2007-11-29  Patrick Caulfield  <pcaulfie@redhat.com>

	Reinstate 'cman_tool join -X', allowing people to start a cluster without the hassle of a cluster.conf file. There are some caveats to this, which are mentioned in the man page.

2007-11-28  David Teigland  <teigland@redhat.com>

	A performance optimization for plocks.  This speeds up locks that are repeatedly accessed by processes on a single node.  Plocks used by processes on multiple nodes work the same way as before.  The optimization is disabled by default, and can be enabled by setting
	  <gfs_controld plock_ownership="1"/>

	in cluster.conf, or by starting gfs_controld with "-o1".  It is disabled
	by default because enabling it breaks compatibility with previous versions
	of gfs_controld.  If all nodes in the cluster are running this version,
	then plock_ownership can be enabled.

	The plock_ownership mode needs extensive testing.  This also introduces
	some minor changes when plock_ownership is disabled, so new testing is
	also required in that mode.  Abhi and I worked on this together.

2007-11-28  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 402971: GFS2: gfs2_edit savemeta doesn't save rindex file.

2007-11-27  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Do not install stripped binaries

2007-11-24  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Switch configure to use perl warnings and fix them up.
	Add kernel_version version check subroutine.

	Set minimal kernel version requirement to 2.6.23.

	Many thanks should go to Marian Marinov <mm at yuhu.biz> for the original
	patch and contribution.

2007-11-21  David Teigland  <teigland@redhat.com>

	ASSERT was doing fprintf(stderr) which goes somewhere we don't want when running as a daemon.

2007-11-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Clear out the ports opened list when a node goes down. Thanks, Lon. bz#327721

2007-11-17  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 382581: GFS2: gfs2_fsck: buffer still held for block

2007-11-15  Robert Peterson  <rpeterso@redhat.com>

	Add the "printsavedmeta" option to the gfs2_edit man page.

	gfs2_edit wasn't printing directory entries and extended attributes correctly.

	Added ability to save inode extended attributes in "savemeta". This is necessary for in order to test bug #382581. Added ability to recurse one level on directories when printing. Fixed bugs associated with traversing directory leaf blocks. Added ability to recognize and display log buffer and quota change blocks. Simplified code by breaking up display_indirect into two functions: one for indirect blocks, the other for directory leaf blocks.

2007-11-15  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix bugzilla 362031

2007-11-14  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 352841: GFS2: Evaluate and implement missing gfs2_tool features

2007-11-14  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Hard encode paths to (u)mount.gfs*
	given the very nature of mount(8) api to look only in /sbin for (u)mount
	helpers, we can hard encode the install paths for our tools into the
	Makefile systems. I have never seen anywhere a different behavior in any
	Linux distribution and it will make packagers life simpler.

	Thanks also to Marc - A. Dahlhaus for spotting the missing DESTDIR
	entries.

2007-11-13  Robert Peterson  <rpeterso@redhat.com>

	Fixed printing of gfs1 journals.

	Resolves: bz 364741: GFS2: gfs2_quota doesn't work unless lock table specified

2007-11-12  Patrick Caulfield  <pcaulfie@redhat.com>

	file msgtest.c was initially added on branch RHEL4.

2007-11-12  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Be consistent across the entire tree on AR and RANLIB invocations

	The new Makefile system never invokes LD directly (and this is a good thing).

	Clean up STRIP usage. It is not consistent and we shouldn't strip random binaries.

2007-11-09  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove cman_wait_init for now. It was becoming overly complicated for such simple task.

2007-11-08  Jonathan Brassow  <jbrassow@redhat.com>

	file rbtree.h was initially added on branch RHEL5.

	file rbtree.c was initially added on branch RHEL5.

2007-11-08  Robert Peterson  <rpeterso@redhat.com>

	Printing the quota file wasn't printing its contents due to a bug.

2007-11-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Add an explanation of the node states shown by "cman_tool nodes" and some informastion about the "disallowed" state.

2007-11-07  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 336561: gfs2_tool accepts jdata flag; man page says no

	Fix a divide by zero if the target isn't a gfs or gfs2 file system.

	Resolves: bz 352581: GFS2: implement gfs2_tool lockdump

2007-11-06  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 354201: GFS2: gfs2_tool: unknown mountpoint on some mount points

2007-11-05  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Add cman_wait_init as wrapper for cman_admin_init/cman_init and cman_is_quorate

2007-11-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Add missing format string.

	Enhance API to retrive just the quorum device information using cman_get_node()

2007-11-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Enable to_stderr logging if 'cman_tool join -d' is used.

2007-11-01  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	If votes for quorumd is _not_ specified in cluster.conf, then automatically set votes to number of nodes - 1.

2007-10-30  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 349601: GFS2 requires straightforward way to determine number of journals

2007-10-29  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Apply, rework and cleanup second part of patch from Marco Ceci to fix 354421

2007-10-26  David Teigland  <teigland@redhat.com>

	xid needs to be unsigned long long

	don't setup netlink if deadlock is disabled

2007-10-26  Ryan McCabe  <rmccabe@redhat.com>

	patch from Marco Ceci to fix 354421

2007-10-26  David Teigland  <teigland@redhat.com>

	Improve the dumping of debug logs from daemons. bz 317181
	group_tool reads debug logs from groupd, fenced, and gfs_controld.
	The dumping code in all three daemons is now identical.  The other
	change is that the dumping function terminates the final write
	with \0, and no longer sends the entire 1MB log buffer if it's not full.

2007-10-26  Ryan McCabe  <rmccabe@redhat.com>

	Compile with -Wformat=2, which will catch usually dangerous format string bugs

	Keep gcc from reporting a bogus warning when compiling with -Wformat=2

	rgmanager format string fixes

	More format string fixes

	Fix format string bug

2007-10-25  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 337961: gfs_grow /mountpoint/ does not work

	Resolves: bz 345501: minor correction to previous commit.

	Resolves: bz 345501: GFS2: gfs2 utils uses non-canonicalized names

2007-10-24  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz #334481: gfs2_jadd man page refers to non-existent -T option

2007-10-24  Ryan McCabe  <rmccabe@redhat.com>

	Commit msg with the last commit went missing..
	- Fix unsafe string handling:
	    - replace memset(s,c,n);sprintf(s,...); with snprintf with proper error checking
	    - don't overflow the stack if the cluster name specified in the env var is too long
	    - don't overflow the stack if the local nodename from uname(2) is too long
	    - don't overflow the stack if the local nodename specified in the env var is too long

	- Don't leak the ccs descriptor in get_ccs_join_info() on errors
	- Fix a couple of small memory leaks in error paths
	- Handle OOM conditions

	- Fix unsafe string handling: 	- replace memset(s,c,n);sprintf(s,...); with snprintf with proper error checking 	- don't overflow the stack if the cluster name specified in the env var is too long 	- don't overflow the stack if the local nodename from uname(2) is too long 	- don't overflow the stack if the local nodename specified in the env var is too long
	- Don't leak the ccs descriptor in get_ccs_join_info() on errors

2007-10-24  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Use standard path var and memset it before each query

	Use right vars to print debugging info

	Clean up duplicate ccs query paths

2007-10-23  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix purely cosmetic typo

2007-10-19  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 291551: gfs2_fsck clears journals without asking.

	Minor correction to the previous commit.  Bopping through indirect pointers was inadvertently changing variable "block" during savemeta.

2007-10-18  Robert Peterson  <rpeterso@redhat.com>

	While working on bz #291551, I discovered that gfs2_edit savemeta only saved true metadata, but we need more than that.  There are lots of blocks that are considered "data" (not metadata) by the RG bitmaps that we still need to save.  These include: 1. All the system journals (which may contain both metadata and    user data, disguised as data blocks within the journal).  We    need to pick out the parts that do not contain user data. 2. The system files, such as statfs, inum, quota file, etc.    These may be helpful in debugging user problems. 3. Indirect block pointers, which may be counted as data for    accounting purposes, even though it's metadata. 4. Directory leaf blocks.
	This change allows gfs2_edit to save and restore these blocks properly,
	and also to print out a breakdown of a saved metadata file:
	gfs2_edit printsavedmeta /tmp/gfsmeta

	It also improves on the information given when a journal is dumped.

2007-10-17  Abhijith Das  <adas@redhat.com>

	fix bz 311591 - make lock_dlm the default lock protocol in mkfs.gfs and mkfs.gfs2

2007-10-17  Lon Hohberger  <lhh@redhat.com>

	Include missing debug.h header file

2007-10-17  David Teigland  <teigland@redhat.com>

	used wrong define, DLM_LOCK_ instead of LKM_

2007-10-17  Lon Hohberger  <lhh@redhat.com>

	Make fence_xvmd read options from ccs like it should

	Make fence_xvmd read options from ccs like it should; merge dbg_printf patch from RHEL5 branch

2007-10-17  David Teigland  <teigland@redhat.com>

	The output of 'dlm_tool lockdump' could make it appear that a granted lock was still converting because the rqmode reported by the kernel is not reset to IV when a NOQUEUE convert fails.

2007-10-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Make sure it compiles against latest openais trunk.

2007-10-12  Robert Peterson  <rpeterso@redhat.com>

	Resolves: 235931: gfs2_edit command to set NOALLOC flag

	Add the ability for gfs2_edit to print gfs1 journals.

2007-10-11  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 251180: Build time warnings for gfs2 userland tools

	Resolves: bz 295301: Need man page for gfs_edit

	Resolves: bz 240545 (addendum).

2007-10-11  Ryan McCabe  <rmccabe@redhat.com>

	E2BIG is more appropriate than ENOSPC here

2007-10-10  Ryan McCabe  <rmccabe@redhat.com>

	Allow valid addresses of nodes even if they're not identical to the way they're specified in cluster.conf

	Fix code that caused warnings on platforms where sizeof(void *) != sizeof(int)

2007-10-08  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 247318: Need man page for gfs2_edit

2007-10-08  Ryan McCabe  <rmccabe@redhat.com>

	add new function to libccs:  * ccs_lookup_nodename  * @cd: ccs descriptor  * @nodename: node name string  * @retval: pointer to location to assign the result, if found  *  * This function takes any valid representation (FQDN, non-qualified  * hostname, IP address, IPv6 address) of a node's name and finds its  * canonical name (per cluster.conf). This function will find the primary  * node name if passed a node's "altname" or any valid representation  * of it.

2007-10-03  Marek 'marx' Grac  <mgrac@redhat.com>

	Resolves: #250681 - mount samba share from netfs RA

2007-10-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy logsys use. Is this OK now Steve ?

2007-10-01  Ryan McCabe  <rmccabe@redhat.com>

	Fix 314091

2007-10-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Use "logger_subsys" & "subsys" keys rather than "logger" and "ident".

2007-10-01  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Use proper vars to disable targets

	Fix configure to handle properly 0.x or x.0 releases.

2007-09-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Reinstate cman_tool services, which got lost inexplicably.

	Call "group_tool ls" for cman_tool services

2007-09-28  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	configure: Backticks don't work in strings.  Use POSIX::uname().
	The strings that use backticks to get `uname -r` don't work as expected.
	Let's use POSIX::uname() directly and let perl do the work.

	Patch by Joel Becker <joel.becker@oracle.com>

2007-09-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Recalculate quorum based on the expected votes value of a new node. bz#308581

2007-09-25  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 304001: GFS2: Filesystems with 1k block size won't mount

2007-09-24  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	switch permanently to perl -w
	fix all the warnings in the script. Thanks to Patrick for spotting an extra one.

	Add support to allow disable the build/install targets for each specific subsystem in the tree.
	Major clean up of top level Makefile thanks to Joel Becker input/suggestions.

2007-09-21  Ryan McCabe  <rmccabe@redhat.com>

	fix bz277781 by accepting "nodename" as a synonym for "node"

2007-09-21  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix uninstall target

2007-09-19  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	white space cleanup

2007-09-19  Ryan O'Hara  <rohara@redhat.com>

	Add ability to format output and filter based on node name.

2007-09-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't use _logsys functions as I get my wrist slapped.

2007-09-19  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix configure and Makefiles to cope with kernel built with O=/path...
	Original patch by Joel Becker (joel.becker at oracle.com)

	NOTE for developers: you will need to re-run ./configure to update make/defines.mk
	NOTE for packages: you might need to change the way ./configure is invoked to cope
	                   with kernel_build vs kernel_src

2007-09-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix type-punned pointer warnings

2007-09-19  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix more warnings when building with -O2 and also fix get_rmtabd_loglevel to actually do what is supposed to.

2007-09-18  Lon Hohberger  <lhh@redhat.com>

	Fix #258141 - possible use after free in fenced

2007-09-18  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 247318: Need man page for gfs2_edit

	Resolves: bz 291451: gfs2_fsck -n, Bad file descriptor on line 63 of file buf.c (addendum)

2007-09-18  Abhijith Das  <adas@redhat.com>

	man page changes for new gfs2_quota reset option

2007-09-18  Patrick Caulfield  <pcaulfie@redhat.com>

	check quorum device name length against the right size.

2007-09-17  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 291451: gfs2_fsck -n, Bad file descriptor on line 63 of file buf.c

2007-09-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Use openais logsys functions.

2007-09-16  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 287901: GFS2: fsck errors and corruption with files > 945MB
	The gfs2_fsck program wasn't following enough levels of indirection
	when walking metadata.

2007-09-14  David Teigland  <teigland@redhat.com>

	go back to default of -02 now that -Werror problems are fixed

2007-09-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix compile with -O2 -Werror

	Make it compile with -O2, by fixing a very dodgy cast.

	Allow it to build with -O2

2007-09-07  David Teigland  <teigland@redhat.com>

	Do nodedown events when the confchg for the groupd cpg arrives, instead of when the per-group cpg confchg's arrive.  This means all nodes should have agreed ordering on the sequence of confchg's and messages, since all messages go through the groupd cpg.
	This should fix bz 258121 but I can't reproduce anything like that
	bug to verify.

2007-09-07  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	So in this first patch (that seems the most urgent one):
	- Make prefix default to /usr

	- Clean up all prefix use around configure (this will make alternate
	  prefixes like /usr/local works properly).

	- Add a specific --aisexecbin option that is passed to cman_tool build.
	  This change defaults to /usr/sbin/aisexec (default aisexec install
	  path) but also allow local override if you have aisexec installed in
	  different paths.

	3 NOTES:

	- the cman_tool change has not been tested in production. It builds and
	  shows that the path is passed properly.

	- all people that use a prefix=/ will need to make sure to use some
	  extra configure options to respect FHS (for example to install man
	  pages in /usr/share/man rather than /share/man..).

	- If this patch goes in CVS, you need to make sure to re-run ./configure.

2007-09-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Correctly reduce quorum when a node leaves using "cman_tool leave remove" bz#271701

2007-09-06  David Teigland  <teigland@redhat.com>

	forgot the 0 after the -O

	go back to a default of -O0 instead of -O2 to get the stuff with -Werror to build

2007-09-04  David Teigland  <teigland@redhat.com>

	report that a mount fails due to an in-progress unmount

	Reject mount attempts on an fs that's still in the process of unmounting. This regressed 8 months ago due to the bz 218560 changes.

2007-08-30  Ryan McCabe  <rmccabe@redhat.com>

	listen() is not supported on SOCK_DGRAM

2007-08-30  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Collect common make targets for fence/agents written in python

	Collect all common make targets for fence/agents written in perl

	Remove old code. ACK by Lon

	Fix build warning

2007-08-30  Ryan O'Hara  <rohara@redhat.com>

	BZ 249781 - Fix ccs_tool to return EXIT_SUCCESS for most commands.

2007-08-30  Lon Hohberger  <lhh@redhat.com>

	Fix #229650, pass 3

2007-08-30  Jonathan Brassow  <jbrassow@redhat.com>

	file dm.h-copy was initially added on branch RHEL5.

	file dm-log.h-copy was initially added on branch RHEL5.

2007-08-30  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Cleanup clumon/ as agreed on cluster-dev

2007-08-29  David Teigland  <teigland@redhat.com>

	I think I added this years ago, forget why

2007-08-29  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	This is the first patch of a long series to collect common Makefile targets into their own snippets.
	Collect all passthrough operations into make/passthrough.mk.

	Update all passthrough Makefiles to use the new snippet.

	Cleanup group/test/Makefile

	Cleanup gfs/tests/ Makefiles

	Clean up cman/tests/Makefile

2007-08-28  Ryan McCabe  <rmccabe@redhat.com>

	Fix a handful of possible NULL pointer derefs

2007-08-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix spelling of DAEMON, sigh

	Add a 'cman_tool debug' command that allows cman debugging levels to be changed on-the-fly

2007-08-28  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove obsoleted Makefile

	change the default CFLAGS to "-Wall -O2 -g".
	add --debug option to configure that will override the default CFLAGS
	to "-Wall -O0 -DDEBUG -g".

	clean up all the relevant Makefiles.

	add a few missing ; to configure script.

	-Wall is added by default in CFLAGS via configure to make/defines.mk.
	Remove all the others redundant definitions.

2007-08-24  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Add dlm/tests/Makefile
	clean up dlm/tests/usertest/Makefile

2007-08-24  Abhijith Das  <adas@redhat.com>

	fix for bz253016: userland fixes for gfs2 quota linked list

2007-08-23  Jonathan Brassow  <jbrassow@redhat.com>

	file queues.h was initially added on branch RHEL5.

	file queues.c was initially added on branch RHEL5.

	file logging.h was initially added on branch RHEL5.

	file logging.c was initially added on branch RHEL5.

	file local.h was initially added on branch RHEL5.

	file local.c was initially added on branch RHEL5.

	file list.h was initially added on branch RHEL5.

	file link_mon.h was initially added on branch RHEL5.

	file link_mon.c was initially added on branch RHEL5.

	file functions.h was initially added on branch RHEL5.

	file functions.c was initially added on branch RHEL5.

	file common.h was initially added on branch RHEL5.

	file cluster.h was initially added on branch RHEL5.

	file cluster.c was initially added on branch RHEL5.

	file clogd.c was initially added on branch RHEL5.

	file cmirror was initially added on branch RHEL5.

	file Makefile was initially added on branch RHEL5.

2007-08-23  David Teigland  <teigland@redhat.com>

	dstress fixes

	needed to be a little more thorough in taking a canceled transaction out of the dependency graph for cases where multiple locks were blocked between the same two transactions

	rewording and embellishing some bits related to openais.conf

2007-08-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Mention the openais.conf parameters that cman overrides.

2007-08-22  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove fence/agents/xen from CVS HEAD.
	ACK on cluster-devel and IRC #linux-cluster

	Remove cs-deploy-tool from CVS HEAD.
	Last commit on this tool was from 2005 and code is available in all other branches.

	ACK on cluster-devel and IRC #linux-cluster

	Remove ddraid from CVS HEAD.
	ACK on cluster-devel and IRC #linux-cluster

2007-08-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Add some info about openais.conf parameters

	Add some information about setting up multi-home (redundant ring)

2007-08-22  David Teigland  <teigland@redhat.com>

	fix attribute xml format for cluster_id and keyfile

2007-08-22  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix build with gcc-4.2

2007-08-22  David Teigland  <teigland@redhat.com>

	add new test for deadlocks

	use an admin handle from cman to call set_dirty

	mention group_tool should be used instead of cman_tool services

2007-08-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Update man page

2007-08-22  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Cleanup FOO_RELEASE_NAME to RELEASE_VERSION

2007-08-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Document that cman_set_dirty() needs an admin socket.

	Clear error flag for SET_DIRTY

2007-08-21  David Teigland  <teigland@redhat.com>

	comment out the new cman_set_dirty() call; it's not working

2007-08-21  Ryan McCabe  <rmccabe@redhat.com>

	Fix access beyond allocated memory

2007-08-21  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Allow the full cluster suite to build using external kernel source.
	Also remove the use of -idirafter that with some old versions of gcc
	does not behave as we expect.

2007-08-20  Abhijith Das  <adas@redhat.com>

	fix for bz253172 - gfs2 init script should not unload any kernel modules

2007-08-20  David Teigland  <teigland@redhat.com>

	proper help output for -m option

	the -m mode option was being ignored and 0600 always used (this change must have been lost at the same time as the -d option)

	the NODIR new_lockspace flag was always being used, even if the -d was used to deselect it

	update ccs man pages

	Call the new cman_set_dirty() api to disallow clusters both with fence/dlm/gfs state from merging. Adjust the oom setting for the daemon to avoid oom kills.

2007-08-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Add a "dirty" flag to cman to prevent active clusters merging with one-another. bz#251966

2007-08-20  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove redundant gfs_ondisk.h from gfs/include/ and gfs2/include/
	both files are outdated compared to the one shipped in
	gfs-kernel/src/gfs/gfs_ondisk.h and there should be no need of
	duplicates around the tree.

	gfs and gfs2 both use to include gfskincdir that is enough to guarantee
	that gfs_ondisk.h will be available at build time.

	gfs2/mount/Makefile requires this one liner. I spotted that we try to include
	gfs2kincdir that we never set and therefor it was failing to build without
	a local copy of gfs_ondisk.h

	add clean: target or make clean will fail.
	use TARGET8 to be consistent with TARGET3

2007-08-17  David Teigland  <teigland@redhat.com>

	handle addition/removal/failure of nodes during a deadlock cycle serialize deadlock cycles and limit how often cycles are started

	install in man dir

	add makefile

	install dlm_tool.8

	Vastly simplify this man page.  Include no cman or fencing information but refer to the cman and fenced pages.

	Outline the basic ideas of multiple methods and multiple devices.

	minor updates

	add man page

2007-08-16  David Teigland  <teigland@redhat.com>

	mention fencing override, describe the structure of node fencing parameters in cluster.conf, point to web site for device-specific documentation

	add man pages

2007-08-16  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz #240545: gfs2_fsck should behave more like the other fscks.

2007-08-15  David Teigland  <teigland@redhat.com>

	Update fence, fenced, fence_tool and fence_node man pages which were stuck in the RHEL4 era.

	clean out some options that were only relevant to rhel4 remove the monitor option which didn't do anything add the dump option to dump the fenced debug buffer (group_tool can still do this, but fence_tool wasn't oddly enough)

	clean out junk that was only relevant to rhel4

2007-08-15  Ryan McCabe  <rmccabe@redhat.com>

	Fix a few (harmless) places where memory is allocated but not freed I stumbled onto hunting down something else.

2007-08-15  Lon Hohberger  <lhh@redhat.com>

	Fix uninitialized var

2007-08-13  David Teigland  <teigland@redhat.com>

	put back the ability to do pid-based deadlock detection on 5.1 kernels

2007-08-10  David Teigland  <teigland@redhat.com>

	Detection and resolution now works with my basic deadlock tests.
	Had to rework how lock state is assembled.  The previous method was
	simpler and just gathered the master lock state from all nodes, but
	I failed to realize that the xid (transaction id) isn't synced to
	remote master copy locks.  So, now all lock state is saved in the
	checkpoints, both master-copy and process-copy (containing the xid)
	which are then merged to give the full view of the lock.

2007-08-10  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	group/ now depends libdlm. Express this new dependency in top level Makefile to guarantee that group will be built only after dlm.

2007-08-09  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Clean up some Makefiles that did not use proper openaisincdir and dlmincdir.

	Fix build on parisc as we did for ia64

2007-08-07  David Teigland  <teigland@redhat.com>

	don't add the same transaction to a waitfor list more than once

2007-08-06  David Teigland  <teigland@redhat.com>

	fill in a couple more bits related to canceling the chosen lock

	Remove check_sys_fs() since it breaks on-demand fs module loading from the kernel (already changed on RHEL5 branch). Use strerror() instead of errno in another spot to be more user friendly.

2007-08-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't lost the cluster name if it is specified on the command line probably the cause of bz#250688

2007-08-02  Lon Hohberger  <lhh@redhat.com>

	Fix #248727, round 2

2007-07-31  Lon Hohberger  <lhh@redhat.com>

	Fix build problem

	Fix bug #248727

2007-07-30  Lon Hohberger  <lhh@redhat.com>

	Fix #250152

2007-07-30  Robert Peterson  <rpeterso@redhat.com>

	Added ability to parse and print journal information.  For example: gfs2_edit -p journal2 /dev/roth_vg/roth_lv
	Also added the ability to jump relative block numbers.  This is for
	when you jump to a block by "editing" the block number:
	Cursor up to block number, press <enter> to enter destination block.
	Before you could type a structure or block number.  Now you can type
	in a structure, block number, or relative block number.  For example,
	if you're on the superblock (block 0x10) enter +0x300 will take you
	to block 0x310.  This number may be in decimal or hex and may be
	positive or negative.

2007-07-27  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bug #248423: gfs2_tool can not set data journal flags as specified in the man page.

2007-07-26  Lon Hohberger  <lhh@redhat.com>

	Fix #249758

2007-07-24  David Teigland  <teigland@redhat.com>

	sdake says that DESTDIR=/ is correct, not /usr

	minor updates for cluster-2.01.00

	dlm_tool deadlock_check <name> is a way to manually kick off a deadlock detection cycle for the named lockspace

	add new code to find and resolve deadlocks, still incomplete, disabled by default

2007-07-23  Lon Hohberger  <lhh@redhat.com>

	Misc. bugfixes; see ChangeLog

2007-07-23  David Teigland  <teigland@redhat.com>

	Brute-force porting to 2.6.23-rc1.  There are non-trivial changes for which I just copied what had been done to gfs2 without investigating whether gfs1 needs something different.

2007-07-20  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz #247591: Make default journal size for gfs2 128M

2007-07-20  Abhijith Das  <adas@redhat.com>

	Fix for bz248177: We delete the old /etc/mtab entry and add a new one during remount. Any changes made to the mount options using remount are reflected in /etc/mtab now.

2007-07-18  David Teigland  <teigland@redhat.com>

	recent cleanup of warnings should have specified unsigned in long long casts

2007-07-17  Robert Peterson  <rpeterso@redhat.com>

	I added the ability to recurse indirect blocks.  That means that you can now print a list of all blocks associated with a file. For example, you could print all block numbers associated with journal0 by doing something like:
	gfs2_edit -p 0x19 /dev/roth_vg/roth_lv

	assuming, of course, that you know that block 0x19 contains journal0.
	(You can use gfs2_edit -p jindex <dev> to get that information though).

	I fixed some bugs with restoremeta where it was dying if the
	metadata to be restored was bigger than the destination file system
	could hold.

	I made restoremeta do some "warm fuzzy stuff" to report its
	progress of the restore operation so the user doesn't think the
	restoremeta is permanently hung.

	I renamed some long variable names to short ones to make the
	code less wordy.

	I fixed a minor segfault if you hit "j" when your cursor is
	on the block number of the hex view.

	I probably should have committed these changes earlier rather than
	save them up, but some of my changes had serious regressions and I
	didn't have time to sort it out and fix it until just now (I didn't
	want to commit a broken version to cvs.)

2007-07-13  David Teigland  <teigland@redhat.com>

	add lockdump and option to set permission of dlm device when creating

	Make gfs-kernel compile against post-2.6.22 (2.6.23-rc) kernels. (No more sendfile which is now done via splice which gfs1 still lacks.)

2007-07-12  Ryan McCabe  <rmccabe@redhat.com>

	Detect bridged networking configurations where additional parameters are supplied to the script.

2007-07-12  Ryan O'Hara  <rohara@redhat.com>

	Fix bug where mkfs always exits with EXIT_FAILURE.

2007-07-12  Marek 'marx' Grac  <mgrac@redhat.com>

	Resolves: #245178 - install RA for named (agent already in CVS)

2007-07-12  James Parsons  <jparsons@redhat.com>

	Fix for bz238106, new firmware version issues

2007-07-11  David Teigland  <teigland@redhat.com>

	add a bunch of casts to quiet warnings on x86-64 print a couple decimal places for times in the debug logging

2007-07-11  Patrick Caulfield  <pcaulfie@redhat.com>

	file dlm_query_wait.3 was initially added on branch RHEL4.

	file dlm_query.3 was initially added on branch RHEL4.

	file dlm_ls_query_wait.3 was initially added on branch RHEL4.

	file dlm_ls_query.3 was initially added on branch RHEL4.

2007-07-10  Lon Hohberger  <lhh@redhat.com>

	Resolves: 247488

2007-07-10  Ryan O'Hara  <rohara@redhat.com>

	BZ 240584 - Check to see if device is mounted before creating filesystem.

2007-07-10  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 247591: Make default journal size for gfs2 128M

2007-07-09  David Teigland  <teigland@redhat.com>

	Various small changes and additions.  Munging formatting to avoid line wrapping on 80 columns.

2007-07-09  Patrick Caulfield  <pcaulfie@redhat.com>

	remove redundant Makefile lines

	libdlm man pages

2007-07-05  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Overload Makefile to give Lon a build target and keep the style consistent across.
	Most important change (really) is to keep incdir as last or custom incdir
	build will break.

2007-07-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Honour the mode parameter to dlm_create_lockspace() even if the device node was created by udev.

2007-07-02  Jonathan Brassow  <jbrassow@redhat.com>

	<Previous check-in> Require vg_name to be unique.  Allowing multiple LVs from the same VG on different machines can lead to races when updating metadata during device failures. </Previous check-in>
	We can do better.  This patch puts the validation in lvm.sh so that
	it can print out a understandable error message.

2007-07-02  Lon Hohberger  <lhh@redhat.com>

	Fix #237144 - pass 2.  All testcases accounted for now.

2007-06-29  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 241096: GFS: bug in gfs truncate

2007-06-29  Lon Hohberger  <lhh@redhat.com>

	Add note to usage.txt for configuring on 64-bit environments

2007-06-29  Robert Peterson  <rpeterso@redhat.com>

	Revolves: bz 245803: GFS2: buffer count underflow for block 29581 (0x738d)

2007-06-28  David Teigland  <teigland@redhat.com>

	- add more specific warnings/errors when connecting to gfs_controld fails - use strerror to report more helpful error messages in a few spots

2007-06-27  Lon Hohberger  <lhh@redhat.com>

	Merge from RHEL5 branch

	Remove testprog target.

2007-06-26  Lon Hohberger  <lhh@redhat.com>

	Make lan+ work if built as a STONITH module

2007-06-26  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 239729:
		The purge_nr in glock_scan is already a pointer. Fix error in today's check-in.

	Bugzilla 239729:
	  Accidentally moved the wrong patch - fix previous check-in.

	RedHat bugzilla 239727:
	Previous CVS check-in did a last minute change with the way purge count
	was calculated. The intention was to trim glocks evenly across all the
	hash buckets and apparently the size of hash array was overlooked. It
	ends up with zero trimming count most of the time. This virtually makes
	glock trimming patch a void feature.

2007-06-26  Lon Hohberger  <lhh@redhat.com>

	Clean up testprog in make clean

	Ancillary patch to fix debug output

	Fix full-virt rebooting (#243872); add local-only / no-cluster mode to fence_xvmd

2007-06-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix timer durations

2007-06-26  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 245360: GFS2: userland tools have problems with small block sizes

	Add savemeta and restoremeta functions to gfs2_edit

2007-06-25  Ryan McCabe  <rmccabe@redhat.com>

	HP changed the iLO 2 interface again in the latest firmware revision, 1.30 (released on 2007-06-01)

2007-06-25  David Teigland  <teigland@redhat.com>

	s/unsigned long/unsigned long long/

2007-06-25  Robert Peterson  <rpeterso@redhat.com>

	Fix a place where indirect offsets were calculated incorrectly.

2007-06-25  Ryan McCabe  <rmccabe@redhat.com>

	Rename "private" to "priv" to make the file usable by C++ programs, and wrap the header with extern C { ... } if compiling C++.

2007-06-25  Lon Hohberger  <lhh@redhat.com>

	Fix missing label

2007-06-22  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 245360: GFS2: userland tools have problems with small block sizes

2007-06-22  Lon Hohberger  <lhh@redhat.com>

	Make exclusive resources work again

2007-06-22  Robert Peterson  <rpeterso@redhat.com>

	Make gfs2_edit handle small different block sizes.

2007-06-21  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix build on ia64 by adding a temporary workaround and make sure to wrap STACKSIZE properly withing DEBUG.

2007-06-20  Benjamin Marzinski  <bmarzins@redhat.com>

	GNBD doesn't need to flush the cache after it looses connection with the server. Either it will be multipathed, and the multipath device will own the cache, or it won't and flushing the cache will get you nothing more than a flood of error messages all at once, instead of a stream.

2007-06-19  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 231904:
	  Port RHEL4 fast statfs (for commands such as "df") implementation over.
	  The "lvb" enhancement will be followed around RHEL 5.2 time frame.
	  Ballpark performance numbers:

	  dhcp145 (1 cpu HP): old df took 0.875 seconds, new df 0.008 second
	  dhcp146 (4 cpus DELL): old df took 0.808 seconds, new df 0.006 second.

	  Activated via "gfs_tool settune <mount point> statfs_fast 1" command.

2007-06-19  Lon Hohberger  <lhh@redhat.com>

	Fix update failure if node was fenced

2007-06-19  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 240570: Can't mount GFS file system on AoE device

2007-06-19  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Make sure to cleanup the buffer when processing each request or dirty data can be passed from one request to another.
	Add a barrier to make sure that the socket data are not bigger than the buffer
	or we overflow somewhere at random.

	These 2 changes should be backported to different stable branches.

2007-06-18  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 244163: Incorrect output of gfs2_tool sb <dev> all

2007-06-17  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 239729:
	 Backport RHEL4 glock trimming patch over to improve GFS slab cache
	 consumption issue.

	bugzilla 244343:
	Backport RHEL4 gfs datasync patch to head.

2007-06-15  Lon Hohberger  <lhh@redhat.com>

	Fix #243691/2

2007-06-14  Lon Hohberger  <lhh@redhat.com>

	Fix type size for 32/64-bit mixed clusters

2007-06-14  Marek 'marx' Grac  <mgrac@redhat.com>

	New flag -F for clusvcadm to respect failover domain (#211469). Also changes clusvcadm -e service00 which enable service on local node and do not respect failover (same as in RHEL4, in RHEL 5.0 it just wrote Failure).
	Old flag -F (freeze, introduced after RHEL50) was changed to -Z.

2007-06-13  Lon Hohberger  <lhh@redhat.com>

	Fix status check

	Fix #229650 - part 2; fixes an uninitialized var problem

2007-06-13  David Teigland  <teigland@redhat.com>

	Block SIGINT (^C) around the three steps of mount: joining the mountgroup, doing kernel mount, adding mtab entry. And the same for doing the opposite in unmount.

2007-06-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Use new openais timers

2007-06-13  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Wave goodbye to libcman bits :)

2007-06-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't link cman with libcman!

2007-06-12  David Teigland  <teigland@redhat.com>

	log an error message if we see mount.gfs killed before it's done

2007-06-11  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove old dead code from the tree.

2007-06-08  David Teigland  <teigland@redhat.com>

	Return 1 or 0 GETLK result to the kernel for conflict/no-conflict. We were always returning 0 before.

2007-06-08  Ryan O'Hara  <rohara@redhat.com>

	Read nodir from lockspace xml node via ccs_get.

2007-06-06  David Teigland  <teigland@redhat.com>

	(copy from RHEL5 branch) New lockspace config for external dlm. Changed get_weight to look for node weight in lockspace config.

	translate different error numbers from gfs_controld into specific, helpful error messages

	return a different error number to mount.gfs for each specific failure case, so mount can translate that into a helpful error message

2007-06-06  Robert Peterson  <rpeterso@redhat.com>

	Resolves: Bugzilla Bug 242056: GFS2 needs block sizes < 4k (mkfs changes)

2007-06-06  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	both gnbd and gfs1 need some love for .22..
	gnbd:
	- invalidate_bdev changed interface with commit:
	f98393a64ca1392130724c3acb4e3f325801d2b6

	gfs1:
	- struct kset has been cleaned up with commit:
	823bccfc4002296ba88c3ad0f049e1abd8108d30
	- posix_test_lock changed interface with commit:
	9d6a8c5c213e34c475e72b245a8eb709258e968c

	Fix dlm/tool install and clean target

	Fix LDFLAGS override:
	/lib and /usr/lib don't need to be specified at link time.

2007-06-05  David Teigland  <teigland@redhat.com>

	report an error if no lockspace name is provided

2007-06-05  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 242759:
	Bump into this problem while debugging bug #236565 (GFS SPECsfs panic).
	Apparently a minor oversight while adding new function into GFS for
	RHEL5. GFS versions <= RHEL4 is immuned from this issue.

	Upon memory pressure, VM starts to release inode cache entries that would
	fail gfs iget. GFS1 flags this error as "ENOMEM" but returns from gfs_create
	call without releasing the glock.

	Bugzilla 236565
	Fix a race between GFS lookup code and VM cache reclaim logic kicked off
	under memory pressure. At the end of the lookup, gfs releases inode glock
	pre-maturely.  This creates a window inside the bottom portion of logic
	that could make gfs_iget updating the associated GFS inode structure that
	has been freed. Depending on who gets the new memory, unspecified corruptions
	occur.

	In the case where this bug is found, it corrupts TCP buffer head that ends
	up trashing nfsd kernel stack.

2007-06-04  Marek 'marx' Grac  <mgrac@redhat.com>

	Bug: 212479 - ip.sh causes /sbin/ip to produce warnings
	Missing netmask is parsed from /sbin/ip

2007-06-01  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	* Fix incdir usage across the entire tree so that:   - it can override standard include paths for real   - it is always used after more specific inc overrides
	* Clean up a few Makefiles to be more consistent with CFLAGS ordering

	* Fix gfs-kernel/src/gfs/Makefile clean: target

2007-06-01  Abhijith Das  <adas@redhat.com>

	Changes to fix broken code after Bob pulled out metafs mounting functionality from gfs2_quota into libgfs2.

2007-05-31  Lon Hohberger  <lhh@redhat.com>

	Fix 234249, 229650

2007-05-31  Patrick Caulfield  <pcaulfie@redhat.com>

	open_lockspace needs to detect kernel version too, otherwise all lockops will fail mysteriously.

2007-05-30  David Teigland  <teigland@redhat.com>

	bunch of stuff to test new features

	Add dlm_ls_deadlock_cancel() that allows a system daemon to cancel an application's deadlocked lock.  This requires the latest dlm kernel headers.

2007-05-29  Jonathan Brassow  <jbrassow@redhat.com>

	Require vg_name to be unique.  Allowing multiple LVs from the same VG on different machines can lead to races when updating metadata during device failures.

2007-05-25  Wendy Cheng  <wcheng@redhat.com>

	Apparently we can't remove these two methods from file operations table. Since gfs_read() had been changed to use do_sync_read() that requires to have aio defined in the file operations table.
	So vector read/write (implies NFSD) will be partially broken again after
	we put these two methods back.

2007-05-24  David Teigland  <teigland@redhat.com>

	don't do gfs_sb_print() if we don't detect a gfs fs, it often just prints a bunch of garbage

2007-05-22  Lon Hohberger  <lhh@redhat.com>

	Update

	Add missing primary keys to SAP agents

2007-05-21  Lon Hohberger  <lhh@redhat.com>

	Fix typos in resource script logging

2007-05-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Add swab.h for compiling against openais trunk

	Fix typo in openaisincdir

2007-05-18  David Teigland  <teigland@redhat.com>

	use dlm/Makefile to build lib and tool dirs

	add dlm_tool, can be used to join/leave lockspace

	Make new features available based on recent dlm kernel patches.
	The kernel patches change the user/kernel device interface used by libdlm.
	(You'll need the new dlm_device.h kernel header installed on your system
	to build the lib.) libdlm is backward compatible with the old kernel
	interface, but some of the new features will return errors on old kernels.

	New API's provided by libdlm:
	- dlm_new_lockspace() is just like dlm_create_lockspace() but has a flags
	  arg so flags can be passed when creating/joining a lockspace.
	- DLM_LSFL_NODIR and DLM_LSFL_TIMEWARN are new flags that can be used with
	  dlm_new_lockspace().
	- dlm_ls_purge() is new and can be used to purge orphan locks.
	- all DLM_LKF flags can now be used with dlm_lock* routines (flags above
	  16 bits couldn't be used before)
	- new DLM_LKF_TIMEOUT flag to enable lock timeouts
	- dlm_ls_lockx() is new and adds "xid" and "timeout" args

	All previous API's are still available, and programs compiled against
	previous versions of libdlm should still work.

2007-05-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Allow ccs to change the two_node flag. bz#240508

2007-05-15  Robert Peterson  <rpeterso@redhat.com>

	Resolves: Bugzilla Bug 239023: gfs2_fsck not good at fixing corrupt directory entries.

2007-05-15  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove unused files.

	Rrestore the make dependencies within the same subproject (same as it was before the big rework), do some PHONY clean up, clean up a few Makefiles that were still using an old format.
	Patch ACK by Lon and Patrick on IRC.

2007-05-15  Abhijith Das  <adas@redhat.com>

	Need to write the user/group id to the sysfs quota refresh file instead of '1'

2007-05-14  Robert Peterson  <rpeterso@redhat.com>

	Close the /sys/fs directory after using it.

2007-05-14  Lon Hohberger  <lhh@redhat.com>

	Make manual fencing's command line parser backward compatible; per dct

2007-05-11  Robert Peterson  <rpeterso@redhat.com>

	Resolves: Bugzilla Bug 239844: mount.gfs2 doesn't work when _netdev is used in /etc/fstab.

2007-05-11  Ryan McCabe  <rmccabe@redhat.com>

	Convert \r\n line breaks to \n

2007-05-11  Abhijith Das  <adas@redhat.com>

	we don't use this file anymore. removing

2007-05-10  Robert Peterson  <rpeterso@redhat.com>

	Resolves: Bugzilla Bug 234844: Need to add a "gfs2_grow" command

2007-05-10  Ryan McCabe  <rmccabe@redhat.com>

	don't try to workaround xend networking when running on a non-xen kernel

2007-05-09  Jonathan Brassow  <jbrassow@redhat.com>

	If misconfigured, HA LVM + mirroring can cause data corruption.  We should attempt to catch configuration errors before allowing LVM resources to start.

2007-05-09  Lon Hohberger  <lhh@redhat.com>

	Add SAP agents; resolves #238916

2007-05-09  Jonathan Brassow  <jbrassow@redhat.com>

	People seem to think that they have to setup lvm in rgmanager even though they are using clvm.  This causes the two to collide during use.
	The HA LVM resource script should detect if a volume is clustered and ignore it.

2007-05-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't override <totem secauth>  if it appears in cluster.conf. This allows users to disable encryption if they want.

2007-05-08  Wendy Cheng  <wcheng@redhat.com>

	GFS(s) expects NFS fh_type and fh_len would have the same value. This is not correct. One obvious symptom is that it will fail NFS V2 (that uses fixed fh_len for all requests) mount command.

2007-05-08  Lon Hohberger  <lhh@redhat.com>

	Readding SAPInstance/SAPDatabase

	Add SAPInstance and SAPDatabase resource agents to HEAD

	Apply patch to fix bugzilla # 232140

2007-05-04  David Teigland  <teigland@redhat.com>

	Look in cluster.conf dlm section for protocol, timewarn, and log_debug settings and apply them to kernel if found.

2007-05-04  Wendy Cheng  <wcheng@redhat.com>

	Temporarily disable GFS natvie AIO support since it currently breaks vector read-write (used by user mode application system call and NFSD).
	Will come back to fix this soon. Right now, application is expected to
	use posix AIO AIO call (done by libc AIO emulation).

2007-05-04  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 229484: gfs_fsck not good at fixing corrupt directory entries

	Resolves: bz 238740: GFS fsck is has problems with resource groups

2007-05-03  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix build system. Thanks to Alasdair for spotting the error

2007-05-03  Lon Hohberger  <lhh@redhat.com>

	Add test case from RHEL4 branch

	Fix corner case reported in #212121

2007-05-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Change unsigned char* to char* for compatibility with openais trunk.

2007-05-03  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove dead code

	Readd ipv6 support to ccs_tool update and add verbose option

2007-05-02  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	pretty self explanatory, this code is not used anywhere. Get rid of it.

	When the project switched away from magma, we forgot to enable IPv6 for cluster_base_port. The patch fix that and add some checks that were marked as TODO in the code.

	both libccs and daemon were building and linking common/log.c. Make libccs sucks in log.o and make ccsd link against libccs. Also fix ccs top level makefile to build in proper order.

	allow to specify --fence_agents="list of fence agents" at configure time.
	default is to build all of them and add a little help section.

	The detection of available list is done by checking
	fence/agents/agent_name/Makefile presence.

	It also does another round of Makefile cleanup and fix the Makefiles for
	previously DISABLEDAGENTS.

2007-05-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Add const to libcman Thanks to  Jim Meyering for the patch

2007-05-01  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 223893: gfs2_fsck unable to fix damaged RGs and RG indexes.

2007-05-01  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix gfs2 identity exit code path

2007-04-30  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Remove unused vars

	Commit new build system as proposed and discussed on cluster-devel mailing list:
	https://www.redhat.com/archives/cluster-devel/2007-April/msg00139.html

	and following thread with acknoledge from other developers on IRC.

2007-04-27  David Teigland  <teigland@redhat.com>

	various changes

2007-04-27  Lon Hohberger  <lhh@redhat.com>

	Add patch from Simone Gotti to implement service freeze/unfreeze.  Add simple buffer handling for later use.

	Re-fix #222484

2007-04-27  Ryan McCabe  <rmccabe@redhat.com>

	Work around network disruption caused by XenD's bridged networking (bz230783, bz231227).

2007-04-27  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Fix build on parisc

2007-04-26  Lon Hohberger  <lhh@redhat.com>

	Fix #231521

2007-04-26  David Teigland  <teigland@redhat.com>

	change some mount error conditions to log_error() instead of log_debug() so they appear in syslog.  Also set /proc/self/oom_adj.

	Check right away if the kernel has gfs/gfs2 support by looking in /sys/fs/.  This results in a user-friendly error message instead of something like "gfs_controld error 19".

2007-04-26  Fabio M. Di Nitto  <fabbione@ubuntu.com>

	Use resrules-noccs in dtest build target

2007-04-24  Robert Peterson  <rpeterso@redhat.com>

	Horrible kludge to allow display/print of the rgs themselves (but not yet the bitmaps) for easier debugging of bz 223893. Example: gfs2_edit -p rgs /dev/trin_vg/trin_lv

2007-04-23  David Teigland  <teigland@redhat.com>

	Use realpath(3) to canonicalize path names for device and mount point. bz 237544

	Look for a protocol setting in cluster.conf dlm section, and set kernel accordingly if found. Also, set /proc/self/oom_adj (all daemons will get this).

2007-04-19  Lon Hohberger  <lhh@redhat.com>

	Fix bug 234589

	Apply patch from Simone Gotti to fix logging errors in clusterfs.sh

	Apply patch from Andrey Mirkin to fix 237144

	Cleanups to make the resource agents behave better (return OCF_NOT_RUNNING, for example)

2007-04-18  Jonathan Brassow  <jbrassow@redhat.com>

	Bug 236580: [HA LVM]: Bringing site back on-line after failure causes pr...
	Setup:
	- 2 interconnected sites
	- each site has a disk and a machine
	- LVM mirroring is used to mirror the disks from the sites

	When one site fails, the LVM happily moves over to the second site -
	removing the failed disk from the VG that was part of the failed
	site.  However, when the failed site is restored and the service
	attempts to move back to the original machine, it fails because
	of the conflicts in LVM metadata on the disks.

	This fix allows the LV to be reactivated on the original node
	by filtering out the devices which have stale metadata (i.e
	the device that was removed during the failure).

2007-04-18  Lon Hohberger  <lhh@redhat.com>

	Fix dtest.c compile errors

	Add obvious requirement on shared resource case as suggested by Simone Gotti

	fix depends.h/depends.c

2007-04-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Install udev rules file

2007-04-12  Lon Hohberger  <lhh@redhat.com>

	Fix watchdog race on rgmanager exit; BZ#236204, patch from Andrey Mirkin

2007-04-05  Lon Hohberger  <lhh@redhat.com>

	Make agents more OCF (Open Cluster Famework) compliant

2007-04-04  Abhijith Das  <adas@redhat.com>

	fix for bz 225199 - Same as GFS1 fix in RHEL4 (bz 210362). We don't run throug the entire gfs_quota sparse file to do a list operation anymore. We get the layout of the gfs_quota file on disk and only read quota information off the data blocks that are actually in use. Also added functionality to GFS_IOCTL_SUPER to provide the metadata of the hidden quota file.

2007-04-04  Lon Hohberger  <lhh@redhat.com>

	allow ocfs[2] to work with the clusterfs resource agent.  Also, commit patch which corrects interval processing for status operations

2007-04-04  Ryan McCabe  <rmccabe@redhat.com>

	Make power on work correctly for RIBCL version 2.22 on both iLO2 and iLO: for the former, HOLD_PWR_BTN is used to both power the machine on and off; when the power is off, PRESS_PWR_BUTTON has no effect. For the latter, HOLD_PWR_BUTTON is used to power the machine off, and PRESS_PWR_BUTTON is used to power the machine on; when the power is off, HOLD_PWR_BUTTON has no effect.

2007-04-03  Lon Hohberger  <lhh@redhat.com>

	Kill VM machine immediately; patch from Jeroen van den Horn

2007-04-03  Robert Peterson  <rpeterso@redhat.com>

	Resolves: Bugzilla Bug 235061: gfs_fsck: Bad programmer! You forgot to catch the ÿ flag.

	Resolves: Bugzilla Bug 235060: gfs_fsck: Bad programmer! You forgot to catch the ÿ flag.

2007-03-29  Robert Peterson  <rpeterso@redhat.com>

	Jump from RG index was broken.

2007-03-28  Lon Hohberger  <lhh@redhat.com>

	Fix SPARC / HPPA build; patch from Fabio M. Di Nitto

2007-03-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove udev file from here as it is confusing. The real one is in ../scripts

	Newer versions of udev prefer == to =

2007-03-27  Lon Hohberger  <lhh@redhat.com>

	Merge patch from Crosswalk team  Team: Leonard Maiorani, Scott Cannata, Henry Harris
	* Always check malloc() return codes
	* Fix errant clu_unlock() calls in vft.c in cases where clu_lock() failed
	* Add ability to wrap pthread_mutex / pthread_rwlock calls for better
	  stability
	* Fix improper pthread_mutex_destroy() semantics

2007-03-27  David Teigland  <teigland@redhat.com>

	latest version, "stress" test running correctly

2007-03-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Actually, MAX_INT is a bit of a bad idea under this new system.

	Fix bug where we could free an lksb while dlm_lock is still using it.

2007-03-26  Robert Peterson  <rpeterso@redhat.com>

	Resolves: Bugzilla Bug 233083: Wrong link command in gfs2-utils mkfs/Makefile (with solution).

	Resolves: Bugzilla Bug 232124: gfs2_fsck will create multiple lost+found directories.

	Resolves: Bugzilla Bug 232019: gfs2_fsck doesn't fix an ea problem.

2007-03-23  Lon Hohberger  <lhh@redhat.com>

	Remove dead code; fix build_tree loop

	Merge ordering patch from RHEL4 branch; update automated test cases

	Use more strict build options

2007-03-20  Lon Hohberger  <lhh@redhat.com>

	Fix multimaster bug: ensure timings are accurate and provide multi-master conflict resolution

	Fix clean target; patch from Fabio M. Di Nitto

	Force release of lockspace; patch from Patrick Caulfield

	Apply build cleanup patch from Fabio M. Di Nitto

2007-03-15  Patrick Caulfield  <pcaulfie@redhat.com>

	If the machine is multi-homed, then using a truncated name in uname but not in cluster.conf would fail to match them up.

	Support IP(v4) addresses in cluster.conf per bz#232068

2007-03-10  Lon Hohberger  <lhh@redhat.com>

	Strings cleanup.  Enable vm.sh live migration.

	Fix help message

2007-03-08  Ryan McCabe  <rmccabe@redhat.com>

	Add 'M' to the getopt string to keep clusvcadm from complaining that M is an invalid option.

2007-03-07  Lon Hohberger  <lhh@redhat.com>

	Fix 213241

2007-03-06  Ryan O'Hara  <rohara@redhat.com>

	Fix help message to refer to script as 'fence_scsi_test'.

2007-03-06  Lon Hohberger  <lhh@redhat.com>

	Add open failure message

	Fix missing newline in debug message

	Resolves: 231151 Enable auto-fallback to no-authentication for fence_xvm if fence_xvm.key does not exist.

2007-02-28  Robert Peterson  <rpeterso@redhat.com>

	Made hex editing a lot easier (for bz 229484).  Fixed several bugs regarding printing.  Added ability to print/view gfs1 journal index.

2007-02-27  David Teigland  <teigland@redhat.com>

	un-comment-out gfs-kernel and gnbd-kernel since they now build on upstream kernel

	updates

	lots of changes, biggest is new "stress" test

2007-02-27  Stanko Kupcevic  <kupcevic@redhat.com>

	Fix for bz230134 (can't fence port 1:1 with fence_apc)

2007-02-26  Robert Peterson  <rpeterso@redhat.com>

	Resolves bz: 229222: gfs2_fsck stuck in infinite loop

2007-02-22  Lon Hohberger  <lhh@redhat.com>

	Make status checks happen at 'start' time (parent-before-child) instead of 'stop' time (parent-after-child).

2007-02-22  David Teigland  <teigland@redhat.com>

	remove the self paramter (sync up with RHEL5 branch)

2007-02-22  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 229601: gfs_tool fails to report counters

2007-02-21  Lon Hohberger  <lhh@redhat.com>

	Fix anonuid/anongid parsing in nfsclient.sh

	Resolves: 222445 * Only let one status queue thread spawn at a time
	Other:
	* Misc tweaks to alloc.c for debugging

	Resolves: 229338 * Makes zero-heuristic mode work (#229338)
	General (small) fixes:
	* Add time stamp to status file
	* Hush stdout/stderr from init script
	* Give lots of information in status file if debug mode is enabled

	Fixes for clusters with long failover times (e.g. 2+ minutes):
	* Enable status file generation during initialization loop
	* Allow termination (e.g. service qdiskd stop) during initialization loop
	* Add tunables for clusters with long failure detection times (e.g. 2+ minutes)

	Add example test configuration for dtest

	Remove ancient / unused script

	Check in missing header

2007-02-20  Lon Hohberger  <lhh@redhat.com>

	Add missing comment

	Initial checkin of simple dependency engine

	Fix 229254 - extraneous man pages, 228823 - allow disable of services stuck in 'stopping' state

2007-02-20  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 229220: gfs_fsck stuck in infinite loop

2007-02-19  Ryan McCabe  <rmccabe@redhat.com>

	Support power on/reboot for iLO2

2007-02-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Add -c clustername to help output.

	Add delay switch

	If exec fails, then tell the parent process.

2007-02-15  Lon Hohberger  <lhh@redhat.com>

	Add LVM failover agent; by Jon Brassow

2007-02-15  Ryan McCabe  <rmccabe@redhat.com>

	- Document the -S/passwd_script fence params. - Update the copyright notices.

2007-02-15  Lon Hohberger  <lhh@redhat.com>

	Fix missing copytobin target for RHEL4 branch

2007-02-14  Lon Hohberger  <lhh@redhat.com>

	Add member_util.sh to installation

	Add member_util.sh functions

	Add RA installs to trunk; Make sure utility stuff is installed in the right place

2007-02-14  Ryan O'Hara  <rohara@redhat.com>

	Ignore EPIPE error when sending response. This can happen is, for example, rgmanager makes a request, ccs receives/processes the request, but rgmanager dies before ccs can send the response. Also added retry if we catch EINTR during write.

2007-02-14  Lon Hohberger  <lhh@redhat.com>

	Make service.sh understand lvm RA type

2007-02-14  Stanko Kupcevic  <kupcevic@redhat.com>

	Support "passwd_script" parameter in python fence agents. If both "passwd" and "passwd_script" parameters are specified, "passwd_script" will be used first (if it fails, fencing will be attempted using "passwd" parameter).

2007-02-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't report 0 exit status as a failure.

2007-02-14  Stanko Kupcevic  <kupcevic@redhat.com>

	fence_apc_snmp ignores "port" parameter

2007-02-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Add man page info for ccs_tool addnodeids

2007-02-13  Ryan McCabe  <rmccabe@redhat.com>

	Support the "passwd_script" parameter in the C fence agents.

2007-02-13  Lon Hohberger  <lhh@redhat.com>

	Remove fence_manual; only provide manual-failure override

	Apply fixes from RHEL4 branch

2007-02-13  Robert Peterson  <rpeterso@redhat.com>

	Misc improvements.  Better scrolling.  You can now scroll through the rindex.  The superblock now has a pseudo-extended display. Fixed the file offset calculations for indirect pointers. It still has some bugs but it's better than it was.

2007-02-12  Ryan McCabe  <rmccabe@redhat.com>

	Update the perl fence agents to take the additional command line option -S <path> or stdin param passwd_script=<path>

2007-02-12  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 221743: gfs2_fsck errors still

	Resolves: bz 222308: mkfs and journal addition for GFS2 should produce contiguous journals.

2007-02-09  David Teigland  <teigland@redhat.com>

	clear configfs stuff if we get SIGTERM, this is a convenience if you want to kill dlm_controld and remove the dlm module without leaving the cluster.  Otherwise you have to manually clear configfs dirs.

	If the only two groups were two dlm lockspaces, then during recovery, the first would detect the all_nodes_all_stopped condition and move on to the starting state, and the second would never get a chance to detect the all_nodes_all_stopped state since the event state of the first was no longer FAIL_ALL_STOPPED.  Use a separate flag to indicate that the all stopped state has been reached instead of relying on the event state.

2007-02-08  Robert Peterson  <rpeterso@redhat.com>

	Fixed some bugs and made some improvements. When displaying indirect blocks, it now gives the data offset. Also added page-up/page-down/home/end navigation to block list display.

2007-02-06  Lon Hohberger  <lhh@redhat.com>

	Don't query rgmanager if the user only wants a node state

2007-02-02  Robert Peterson  <rpeterso@redhat.com>

	Misc updates to bring gfs-kernel up to the 2.6.20-rc7 and similar kernels.  Also fixed some minor typos.

2007-02-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Add threads example

2007-01-31  David Teigland  <teigland@redhat.com>

	join lockspace, optionally sleep, leave the lockspace. useful for testing, also useful to clear/release a lockspace from any random process that exited without releasing its lockspace

2007-01-31  James Parsons  <jparsons@redhat.com>

	New apc agent written in python that supports named outlets and outlet groups, minus perl pain. Addresses bz172179 and bz134489. yee haw

	fix for bz220946

	fix for bz205457

2007-01-31  David Teigland  <teigland@redhat.com>

	test program like gfs's 'alternate' but using an lvb instead of a file. nodes take turns incrementing the counter in the lvb

2007-01-31  Patrick Caulfield  <pcaulfie@redhat.com>

	Read the LVB every time, rather than not at all.

2007-01-29  Ryan O'Hara  <rohara@redhat.com>

	If no password is specified, pass a "-P ''" to the ipmitool to prevent it from prompting for a password.

2007-01-29  Lon Hohberger  <lhh@redhat.com>

	Add error reporting if msg_open fails; patch from Josef Whiter

2007-01-26  Lon Hohberger  <lhh@redhat.com>

	Fix 223519

	Port fix for logging of errors in config from RHEL5 branch

	Add list_prepend macro

	Add override for action timings

	Clean up test cases

	merge fixes from RHEL5 branch

	Fix #222484

2007-01-26  Ryan O'Hara  <rohara@redhat.com>

	file scsi_watchdog.conf was initially added on branch RHEL4.

	file scsi_watchdog was initially added on branch RHEL4.

	file scsi_reserve.sysconfig was initially added on branch RHEL4.

2007-01-26  Lon Hohberger  <lhh@redhat.com>

	Patch from Fabio Massimo Di Nitto - Fix portability of getuptime function

2007-01-24  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 222299: gfs knows of directories which it chooses not to display

2007-01-23  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 222759: gfs_mkfs doesn't zero data after gfs superblock

	Resolves: bz 223500: gfs2_fsck runs slower than previous version

	Resolves: bz 223843 GFS2: gfs2_fsck segfaulting on corrupt extended attributes

	Resolves: bz 223506: gfs2_fsck: fatal: invalid metadata block This is a crosswrite from gfs1. 1. Fix a memory leak in pass1b. 2. Improve performance of pass1b by combining loops through fs. 3. Give an error message and abort if file system > 16TB and node    architecture is 32-bits. 4. Give users an "Abort" "Continue" and "Skip" if they interrupt    with ctrl-c.  Also, report progress for that pass on interrupt. 5. Added more "percent complete" messages for other passes.
	See bz comments for more details.

2007-01-23  Lon Hohberger  <lhh@redhat.com>

	Use /proc/uptime by default instead of gettimeofday(2) for internal timings to avoid problems when the clock is reset by NTP

2007-01-23  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 222933: regression: fence_tool no longer times out after 300 seconds

2007-01-23  Lon Hohberger  <lhh@redhat.com>

	Simple manual override for fenced & example replacement for fence_ack_manual

2007-01-22  Lon Hohberger  <lhh@redhat.com>

	Resolves bugzillas: #213533, #216092, #220211, #223002, #223234/#223240
	Detailed comments:

	* Lock in memory to prevent being swapped out
	* Turn on RR scheduling for main + score threads
	* Let qdiskd wait for CMAN to start
	* Add option to qdiskd to stop CMAN if qdisk device is not available
	* Make qdisk interval timings more accurate
	* Add option to reboot node if qdiskd detects internal hang > failure time (e.g. interval*tko, in seconds)
	* Add per-heuristic tko counts for unreliable heuristics (e.g. ping packets)
	* Remove nodes from quorate mask immediately on eviction
	* Update man pages with better examples
	* Don't let >1 instance of qdiskd be started
	* Clarify logging output.
	* Improve data in status_file.
	* Allow qdiskd to run with no defined heuristics (master-always-wins mode).
	* Make fencing of nodes optional (default = on).
	* Make sure CMAN is running before we try to talk to it at each point.

2007-01-19  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 222871 gfs_fsck runs slower than previous versions

2007-01-17  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 222743: gfs_grow gets the rgindex out of order.

2007-01-17  Lon Hohberger  <lhh@redhat.com>

	Fix #222961 - required for Conga to work.

2007-01-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix typo. thanks Bob.

	If we get killed by another node then print the reason in English rather than just a number.

2007-01-16  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 222747: Remove references to lock_gulm from cluster man pages

2007-01-16  Lon Hohberger  <lhh@redhat.com>

	Resolves: #222485; patch from Simone Gotti Makes relocation work correctly.

	Apply patch from Simone Gotti; fixes #222744/#222838

2007-01-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't return to 'cman_tool leave' until we are just about to quit. Otherwise there can be a delay between cman_tool thinking that we are down, and the node really being out of the cluster. see bz#222686

2007-01-15  Lon Hohberger  <lhh@redhat.com>

	Fix bug causing cluster.conf / rm log level to be ignored in resource agents

2007-01-11  David Teigland  <teigland@redhat.com>

	Move memset(0) into the for loop so we're clearing the data buffer each time through.  We were seeing some bogus data from group_tool -v.

2007-01-11  James Parsons  <jparsons@redhat.com>

	bz222234

2007-01-10  Lon Hohberger  <lhh@redhat.com>

	Resolves: #221210 Allows fence_xvm to respond even if the virtual machine has never existed in the cluster.

2007-01-09  David Teigland  <teigland@redhat.com>

	add -K option to enable dlm kernel log_debug's (does nothing if /sys/kernel/config/dlm/cluster/log_debug doesn't exist)

2007-01-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Add flood program back.

	quorumdev_poll is in milliseconds, not seconds! Thanks to Simone Gotti

2007-01-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't lose NUL on the end of the fence-agent. thanks to Simone Gotti <simone.gotti@email.it> for the patch

	If there are already queued messages for a client then don't send new ones out of order

2007-01-06  Benjamin Marzinski  <bmarzins@redhat.com>

	Get GNBD compiling with the latest upstream kernel.

2007-01-05  David Teigland  <teigland@redhat.com>

	groupd creates uint32 global id's for each group.  It doesn't use them itself, but provides them to each registered app to use if it wants.  (The dlm and gfs each use the global id in messages to distinguish between different lockspaces/fs's.)  groupd's method of creating these gid's (local counter | local nodeid) can result in duplicate gid's in the cluster given a somewhat uncommon sequence of events. bz 221629

2007-01-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Clear the node structure before calling cman_get_node(). Thanks to simone.gotti@email.it

	Send correct length of quorum device name sent to cman. Thanks to simone.gotti@email.it for the patch

2007-01-04  David Teigland  <teigland@redhat.com>

	added "flood n mode" function a while ago, doesn't equate to pjc's "flood" program even though that's what I was originally hoping to emulate

2007-01-02  David Teigland  <teigland@redhat.com>

	mount/umount modifications of /etc/mtab weren't smart enough to get straight two different fs's mounted on the same mountpoint bz 218560

2007-01-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Give a better error if the cluster name is too long.

2006-12-21  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 219876: mount.gfs hangs if there are insufficient journals configured in the filesystem

2006-12-20  David Teigland  <teigland@redhat.com>

	Support mounting a single fs on multiple mount points. bz 218560

2006-12-19  David Teigland  <teigland@redhat.com>

	Fixes related to the needs_recovery state and first-mounter recovery. Probably not perfect yet, but working in the tests I'm able to contrive. bz 218551

	When the first mounter is recovering all the journals, it should use TRY on the journal locks.  There's one rare case where other mounters will exist who hold journal locks that we don't want to block on.  That's when the other mounters are readonly, haven't been able to recover the fs after a node failure, and the next rw mounter is told to do first mounter recovery.  The journals of these readonly nodes can be skipped when the pseudo-first mounter is going through all journals.  Changed this a long time ago but never checked it in. bz 218551

2006-12-19  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 219878: gfs2 creation should default to 1 journal and lock_nolock

2006-12-19  David Teigland  <teigland@redhat.com>

	revert last checkin

2006-12-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix bug where cman_dispatch(CMAN_DISPATCH_ONE) could dispatch several messages.

2006-12-19  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz 218560: multiple mount points fail with gfs and gfs2

	Resolves: bz 219866: GFS init script - FATAL: Module lock_dlm is in use.

2006-12-18  Lon Hohberger  <lhh@redhat.com>

	Implement cap on max # of outstanding status check threads; fixes bugzilla #218697

2006-12-18  Benjamin Marzinski  <bmarzins@redhat.com>

	GNBD was hanging with the cfq scheduler, so I changed the default scheduler for all gnbd devices to the anticipatory scheduler.

2006-12-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Increase token timeout to 10s as per bz#216954

2006-12-15  Benjamin Marzinski  <bmarzins@redhat.com>

	make it so that the -c and -[u|U] flags are mutually exclusive. Resolves bz 219413

2006-12-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Add cluster_id override field to cluster.conf, so that people can manually assign cluster IDs where the hash values for similar names clash

2006-12-14  Lon Hohberger  <lhh@redhat.com>

	Fix #216774, pass 3

	Fix #216774

2006-12-14  David Teigland  <teigland@redhat.com>

	Switch from CMAN_DISPATCH_ONE loop to CMAN_DISPATCH_ALL to resolve delayed cman shutdown callbacks. bz 219385

2006-12-14  Lon Hohberger  <lhh@redhat.com>

	Fix #216774; missed rg_thread.c

2006-12-14  David Teigland  <teigland@redhat.com>

	Switch from CMAN_DISPATCH_ONE loop to CMAN_DISPATCH_ALL to resolve delayed cman shutdown callbacks. bz 219385

2006-12-13  David Teigland  <teigland@redhat.com>

	groupd's function that returns info for group status queries was mistakenly setting the "member" status to 0 when a node was leaving. This led fence_tool to believe that the local node was no longer a member (i.e. had finished leaving) when in fact the leave wasn't complete yet. bz 219385

2006-12-13  Lon Hohberger  <lhh@redhat.com>

	Fix #211468 - clustat always returns 0, but should give a nonzero code for non-running services.

	Fix segfault in clustat if node is not a cluster member

2006-12-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix typo that could affect shutdown. see bz#219385

2006-12-12  David Teigland  <teigland@redhat.com>

	add lock_flood/unlock_flood/unlock_flood-exit commands to test doing large volumes of locks/unlocks

2006-12-08  Abhijith Das  <adas@redhat.com>

	don't fail if unmounting configfs fails

2006-12-08  David Teigland  <teigland@redhat.com>

	tidy up some prints

2006-12-07  David Teigland  <teigland@redhat.com>

	very useful testing program I wrote a long time ago

2006-12-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix minor bug where cman_tool join didn't spot that aisexec had started correctly or crashed.
	This means we can up the timer for allowing aisexec to start with no ill
	effects. see bz#218688

2006-12-05  David Teigland  <teigland@redhat.com>

	Call into the lock module to do a withdraw instead of just calling BUG. bz 215962

	When lockfs is called from the vfs (due to a dm suspend), don't try to do the lockfs if the fs is being shut down (due to a withdraw). bz 215962

	Pass gfs_controld the device being mounted, it'll use this if it needs to withdraw the fs. bz 215962

	Before doing the mount-group portion of withdraw, fork off a dmsetup to suspend the fs device.  This means gfs doesn't need to call dm_suspend() in the kernel before calling out to us.  The suspend waits for all outstanding i/o to return on the device which is necessary prior to telling other nodes to do recovery.  (Later we should probably swap in an error table and resume the device.) bz 215962

	change the default plock rate limit from 10 to 100 bz 216052

2006-12-04  Lon Hohberger  <lhh@redhat.com>

	Fix build error

2006-12-01  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz218134: GFS & GFS2: umount while busy gives bogus error message.

2006-12-01  Lon Hohberger  <lhh@redhat.com>

	Handle 0.1.9 case of libvirt returning a virDomainPtr + state for a VM that doesn't exist (vm state == VIR_DOMAIN_SHUTOFF)

2006-12-01  Abhijith Das  <adas@redhat.com>

	bz 190196. gfs2_quota. Doesn't use sysfs anymore. Uses the gfs2meta filesystem instead.

2006-12-01  David Teigland  <teigland@redhat.com>

	Be more intelligent about handling recovery sets so we can deal with cases where a node fails, rejoins, then fails again before recovery has completed for the first failure.  Also handles case where the groupd process exits without the node going down.  If that happens, we want to kill the node (via cman) if the node was in any groups and ignore it otherwise.

	group_tool dump doesn't handle partial reads/writes, now we always dump entire fixed size debug buffer bz 214540

2006-12-01  Patrick Caulfield  <pcaulfie@redhat.com>

	That 'if' really should have been a 'while'. If anyone can remember which bug this was supposed to fix, please pipe up :)

2006-12-01  Lon Hohberger  <lhh@redhat.com>

	Fix bug where fence agents were getting info up to groupd

2006-11-30  Lon Hohberger  <lhh@redhat.com>

	Fix bug reported by Fabio M. Di Nitto - duplicate definition of assign_noccs

2006-11-30  David Teigland  <teigland@redhat.com>

	From: Steven Dake We dispatch in the dispatch handler now instead of saving the data.  Also we use dispatch all which will basically try to dispatch all messages possible in one go instead of only dispatching on each loop through poll.

2006-11-30  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz217798: Need to port Resource Group optimization from gfs1 to gfs2

2006-11-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't truncate the node name when we check for it unqualified. bz#217724

2006-11-29  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz213763: mkdir takes more time on larger file systems. Made gfs_mkfs use RG sizes based on size of file system to maximize performance.

	Resolves: bz217436: Several updates needed to cluster.conf man page. 1. Removed references to gulm. 2. Other misc changes.

	Resolves: bz217436: Several updates needed to cluster.conf man page. 1. Added required nodeid="x" to cluster.conf example. 2. Added <cman/> tag to cluster.conf example. 3. Added section on cluster.conf validation (Credit Jim Parsons) 4. Fixed spelling and grammar problems.

2006-11-28  David Teigland  <teigland@redhat.com>

	the fix yesterday to prevent a segfault when mount failed mistakenly also changed the exit point from the function causing the error to not be written back to mount.gfs

2006-11-28  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz216902: mkfs.gfs2 allows non-4K block size. The executive decision was made to remove the -b option in mkfs.gfs2 until we can get all of this sorted out with the gfs2 kernel.

	Resolves: bz217460: fence_tool man page updates needed. Thanks go to Fabio Massimo Di Nitto for contributing this.

2006-11-28  James Parsons  <jparsons@redhat.com>

	file fence_baytech.py was initially added on branch RHEL4.

2006-11-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Tell cman when the config file has been updated

2006-11-27  David Teigland  <teigland@redhat.com>

	if mount fails, don't try to save the mg info for the new group since there won't be any mg and we'll segfault

2006-11-27  Ryan O'Hara  <rohara@redhat.com>

	Fix comment. Fix exit status be rval.

2006-11-27  Lon Hohberger  <lhh@redhat.com>

	Fix #213878 - segfault in rg_thread.c due to improper loop semantics

2006-11-27  Wendy Cheng  <wcheng@redhat.com>

	bugzilla : 217374 - temporarily disable GFS1 withdraw until bz215962 is ready.

2006-11-27  Ryan McCabe  <rmccabe@redhat.com>

	Add DRAC5 and DRAC4/I support Related: #211836, #211918

2006-11-22  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz216898 mkfs.gfs2 needs to zero the first 16 blocks of file system

2006-11-21  David Teigland  <teigland@redhat.com>

	handle errors or short reads when reading /dev/misc/lock_dlm_plock

2006-11-21  Lon Hohberger  <lhh@redhat.com>

	Fix #213218

2006-11-20  David Teigland  <teigland@redhat.com>

	use timersub() macro to subtract timevals instead of coding it

	fix a couple of problems if openais enables flow control: - the poll loop spins due to plocks being ready to process but being   ignored due to the flow control; we need to remove the plock fd from   the poll set when flow control is enabled (just like we do when the   plock rate limiter is active) - we were not updating the flow control state from openais when   flow control was enabled unless we received a cpg message; we need   to update it periodically while blocked since we may not receive   cpg messages from other nodes causing us to update the state

	The plock rate limiting code should use the full timeval to measure the 1 sec limit interval instead of just the rough difference in tv_sec values.

2006-11-20  Robert Peterson  <rpeterso@redhat.com>

	Fix another case where lf_dirent_format was not rewritten to disk after it was fixed.

2006-11-17  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz208836 - fatal: invalid metadata block 1. Fix a memory leak in pass1b. 2. Improve performance of pass1b by combining loops through fs. 3. Give an error message and abort if file system > 16TB and node    architecture is 32-bits. 4. Give users an "Abort" "Continue" and "Skip" if they interrupt    with ctrl-c.  Also, report progress for that pass on interrupt. 5. Added more "percent complete" messages for other passes.
	See bz comment #33 for more details.

2006-11-17  David Teigland  <teigland@redhat.com>

	if read() returns a non-EINTR error then abort

	if read() returns a non-EINTR error then shut down the client

2006-11-17  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 214274: Oops... only directIO has this issue - buffer IO should be fine. Revert buffer io changes.

2006-11-17  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz215817 umount caused a 'filesystem consistency error' kernel BUG

2006-11-17  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 214274: GFS has been splitting large writes into smaller atomic     transactions. This would generate multiple aio completion calls (one     for each transaction) that falsely notify application about data     completion. Problem is reported by QA team as data corruption.

2006-11-16  Ryan O'Hara  <rohara@redhat.com>

	Fix annoying whitespace inconsistency.

	Detect and fix potential endia problem in lf_dirent_format.

2006-11-15  Lon Hohberger  <lhh@redhat.com>

	Fix error reporting from cman if run while xend is not running.

2006-11-15  David Teigland  <teigland@redhat.com>

	fix sched_priority from sdake

	uncomment scheduler settings fix sched_priority from sdake

2006-11-14  Robert Peterson  <rpeterso@redhat.com>

	Resolves: bz211465 fsck errors on gfs2 volume

2006-11-14  David Teigland  <teigland@redhat.com>

	Default plock rate limit of 10 instead of 0.

	Add plock rate limit option -l <limit>.  Current default is no limit (0). If a limit is set, gfs_controld will send no more than <limit> plock operations (multicast messages) every second.
	Given a limit of 10, one file system where plocks are used, and a program
	that does a tight loop of fcntl lock/unlock operations, the max number of
	loop iterations in 1 second would be 5.  If eight nodes were all doing
	this there would be 80 total network multicasts every second from all
	nodes in the cluster.

	We also record the volume of plock messages accepted locally and received
	from the network in the debug log.  A log entry is written for every
	1000 locally accepted plock operations and for every 1000 operations
	received from the network.

2006-11-14  Robert Peterson  <rpeterso@redhat.com>

	Ability for gfs2_edit to handle gfs1 indirect metapointers.

2006-11-13  Ryan O'Hara  <rohara@redhat.com>

	Include sd_freeze_count in counters output. This will allow users to see the freeze count via gfs_tool counters.

2006-11-13  Chris Feist  <cfeist@redhat.com>

	Fixes to prevent compile time warnings/errors in brew.

	Need to include directory for ccs.h header file.

2006-11-13  Lon Hohberger  <lhh@redhat.com>

	Fix bugzilla #212474; fully integrates fence_xvmd with ccs & the cman init script

2006-11-10  Benjamin Marzinski  <bmarzins@redhat.com>

	fix for bz215095 & 215099.
	for 215099, gnbd now only handles signals in sock_xmit() when it is called by
	the gnbd_recvd process. Otherwise, it simply blocks the signals until it
	completes the IO. This keeps gnbd from sending partial requests to the
	server, which can lead to data corruption.

	for 215095, the gfs function clean_journal() now uses the noinline attriubute,
	gfs_find_jhead() only uses on struct gfs_log_header, and gfs_recover_journal() dynamically allocates its struct gfs_log_header, all to conserve stack space.

	In the gnbd function sock_xmit(), you no longer get the signal info, so
	gnbd_recvd cannot print which signal it received, but it saves over 120 bytes
	of stack space.

2006-11-09  Robert Peterson  <rpeterso@redhat.com>

	This is the fix for Bugzilla Bug 214524: group_tool dump can give short output.

	This is the fix for Bugzilla Bug 214625: Add group_tool log function to group_tool and groupd.

	This is the fix for Bugzilla Bug 214621: Allow gfs2_edit to view, print and edit gfs(1) file systems.

2006-11-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Set join_timeout and consensus_timeout to higher defaults as per bz#214920

2006-11-08  Robert Peterson  <rpeterso@redhat.com>

	This is the fix for Bugzilla Bug 214513: gfs2_convert must reject file systems with block size != 4K.

2006-11-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Always compile in debug logging - you never know when it might come in handy and it's disabled by default anyway.

2006-11-06  Marek 'marx' Grac  <mgrac@redhat.com>

	Bug #213524. Resource agent for named + patch for stopping applications

2006-11-06  Patrick Caulfield  <pcaulfie@redhat.com>

	if an AISONLY node dies, mark it DEAD bz#213747 comments 9-13 (ish)

2006-11-03  Ryan O'Hara  <rohara@redhat.com>

	Added fence_scsi_test to help test SCSI reservation capabilities.

2006-11-03  Lon Hohberger  <lhh@redhat.com>

	Fix bugzillas #212444, #212433

2006-11-03  David Teigland  <teigland@redhat.com>

	When a new master joins the mountgroup, it retrieves plocks from the ckpt created by the old master, then unlinks and closes the ckpt so it can create another new ckpt later.
	Bug found by sdake where the ckpt close following the unlink was
	being skipped because the ckpt handle wasn't being set.

2006-11-03  Patrick Caulfield  <pcaulfie@redhat.com>

	fix bz#213747 Basically we don't let a node join a cluster that already has "Disallowed" nodes in it as we don't consistently know the state of the cluster in that case (it could be two inquorate halves for example).
	Sorry, Steven, this is yet another instance where cman has to exit() the aisexec
	process for the greater good of the cluster.

	I've also enhanceed "cman_tool nodes" to show the disallowed nodes and a warning
	message that the cluster is in a bit of a mess.

2006-11-01  Lon Hohberger  <lhh@redhat.com>

	Apply patch to fix build on newer kernels from Fabio M. Di Nitto <fabbione at ubuntu.com>

2006-10-31  Patrick Caulfield  <pcaulfie@redhat.com>

	On Steven Dake's recommendation, also up the token_retransmit count to 20. and fix a couple of typos.

	Set the default token timeout to 5 seconds. It can still be overridden in cluster.conf if required.

2006-10-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Lon's patch to user /etc/sysconfig/cman for customisation. bz#212393

2006-10-27  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 211622 - Root issue is found and fix. Backout the workaround.

2006-10-26  Abhijith Das  <adas@redhat.com>

	bz 211418. Modified gfs2_tool and gfs2_jadd to use the new inode flags in fs.h instead of deprecated iflags.h

2006-10-25  Lon Hohberger  <lhh@redhat.com>

	Update Changelog

	Fix #212074

2006-10-25  Patrick Caulfield  <pcaulfie@redhat.com>

	fix CMAN_DISPATCH_ALL. Patch from Mikhail A Zelikov which got inexplicably lost, sorry.

2006-10-25  Benjamin Marzinski  <bmarzins@redhat.com>

	This is a bugfix for bz #211923.
	When can't mount a filesystem because you already have it mounted, or some
	similar reason, you print out a helpful message, so the user can fix the
	problem.

2006-10-24  David Teigland  <teigland@redhat.com>

	recent commit fixing bz 210344 removed the memset so we're getting garbage back sometimes

	Clear out configfs dirs that we've created before exiting. Allows dlm kernel mod can be removed straight away now. bz 211924 (code setting scheduler priority also added but commented out)

	clean up gross code

2006-10-24  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 211622: GFS1 will asserts at xmote_bh() if DLM grants SHARED                  lock to direct IO's DEFERRED request. Add LM_FLAG_ANY                  to direct read to allow relaxed state and change direct                  write to use EXCLUSIVE lock.

2006-10-24  Lon Hohberger  <lhh@redhat.com>

	Fix #211701 (rgmanager + clustat hangs), #211933 (xenvm rename -> vm)

2006-10-23  Benjamin Marzinski  <bmarzins@redhat.com>

	Really gross hack!!! This is a workaround for one of the bugs the got lumped into 166701. It breaks POSIX behavior in a corner case to avoid crashing... It's icky.
	when NFS opens a file with O_CREAT, the kernel nfs daemon checks to see
	if the file exists. If it does, nfsd does the *right thing* (either opens the
	file, or if the file was opened with O_EXCL, returns an error).  If the file
	doesn't exist, it passes the request down to the underlying file system.
	Unfortunately, since nfs *knows* that the file doesn't exist, it doesn't
	bother to pass a nameidata structure, which would include the intent
	information. However since gfs is a cluster file system, the file could have
	been created on another node after nfs checks for it. If this is the case,
	gfs needs the intent information to do the *right thing*.  It panics when
	it finds a NULL pointer, instead of the nameidata. Now, instead of panicing,
	if gfs finds a NULL nameidata pointer. It assumes that the file was not
	created with O_EXCL.

	This assumption could be wrong, with the result that an application could
	thing that it has created a new file, when in fact, it has opened an existing
	one.

2006-10-23  Abhijith Das  <adas@redhat.com>

	Adding Josef's noquota mount option for GFS1 in RHEL5. Original bz 205285

2006-10-23  David Teigland  <teigland@redhat.com>

	Patch from Abhi to fix case where a node's mount is rejected by other group members causing gfs_controld on the mounter to leave the group immediately.  It was sometimes leaving before its join was even finished which caused groupd to reject the leave, so we need to wait for the join to complete before doing the leave.

2006-10-21  Robert Peterson  <rpeterso@redhat.com>

	This is the fix for Bugzilla Bug 210344: group_tool does not handle short reads.

2006-10-20  Lon Hohberger  <lhh@redhat.com>

	Roll back patch to resrules.c

	Roll back patch to clusterfs.sh

	Fix 202637 - error reporting missing from some agents

	Compatibility fix for resource agents between linux-cluster and linux-ha

2006-10-20  David Teigland  <teigland@redhat.com>

	we weren't cleaning everything up for a client upon POLLUP

2006-10-20  Robert Peterson  <rpeterso@redhat.com>

	Fix for Bugzilla Bug 211405: If groupd segfaults, dump the most recent log information.

	This is the fix for Bugzilla Bug 210732: ccsd doesn't spot cluster going quorate.  The fix was written by Patrick Caulfield, but I tested it and it now works properly.  I'm doing the commit because Patrick is out today.

2006-10-18  Robert Peterson  <rpeterso@redhat.com>

	This is the fix for bugzilla bug 211337: must create core files for daemons on segfault.

2006-10-17  Wendy Cheng  <wcheng@redhat.com>

	Port RHEL4 GFS AIO (asynchronous IO) implementation into RHEL5/FC6 and community-version of GFS1.

2006-10-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Get notifications BEFORE getting state otherwise we have a race condition. probably fixes bz#210732

2006-10-16  Lon Hohberger  <lhh@redhat.com>

	Updated xenvm resource agent

2006-10-16  David Teigland  <teigland@redhat.com>

	Recent changes to mount scenarios (mounts while another node is doing first mount recovery) added a couple places where we need to clear the "save_plocks" flag to allow a new mount to begin processing plock requests.

2006-10-16  Patrick Caulfield  <pcaulfie@redhat.com>

	'while' should be an 'if'

2006-10-16  David Teigland  <teigland@redhat.com>

	typo, deleting "rs" instead of "re" when cleaning stuff up

	fix typo in debug message

	fix style badness

	A node that was just added would incorrectly conclude that the node after it needed to do first mounter recovery.

2006-10-16  Lon Hohberger  <lhh@redhat.com>

	Fix #209544 - umount failing on gfs/nfs services

2006-10-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Sigh, got the condition back-to-front. This should fix the AISONLY status (again).

2006-10-15  Wendy Cheng  <wcheng@redhat.com>

	Just found 2.6.18 kernel has something called down_read_non_onwer for rwsemaphore. If we can implement a similar function that does something like "up_write_if_owner", then we can put i_alloc_sem back to correct state. Correct the comment and mark this possibility.

	Bugzilla 203170 - direct IO deadlock: We'll have the same deadlock as described in bugzilla 173912 without RHEL4 kernel DIO_CLUSTER_LOCKING flag. To work around this issue, the i_alloc_sem is dropped from GFS. We expect glock will be able to handle the local synchronization.

2006-10-14  Robert Peterson  <rpeterso@redhat.com>

	This is the fix for bugzilla bug 210369: acls are not enabled after remount.  The problem was a combination of things, but mainly due to the gfs mount helper mount.gfs2 not passing the mount parameters on in the extras string during a remount. The mount helper was also incorrectly putting some messages into stdout.

2006-10-14  Benjamin Marzinski  <bmarzins@redhat.com>

	Make gnbd work with cman correctly. This sort of roughly falls under the heading of bz #210415

2006-10-14  Robert Peterson  <rpeterso@redhat.com>

	This is a fix for bugzilla bug 210300: Unknown mount option "users".  The gfs and gfs2 mount helper (/sbin/mount.gfs2) was aborting if it saw mount options that are not part of mount.h (i.e. internal to mount and vfs).  The fix is to add the missing options so the mount helper will recognize them properly.

2006-10-13  Chris Feist  <cfeist@redhat.com>

	We don't want to delete the scsi_reserve init script when doing a make clean.

2006-10-13  David Teigland  <teigland@redhat.com>

	Fix an effect of recovery mixed with joins where the node whose join event was interrupted by the recovery can sometimes not have its g->joining flag cleared which would cause a later unmount to hang.

	The corresponding changes to the gfs_controld changes in handling mixed mounts and recoveries and failed mounts.  We now tell gfs_controld when our mount has completed and the result using the same connection that we created when requesting the mount.

	Handling a lot of hard situations in the areas of: - recoveries mixed with mounts in lots of different ways - mount failures while lots of nodes are mounting in parallel
	(Part of this is also an update to mount.gfs, both gfs_controld and
	mount.gfs need to be updated together.)

2006-10-13  Robert Peterson  <rpeterso@redhat.com>

	This is the fix for bugzilla bug 210587: Oops in gfs_get_dentry via NFS.  The gfs file system, when called by NFS, was sometimes referencing the vestigial license file, causing the segfault.

2006-10-13  David Teigland  <teigland@redhat.com>

	replace spaces with tabs

2006-10-13  Ryan O'Hara  <rohara@redhat.com>

	Remove unnecessary chmod for scsi_reserve.

2006-10-13  Robert Peterson  <rpeterso@redhat.com>

	This fix is for bugzilla 210641: Race condition hang/failure between cman daemons and groupd.  Added a retry with timeout to group_init and all its callers.

2006-10-13  David Teigland  <teigland@redhat.com>

	If cpg_join or cpg_leave are stuck in a retry loop, put an error message in syslog after ten seconds.

2006-10-13  Robert Peterson  <rpeterso@redhat.com>

	This is for bugzilla 210162: fence_tool needs -w and -t options to wait for group membership.

2006-10-13  Lon Hohberger  <lhh@redhat.com>

	Ancillary patch to fix 202492 and actually add back groupmember attr, not just rgmanager (per-node) attr

2006-10-13  Ryan O'Hara  <rohara@redhat.com>

	Add code to create initdir if it doesn't exist.

2006-10-12  Chris Feist  <cfeist@redhat.com>

	Added changes to support installing init scripts w/ brew build.

2006-10-12  Ryan O'Hara  <rohara@redhat.com>

	Remove scsi_reseve from "all". This will be handled by the agent make target.

	Add scsi_reserve init script to Makefile so that it gets installed.

2006-10-12  David Teigland  <teigland@redhat.com>

	Handle the case where we're the second node being added to the group and the only other member fails.  We need to go ahead and process our join.

2006-10-12  Benjamin Marzinski  <bmarzins@redhat.com>

	Change the way gnbd notifies multipathd about device changes, to deal with the new udev.

2006-10-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Avoid spurious messages. and also fix an odd node count when nodes rejoin.

2006-10-10  Marek 'marx' Grac  <mgrac@redhat.com>

	Script for parsing Tomcat's conf/server.xml

	Bug #204784. Adding Tomcat resource agent

2006-10-09  David Teigland  <teigland@redhat.com>

	if we get a plock request from the kernel when plocks are disabled, return -ENOSYS for the request

	add -p option to completely disable plocks/ckpts

2006-10-09  Patrick Caulfield  <pcaulfie@redhat.com>

	If there are disallowed (AISONLY) nodes in the cluster, then name & shame them.

	Don't fence a node if it has already been fenced. bz#204633

2006-10-06  Lon Hohberger  <lhh@redhat.com>

	Fixed 202492, not 202497...

	Fix #202497

2006-10-06  David Teigland  <teigland@redhat.com>

	This is a big batch of code that gets us further along the path to handling recoveries mixed with joins (gfs mounts).  The test I've been using to work on this is inserting a BUG() at the start of gfs_lm_get_lock() on six of eight nodes and then mounting on all of them in parallel.  We should end up with the two nodes without the BUG properly mounted and the six with the BUG properly recovered.

	- check cpg flow control status from openais when processing plocks - handle case where we're mounting and the only other mounted node   fails -- we need to become the first mounter if we've not begun   mount(2) yet - journal recovery requests need to be fed serially to gfs, we weren't   doing that in the case where a gfs journal recovery was in progress   when another node failed

	make the number of clients a global variable so it will be easier to add clients later

2006-10-06  Chris Feist  <cfeist@redhat.com>

	Update building for xvm fence agent to build cleanly in brew.

2006-10-05  Lon Hohberger  <lhh@redhat.com>

	Fix #208115

	Add --enable_xen configuration option (off by default), and make sure -V flag works for fence_xvm[d]

2006-10-05  David Teigland  <teigland@redhat.com>

	don't configure gfs-kernel or gnbd-kernel now that they're not built by default

	update

	gfs-kernel (gfs1) and gnbd-kernel are going to track the RHEL5 kernel in cvs head.  We want the default top-level build of cvs head to work on upstream kernels, though, e.g. 2.6.19, for people who are trying out upstream gfs2/dlm.
	So, comment gfs-kernel and gnbd-kernel out of the top level makefile.
	Once we create a RHEL5 branch, we can uncomment them there (and
	perhaps remove gfs-kernel and gnbd-kernel from cvs head.)

2006-10-05  Lon Hohberger  <lhh@redhat.com>

	Implementation of client/server based Xen Virtual Machine (xvm) fencing. This allows fencing of a virtual machine from any other virtual machine in the cluster (regardless of the physical host) which shares the same private key, either based on UUID or Xen domain name.  Please see README and TODO before posting feature requests.

2006-10-05  Chris Feist  <cfeist@redhat.com>

	- Added in fixes to make gfs-kmod compatible with the RHEL5 kernel    - removed inode->i_blksize references    - Using i_private instead of u.generic_ip in the inode struct

2006-10-05  David Teigland  <teigland@redhat.com>

	updates

2006-10-05  Patrick Caulfield  <pcaulfie@redhat.com>

	A bit of a hack to cope with the race condition where dlm_controld gets the groupd callback before the cman one and tries to start a DLM lockspace before all the node addresses are known.
	I think this will fix bz#207197

	Add some extra semantics to CMAN to cope with openAIS rejoins. Basically, this adds an extra state to a node: AISONLY which is only cleared when cman receives a valid TRANSITION message from the node.
	A TRANSITION message is deemed to be invalid if the join_time of the node
	has not been changed (this is the timestamp the daemon was started) and
	the node has since been down and is rejoining. cman_tool will show if this
	is the case for a cluster by displaying the DisallowedNodes flag in the
	"cman_tool status command".

	If there are disallowed nodes in the cluster then the "cman_tool expected"
	command is disabled until those nodes have been removed.

2006-10-04  Robert Peterson  <rpeterso@redhat.com>

	Add -w option back to fence_tool join in cman init script.

	Add the "-w" (wait) and "-t" (timeout) parameters back in to fence_tool.

2006-10-04  Marek 'marx' Grac  <mgrac@redhat.com>

	This patch pushes generated configuration files for service in /etc/cluster/ (RA_COMMON_conf_dir) where each service (samba, openldap, ...) has it's own directory. In this directory is another directory with instances (OCF_RESOURCE_INSTANCE).
	Our generated configuration files are not re-generated when user changes them, that' reason why there are in /etc and not in /var.

2006-10-04  David Teigland  <teigland@redhat.com>

	set the "member" field in the group_data struct that's returned when querying for group information

2006-10-03  Lon Hohberger  <lhh@redhat.com>

	Fix #208577

2006-10-03  Ryan O'Hara  <rohara@redhat.com>

	Added gfs_security_init to initialize SELinux xattrs for newly created inodes.

2006-10-02  Ryan O'Hara  <rohara@redhat.com>

	Add GFS_EATYPE_SECURITY as valid xattr type and increment GFS_EATYPE_LAST. Without this gfs_fsck will complain (and remove) SELinux xattrs.

2006-10-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't even start up if the local host name resolves to 127.0.0.1

2006-09-29  Marek 'marx' Grac  <mgrac@redhat.com>

	Test if PID file of the application points to running PID. If not then this PID file is deleted and application can start.

	Some application needs time until they stop all theirs processes, so we have to wait a few moments until main/parent process is finished. This patch adds an option 'shutdown_wait' for each application's RA.

2006-09-28  Lon Hohberger  <lhh@redhat.com>

	Fix segfault due to missing param

2006-09-28  David Teigland  <teigland@redhat.com>

	put a message in syslog if we get a cpg error that we can't deal with

2006-09-28  Abhijith Das  <adas@redhat.com>

	memory violation

2006-09-27  Lon Hohberger  <lhh@redhat.com>

	Fix 202498

	Clean up build

	Apply patch from Fabio M. Di Nitto to fix clustat service name expansion bug

	Fix various bugs, incl. 208011, 203762

	Fix failed->disabled state transitions; #208011

2006-09-27  Marek 'marx' Grac  <mgrac@redhat.com>

	Add check if the instance of RA has parent (variable service_name)

	Adding Samba resource agent (tag <samba>). We already have resource agent for Samba but this is written in the same way as the other application's RA (mysql, apache, ...). Old-style RA stays available (tag <smb>) so it won't break backward compatibility.

	Adds new function (generate_name_for_pid_dir()). Minor update of messages texts.

2006-09-26  David Teigland  <teigland@redhat.com>

	Adding -vv to the groupd command line will result in a log_debug for every cpg send and every cpg recv.

	Add debugging in four areas to help us know more quickly when something might be wrong at the cpg level: - log if cpg flow control goes on - log when we're waiting to receive a cpg event for our own join - when we're in a FOO_STOP_WAIT or FOO_START_WAIT state, log how   many more cpg messages we're waiting to receive before moving on   to the next state - save the event id of the last cpg message we sent, and clear that   value when we receive that message back (this value is printed to   the debug log when someone runs group_tool, not shown in the   group_tool output)

2006-09-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Add struct entry for .flow_control to keep latest openais happy.

2006-09-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Cope with a node being fenced manually and then going offline (ie someone else fenced it).. Some further modifications to fenced can then prevent double-fencing with the following caveats:
	- the clocks on the nodes are reasonably in sync
	- the node goes down within two minutes of the fence message being received

	If there is any ambiguity then cman will mark the node as unfenced so that
	fenced can do the job anyway.

2006-09-21  Benjamin Marzinski  <bmarzins@redhat.com>

	Fix for bugzilla #207599. The individual gserv processes inherit the atexit callbacks from the main gnbd_serv process. One of those kills all the gserv processes. Now they don't do that.

2006-09-21  Lon Hohberger  <lhh@redhat.com>

	Apply resource-instance-name.patch

2006-09-20  David Teigland  <teigland@redhat.com>

	Get lm_interface.h from the kernel instead of keeping a duplicate copy here.  Requires recent upstream gfs2 change that moves lm_interface.h from fs/gfs2/ to include/linux/

2006-09-20  Robert Peterson  <rpeterso@redhat.com>

	Addendum to bz 200883.  If gfs2_fsck can't finish initialization, it was exiting but not fixing the lock protocol back for normal use.

	Addendum to bz 200883.  If gfs_fsck can't finish initialization, it was exiting but not fixing the lock protocol back for normal use.

	This is a crosswrite from gfs1 for bugzilla bz 200883: gfs_fsck segfaults on very large file systems.  The same problem existed and is now fixed in gfs2_fsck and libgfs2.

	This is the fix for bugzilla 200883: gfs_fsck segfaults. The problem was that gfs_fsck was running out of memory for in-core bitmaps when run on very large file systems. For example, 45T requires about 11GB of memory.  This fix doesn't allow it to run, this just exits gracefully, tells them why, and how much additional memory is needed.

2006-09-20  Marek 'marx' Grac  <mgrac@redhat.com>

	After upgrade to 'unified names for PID files' we can clean code a bit.

	Adds possibility to add command line options to MySQL RA. Names of variable in RA's metadata are changed to unify style.

	Adds possibility to add command line options to Apache RA. Names of variable in RA's metadata are changed to unify style.

	Bug #204058. Adding resource agent for PostgreSQL 8

2006-09-19  Jonathan Brassow  <jbrassow@redhat.com>

	lsnodes -> lsnode typo.

2006-09-18  Chris Feist  <cfeist@redhat.com>

	- Fix for bz #206325, ccs should not be started with the '-X' option & return   the socket file descriptor instead of '0' when returning from ccs_open.

2006-09-18  Marek 'marx' Grac  <mgrac@redhat.com>

	PID files are stored in common directory. Name of the PID file is generated from the OCF_RESOURCE_INSTANCE. Resource agents for Apache, MySQL and OpenLDAP are updated.

2006-09-15  David Teigland  <teigland@redhat.com>

	positive return code from recover_current_event() should just indicate that the event should be processed again, and not added to the return value of process_app() which causes the whole thing to be called in a loop

	have groupd set the scheduler to RR priority 2, same as gfs_controld

2006-09-14  David Teigland  <teigland@redhat.com>

	Fixes a really stupid bug checked in yesterday that causes groupd to seg fault due to referencing a pointer that's not been set yet.

	handle short/interrupted writes/reads

2006-09-14  Benjamin Marzinski  <bmarzins@redhat.com>

	file log.h was initially added on branch RHEL4.

	file log.c was initially added on branch RHEL4.

2006-09-14  Marek 'marx' Grac  <mgrac@redhat.com>

	typing error

	Simplifying scripts: The basic method of monitoring service is to check for PID file and test if we have such process. This function should be used by every RA for application.

2006-09-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Cope with short writes to the cman socket. bz#206093

2006-09-14  Marek 'marx' Grac  <mgrac@redhat.com>

	Bug #204060. Adding OpenLDAP resource agent

2006-09-13  David Teigland  <teigland@redhat.com>

	update per the gfs2 upstream changes to the lock module interface: - remove sync_lvb - remove lm_lock_t, lm_lockspace_t, lm_fsdata_t typedefs

2006-09-12  David Teigland  <teigland@redhat.com>

	Use the event_nr arg provided in start_done to check if the start_done callback should be ignored; were ignoring the event_nr.  The check of the current event state covered it, but ended up producing an unnecessary warning in syslog.

	undo junk mistakenly added by last commit

	remove stuff from dlm/nolock/harness since it all comes from upstream now

2006-09-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix strdup braindamage that probably caused segfaults when nodes left the cluster.
	This is likely to be the cause of bz#206083
	(thanks to Steven Dake for most of the diagnostics on this).

2006-09-09  David Teigland  <teigland@redhat.com>

	use same retry delay on cpg sends as gfs_controld, usleep(1000) between each retry

	- minor change to the delay we add between each cpg_mcast retry - set scheduler to RR priority 2 for gfs_controld

2006-09-07  David Teigland  <teigland@redhat.com>

	handle short or interrupted reads/writes, an snprintf instead of sprintf, strtoul instead of atoi, handle an ENOMEM

	no void arg in dlm_get_fd prototype was causing warnings

2006-09-06  James Parsons  <jparsons@redhat.com>

	Support for DRAC ERA

2006-09-01  Lon Hohberger  <lhh@redhat.com>

	2006-09-01 Lon Hohberger <lhh at redhat.com>         * include/resgroup.h: Add proto for rg_strerror         * include/vf.h: Add proto for vf_invalidate (flushes vf cache)         * src/clulib/rg_strings.c: Add rg_strerror function, define         human-readable strings for rgmanager error values         * src/clulib/vft.c: Add vf_invalidate (separate from vf_shutdown)         * src/daemons/groups.c: Fix obvious logic error         * src/daemons/main.c: Fix rg_doall() message during loss of quorum.         Invalidate local VF cache and kill resource configurations on         loss of quorum (#202497).  Send RG_EQUORUM back to clustat/clusvcadm         so that they report why they can't get information.  Don't queue         status checks if we've lost quorum.  Add command line parameter to         disable internal crash watchdog         * src/utils/clustat.c, clusvcadm.c: Handle SIGPIPE, and produce         useful errors if possible.

2006-09-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Rename 'private' to 'privdata' so it doesn't upset C++

2006-08-31  David Teigland  <teigland@redhat.com>

	convert write(2) calls to use do_write() which handles EINTR and short writes

	When deciding whether we need to unlink the checkpoint and resend journals for a failed master node we weren't distinguishing between the master failing (where we need to do this stuff) and the master just leaving (where we don't).

	tidy up a couple style things

	when we set a recovery event back to the FAIL_BEGIN state, make sure that we process the event once before processing any new messages.  this is probably a better fix for bz 202635 than I added previously where we accept messages more liberally i.e. in X_BEGIN states.

2006-08-31  Robert Peterson  <rpeterso@redhat.com>

	This is a fix for Bugzilla Bug 203916: groupd daemon segfault and mount hang when mounting five or more GFS file systems.

2006-08-31  David Teigland  <teigland@redhat.com>

	- break from snprintf loop when buffer is filled - handle some odd error cases like EINTR - handle short writes

2006-08-31  Ryan O'Hara  <rohara@redhat.com>

	ccsd is now fixed such that it will not daemonize until the socket is ready for communication. As a result, the sleep after starting ccsd is no longer needed.

	Moved code which signals parent (SIGTERM), which allows the parent process to continue and exit. This signal was occuring before ccsd had the sockets ready for communication, and as a result the cman init script would sometimes fail because the ccsd would daemonize before the socket was ready.
	This fix will not signal the parent until ccsd is ready (socket is created
	and ready; before select() loop).

2006-08-31  Marek 'marx' Grac  <mgrac@redhat.com>

	Minor changes.

	Bug #204057. Adding Apache resource agent and utility which parse httpd.conf.

	Bug #204054. Adding MySQL resource agents and utilities which will be common for other RA.

	Fix #203720. Do not run backup copies (ends with ~) of resource agents.

2006-08-30  Abhijith Das  <adas@redhat.com>

	fix for bz 190204. gfs2_jadd uses the gfs2meta filesystem to add journals to an existing gfs2 fs

2006-08-30  Ryan O'Hara  <rohara@redhat.com>

	Remove error handling for missing magma plugins.

2006-08-28  Chris Feist  <cfeist@redhat.com>

	Create symlinks for mount.gfs & umount.gfs.

	The gfs package should be installing the umount/mount.gfs links.

2006-08-26  Abhijith Das  <adas@redhat.com>

	fix for bz 203167 and bz 202984. stop_fence was commented out. Now we do stop_fence before doing a cman_tool leave.

2006-08-24  Patrick Caulfield  <pcaulfie@redhat.com>

	initialise confchg_callback

2006-08-22  Chris Feist  <cfeist@redhat.com>

	Don't force the owner to root (breaks rpm build).

	Added gfs_ondisk.h to allow builds outside of tree.

2006-08-22  David Teigland  <teigland@redhat.com>

	When we're in X_BEGIN state, accept "stopped" messages from other nodes.  This applies to bz 202635. (There may be a better way to address this, e.g. forcing a new FAIL_BEGIN event to be processed before processing any messages)

2006-08-21  Chris Feist  <cfeist@redhat.com>

	- Install the init script in the correct place. - Change includes for gfs_ondisk.h & gfs_ioctl.h.

	Copied gfs_ondisk.h from gfs-kernel to allow builds to succeed.

2006-08-21  David Teigland  <teigland@redhat.com>

	expand the number of cases where we don't tell gfs-kernel to do recovery because it won't be able to -- esp cases related to a mount in progress but not yet far enough for gfs to be able to do journal recovery

2006-08-21  Robert Peterson  <rpeterso@redhat.com>

	Get gfs_ondisk.h from local includes, not kernel includes.

2006-08-21  David Teigland  <teigland@redhat.com>

	- the check for us becoming the new low nodeid after the previous one   failed and unlinking the ckpt wasn't adequately checking for the old   low node having failed - rename low_finished_nodeid to master_nodeid and clarify some of the   code using this since it was confusing and misleading

2006-08-21  Lon Hohberger  <lhh@redhat.com>

	2006-08-21 Lon Hohberger <lhh at redhat.com>         * src/daemons/main.c: Fix #202500 - simultaneous starts confuse         rgmanager.  This happened due to the fact that rgmanager was not         correctly determining port listening status of other nodes on the         first pass, and subsequent attempts to determine status of other 	nodes were not tried.

2006-08-18  Lon Hohberger  <lhh@redhat.com>

	Fix 200776 - mixed up default log level constants

2006-08-18  David Teigland  <teigland@redhat.com>

	when the low nodeid fails, the checkpoint needs to be unlinked, otherwise creating the ckpt will fail down the road when another node mounts

2006-08-18  Lon Hohberger  <lhh@redhat.com>

	2006-08-18 Lon Hohberger <lhh at redhat.com> 	* include/resgroup.h: Change ordering and add magic field to 	rgmanager state field (warning: breaks compatibility from 08/08 CVS!) 	* src/clulib/ckpt_state.c, src/daemons/rg_state.c: Fix bug 	preventing correct operation of ckpt operation after initial boot. 	Get rid of debug info. 	* src/daemons/groups,c, main.c: Fix #202499 - shutdown while handling 	transitions sometimes allows services to restart (due to not locking 	RGs locally) 	* src/resources/clusterfs.sh, fs.sh, nfsclient.sh: Add proper 	warning messages if status check fails 	* src/resources/ra-api-1-modified.dtd: Allow 'migrate' option

2006-08-17  David Teigland  <teigland@redhat.com>

	change debug messages related to storing/retrieving plocks to/from checkpoints to see more details about the ckpt

2006-08-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix a bug in the demo prog. no point in setting a bad example (again)

	Add a confchg callback to libcman, similar to the openAIS ones. this gives a race-free notification of cluster change deltas and will probably simplify client code hugely. (or it would if most of it hadn't already been written!)

2006-08-16  David Teigland  <teigland@redhat.com>

	after unlinking a ckpt, don't try to close it if we don't have it open, (no big problem, the close would just fail) and go back to syslogging ckpt close errors

2006-08-16  James Parsons  <jparsons@redhat.com>

	Ignore unused args to stdin

2006-08-16  David Teigland  <teigland@redhat.com>

	don't barf on unknown option arg

2006-08-16  James Parsons  <jparsons@redhat.com>

	ignored unused args from stdin

2006-08-16  David Teigland  <teigland@redhat.com>

	change log_plock() to log_group() for packing/unpacking plocks in checkpoint

2006-08-16  Robert Peterson  <rpeterso@redhat.com>

	Fixed segfault in gfs_controld.

2006-08-15  David Teigland  <teigland@redhat.com>

	errors opening sysfs files are normal/expected in many cases, so don't complain in syslog about it

	don't barf on extra args

	don't barf on unused args

	daemons that depend on groupd (fenced, dlm_controld, gfs_controld) should log and error and exit if groupd dies

2006-08-15  Patrick Caulfield  <pcaulfie@redhat.com>

	"group" should be "amf"

	At startup, check that ALL nodes in CCS have nodeids assigned. If not, then refuse to start.

2006-08-14  David Teigland  <teigland@redhat.com>

	Code that starts groups in order of level during recovery wasn't working right in the case where a node fails while mounting, i.e. node fails after it's joined the level2 mountgroup but before it joins the level1 lockspace.  Code now checks that all lower levels are recovered instead of just checking that level-1 is recovered.

	remove a couple log_error's

	show all options in help output

	There's been a relatively unusual problem explained in the comments that I'd been putting off fixing for lack of a nice solution.  Turns out this problem could crop up more often than hoped, so have had to fix it.
	1) mount.gfs asks gfs_controld to join mount group
	2) gfs_controld does and notifies mount.gfs to go ahead with mount(2)
	3) gfs_controld gets a stop callback for the group due to another node
	   mounting
	4) gfs_controld needs to wait for the kernel mount to complete before it
	   can stop/suspend the mount group (through sysfs)
	5) mount(2) fails in the kernel for whatever reason
	6) mount.gfs tells gfs_controld the kernel mount failed

	gfs_controld is waiting for the kernel mount to complete outside its
	normal poll loop, though, so it won't ever get the message in step 6, and
	will wait forever for the failed mount to actually complete.

	Added a pipe between mount.gfs and gfs_controld that mount.gfs just uses
	to send a failed mount message.  gfs_controld watches the pipe for this
	error message while waiting for the kernel mount.  mount.gfs uses unix
	socket ancilliary data to send an fd to gfs_controld.

2006-08-14  Robert Peterson  <rpeterso@redhat.com>

	Fixed segfault converting bitmaps during inode conversion.

2006-08-12  Robert Peterson  <rpeterso@redhat.com>

	Reset other inode bits when temporarily setting S_IFDIR bit.

2006-08-11  David Teigland  <teigland@redhat.com>

	report mount failure debug message earlier

2006-08-11  Robert Peterson  <rpeterso@redhat.com>

	This change is for Makefile reform allowing a simple "make" command to recompile the entire cluster suite:
	1. All Makefiles have been changed to get rid of references
	   to "copytobin" and the bin directory.  This will
	   eliminate discrepancies between "bin" versions and
	   installed versions of the programs.
	2. The cman and group configure files have been modified
	   to allow linking properly to /usr/lib64 on x86_64
	   systems without specifying libdir.
	3. Fixed several problems relating to "make install"
	   not recompiling modified code.
	4. Fixed some dependency problems with gfs and gfs2 tools
	   that linked against libgfs and libgfs2 respectively.
	5. All Makefiles have been updated to use "make -C <dir>"
	   rather than "cd <dir> ; make" so that compile errors
	   won't charge ahead without stopping you.
	6. Deleted references to obsolete iddev library.
	7. Got rid of more "linux" symlinks for includes.
	8. Misc minor Makefile cleanup.

2006-08-11  Lon Hohberger  <lhh@redhat.com>

	Apply Navid's patch to -head

2006-08-11  Robert Peterson  <rpeterso@redhat.com>

	Get rid of symlink "linux" for referencing includes and use the correct lm_interface.h.

2006-08-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Create a pipe between cman_tool and the cman daemon so that it can communicate back any failures that occur during initialisation.
	This should help debug any problems people have with cman appearing
	to die straight after startup.

	Set a good example by checking return values.

	We don't really need to include signal.h twice :)

2006-08-10  Robert Peterson  <rpeterso@redhat.com>

	Make block_list use a consistent set of values rather than enum values in one place and #defines in another, and trying to keep them in sync.

	Fix include gfs_ondisk.h to be located in gfs kernel source rather than in the kernel includes.

	Fix minor compile problem due to missing include.

2006-08-10  David Teigland  <teigland@redhat.com>

	log_debug() when we receive a withdraw message

2006-08-10  Robert Peterson  <rpeterso@redhat.com>

	Mounting was mistakenly allowed with too few journals.

2006-08-09  Lon Hohberger  <lhh@redhat.com>

	Fix relocation & transition handling

2006-08-09  Robert Peterson  <rpeterso@redhat.com>

	Fix compile error with vmalloc.

	Hex values were not shown or printed correctly on x86_64.

2006-08-09  David Teigland  <teigland@redhat.com>

	don't send plock debugging to stdout with -D, use -P to get that now

2006-08-09  James Parsons  <jparsons@redhat.com>

	addresses bz193065

	Removed BULL refs from man page

2006-08-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Some systems need #include <signal.h> and who are we to deny them ?

2006-08-08  David Teigland  <teigland@redhat.com>

	The idea to have the last node that did the checkpoint try to reuse it even if it wasn't the low nodeid any more doesn't work because the new mounter tries to read the ckpt when it gets the journals message from the low nodeid before the ckpt is written from the other node.  Now, the low nodeid is always the one to create a ckpt for a new mounter which means a node saving the last ckpt needs to unlink it when it sees a new low nodeid join the group.

2006-08-08  Benjamin Marzinski  <bmarzins@redhat.com>

	setting multiple locations for gnbd_get_uid to check for scsi_id, and updating the man page. Patches from Fabio

	pull devfs stuff out of gnbd.

2006-08-08  David Teigland  <teigland@redhat.com>

	if a node has a saved ckpt when it unmounts, it needs to unlink it so another node can create a new ckpt for the next mounter

	use the correct (global) handle when unlinking a checkpoint

2006-08-08  Lon Hohberger  <lhh@redhat.com>

	Fix parameter ordering for calling cman_send_data_unlocked

	        * src/clulib/ckpt_state.c: Preliminary implementation of replacement         for VF using AIS CKPT B.02.01 (w/ built-in test program)         * include/cman-private.h: Clean up APIs (cman APIs return         cman_handle_t, which is void*, should be using void ** all over)         * include/message.h: Bump context count to 128, add destination         node ID in header of packets.         * src/clulib/alloc.c: If we alloc the same size, return the same         block         * src/clulib/cman.c: API cleanups         * src/clulib/message.c: Add error checking to msg_print         * src/clulib/msg_cluster.c: Check destination in header before         processing message remove dup #define for MAX_CONTEXTS, add         proto_error() macro for displaying protocol errors.  Use 'max'         instead of 'fd' for select().  Use correct var when assigning         contexts.  Fix CMAN handles.  Return correct size from msg_send()         requests.         * src/clulib/msgtest.c: Fix CMAN handles         * src/clulib/vft.c: Don't handle VF_CURRENT inside comms thread         * src/daemons/main.c: Check to see if nodes are listening on our         port before we consider them running.  Handle VF_CURRENT requests         from other nodes.  Fail if we can't determine local node ID         * src/daemons/rg_forward.c: Give 10 minutes for responses to         forwarded requests.         * src/daemons/rg_state.c: Shorten RG state names.  Fix 'Uncertain'         output line.         * src/utils/clustat.c: Fix ccs_member_list() function.

2006-08-07  David Teigland  <teigland@redhat.com>

	free all plock state for an fs when it's unmounted

	update lm_interface.h from version in git tree

2006-08-04  David Teigland  <teigland@redhat.com>

	Some basic stuff that I hadn't realized I'd not done back when first writing this: - purge plocks of failed nodes - implement get - write results back to processes waiting in the kernel

	bring lm_interface.h in sync with the version in gfs2

2006-08-04  Abhijith Das  <adas@redhat.com>

	Continuing work on bz 195591. awk matching string for gfs and gfs2 was not right. Was causing the init scripts to go into a loop when both gfs and gfs2 fs were mounted

2006-08-04  Chris Feist  <cfeist@redhat.com>

	Reverted changes to fix 64 bit arch building.

2006-08-03  Robert Peterson  <rpeterso@redhat.com>

	Got rid of iddev references.

	The gfs2 userland tools weren't compiling when cluster configure was used because the gfs2kincdir was being overridden.

2006-08-02  David Teigland  <teigland@redhat.com>

	- complain and ignore checkpoint sections with a bad size - do checkpoint for new nodes if low node in charge of that failed

	before freeing a group struct, sanity check it's not referenced in any recovery sets

	do byte-swapping

	- checkpoint usage for plocks is getting closer, basic writing/reading   of plock state to/from ckpt's works, but unlinking ckpt's and clearing   open ckpt's from processes that exit don't appear to be working right   in openais

2006-08-02  Lon Hohberger  <lhh@redhat.com>

	fix 200449 - status checks wrong

2006-08-02  Robert Peterson  <rpeterso@redhat.com>

	This is a fix for bugzilla bz 164499 (Unable to mount loopback images from mounted GFS partition).  The previous fix had a problem where any writes to files in the file system would cause the problem to reappear.  For more details see: https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=164499

	Fix compilation problems on x86_64 (link against /usr/lib or /usr/lib64 depending on archetecture).

2006-08-02  Patrick Caulfield  <pcaulfie@redhat.com>

	if we can't get the latest config from CCS, poll it until we do.

2006-08-02  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 199984: Increasing gt_statfs_slots tunable could significantly boost gfs "df" performance; e.g. set it to 128 from current default (64) could cut the "df" wall time in half with larger filesystem size. However, the kmalloc call within stat_gfs_async() has the possibility to fail due to increased gt_statfs_slots. There is really no need for this array to be on a piece of contiguous memory. Switch to vmalloc().

2006-08-01  Robert Peterson  <rpeterso@redhat.com>

	Add useradd for ais user, added instructions for gfs (1).

2006-07-31  David Teigland  <teigland@redhat.com>

	'group_tool dump plocks <fsname>' can now be used to display all plocks held in the fs

	- use nodeid and owner when checking the owner of a plock instead of   just pid - this requires the recent addition of an owner field to the struct   in the lock_dlm_plock.h kernel header - add ability to dump all the plocks to a client (group_tool) to display - add new code that uses the SA CKPT service to synchronize all the   plock state for the group to a new node that joins the group, this is   currently disabled until it's been tested and debugged

2006-07-28  Robert Peterson  <rpeterso@redhat.com>

	OpenAIS builds for /usr/lib64/openais on x86_64 machines. We need to link against what it uses.

2006-07-28  David Teigland  <teigland@redhat.com>

	Update the cman member list every time we call is_member().  When called from the fence delay loop, we're not processing callbacks so our member list won't be updated as a result of a cman callback.

2006-07-28  Robert Peterson  <rpeterso@redhat.com>

	1. Allow SIGINT signals so that gdb can break into hung mounts. 2. Remove multiple trailing slashes for directory and mount point. 3. Accept the -f option on umount that's sent to us during shutdown.

2006-07-27  Ryan O'Hara  <rohara@redhat.com>

	Early version of a script to help users determine if a logical volume might be in use by another node. Useful to avoid doing a mkfs or fsck on a mounted filesystem.

2006-07-25  Robert Peterson  <rpeterso@redhat.com>

	Switch was specified incorrectly for apc power switch.

2006-07-25  David Teigland  <teigland@redhat.com>

	'group_tool dump fence' will dump fenced's debug buffer

	keep 1MB circular buffer of debug messages that can be sent to a connected client

	From: fabbione@ubuntu.com
	This one was a nasty bug that was causing several issues.

	For example:

	mount -t gfs /dev/foo /mnt -> ok
	mount -t gfs /dev/foo /mnt/ -> nok failing with:
	can't find /proc/mounts entry for directory /mnt/

	(caused by read_proc_mounts in util.c when comparing with /proc/mounts
	that does not reference the trailing /).

	Other bugs are also fixed by making mo->dir consistent.

	mount -t gfs /dev/foo /mnt -> ok
	umount /mnt/ -> nok:
	/sbin/umount.gfs: lock_dlm_leave: gfs_controld leave error: -1

	because the mo->dir is also registered in lock_dlm daemon.

	This was causing a severe inconsistence that was blocking
	mounting/umounting
	or other volumes/devices.

2006-07-24  Ryan O'Hara  <rohara@redhat.com>

	Fixed typo. "ccstool" should be "ccs_tool".

2006-07-24  David Teigland  <teigland@redhat.com>

	remove duplicate \n from a couple log_debug/log_error

	have gfs2/Makefile install/uninstall mount and umount binaries itself rather than going through copytobin and having bin/Makefile install them (plan to remove copytobin from other dirs too)

2006-07-21  Robert Peterson  <rpeterso@redhat.com>

	Moved cman_tool from /sbin to /usr/sbin

2006-07-21  Lon Hohberger  <lhh@redhat.com>

	Add man pages for qdisk

2006-07-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Update to use new openAIS totemip & totempg APIs. Needs the Openais that's probably going to be released later today ;-)

2006-07-21  Abhijith Das  <adas@redhat.com>

	gfs2 doesn't allow gfs2meta and gfs2 filesystems to run parallely. gfs2_jadd umounts gfs2 and mounts gfs2meta to do its thing. Removed test mode. little-endian to big-endian change on disk-hash.

2006-07-20  Robert Peterson  <rpeterso@redhat.com>

	Service stop was killing daemons, which hung system at umount time. Also, service status would hang when cluster was down.

2006-07-20  David Teigland  <teigland@redhat.com>

	if mount.gfs is unmounting/leaving the group because the kernel mount failed, then don't wait for the kernel mount to complete before doing the leave

	when a kernel mount fails and we leave the mountgroup, we need to pass an error value with the unmount/leave so gfs_controld will know to not wait for the kernel mount to complete before doing the leave

	use cmanincdir when building gnbd

	uncomment bullpap and ipmilan add copytobin for rsa & rsb (we should probably add explanation for why certain agents are commented out)

2006-07-19  David Teigland  <teigland@redhat.com>

	needed _safe version of list_for_each_entry when moving entries

2006-07-19  Lon Hohberger  <lhh@redhat.com>

	Fix typo in Makefile

	Add preliminary live-migration support (e.g. for Xen for FC6

2006-07-19  David Teigland  <teigland@redhat.com>

	some trailing )'s were left out

	set cmanlibdir for group

	do distclean

	do distclean in group/

	Use system includes instead of including from configured kernel_src. (People building the tree on old distros may need to copy some headers into /usr/include/linux/)

2006-07-19  Robert Peterson  <rpeterso@redhat.com>

	Patch from Fabio Di Nitto: Make sure to clean up *.d files and remove gfs_fsck binary in make clean.

	Remove iddev from configure script.

2006-07-19  Patrick Caulfield  <pcaulfie@redhat.com>

	for RRP use "active" rather than "passive" on Steve's advice.

2006-07-18  Robert Peterson  <rpeterso@redhat.com>

	Rename req_lock to gfs_req_lock to avoid duplicate symbols.

	Add /proc/fs/gfs support back in.

	Accomodate changes Steve Whitehouse made to gfs2's dinode structure.

2006-07-17  Ryan O'Hara  <rohara@redhat.com>

	Added support for SELinux extended attribute types.

2006-07-17  David Teigland  <teigland@redhat.com>

	fix up debug logging

2006-07-17  Ryan O'Hara  <rohara@redhat.com>

	Remove extra argument from log_debug call.

2006-07-14  David Teigland  <teigland@redhat.com>

	node A may get a start cb and send a started message, and node B may receive the started message before it gets its own start cb; node B shouldn't ignore the started message from A.

2006-07-14  Robert Peterson  <rpeterso@redhat.com>

	Fix divide by zero because superblock constants were not correctly set.

	Split read_sb into read_sb and compute_constants like libgfs2. That enables programs that do not read the superblock (like mkfs) to get the constants they need.

2006-07-14  David Teigland  <teigland@redhat.com>

	add option to dump debug messages from gfs_controld using 'group_tool dump gfs', 'group_tool dump' still dumps debug messages from groupd.

	keep a 1MB circular buffer of debug messages, they can be dumped out by running 'group_tool dump gfs'

2006-07-14  Robert Peterson  <rpeterso@redhat.com>

	This is a bug fix for bz 164499.  It allows loopback-mounted files within a gfs file system.

2006-07-14  David Teigland  <teigland@redhat.com>

	remove duplicate line

	add libgfs

2006-07-14  Robert Peterson  <rpeterso@redhat.com>

	A printf to stdout was getting redirected to the daemon's socket causing the daemon to log strange errors and mount hangs.

2006-07-13  David Teigland  <teigland@redhat.com>

	- memset to 0 arrays of arg pointers - tighten up the splitting of strings into arg arrays - reduce the size of the arg pointer arrays since we now know the max number of args we're splitting out

2006-07-13  Robert Peterson  <rpeterso@redhat.com>

	Remove gulm, dlm and nolock from Makefile.  gfs1 will now use the dlm and nolock from gfs2.  The gulm locking protocol is going away.

2006-07-13  David Teigland  <teigland@redhat.com>

	debug print of the full uevent string from the kernel

	fix dump len so we don't complain

	fix up group_tool dump which was broken

	no more dlm_device module

2006-07-13  Ryan O'Hara  <rohara@redhat.com>

	Moved from fence/scripts directory.

	Move scsi_reserve init script to fencing agent directory.

2006-07-12  Ryan O'Hara  <rohara@redhat.com>

	fence_scsi agent should use "self" rather than try to determine node node.

2006-07-12  Stanko Kupcevic  <kupcevic@redhat.com>

	"clumon moved under Conga project" message

2006-07-12  Lon Hohberger  <lhh@redhat.com>

	*** empty log message ***

2006-07-12  Ryan O'Hara  <rohara@redhat.com>

	Added success and failure commands in start/stop.
	scsi_reserve start - success if we can register with a device.
	scsi_reserve stop  - success if wa can unregister with a device.

	Note that we always try to create a reservation for a device in start,
	but we do not care about success/failure. If it fails, it is probably
	because a reservation already exists.

2006-07-12  Lon Hohberger  <lhh@redhat.com>

	Fix licensing information in resources

	Add missing xenvm.sh resource

	Fix #198406 - lack of ipv6 support in clufindhostname.c

	Patch for in-tree builds from Fabio M. Di Nitto. <fabbione at ubuntu.com>

	Fix missing/non-updated #includes

2006-07-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't lose the end of a lock name

2006-07-12  Lon Hohberger  <lhh@redhat.com>

	- Make rgmanager actually do things. - Finish port of rgmanager to CMAN messaging. - Add feature to wait for nodes to be fenced prior to handling a node-down event. - Add direct DLM lock support. - Fix local communication. - Optimize VF data distribution algorithm to use CMAN/Totem's broadcast mode; this should make rgmanager much more scalable. - Add multiplexing for CMAN communications so threads can have pseudo private channels over the One CMAN socket. - Add service->service dependencies based on service events. - Add node ID display to clustat text-mode output.

2006-07-11  Robert Peterson  <rpeterso@redhat.com>

	Changes necessary due to removal of iddev parts (replaced by libvolume_id)

	Reverse previous decision on locking.c.  Removed unwanted sysfs groups.  Removed some debug code.

2006-07-11  Ryan O'Hara  <rohara@redhat.com>

	Updated copywrite and fixed title.

2006-07-11  Robert Peterson  <rpeterso@redhat.com>

	Re-add locking.c with its redundant gfs_mount_lockproto and gfs_unmount_lockproto routines because calling the gfs2 equivalents (and the externalizing of them) would probably not be acceptable to the upstream community.

2006-07-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't copy the agent name if it's NULL. Make the requred size of the agent string clear.

2006-07-11  Robert Peterson  <rpeterso@redhat.com>

	Changes necessary due to removal of iddev parts (replaced by libvolume_id)

	Changes necessary due to removal of iddev parts (replaced by libvolume_id) Also incorporated libgfs for common functions.

	Changes necessary due to removal of iddev parts (replaced by libvolume_id). Also incorporated libgfs for common functions.

	New ncurses-based gfs_edit synced from RHEL4 and STABLE branches.

	Change gfs to work with new locking infrastructure. Also, changes crosswritten from STABLE, and removed undesired debug code.

2006-07-11  Abhijith Das  <adas@redhat.com>

	Removed reference to lock_gulm from the script. Works fine as is.

	Initial commit of gfs2_jadd. Doesn't work fully. Needs to be tested with GFS2 filesystem.

2006-07-11  Ryan O'Hara  <rohara@redhat.com>

	Initial version of the fence_scsi man page.

2006-07-11  Abhijith Das  <adas@redhat.com>

	gfs2 init script. Minor changes. Works just fine

2006-07-10  Ryan O'Hara  <rohara@redhat.com>

	Name of node to be fenced is passed via "nodename=" parameter.

2006-07-10  Chris Feist  <cfeist@redhat.com>

	Added -lpthread to LDFLAGS to fix bz #198187 (Unresolved symbols w/ ldd -r)

2006-07-10  Ryan O'Hara  <rohara@redhat.com>

	Added "self" parameter to dispatch_fence_agent. Added "-s" option as way to pass name of current node.
	This is needed for SCSI persistent reservation (fence_scsi).

	Added "self" parament to dispatch_fence_agent.
	Needed for SCSI persistent reservation (fence_scsi).

	Added "self" parameter as a way to pass our_name to the agent.
	This is needed for SCSI persistent reservation (fence_scsi).

2006-07-10  David Teigland  <teigland@redhat.com>

	set DESTDIR when installing openais

2006-07-07  David Teigland  <teigland@redhat.com>

	dispatch_fence_agent() was prototyped and called with an extra arg that doesn't exist in the real function

2006-07-07  Chris Feist  <cfeist@redhat.com>

	Fixed building for x86_64.

	Makefile fixes to assist with rpm building.

2006-07-07  David Teigland  <teigland@redhat.com>

	complain and ignore a cpg confchg reason we don't understand

2006-07-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Make sure we ${libexecdir}/lcrso - packagers need it.

	Make SBINDIR default to /usr/sbin so we can find aisexec

2006-07-06  Ryan O'Hara  <rohara@redhat.com>

	Fix stdin parameter parsing to handle 'name=value' correctly.

	Added extra output when verbose option is given. Fixed code to close stdin, stdout, stderr after open3 call.

	Added parameters for chkconfig.
	Script will be started for levels 3, 4, and 5.
	Start priority is 25.
	Stop priority is 75.

2006-07-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't force unwanted flags on people. honour DEBUG=y

	Count votes correctly - buy not shadowing variables, sigh. Also fail to start if the nodeid is not set.

	gah! forgot to remove the /cman off the end of SBINDIR

	Run aisexec from SBINDIR

2006-06-30  David Teigland  <teigland@redhat.com>

	put back old check that previous commit avoided

	steps to download/build/install openais and libvolume_id tarballs

	build against installed cman lib and header

	build against installed headers and libs for cman and openais

	to be consistent, <libcman.h> instead of "libcman.h"

	- build against installed openais/cman headers and libs - if a cman node fails that isn't in the groupd cpg, don't wait   on a cpg update for it

	gfs_controld_connect error values are < 0, not 0

2006-06-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Build using installed openais

2006-06-30  James Parsons  <jparsons@redhat.com>

	remove this file in preference for the version with filetype extension, like other agents. The Makefile generates the version for the sbin dir without extension.

2006-06-29  James Parsons  <jparsons@redhat.com>

	Added new fence_scsi agent support

	Added support for new fence_scsi agent

	Makefile and cool new scsi agent renamed to match convention.

2006-06-29  Ryan O'Hara  <rohara@redhat.com>

	Fix perl cmd declaration that caused sg_persist to fail.

2006-06-29  Abhijith Das  <adas@redhat.com>

	modprobing lock_dlm before starting gfs_controld, removed init.d make targets for ccs and fence

2006-06-29  Ryan O'Hara  <rohara@redhat.com>

	Initial check-in of SCSI persistent reservation init script.

	Initial check-in of SCSI persistent reservation fence agent.

2006-06-29  David Teigland  <teigland@redhat.com>

	- extra checking and debugging when events get backlogged - prevent joins while we're still leaving and leaves while   we're still joining

2006-06-28  Abhijith Das  <adas@redhat.com>

	Removed ccsd and fenced init scripts. Their functionality is replaced by the cman init script

	Single init script to start up cluster: Covers loading of modules, starting ccsd, cman and fencing, and starting daemons. Replaces ccsd, cman and fenced init scripts

2006-06-28  David Teigland  <teigland@redhat.com>

	fix compiler warnings

	fix makefile From: fabbione@ubuntu.com (Fabio M. Di Nitto)

	Fix install From: fabbione@ubuntu.com (Fabio M. Di Nitto)

2006-06-28  Jonathan Brassow  <jbrassow@redhat.com>

	- cmirror is not ready to compile in HEAD

2006-06-28  Robert Peterson  <rpeterso@redhat.com>

	Include man pages for convert, fsck, etc., in Makefile.

	Clean up .d files on Make clean rather than distclean

2006-06-27  Robert Peterson  <rpeterso@redhat.com>

	Switch to libvolume_id method of determining pre-existing file systems.

2006-06-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix build error. Thanks Lon.

2006-06-26  David Teigland  <teigland@redhat.com>

	posix_test_lock() args updated for 2.6.17

2006-06-26  Jonathan Brassow  <jbrassow@redhat.com>

	- filling out client side logging implementation (patches sent previously)
	Work remaining:
	1) client (kernel) side netlink implementation
	2) server implementation

2006-06-26  Benjamin Marzinski  <bmarzins@redhat.com>

	fixing dm-multipath support for GNBD

	libsysfs is deprecated. Stop using it.

2006-06-23  Lon Hohberger  <lhh@redhat.com>

	Fix includes for build on ia64

	Implements 'label' support for qdisk.  Uses /proc/partitions for device info & scans devices for signatures.  Useful in environments where a device is present but maybe numbered differently on different nodes depending on the host/SAN configuration.
	Also adds initialization utility which must be run before qdiskd will
	use a given partition.

2006-06-23  David Teigland  <teigland@redhat.com>

	retry cpg_join and cpg_leave if error is TRY_AGAIN

2006-06-22  David Teigland  <teigland@redhat.com>

	don't process new join/leave events without quorum

	remove debug printf

	now that we copy out app member list for viewing, set the member count to that total instead of cpg member list total

	improvements to debug messages

2006-06-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Update to OpenAIS with patch for CPG alignment bug

2006-06-21  David Teigland  <teigland@redhat.com>

	add standard script

	need to include ../make/defines.mk to get {sbindir} definition this added -Wall which I didn't notice was missing before, so this uncovered a bunch of warnings that are now fixed

	Don't finalize/terminate a local group leave until we see that all remaining group members have stopped.

2006-06-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Pull latest openAIS

2006-06-21  Jonathan Brassow  <jbrassow@redhat.com>

	- This is the beginning of the cluster mirror log rewrite.  The   purpose is to work with the new CMAN/OpenAIS framework.  The   server moves to user-space.
	Will post description and RFC to cluster-devel.

2006-06-20  David Teigland  <teigland@redhat.com>

	openlog("groupd", LOG_PID, LOG_DAEMON) for syslog entries

	- sort out which messages should be log_debug/log_group vs   log_print/log_error - put log_print/log_error messages in syslog

2006-06-20  Robert Peterson  <rpeterso@redhat.com>

	Fixed bugs regarding acls and eattrs.  Also crosswrote some fixes from gfs1 regarding eattrs.

2006-06-20  David Teigland  <teigland@redhat.com>

	don't skip fencing a node unless it's both a cman member and has fully started groupd

	- keep cman member list updated by using cman callbacks instead   of polling cman for the latest list every time we're interested - only bypass fencing of a node if it's both a cman member and   in the groupd cpg (has started groupd past the point of checking   for residual gfs/dlm state)

	Moving the cluster infrastructure to userland introduced a new problem that we didn't need to worry about before.  All cluster state now exists in userland processes which can go away and then come back like new, i.e. unaware of the previous state.
	Typically, when the userland cluster infrastructure on a node
	"disappears", another node recognizes this as a node failure and recovers.
	There's no problem there.  The problem is when the cluster infrastructure
	disappears on all the cluster nodes and then comes back.  The
	infrastructure that disappeared may have abandoned control of gfs/dlm
	instances in the kernel.  When the infrastructure comes back, it's like a
	brand new cluster, it knows nothing about the residual, uncontrolled
	instances of gfs/dlm.  New nodes would use gfs/dlm in this new cluster
	independently of the unknown gfs/dlm users from before and there'd be
	immediate corruption [1].

	Eventually, the infrastructure may be able to reconstruct the global state
	of abandoned instances of gfs/dlm when it comes back and reassert control
	of them, but that's not realistic any time soon.  For now, the
	infrastructure needs to recognize nodes with residual gfs/dlm state as
	failed nodes that need recovery (starting with fencing).  That recognition
	and recovery now happens as part of the startup initialization, before new
	instances of gfs/dlm are created [2].

	[1] This is trivial to demonstrate:
	- start up a cluster on nodes A,B,C
	- mount gfs on nodes A,B
	- run 'cman_tool leave force' on A,B,C
	- start up the cluster again on A,B,C
	- mount gfs on node C
	- nodes A,B are now using gfs independently of node C

	[2] The previous example now works like this:
	- start up a cluster on nodes A,B,C
	- mount gfs on nodes A,B
	- run 'cman_tool leave force' on A,B,C
	- start up the cluster again on A,B,C
	  i)  when groupd starts on A,B, it recognizes the uncontrolled instance
	      of gfs, kills cman locally and fences the local node [3]
	  ii) when C runs fence_tool join, a new fence domain is started which
	      fences nodes with an unknown state, which are A and B
	- mount gfs on node C

	[3] This self-fencing does nothing for node C which still needs to fence
	both A and B itself.  If A fences itself before C fences it, A will be
	fenced twice.  This self-fencing step is optional, but it can be
	convenient when 1) all the nodes restarting the infrastructure find
	residual gfs/dlm instances and 2) reboot fencing is used.  The anticipated
	situation is one where everyone has residual state so no one can start up
	to fence anyone else; all are stuck.  But, they all fence themselves,
	reboot and resolve everything.

	There's a different approach we could take that would be more convenient
	when not all cluster nodes are likely to be mounting gfs or SAN fencing is
	used.  In this case, a node that finds residual gfs/dlm instances would
	remain a cman member and not fence itself.  This would contribute quorum
	to help another node without residual state start up and fence it.

	The solution to this confusing situation is simple:
	- groupd now checks for residual gfs/dlm kernel state when it starts up
	  and if it finds any it kills cman and exec's fence_node <myname>.
	- fenced can't bypass fencing of a node unless the node is both a cman
	  member and has fully started groupd (a node may need fencing if it's
	  joined the cluster but groupd isn't starting).
	- the same consideration in fence_manual as fenced

2006-06-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Make it clear that admin sockets can't receive callbacks either.

2006-06-19  Robert Peterson  <rpeterso@redhat.com>

	Fixed problems printing stuffed directories like master and jindex. Also enhanced the jump 'j' command capabilities to jump based on highlighted directory entries.  Also made it remember display mode and highlighted entry when jumping from structure to structure.

	Converted file systems had no journals.

	Changes to lock protocol were not saved.  Also removed some vestigial stubs from libgfs2.h.

2006-06-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Add missing include.

2006-06-17  Wendy Cheng  <wcheng@redhat.com>

	Sync with base kernel data structure changes:      1. i_sem (in struct inode) is replaced by i_mutex.      2. s_old_blocksize (in struct super_block) no longer exists.
	Thank to Mathieu Avila <mathieu.avila@seanodes.com> pointed this out.

2006-06-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Add include so we get a prototype for syscall()

2006-06-15  David Teigland  <teigland@redhat.com>

	remaining withdraw bits now in recover.c

	Complete the code to support withdraw, not yet tested.  This also switches from using dlm locks for withdraw notifications to simply using messages.  The way the daemon now works allows a much simpler approach to withdraw than what we had before where we needed the dlm locks.  Setting up a dlm lockspace for the daemon was also an annoyingly heavy-weight step and the dlm kernel state of the daemon made cleaning up from crashes difficult.

2006-06-15  Robert Peterson  <rpeterso@redhat.com>

	Fixed a bug where changes to the root inode are not written to disk. Also, added logging changes for bz 156009.

	Added some error reporting back in when checking for gfs2 file systems.

2006-06-15  Abhijith Das  <adas@redhat.com>

	Edited Makefile to look more like other makefiles, dependent on objects rather than sources, etc. Removed reference to asm/page.h (for PAGE_SIZE) from util.c. Wasn't compiling on x86_64. Instead made PAGE_SIZE a #define

2006-06-15  David Teigland  <teigland@redhat.com>

	Significant reworking of how mounts are processed.  The previous approach couldn't deal with certain node failures that occured while processing a new mounter.  In this new approach, processing a mounter is largely independent of processing node failures.  Nodes failing while processing a mounter hasn't actually been tested yet, so there are sure to be details to fix.

2006-06-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Build against installed headers rather the ./configured kernel source.

2006-06-14  David Teigland  <teigland@redhat.com>

	for group_tool query, fill in members list from app perspective, not cpg perspective

2006-06-14  Chris Feist  <cfeist@redhat.com>

	Fix configure script so we don't try to pass ccsincdir & ccslib dir to   rgmanager.

2006-06-14  David Teigland  <teigland@redhat.com>

	change log_error to log_debug for non-error

	update some of the build steps

2006-06-14  Robert Peterson  <rpeterso@redhat.com>

	This addresses bugzilla bug #156009 - gfs fsck needs a good review of logging.  I improved logging and added some "warm fuzzy" feel-good messages to let the users know it's not hung.

2006-06-14  David Teigland  <teigland@redhat.com>

	don't syslog non-errors

2006-06-14  Robert Peterson  <rpeterso@redhat.com>

	Remove obsolete references to unlinked_tag.

2006-06-13  Lon Hohberger  <lhh@redhat.com>

	Include missing .c files in src/clulib; remove defunct src/daemons/members.c

	Patch from Fabio Massimo Di Nitto: Fix includes

2006-06-13  Robert Peterson  <rpeterso@redhat.com>

	Improvements to Makefile, renamed gfs2_mkfs man page to mkfs.gfs2.8

2006-06-13  Chris Feist  <cfeist@redhat.com>

	Not necessary to specify /sbin.

	Install files in the correct location.

2006-06-13  Robert Peterson  <rpeterso@redhat.com>

	Fix typo in Makefile

2006-06-12  Chris Feist  <cfeist@redhat.com>

	Use ccslibdir instead of libdir to find ccs libraries.

	Assign ccslibdir to the appropriate variable in the configure script.

2006-06-12  Robert Peterson  <rpeterso@redhat.com>

	Add gfs2_fsck to Makefile

2006-06-12  Chris Feist  <cfeist@redhat.com>

	Remove references to magmalibdir & magmaincdir.

2006-06-12  Robert Peterson  <rpeterso@redhat.com>

	Change copyright to 2006

	Fixed a bug when printing stuffed directories.  For example, gfs2_edit -p masterdir was not working properly.

	Made all block numbers show in decimal and hex.  Minor bug fixes. Moved some functions to libgfs2.

	Got rid of dependency on libgfs.  Every is now done with libgfs2 functions.  Also did some cleanup and bug fixes.

	Moved functions from fsck to libgfs2, added functions to make gfs2_convert not use libgfs.

	Added gfs2_fsck, added gfs2_convert, renamed gfs2_mkfs to mkfs.gfs2

2006-06-12  Alasdair G. Kergon  <agk@redhat.com>

	test checkin

	test checkin

2006-06-12  David Teigland  <teigland@redhat.com>

	run configure in group/

	remove lock_dlm/ files, moved to group/gfs_controld/

	remove daemon/ files, now in group/dlm_controld remove dlm_tool/ files, not used

2006-06-12  Chris Feist  <cfeist@redhat.com>

	Initscripts should be installed in /etc/rc.d/init.d

	Fixed install script to install appropriate binaries.

2006-06-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove dlm32 as all the 32/64 conversions are done in the kernel now. You need the latest GIT kernel for this to work...

2006-06-10  Chris Feist  <cfeist@redhat.com>

	- We don't use the copytobin target in libgfs2 - Added the copytobin target in convert and mkfs - Disabled copytobin target in quota

2006-06-09  Chris Feist  <cfeist@redhat.com>

	Modified makefile to use  instead of hardcoded directory.

2006-06-09  David Teigland  <teigland@redhat.com>

	move dlm/daemon/ to group/dlm_controld/ move gfs/lock_dlm/daemon/ to group/gfs_controld/

2006-06-09  Chris Feist  <cfeist@redhat.com>

	Temporarily disable quota build until functioning w/ gfs2.

	Updated include to properly find gfs_ondisk.h.

2006-06-09  Abhijith Das  <adas@redhat.com>

	Removed usage of IFLAG_INHERITDIRECTIO and IFLAG_INHERITJDATA flags, because they were removed from linux/iflags.h

2006-06-09  David Teigland  <teigland@redhat.com>

	there is no dlm_tool any more

	- get NETLINK_KOBJECT_UEVENT definition from kernel's netlink.h - needed to include "netlink.h" instead of <linux/netlink.h> to get   the most recent one

	- get kernel types like __be64 and __u64 (used in gfs2_ondisk.h) by   including linux/types.h - have makefile -I../../gfs-kernel/src/gfs and source file   include "gfs_ondisk.h"

2006-06-08  Robert Peterson  <rpeterso@redhat.com>

	Misc bug fixes.  For example, it was not updating block free counts for fsck.

	Missed on initial check-in.

2006-06-08  David Teigland  <teigland@redhat.com>

	Set up a separate cpg for sending messages (e.g. for processing mount/unmount) instead of sending them through the cpg used to represent the mount group.  Since we apply cpg changes to the mount group async, that cpg won't always contain all the nodes we need to process the mount/unmount.  A mount from one node in parallel with unmount from another often won't work without this.
	Also fix the makefile to include headers from the kernel_src location.

2006-06-06  Robert Peterson  <rpeterso@redhat.com>

	Remove obsolete parts now in libgfs2.

	First working version that uses libgfs2.  May still have problems.

	Fix several bugs and add changes necessary to match libgfs2.

	Ability to print directory details, minor libgfs2 changes.

	Prep for libvolume_id, minor changes due to libgfs2 changes.

	Several updates and bug fixes, mainly for gfs2_fsck.

2006-06-06  Patrick Caulfield  <pcaulfie@redhat.com>

	We need to build libccs -fPIC because it's included by cman which is a shared object.

2006-06-05  Robert Peterson  <rpeterso@redhat.com>

	Added refs to libgfs2, gfs2_convert, and gfs2_fsck.

2006-06-02  Benjamin Marzinski  <bmarzins@redhat.com>

	There. that should work better

	changed from MODULE_PARM to module_param

2006-06-02  Lon Hohberger  <lhh@redhat.com>

	Start of ripping out dependency on magma; builds but does not currently work

2006-06-02  Benjamin Marzinski  <bmarzins@redhat.com>

	more Makefile fixing

	updated man pages with UID information

2006-05-31  Chris Feist  <cfeist@redhat.com>

	Added ccsincdir and ccslibdir to facilitate building.

2006-05-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Use new OpenAIS

2006-05-26  David Teigland  <teigland@redhat.com>

	when finishing an unmount for a node, we shouldn't be checking it's recovery status as if it had failed (instead of unmounting)

2006-05-25  David Teigland  <teigland@redhat.com>

	when unrecovered nodes are set to be recovered again after sequential node failures, we need to exclude nodes that are unmounting and don't need any recovery

	- re-enable the code that waits for the kernel mount in the finish()   for a mountgroup join.  should work better now with the recent   lock_dlm kernel change - we were missing a clear_new() call in the case of a first mounter   delaying its start_done() for a second mounter - we need to discard group messages on a node that's been added to   the cpg group but not yet added (asynchronously) to the app group

	check that the specified mount type matches the actual fs type on disk (magic number alone no longer does this since 1&2 have same magic #)

	retry cpg_join() when it returns ERR_TRY_AGAIN

2006-05-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't call a parameter 'time' as it confuses some compilers.

2006-05-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't segv if the node has no "votes" property. bz#192136

	Align some message structures better

	Do the big-endian conversion so it actually works.

	Add missing swab_header().

2006-05-22  Lon Hohberger  <lhh@redhat.com>

	Fix build on 64-bit arches

2006-05-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Add support for OpenAIS RRP. altnames in ccs should now work

2006-05-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Allow loggin facility to be configured.

2006-05-19  Lon Hohberger  <lhh@redhat.com>

	Add simple scoring/disk-based quorum daemon

2006-05-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix some stats as reported by cman_tool status

2006-05-17  David Teigland  <teigland@redhat.com>

	only print debugging info to stderr if -D was used -- this may have caused problems when not using -D since debug messages would probably go down some other fd.  Also log errors to syslog.

	decrement the node count before printing debug info so we see the new value

	Changes to the way recovery events are handled when we're already in a recovery event.  Multiple recovery events are now merged most of the time.  Also fixes to the way groups depend on other levels for ordering of recoveries.

2006-05-17  Abhijith Das  <adas@redhat.com>

	bz 191222 : removed debug printk

2006-05-16  Robert Peterson  <rpeterso@redhat.com>

	Compile libgfs2 first.  Removed obsolete gfs2_debug tool.

	Add convert tool and libgfs2.

2006-05-16  Benjamin Marzinski  <bmarzins@redhat.com>

	Make GNBD work with cman.

2006-05-16  James Parsons  <jparsons@redhat.com>

	file powernet369.mib was initially added on branch RHEL4.

	file fence_apc_snmp.py was initially added on branch RHEL4.

	file fence_apc_snmp was initially added on branch RHEL4.

	file README_SNMP was initially added on branch RHEL4.

	file Makefile was initially added on branch RHEL4.

2006-05-16  Ryan McCabe  <rmccabe@redhat.com>

	fence_apc_snmp support

2006-05-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't busy-wait if a write fails.

	Make it background properly.
	Now there's no magma, there's no point in waiting for the cluster manager
	to connect, because ccsd needs to be started before the cman.

	Missing semicolon! oh dear.

	Don't let port number default to junk.

2006-05-16  Abhijith Das  <adas@redhat.com>

	bz191222 fix. When releasing a glock with GL_NOCACHE flag set, care was not taken to ensure that only one holder for the glock remained. This was corrupting the glock and preventing further access to the glock. FLOCKS use this GL_NOCACHE flag. See bugzilla for more information. This patch needs to go through a test cycle to ensure that it doesn't affect other code

2006-05-15  David Teigland  <teigland@redhat.com>

	when sending the results of local journal recoveries, we weren't selecting just the successful recoveries and were potentially writing off the end of the message buffer

2006-05-15  Robert Peterson  <rpeterso@redhat.com>

	Initial checkin.

	Incorporate libgfs2.

2006-05-15  David Teigland  <teigland@redhat.com>

	print out the buffer for debugging when we can't parse it

2006-05-15  Robert Peterson  <rpeterso@redhat.com>

	Initial checkin of libgfs2 and related.

	Remove automake-related files and redundant includes.

	Got rid of automake and added minor fixes.

	Initial checkin of libgfs.

2006-05-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix key file override.

	Get rid of some redundant calls

	Be careful about returning junk as a node address.

	Tidy some of the inter-file communications.

2006-05-13  David Teigland  <teigland@redhat.com>

	When a node is joining a group, has been added to the cpg, but is still queued to be added to the app, and then fails, we just purge its join event for the app and shouldn't queue a recovery event for the app since it doesn't exist there yet.

	Handle case where none of the current members of the mountgroup can recover journals (they're readonly) and there are journals that need recovery.  The next rw mounter is told to recover all journals, and after it's done it needs to unblock access to the fs on the other readonly mounters. (This was mistakenly included in last checkin, it's not been tested yet.)

2006-05-12  David Teigland  <teigland@redhat.com>

	Comment out code that waits for kernel mount, it's not working in some cases.

	- id's where being removed from a recovery event's extended list too early, so multinode recovery processing was getting stuck. - when an extended recovery event aborts another event, the extended nodes in the rev weren't being marked stopped in the first event

2006-05-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Mention ccs_tool as a way of adding nodeids to a cluster.conf file.

2006-05-11  Chris Feist  <cfeist@redhat.com>

	Fixed fence so includes the proper directory for cman. Fixed rgmanager's clulib so it includes the proper ccs directory.

2006-05-11  David Teigland  <teigland@redhat.com>

	set stopped flag for rev->nodeid, not ev->nodeid

	When more than one node failed at once, creating an extended recovery event, we weren't updating both recovery sets (for both nodes) when we finished processing the event.

2006-05-11  Robert Peterson  <rpeterso@redhat.com>

	New and improved gfs2_edit tool based on ncurses. This replaces both gfs2_edit and gfs2_debug.

2006-05-11  David Teigland  <teigland@redhat.com>

	Fix some possible problems with overlapping recoveries, and cases where we could confuse a pending event for the recovery event in the checks that control whether recovery processing should wait.

2006-05-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove redundant kernel examples. Make userland examples compile cleanly.

	Return all multicast addresses. Also return a list of (cman) ports being listened on. Display both in cman_tool.

	Make the examples compile and do something.

2006-05-11  Ryan McCabe  <rmccabe@redhat.com>

	Ignore outlet groups

2006-05-10  Patrick Caulfield  <pcaulfie@redhat.com>

	A rag bag of stuff:
	- Allow override keyfile on cmdline
	- more selective help (eg cman_tool join -h)
	- Show if fenced in cman_tool nodes
	- Show node addresses in can_tool nodes
	- If no multicast set then encode cluster ID in a multicast address
	  to avoid clashes of clusters
	- add cman_get_node_addrs() to libcman (not fully implemented yet)
	- Some preparation for rrp in OpenAIS.

	Add facility to assign a multicast address to the cluster. This is (perhaps confusingly) part of the addnodeids subcommand which is really the V1->V2 upgrade command now.

	Don't go into an infinite busy loop if cman shuts down.

2006-05-09  David Teigland  <teigland@redhat.com>

	If there are no devices defined within a node's method, that method should be considered failed. Fix from navid@redhat.com Fixes bz #190661

2006-05-09  Abhijith Das  <adas@redhat.com>

	fix for bz 190392 + pjc's return 1 if 'status' fails. bz#187279

2006-05-05  Abhijith Das  <adas@redhat.com>

	bz 190200 : man page changes for gfs2_tool changes

	bz 190200: cleaned up gfs2_tool to compile. Removed some features (gfs2 doesn't support them anymore) and commented some out for later implementation. Needs to be reviewed sometime in the future.

2006-05-03  David Teigland  <teigland@redhat.com>

	When mounting a fs, we first join the mountgroup, then tell mount.gfs to procede with the kernel mount.  Once we're in the mountgroup, we can get a stop callback at any time, which requires us to block the fs by setting a sysfs file.  If the kernel mount is slow, we can get a stop callback and try to set the sysfs file before the kernel mount has actually created the sysfs files for the fs.  A new (untested) function delays any further processing until the sysfs files exist.

2006-05-02  David Teigland  <teigland@redhat.com>

	Untested fix for the case where nodeA fails, nodeB fails while recovering journalA, nodeC needs to recover both journalA and journalB.  nodeC wasn't retrying to recover journalA.

	make some names more descriptive of what they do

	build all order: cman/lib, ccs, cman

	An unused recovery set needs to be cleared in either cpg or cman callback, whichever comes second.  Last checkin also wasn't adding recovery_set to list when created by cman callback.

	fix logic that reduces debug output

	This should fix the trouble caused by nodes rejoining the cluster before they've been recovered (common with fence_manual).  There may still be some problem if the unrecovered/rejoined node fails again before the first recovery for it is done.

2006-05-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Disable VS filter

2006-04-29  David Teigland  <teigland@redhat.com>

	it's not right to use "init" to determine when to save an options message vs processing it; we have to check if we've received a start callback yet

	looks like we need to build: cluster/cman/lib cluster/ccs cluster/cman

2006-04-28  David Teigland  <teigland@redhat.com>

	%ll print format for handles

	in withdraw the group name wasn't being parsed from the table name

	when multiple nodes failed together (in one event) we were only marking the first as stopped and not the others

2006-04-28  Patrick Caulfield  <pcaulfie@redhat.com>

	This needs libcman now too

	Use new OpenAIS with important CPG fix. cpg now tells you /all/ the nodes that left the cluster rather than just the first one.

2006-04-27  Robert Peterson  <rpeterso@redhat.com>

	Initial checkin of libgfs2.

2006-04-27  David Teigland  <teigland@redhat.com>

	We can get more than one node reporting success in recovering the journal for a failed node.  The first has really recovered it, the rest have found the fs clean and report success.  Change assertion to recognize that.

	If a bug in a client results in them doing a startdone at the wrong time, catch and report it.

	When we get the extraneous recovery_done for our own journal when we mount, we need just ignore it.  Previous changes to recovery inadvertently added recovery processing to this case.

2006-04-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Use latest openAIS which, I think, will fix Dave's trouble

2006-04-27  David Teigland  <teigland@redhat.com>

	When a recovery event arises while processing another recovery event, the first event continues to be processed through the stopping state before it's supplanted.  We weren't calling process_current_event() on it, though, so it wasn't going anywhere.

2006-04-26  David Teigland  <teigland@redhat.com>

	recovery result values for success/gaveup reversed

	munge debug messages

	Major changes in handling recovery for failed nodes.  Previously, we assumed that if there was a node mounted rw, the journals of any failed nodes would be recovered.  The way mounts are done today, the last rw mounter could be unmounting during a recovery which means it may not do recovery.  To fix this, nodes now inform each other when they've successfully recovered a journal.

2006-04-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Inform cman when we have fenced a node.

	Add API to keep track of when and how a node was last fenced.

2006-04-25  James Parsons  <jparsons@redhat.com>

	Fixed copy - paste error in usage

2006-04-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Admin sockets can't get notifications either.

	Fix (I hope) hierarchy descending in CCS.

2006-04-21  David Teigland  <teigland@redhat.com>

	debug statements

	improve some debug messages

2006-04-21  Ryan O'Hara  <rohara@redhat.com>

	Fixed compiler warnings.

2006-04-21  David Teigland  <teigland@redhat.com>

	now need to build cman before ccs

2006-04-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Change the default port. If people try to run old and new cman on the same port on the same network, things could get /very/ messy.

	Use new AIS logging functions.

2006-04-20  Robert Peterson  <rpeterso@redhat.com>

	Fix for bugzilla bz 179069: gfs_fsck unable to fix file system. This is an extensive fix to repair damaged and corrupt resource groups and resource group index entries that previously caused gfs_fsck to abort.

2006-04-20  Ryan O'Hara  <rohara@redhat.com>

	Removed magma dependencies.

2006-04-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't call lcr_component_register twice as it /really/ annoys aisexec. Also cope with being partially invoked (ie added to openais.conf but not called with OPENAIS_DEFAULT_CONFIG_IFACE set.

2006-04-19  David Teigland  <teigland@redhat.com>

	Look for gfs_ondisk.h in ../../gfs-kernel/src/gfs/ instead of in the kernel src tree.  gfs2_ondisk.h will be in the kernel tree so we can continue to include <linux/gfs2_ondisk.h>

2006-04-19  Ryan McCabe  <rmccabe@redhat.com>

	renamed to rsb

	rsb agent, this time named rsb along with a man page and makefile mods

2006-04-19  David Teigland  <teigland@redhat.com>

	Fix hang if unmount overlaps recovery slightly differently, i.e. if unmount occurs between telling gfs to do recovery on a journal and getting a response.  (Last fix was unmount before just before telling gfs to recover a journal.)

	This should help fix a possible hang caused by a node failing at just the right time during our unmount.

2006-04-18  David Teigland  <teigland@redhat.com>

	Remove the restrictions on when readonly mounts are allowed.  As long as the fs doesn't need recovery, any mount mode (rw/ro/spectator) is allowed.

	byte-swap id's in inter-node messages

2006-04-18  Ryan McCabe  <rmccabe@redhat.com>

	logout correctly on status check

2006-04-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Use revised ais loading system (that now works correctly) on FC5

2006-04-17  David Teigland  <teigland@redhat.com>

	If the last rw mounter umounts leaving only ro nodes, the remaining nodes don't need to leave the fs blocked like they do if the last rw mounter fails (and needs journal recovery).  This also means that an rw mounter that mounts when there are only ro mounters doesn't need to do first-mounter recovery except when there are actually journals that need to be recovered.

2006-04-17  Ryan McCabe  <rmccabe@redhat.com>

	fence agent for fujitsu-siemens primergy rsb device

2006-04-17  David Teigland  <teigland@redhat.com>

	Add some more tips, and an example cluster.conf

2006-04-14  David Teigland  <teigland@redhat.com>

	A start_done() was missing in the case where the last rw mounter leaves and the remaining ro/spect nodes are restarting.

2006-04-13  David Teigland  <teigland@redhat.com>

	valid jid is >=0 not >0

2006-04-13  Stanko Kupcevic  <kupcevic@redhat.com>

	FC5 support, start cs-deploy-tool with --fc5 argument

2006-04-13  David Teigland  <teigland@redhat.com>

	Add remount support which involves updating our mount mode (ro/rw) on all nodes. Fix 16/32-bit mixup in metaheader that was recently fixed in gfs2.

	This is a significant rewrite and expansion of the code that manages gfs mounts.  For the first time we are considering the mount mode (rw/ro/spectator) in the mount process and how it relates to recovery.  In the past, we've not dealt with the issues that come up when ro/spectator nodes cannot recover the fs.  This has only been tested up to the point of the previous functionality, there will still be bugs in the new areas.

2006-04-13  Chris Feist  <cfeist@redhat.com>

	Removed most references to magma from gnbd.

	Removed gulm from Makefile.

	Removed dlm-kernel & gulm from configure script.

2006-04-13  Patrick Caulfield  <pcaulfie@redhat.com>

	'addnodeids' command adds node IDs to nodes that don't have them.

	Allow users to specify log level on command line

	Add recognition of ALTNAME tags in CCS to specify multiple ethernet interfaces to use for communications. Note: The lower ais layers don't fully support this yet...

2006-04-12  Chris Feist  <cfeist@redhat.com>

	Removed gulm directory as it is no longer used.

	Removed gulm from HEAD.

	Removed directories not needed for RHEL5. Updated Makefile and configure script to reflect directory removals.

2006-04-12  Patrick Caulfield  <pcaulfie@redhat.com>

	s/Blocked/blocked/ when displaying quorum.

2006-04-11  David Teigland  <teigland@redhat.com>

	mount configfs at /sys/kernel/config, not /config

	mount point for configfs is /sys/kernel/config, not /config

2006-04-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Explain cna_address

2006-04-10  Abhijith Das  <adas@redhat.com>

	fixed. Obeys LSB standards for return values

2006-04-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Print a space between IP addresses

2006-04-07  Ryan McCabe  <rmccabe@redhat.com>

	support switches with greater than 9 outlets, and handle lists that run longer than one screen.

2006-04-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Do recursive queries on CCS and store in the objdb. (not as easy as it might sound!)

2006-04-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove a (now) spurious include

	Update to latest AIS. we not don't need to patch the AIS sources as it can be all configured dynamically.

2006-04-05  Stanko Kupcevic  <kupcevic@redhat.com>

	GUI touch up

2006-03-30  Steven Whitehouse  <swhiteho@redhat.com>

	Fix a bug where the wrong size endian conversion was used to initialize certain fields.

2006-03-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Update to latest openAIS code.

2006-03-28  Benjamin Marzinski  <bmarzins@redhat.com>

	If it took too long for an uncached gnbd recvd process to stop after the server was fenced, gnbd_monitor would mistakenly think that the old dying process was a new starting process. Because of this, the client would not auto-restart the gnbd device when the server started back up. This is now fixed. Now, gnbd_monitor will not move a device from the reset state to the restartable state unless the old recvd process has stopped.

2006-03-27  Stanko Kupcevic  <kupcevic@redhat.com>

	Improved rpm selection and installation phase

2006-03-24  Robert Peterson  <rpeterso@redhat.com>

	Fix for bz 186125: gfs_fsck on GFS 6.1TB filesystem gives error and leaves volume in an unmountable state.

2006-03-24  Abhijith Das  <adas@redhat.com>

	cman init script fix for bz 159783. dlm module is modprobed immediately after cman module. Previously, dlm module was loaded after cman_tool join.

2006-03-24  David Teigland  <teigland@redhat.com>

	If the user specifies hostdata options on the command line, they need to be combined with the standard hostdata options from gfs_controld.

2006-03-23  David Teigland  <teigland@redhat.com>

	When we exit because the cluster has shutdown, do a force release of the abandoned libdlm lockspace to clear it up.  This requires a dlm-kernel change to use force=3 for libdlm's FORCEFREE.

	When starting up, also clear any old configfs dirs out of /config/dlm/cluster/spaces/.  Some may be left over for a defunct lockspace if the cluster shut down before the ls was left.

	Exit if we get POLLHUP from cman.

	Exit if we get POLLHUP on cman fd.

2006-03-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Loads more documentation for each call.

	Return EBUSY if we don't know whether a remote node "is_listening" or not.

	Make things a little clearer.

2006-03-21  Jonathan Brassow  <jbrassow@redhat.com>

	- ccs_tool can seg fault on upgrade bug 186121
	apcFence {
	        port = 6.2
	        switch = 1
	        option = "off"
	}

	When ccs_tool comes across the integers, it segfaults because it expects
	them to be strings.  This checkin fixes that.

2006-03-21  David Teigland  <teigland@redhat.com>

	always reply yes to a cman shutdown, letting the daemons themselves determine when we can leave

	don't let the gfs_controld lockspace prevent a cman leave

2006-03-21  Patrick Caulfield  <pcaulfie@redhat.com>

	More documentation on API calls.

2006-03-20  David Teigland  <teigland@redhat.com>

	Daemons now exit when cman says the cluster is down.

2006-03-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix typo of the year: "quorumdev_poo"
	Don't get config variables from <cman config name="value"/>, just use
	<cman name="value"/>.
	Having "config" as a key in a config file is just daft,
	also confusing and a change from the RHEL4 syntax (not that this version has
	the same config variables, but there's no point in making it gratuitously
	different).

	"make install" now includes AIS headers & libraries.

	Use the cluster name as the AIS key if no keyfile is specified. This has a couple of advantages: - It allows isolation of clusters by name (as we did before, but /really/   by name this time, rather than a hash of the name). - It avoids the problem of aisexec crashing it it was not running with a key   and it encounters a packet that was.

	Tidy help message, fix cluster name override, tidy "status" code.

	clvmd no longer needs patching for GFS2

2006-03-18  David Teigland  <teigland@redhat.com>

	Reply to cman's TRY_SHUTDOWN callback.

2006-03-17  Benjamin Marzinski  <bmarzins@redhat.com>

	Fixing the get_uid code to make it easier to integrate with multipath

2006-03-17  David Teigland  <teigland@redhat.com>

	Respond to cman's TRY_SHUTDOWN callback.

	add \n to error message

2006-03-17  Patrick Caulfield  <pcaulfie@redhat.com>

	libcman doesn't ncessarily return a padded sockaddr_storage. But it /does/ return the length.

	We must register for events.

	OK, OK, I give in.

	Fix includes

	Try and keep ABI stable between versions. sizeof(cman_node_t) should match that in RHEL4

	Tidy up. and remove some unused structs & constants

2006-03-17  Benjamin Marzinski  <bmarzins@redhat.com>

	fixed gnbd so that it compiles with the upstream kernel.

2006-03-17  David Teigland  <teigland@redhat.com>

	- If, when mounting, we receive the nodeid/jid message before processing   our first start, save the message to process after. - Release withdraw locks for remaining nodes when we get the terminate   callback for our leave instead of immediately when we initiate the leave.   Otherwise it can conflict with the releasing we do as we process other   nodes' unmounts that might be processed before our own.

2006-03-15  Patrick Caulfield  <pcaulfie@redhat.com>

	libcman changes for last one. Need to fix my CVS repository.

	two-phase cman shutdown.
	calling cman_shutdown() will send a REASON_TRY_SHUTDOWN event to all
	clients registered for notifications. They should respond by calling
	cman_replyto_shutdown() to indicate whether they will allow
	cman to closedown or not. if cman gets 1 "no" (0) or the
	request times out (default 5 seconds) then shutdown will be
	cancelled and cman_shutdown() will return -1 with errno == EBUSY.

2006-03-15  Benjamin Marzinski  <bmarzins@redhat.com>

	This is the gnbd code that is required for getting multipathing to work on top of GNBD.

2006-03-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't send extra state change message.

2006-03-10  David Teigland  <teigland@redhat.com>

	sort listed groups by level sort members listed for each group by nodeid

	When nodes are removed from the cluster, remove their dir in configfs.  DLM changed to close lowcomms when this happens (it was wrongly closing lowcomms connection when node was removed from lockspace.)

	Add debug output showing the changes we get from cman.

2006-03-09  David Teigland  <teigland@redhat.com>

	lock_dlmd now called gfs_controld

	changing lock_dlmd to gfs_controld in various places

	Rename the daemon binary from "lock_dlmd" to "gfs_controld". gfs_controld interacts with the cluster infrastructure on behalf of gfs file systems and controls/drives recovery of gfs in the kernel.  The old name was misleading, it looked related to the dlm instead of gfs.  The old name came from the fact that gfs_controld goes through the lock_dlm module when controling gfs.

	Enable withdraw functions by default since libdlm locking is now working fine.

2006-03-08  David Teigland  <teigland@redhat.com>

	- don't process new non-recovery events while recoveries are   still pending (recovery_set's exist) - track progress of recovery sets and free them when they are   complete - before the start stage in recovery, make sure that we've received   a cman callback for all the failed nodes so we're certain to have   the correct quorum status

2006-03-08  Benjamin Marzinski  <bmarzins@redhat.com>

	Reorganize this directory to match the rest of the cluster tree.

2006-03-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't return an error if we had to create the control device! Return something slightly better than EEXIST if we can't create it.

	Odd things could happen if the lock space already existed but the device didn't. No longer.

2006-03-08  Benjamin Marzinski  <bmarzins@redhat.com>

	initial commit of csnap kernel code with a useful build structure.  The code itself is exactly as Daniel left it.  patches 00001 and 00002 are required to build the module.

2006-03-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Use latest AIS with CPG integrated into it. Fix "make uninstall" & "make clean"

2006-03-06  David Teigland  <teigland@redhat.com>

	Purge messages that get queued after we're added to the cpg group but before to our own join is processed.  Otherwise, these messages will just hang around forever.

2006-03-03  David Teigland  <teigland@redhat.com>

	Because cpg leaves are processed asynchronously, we can't use the cpg being changed to send messages; the actual cpg membership may not reflect the nodes we need to send/recv messages with.  Stopped and started messages sent during async confchg processing now go through a separate cpg that the groupd daemon joins itself and connects it to all other groupd daemons.
	Overlapping leave events now work (like you get if multiple nodes
	run fence_tool leave at about the same time), or leaves that
	occur while the group is processing a join.

2006-03-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Patch up so they compile. (mainly taking out query calls)

2006-03-02  David Teigland  <teigland@redhat.com>

	- add version numbers to messages - byte swap messages - adjust event id in recovery events that include multiple failed nodes

	- Add extended event information that group_tool -v will print - All nodes now generate event id's for each confchg based on the   nodeid and event type.  Every message is tagged with the event id   it relates to so groupd can process only messages related to the   current event.  Needed when confchg's back up.

	api changed to unsigned id

2006-03-02  Steven Whitehouse  <swhiteho@redhat.com>

	Change the .gfs2_admin dir such that its no longer linked from the root directory, but becomes a separate root in its own right. If you want to use this version of GFS2, then you need the latest kernel sources from kernel.org. Note that the change made to the metadata is such that older filesystems will continue to mount ok, so updating mkfs is optional.

2006-03-02  David Teigland  <teigland@redhat.com>

	Fix how we dispatch cpg callbacks; dispatch one per poll() event. cpg_dispatch(ALL) breaks things if there's more than one confchg since we need to process each confchg before the next, and a loop around cpg_dispatch(ONE) doesn't work because it will block when there's nothing more to dispatch.

2006-03-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove some assertions that could fail in normal circumstances.

2006-03-01  David Teigland  <teigland@redhat.com>

	check that the mount point exists and is a directory

2006-03-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Make sure p->ls is NULL when we start up. OR we could crash at shutdown. (lon: you might want to check this in other versions)

	Small reversion. The sequence number was pointless.

	change SaNameT to struct cpg_name. add a sequence number to the confchg callback. don't crash when program exits after a cpg_leave.

2006-02-28  David Teigland  <teigland@redhat.com>

	- command string needs to be "setid", "set_id" wasn't recognized - improve some recovery debug messages

	- Basic recovery works. - Need to retry sending cpg messages when RETRY status is returned. - Finish bits for doing recovery in the middle of join/leave/recovery,   not tested yet.

2006-02-27  David Teigland  <teigland@redhat.com>

	More descriptive debug messages. Check errors in various places where they were being ignored.

	Add -w option to disable the withdraw feature. Force it to be set since the dlm locking it uses isn't working.

	set the width of the name field dynamically so state info won't go past 80 columns as often

	Add event state to the set of group info we provide, and have group_tool print it so we can now tell what state the group is in, e.g. adding/removing/recovering nodes.

2006-02-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't clear too much !

2006-02-27  David Teigland  <teigland@redhat.com>

	missed a line which broke the compile

	check for errors returned from group_dispatch()

	return an error from group_dispatch() if the read doesn't return the correct amount of data

	when a cpg connection is closed, also clear out the poll client entry for it

	Uncomment withdraw stuff that uses libdlm.

	don't need to zero out end of addresses any more

2006-02-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Make errno handling a little more consistent

	As a courtesy, zero the whole node address field.

	Return correct status sign for fundamental errors.

	Return the correct address length for a node. NOTE: This changes the protocol version number between libcman and cman,   so you MUST reabuild libcman and anything statically linked to it.

2006-02-24  David Teigland  <teigland@redhat.com>

	Only send jid's to new mounters, not everyone.

	- When we leave a lockspace, remove the configfs entries for it. - When the daemon starts, remove old configfs entries under comms/

	add debugging to determine if the mount syscall is stuck

	note to help clean up in case umount(8) doesn't call umount.gfs2

	- also build libdlm - mkfs type required: -t gfs2 (and -t <table> for mkfs.gfs2) - umount type required: -t gfs2, or umount.gfs2 won't be called - util-linux 2.13-pre6 version of umount(8) is required, older   versions won't call umount.gfs2 helper

	munge header for group listing

	use "gfs" instead of "lock_dlmd" as the group type printed by group_tool

	don't need to include dlm kernel headers

2006-02-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Now compiles against upstream (-mm kernel) DLM.

	Update patch so it works with new build system

	Don't need to override ${sbindir} anymore

	Fix some errors in usage. In particular, CLVMD /can/ be used with the new software - it just needs to be patched before building.

	Oops, slight bug in that Makefile there.

	This is a bit neater. The download is now always a clean OpenAIS tarball, and we patch it after download.

	Install and run cman from libexec

	Return an error if range locks are attempted.

2006-02-24  Steven Whitehouse  <swhiteho@redhat.com>

	Prevent "uninitialized block" message printing out since several blocks don't have the metadata header now.

2006-02-24  David Teigland  <teigland@redhat.com>

	Fixing leaves.

	update for new components

2006-02-23  David Teigland  <teigland@redhat.com>

	Fix the check for us being in the fence domain, libgroup isn't setting the "member" field at the moment, so just look through the member list.

	Fix leave processing, leaving node can't wait for stopped messages from remaining nodes.  Make global id consistently unsigned.

	match debug messages with the same ones in other daemons

	Comment-out withdraw stuff which depends on libdlm which doesn't match upstream dlm since we removed ranges.

	Remove some old state stuff that doesn't exist any more

2006-02-22  David Teigland  <teigland@redhat.com>

	Send messages (used for distributing journal id's and plocks) through libgroup which passes them through to libcpg/openais. libcman is now only used to check our nodeid and the cluster name.

	clean out a few unused bits

	Munging to get this compiling again; need to define new annotated types used in gfs2_ondisk.h, and need our own gfs2_xyz_in() functions since gfs2 now puts these in its own ondisk.c file.

2006-02-22  Steven Whitehouse  <swhiteho@redhat.com>

	Added a simple set of compile/install instructions.

2006-02-22  Patrick Caulfield  <pcaulfie@redhat.com>

	as per lon: add cman_get/set_private routines. Remove some redundant admin routines

	ln -sf doesn't do what I though it did. so rm the symlink before creating the new one.

	Use latest openais - with improved CPG support.

2006-02-21  David Teigland  <teigland@redhat.com>

	remove unused file

2006-02-20  David Teigland  <teigland@redhat.com>

	code for passing through messages, setting global id's, and some changes to how recovery events will mix with other events

	bits for sending messages to the group

2006-02-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Get rid of some redundant stuff

	Don't do endian conversion on nodeids, ais does that for us now.

2006-02-20  Wendy Cheng  <wcheng@redhat.com>

	Bugzilla 182057 - patch 3-3: Add dump_stack() into gmalloc so we could know the culprit whenever out of memory loop occurs.

	Bugzilla 182057 - patch 3-2: GFS was trying to split a full-grown directory (0xffff entries) hash leaf into two and subseqently hang. The buffer requirement 0xffff*sizeof(uint64_t)/2 = 262144 (256K) was too big for kmalloc to handle. Change into vmalloc if kmalloc fails.

	Bugzilla 182057 - patch 3-1: Fixes directory delete out of memory error. Found in customer environment where gfs_inoded is deleting a max size of hash unit (0xffff entries). It hangs in leaf_free() during gmalloc while kmallocing 0xffff*sizeof(uint64_t) (=512K) of memroy. It did a kmalloc, zeroed out the buffer, then copied the zeroed contents into bh buffer and subsequently sent the bh into gfs_writei to write out to disk. This patch removes the unnecessary kmalloc plus the memory copy by directly zero out the bh buffer.

2006-02-17  David Teigland  <teigland@redhat.com>

	more progress, can now process a join

	misc fixes

2006-02-16  David Teigland  <teigland@redhat.com>

	rework things so we should be closer to passing message delivery through this lib

	handful of fixes

2006-02-16  Abhijith Das  <adas@redhat.com>

	fix for bz178812. ccsd init script and daemon print errors now

2006-02-16  David Teigland  <teigland@redhat.com>

	misc fixes getting it to work

2006-02-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Detach the daemon rather better

2006-02-16  David Teigland  <teigland@redhat.com>

	include headers from ../../cman/daemon/openais/trunk/include

2006-02-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Check if ccsd is running before attempting to start the daemon. Otherwise the user just waits around for nothing to happen.

	Allow stderr log messages from ais if "cman_tool join -d" specified.
	WARNING: Don't use this on a serial console with full debug messages
	enabled or it will repeatedly timeout !

	Give aisexec longer to get started. Now that all the CCS accesses are in the daemon it can take some time to get going.

	Run cman as an AIS component. This allows other AIS services to be used in conjunction with it - using their normal API.
	This checkin includes a few small hacks to openais to make it run without
	a configuration file - cman will supply all the config information to it
	from CCS.

	It also includes a new AIS service: cpg. This is a closed process group service
	I'll be submitting upstream soon but is currently used by groupd.

	As there is no AIS config file read by the daemon the services used are
	hard coded in openais/trunk/exec/mainconfig.c as:
	evs, clm, cpg, ckpt, evt, lck, msg, cman

2006-02-15  David Teigland  <teigland@redhat.com>

	Put this code back into the correct state.  (This is not supposed to be the same as the version on RHEL4 or STABLE branches. This is new.)

	add nodeid to message deliver callback

	Remove group_join/leave arg.  Need to find a new method for detecting if new mounter is spectator.

	Remove group_join/leave arg.

	Removed group_join/leave arg.

	Remove the "info" params to join/leave and other related functions. Add the API for sending/receiving.

	New groupd that uses the cpg (closed process group) service from openais. It still uses cman, but only to get the local nodeid and quorum values.

2006-02-15  Wendy Cheng  <wcheng@redhat.com>

	Joined work of bugzilla 164331 (Abhijith Das) and 178469 (specsfs):
	While granting exclusive lock, gfs_glock_cb() expects all other threads
	have relinguished their writes and journal has been flushed and shutdown.
	Otherwise it aborts the call and forces a filesystem consistency error.
	The current umount code (gfs_put_super) doesn't follow this logic by
	doing flushes without log shutdown before the exclusive lock is requested.
	The patch works around this issue by relocating the flushes into
	gfs_make_fs_ro() call itself after the gfs_glock_nq_init() call.

	Properly handle error return code from verify_jhead().

2006-02-15  Robert Peterson  <rpeterso@redhat.com>

	Fix for Bugzilla Bug 178453 – Slow memory leak in /proc/cluster/dlm_dir and /proc/cluster/dlm_locks

2006-02-15  James Parsons  <jparsons@redhat.com>

	Addresses interface change in drac_mc firmware version 1.2

2006-02-14  Steven Whitehouse  <swhiteho@redhat.com>

	This reverts the dirent ondisk structure to be the same on disk as gfs1. mkfs is now uptodate with the git tree head.

2006-02-10  James Parsons  <jparsons@redhat.com>

	Support for drac 4/I

2006-02-09  Wendy Cheng  <wcheng@redhat.com>

	This patch is part of fix for bugzilla 178469 where the 6th word of the nfsd file handle doesn't get correctly byte-swapped in gfs_decode_fh(). It is normally not a problem if the dentry of the file still hanging around in server's cache. However, under heavy IO, the dentry could get re-cycled and the parent info would be used to re-do lookup. We get stale file handle error as the result.

2006-02-09  James Parsons  <jparsons@redhat.com>

	Fix for bz168698

2006-02-08  James Parsons  <jparsons@redhat.com>

	man page for fence_rsa

2006-02-08  Steven Whitehouse  <swhiteho@redhat.com>

	This takes mkfs out of the main build system. It should make it much easier to build it since its just a question of editing the Makefile to point at the kernel source and then, make, make install.
	Also the binary will be called mkfs.gfs2 and make install will stick
	it in /sbin so that you can call it through the mkfs generic front
	end like all the other filesystems do.

	So hopefully this will be easier to build and easier to use. It also
	incorporates the changes required to make filesystems for the new
	journaled file format, so be aware that only the very latest git
	tree of gfs2 will work with it.

2006-02-08  James Parsons  <jparsons@redhat.com>

	fixed typos

2006-02-06  James Parsons  <jparsons@redhat.com>

	rsa support

2006-02-03  James Parsons  <jparsons@redhat.com>

	added explanation of new auth type switch

2006-02-02  Lon Hohberger  <lhh@redhat.com>

	Agent fixes for #178314

	fix #179662

2006-02-02  Jonathan Brassow  <jbrassow@redhat.com>

	- Make the init script do a cman_tool leave remove on stop.  Restarts   still do cman_tool leave

2006-02-02  Benjamin Marzinski  <bmarzins@redhat.com>

	This fixes a problem from bz #173697. gfs_fsck crashed on many types of extended attribute corruptions. Now gfs_fsck correctly deals with them.

2006-01-31  Patrick Caulfield  <pcaulfie@redhat.com>

	Make nodeid mandatory

2006-01-27  Lon Hohberger  <lhh@redhat.com>

	Fix 179063 - some options missing from nfsclient option handler

	Fix 178249 - pass 2

2006-01-26  Robert Peterson  <rpeterso@redhat.com>

	This fixes Bugzilla bz 178367.  Memory leak when reading from either /proc/cluster/nodes or /proc/cluster/services.

2006-01-26  James Parsons  <jparsons@redhat.com>

	Added fence_bladecenter back in to install list

2006-01-24  Lon Hohberger  <lhh@redhat.com>

	Fix broken build

	Fix #178249 - debug messages from gulm.so

2006-01-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Update to 0.71 of openais.

2006-01-24  Abhijith Das  <adas@redhat.com>

	bz127042 fix: kill gnbd_monitor when all uncached gnbds have been removed

2006-01-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Show nodeid in "cman_tool status" output.

	Don't allow a user to release a lockspace if other users have it open.

2006-01-20  Lon Hohberger  <lhh@redhat.com>

	Fix #166109 - random segfault in clurgmgrd.  Fix most of 177467 - clustat hang (does not fix the case where the lock manager never responds to a request).  Fix bug in smb.sh associated with ccs descriptors > 255.

	Fix 178026 - provide lock holder on request from SM.  Fix 178080 - implements work around dlm release 177934 by taking a NULL lock on lockspace acquire.

	Add CLK_HOLDER flag: Tells the plugin to return an allocated uint64_t; #178024 - also fixes incorrect API documentation in man page

2006-01-17  David Teigland  <teigland@redhat.com>

	update gfs2 description

2006-01-17  Stanko Kupcevic  <kupcevic@redhat.com>

	Remove pvs from list of available storage; don't create VG if no storage configured

2006-01-12  Jonathan Brassow  <jbrassow@redhat.com>

	- endian fixes so heterogenious clusters can work WTR CCS 	- thanks to Fabio Di Nitto, and pjc

2006-01-12  Steven Whitehouse  <swhiteho@redhat.com>

	GFS2 no longer writes mh_blkno into the common metadata header for metadata blocks that it creates itself. This completes the removal of the mh_blkno field. GFS2 doesn't check it at all, so it should be backward compatible with GFS1 now.

	mkfs no longer writes the mh_blkno field into the common metadata header since its not needed. Removed the bmap ioctl() call from live.c since its ownly purpose was to allow setting of this field.

	The second half of yesterday's patch. This is the recovery part and now means that gfs2 no longer relies on the mh_blkno field of the common metadata header.

	All normal (i.e. not journaled) file reads/writes now go via the page cache route, even if they are to stuffed inodes.

2006-01-11  Steven Whitehouse  <swhiteho@redhat.com>

	Remember to take out my debugging printks :-)

	Write a list of the block numbers of the succeding metadata blocks which are about to be committed into the log. This uses the spare space at the end of the log descriptor block, so mostly it doesn't actually require any more disk I/O to do this, and when it does, its very little.
	This doesn't actually change recovery (yet) since the recovery side is
	still making use of the mh_blkno field in the metadata header still. The
	intention is to use the list of block numbers instead. This has a slight
	speed advantage in recovery since we no longer need to read any block
	which is in the revoke list, since we will have already read a list of
	the block numbers ahead of time.

	Once this is done, we'll no longer need to use the mh_blkno field in
	the common metadata header which gives two advantages:

	 o We don't need the bmap ioctl() since its only use is the online version
	of mkfs
	 o We don't need to rewrite all the metadata headers when converting gfs1
	to gfs2

	I plan to use an almost identical system to deal with data blocks in
	the journal, with the addition of an extra field to flag whether the
	data block begins with the GFS magic number or not, which is required
	so that we can escape any data blocks which do start with the magic
	number. When thats done, it will greatly simplify dealing with
	journaled data files.

2006-01-11  Jonathan Brassow  <jbrassow@redhat.com>

	- commit Lon's patch   Contains:         - Fix that causes connection desc's to timeout, eliminating           the problem where all desc could be used-up, even though           they are not in-use.         - Increase # of connection desc from 10 -> 30         - Ignore SIGPIPE         - Don't call printf from a signal handler         - Don't catch SIGSEV, allowing for core dumps         - build with -ggdb
	- applied and compile tested

2006-01-11  Lon Hohberger  <lhh@redhat.com>

	Merge ccsd local socket patch from RHEL4 / STABLE

2006-01-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Add quorum device interface back in.

2006-01-10  Steven Whitehouse  <swhiteho@redhat.com>

	Found and fixed an endianess bug where we were using the wrong conversion function (one I introduced earlier I think). Some clean ups which reduce redundant copying and also reduce endianess warnings. Removed some now unused functions.

2006-01-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Use libcman

2006-01-09  David Teigland  <teigland@redhat.com>

	Copy the get/set vfs<->internal casting macros from stable branch to get rid of the piles of compiler warnings.

	make lock modules use modified harness interface and header from gfs

	printk prefix GFS instead of GFS2 in merged harness code

	Incorporate the lock_harness into gfs itself, just as was done for gfs2. GFS1&2 share the same lock module registration interface for now so the same modules can be used with both.

	Munging and renaming related to the merging of lock_harness into gfs.  For the time being, we copy the gfs1 lock module bottom interface so the same lock modules can be used with both gfs1 and gfs2 (it won't be possible to load both gfs1 and gfs2 at once.)  Eventually the lock modules will fork for gfs1/gfs2 and the register interface can change to the gfs2_ prefix.

2006-01-09  James Parsons  <jparsons@redhat.com>

	Fix for bz176375 regression

	Fixed typing designation for var

2006-01-09  Steven Whitehouse  <swhiteho@redhat.com>

	Remove a test which is no longer needed.

2006-01-06  Patrick Caulfield  <pcaulfie@redhat.com>

	file 51-udev-dlm.rules was initially added on branch RHEL4.

2006-01-04  Lon Hohberger  <lhh@redhat.com>

	Fix 176343 - __builtin_return_address(x) for x>0 is never guaranteed to work

2006-01-04  Patrick Caulfield  <pcaulfie@redhat.com>

	udev rules file for DLM

2006-01-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Allow non-root users to create the default lockspace.

	Fix race where a lock could be unlocked before dlm_lock has completed.

	Put externs in the header file.

2005-12-22  Steven Whitehouse  <swhiteho@redhat.com>

	Update mkfs to use the new ioctl for get/set of flags for files.

2005-12-21  Steven Whitehouse  <swhiteho@redhat.com>

	Adding back the get/set flags ioctl, which is the one ioctl that I think we really need. This time its called with the argument being a pointer to the flags to be got/set rather than through the original vectored ioctl call.

	Remove some unused code relating to printing the lock state. If we are to use an fs based interface to revive this feature on user request (the current code is only triggered by a bug occuring) then the code I'm removing here won't be useful anyway.

	Merge the lock harness into gfs since it no longer makes sense to retain it as a standalone module.
	Also drop most ioctls() although I've left the header file for now so that
	the userland utils will still build. Live operations on the fs will not
	be possible until the userland utils have been ported over to use the
	new interface(s).

2005-12-19  David Teigland  <teigland@redhat.com>

	Check if allocate_lockinfo() fails.

	typo: not &'ing DLM_LKF_PERSISTENT with the flags

2005-12-16  Abhijith Das  <adas@redhat.com>

	fix for bz169087 - split fill_super_block() into read_super_block and fill_super_block. calling block_mounters between calls to the two sb functions

2005-12-16  Stanko Kupcevic  <kupcevic@redhat.com>

	add path to logfile to error popups

2005-12-15  Stanko Kupcevic  <kupcevic@redhat.com>

	Verify that node is subscribed to proper RHN channels

2005-12-15  Steven Whitehouse  <swhiteho@redhat.com>

	Some __read_mostly annotation.

	mkfs changes to allow building of filesystems with visible .gfs2_admin directory.

	This change makes the "hidden" files and directories visible to users of the filesystem. Basically it interchanges the order of the root and .gfs2_admin directories.
	There are still some more changes to come in this area, but this is a
	good start. Again you'll need to upgrade mkfs with the changes I'm about
	to check in to build a filesystem with this new feature.

	The plan is that this will remove the need for a large number (all?)
	of the current ioctl()s but I'll leave them where they are until I'm
	sure this is working correctly.

2005-12-14  Steven Whitehouse  <swhiteho@redhat.com>

	These are the fixes to mkfs in order to get it to build against the new big-endian GFS2 kernel source. I'm not intending to fix the other utilities until I've finished the ioctl() changes as that will break them again for a short while.
	If you do need them in the mean time, mostly its a question of adding
	linux/types.h to the include files list, s/le/be at suitable places
	and using the copy of ondisk.c now checked in here.

	Long term I'd like to abstract the things in ondisk.c and make a
	libgfs which all the utilities can share rather than each of them
	having their own copy of them.

	This touches just about everything and changes GFS2 to be big-endian on disk, like GFS1. At this point, most of the major data structures will be compatible in layout and endianess. There are a number of more minor items which are still not compatible, largely in areas where there really is a good reason to make changes.
	There will probably be further metadata changes to come, not least when
	I look at the ioctl question, which is next on my agenda as it will also
	require user tool changes.

	All the user tools in CVS for GFS2 are now broken until I check in
	some changes there (5 mins max I promise!).

2005-12-12  Patrick Caulfield  <pcaulfie@redhat.com>

	I hate CVS, why does it always ignore this directory? Add flags to 'extra' for showing 2node & error states.

	Show 2node flag & error state in cman_tool status

	Some of those messages should go to syslog

2005-12-10  Benjamin Marzinski  <bmarzins@redhat.com>

	Fix for bz 142849
	When you do gfs_write on a stuffed inode, you don't update the page cache,
	because the inodes are stored in the buffer cache. This doesn't effect reads,
	because gfs special cases the stuffed reads.  Unfortunately, sendfile needs to
	use the page cache, because it relys on the destination socket's sendpage
	routine to work. So my fix is: after you do a write on a stuffed inode, if the
	first page of the file is cached (It appears from looking at the code that
	there is already an assumption that stuffed inodes will never be more than a
	page in length) mark the cached page as not uptodate.

2005-12-09  Stanko Kupcevic  <kupcevic@redhat.com>

	Sample snmpd.conf

	Make sure all data is read() from buffer before closing fd

	Added rhcClusterNodesNames, rhcClusterAvailNodesNames, rhcClusterUnavailNodesNames, rhcClusterServicesNames, rhcClusterRunningServicesNames, rhcClusterStoppedServicesNames, rhcClusterFailedServicesNames to rhcCluster, so that users of clients that don't display whole snmp table in a single view (eg. HP OpenView), can see all failed/stopped/... services in one place. Node and service tables haven't been removed. Also, clarified descriptions.

2005-12-09  Lon Hohberger  <lhh@redhat.com>

	Fix #175033 part 2 - read in page-size chunks from /proc/cluster/services

2005-12-09  Steven Whitehouse  <swhiteho@redhat.com>

	A checkpoint in the sparse annotation. There are still a number of areas producing warnings. Two out of three (the vectored ioctl() and the walk_vm() function and friends) are already on Dave T's hit list so I didn't spend a lot of time sorting them out.
	The third (jdata) will need some more work. There is also further work
	to be done adding more annotations, particularly for the ondisk metadata
	but this is a convenient point to check in what I've done so far.

	Fix sparse warning caused by use of int rather than gfp_t in a function argument.

2005-12-08  Lon Hohberger  <lhh@redhat.com>

	Bump SM plugin version

	Fix #175033 - magma-plugins incorrect read behavior for /proc/cluster/services > 4096 bytes

2005-12-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Allow re-reads of CCS to set a new expected_votes value. If we can't read CCS then pause this node until we can (maybe need  some form of retry in here) Fix some prototypes.

	Oops, typo. Also tidy comments so they fit on an 80char line.

	Reinstate lowcomms_close() to tidy up the output queue when a node leaves the cluster.
	Truncate any partial messages that may be left in the input buffer
	if a node goes down under memory pressure (thanks to Mark Butler for
	pointing this out)

2005-12-08  Steven Whitehouse  <swhiteho@redhat.com>

	Removed the hfile_trunc ioctl(). Its not used anywhere at the moment, but I've kept the function itself (will produce a function not used compile warning) just for the moment as I've a hunch it will be useful later via a different interface.

	Tidy endianess conversion in lvb.c. Half the macros were not used anyway. We no longer convert endianess for the structure padding, and the printing code will no longer print its value.
	This is a precusor to a longer look at the endianess conversion and
	addition of sparse annotations.

	Fix up warnings due to kernel function prototypes not matching a couple of GFS2 functions.

	This patch moved the i_alloc structure into the incode inode. This results in fewer memory allocations (one less per write) as well as removing another of the __GFP_NOFAIL allocations from the code.
	I've left the get/put functions associated with i_alloc as it might be
	useful to retain them for debugging and because it maps out the lifetime
	of this structure.

	Temporary variable "error" is not required since there is already a variable being used for that purpose.

	This patch removes an allocation of memory which was occuring on every lookup of a block in a file. The memory requires is now allocated on the stack and its only 20 bytes. A lot less than some of the other stack allocated structures we are using (e.g. struct gfs2_holder) in the code.
	It should speed things up and removes one of the __GFS_NOFAIL allocations
	that we need to remove from the code.

	Fix to quota bug fix... I had accidently commited the RHEL4 patch in head as well. This is the proper fix for the head branch.

2005-12-07  Stanko Kupcevic  <kupcevic@redhat.com>

	Include pegasus headers for zSeries

2005-12-07  Lon Hohberger  <lhh@redhat.com>

	Fix #175229 - remove unneeded references to clurmtabd; it is no longer a necessary piece for NFS failover

	Implement 175215: Inherit fsid for nfs exports

2005-12-07  Stanko Kupcevic  <kupcevic@redhat.com>

	agent and provider READMEs

2005-12-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Call out to group_tool for "cman_tool services". A bit of backward compatibility is always nice :)

2005-12-07  Stanko Kupcevic  <kupcevic@redhat.com>

	Replaced tmp OID with unique one

2005-12-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Tell aispoll to remove the client if it errors.

2005-12-06  Stanko Kupcevic  <kupcevic@redhat.com>

	Signal-safe logging

	Resources used after their release

2005-12-06  James Parsons  <jparsons@redhat.com>

	Fix for bz168698

2005-12-06  Lon Hohberger  <lhh@redhat.com>

	Fix #175114 - rgmanager uses wrong stop-order for unspecified resource agents

	Fix #175108 - rgmanager storing extraneous info using VF

	Fix #175106 - lsof -b blocks when using gethostbyname causing slow force-unmount when DNS is broken

	Fix #174819 - clustat crashes if ccsd is not running

	Fix #173916 - rgmanager log level change requires restart

	Fix #173526 - Samba Resource Agent

	Fix #171236 - pass 1 - ia64 alignment warnings

	Fix #171153 - pass 1 - clustat withholds information if run on multiple members simultaneously

	Fix #165447 - ip.sh fails when using VLAN on bonded interface

2005-12-06  Patrick Caulfield  <pcaulfie@redhat.com>

	sockets should be non-blocking!

	Comment tidy

	CCS node names override temporary ones created from the IP address. Recalculate quorum after re-reading CCS.

	Sort nodes by nodeid

2005-12-06  Steven Whitehouse  <swhiteho@redhat.com>

	Remove an unused variable.

	A two line patch to fix a bug where the quota_enforce setting is ignored.
	Thanks to:

	Marc Curry for reporting the bug and testing the fix and
	Chris Feist for building the RPMs for Marc to test the fix

2005-12-05  Stanko Kupcevic  <kupcevic@redhat.com>

	Restart daemons on upgrades, compile with debugging info

	Abort command execution after 3 second

	Memory corruption due to libxml2 not being thread safe

2005-12-02  Stanko Kupcevic  <kupcevic@redhat.com>

	Memory leak in Socket, remove pidfile on exit, catch SIGCHLD

	spec and code cleanup

	added logging with multiple levels of verbosity

2005-12-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Update to latest AIS (taken straight from svn now) Make thread count configurable.

2005-11-30  Patrick Caulfield  <pcaulfie@redhat.com>

	(re-)read the two_node flag from CVS so we can change it on the fly.

2005-11-30  Stanko Kupcevic  <kupcevic@redhat.com>

	Daemonization of clumond

2005-11-29  Stanko Kupcevic  <kupcevic@redhat.com>

	specfile, dependencies, buildsystem

2005-11-29  Robert Peterson  <rpeterso@redhat.com>

	Fix for Bugzilla Bug 155304 – gnbd_monitor doesn't correctly reset after an uncached gnbd has failed and been restored.

2005-11-29  Steven Whitehouse  <swhiteho@redhat.com>

	Sorry - another ondisk format changing check in...
	I've reordered the fields in the common metadata header and added a pad
	field so that this structure is now of identical size as in gfs1. It
	also has identically functioning fields in the same place.

	One new field is added, mh_blkno which contains the block number of
	the block in question. This is instead of the generation number used
	in gfs1's journaling and now no longer needed. The mh_blkno field is
	checked only once in the code and could be moved into the structure
	where its required, rather than being left in the common header. (I
	checked this with Ken who added the field in the first place)

	I have a thought that it might be a useful feature to have all ondisk
	metadata checksummed in which case this header field might be just the
	right place to put it.

	Also some padding is added to the dinode, sb and rgrp structures in order
	to make them compatible with the earier gfs1 versions. Again fields are
	now in the same places as in gfs1 with padding added where required since
	the fields have got smaller.

	I don't believe that there will be any significant performance impact in
	changing these structures, but it should make things much easier when it
	comes to migration.

	There are other structures (I think that the various directory metadata
	comes under this heading) where removing the padding is likely to
	improve performance significantly and so I'm intending to take a
	different approach there.

	There is likely to be at least one more metadata change for gfs2 in
	the not too distant future. My next main concern is to make gfs2
	bigendian on disk, to match gfs1. Beyond that, all the other changes
	should be much easier to cope with. I did a test recently and found that
	given a few 32bit fields to copy, adding endian coversion made about
	12% difference to the speeed of copying (which we are doing anyway).

	If we keep the two versions with the same on disk endianess then a lot
	of the metadata will not need conversion at all (given the changes in
	this patch). So an upgrade will be quite quick, rather than needing to
	rewrite each and every metadata disk block.

	This patch introduces the tty_write_message() function rather than doing the dereferences directly.
	Make this look like the code for ext2/3. I'm not sure about the test that
	I've left in the code here. ext2/3 doesn't have it and I suspect we don't
	need it, but I've left it for now just in case.

2005-11-24  Stanko Kupcevic  <kupcevic@redhat.com>

	build system

2005-11-23  Stanko Kupcevic  <kupcevic@redhat.com>

	clumond c++ rewrite

2005-11-23  Steven Whitehouse  <swhiteho@redhat.com>

	N.B. This patch changes the ondisk format of GFS2, so you'll need to remake filesystems.
	The idea here is to make the metadata closer to that of GFS1 in order to
	reduce the amount of work required to migrate GFS1 -> GFS2. This patch
	changes the numercial value of a few constants to match those of
	identical function in GFS1. One of the GFS1 constants is no longer
	used in GFS2 (as noted in the comments) and there are two new constants
	added.

	As far as I can tell there are no more constants in GFS2 which are
	not comaptible with those in GFS1. All the remaining ondisk
	incompatibilities are due to structures changing size and I'll
	be taking a look at those next.

2005-11-22  Stanko Kupcevic  <kupcevic@redhat.com>

	Package docs, build 0.9.2

	Addition of html documentation

2005-11-21  Lon Hohberger  <lhh@redhat.com>

	Allow scripts to inherit the name attr of a parent in case the script wants to know it (#172310)

	Fix #162605

2005-11-21  David Teigland  <teigland@redhat.com>

	Check in Wendy Cheng's fix: Flush pages into storage in case of DirectIO falling back to BufferIO.

	Check in Kevin Anderson's mount sync patch: Without the patch, there is a large performance hit when using the -o sync mount option on gfs filesystems. The problem is that pages are not being flushed to disk when the gfs_writepage routine is invoked due to the transaction not yet being completed. Ref: bugzilla 173147.

2005-11-16  Stanko Kupcevic  <kupcevic@redhat.com>

	RPM prerequisites & alpha build

	Message to add two nodes in order to detect shared storage

	Tooltips and touch-ups

	Display size in GBs

2005-11-15  David Teigland  <teigland@redhat.com>

	When using lock_dlm, all gfs2 unmounts would panic in invalidate_inode_buffers (<- invalidate_list <- invalidate_inodes). Invalidate_inodes requires that the sb inodes list not change while it's running, but async unlock completion callbacks from lock_dlm are scheduled during invalidate_inodes.  These callbacks do glock_put() which does a final iput(), clearing the inode and causing the panic.
	The fix is a new semaphore (sd_invalidate_inodes_mutex) which blocks
	glock_put's during invalidate_inodes.

2005-11-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't spam ccsd with diff config entry names.

	add htons() etc on nodeid in totem_ip_address.

2005-11-12  Stanko Kupcevic  <kupcevic@redhat.com>

	Minor GUI touch ups

2005-11-12  David Teigland  <teigland@redhat.com>

	remove option debugging

2005-11-11  David Teigland  <teigland@redhat.com>

	deal with gfs1/gfs2 differences better

	don't restrict to gfs2

2005-11-10  David Teigland  <teigland@redhat.com>

	debugging output and options

2005-11-10  Patrick Caulfield  <pcaulfie@redhat.com>

	new AIS incorporating nodeid zeroing patch that got missed.

2005-11-10  Stanko Kupcevic  <kupcevic@redhat.com>

	Initial checkin of clumon

2005-11-09  David Teigland  <teigland@redhat.com>

	mount.gfs/umount.gfs are mount.gfs2/umount.gfs2

	extraneous \n

	Code to add/del gfs entries from /etc/mtab; junk I was hoping to avoid but can't.

2005-11-09  Stanko Kupcevic  <kupcevic@redhat.com>

	Initial checkin of cs-deploy-tool

2005-11-08  David Teigland  <teigland@redhat.com>

	look in /proc/mounts instead of /etc/mtab for gfs mounts

	add fixme comment

	Share common code between mount/umount; both about finished.

2005-11-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Read key after we've filled in the whole of the totem_config struct, as it now seems to depend on bits of it.

	If AIS passes us a node ID then we should beleive it. Also cope with not being able to resolve IP addresses at startup. If AIS passes us a nodeid that matches then we can use that one.

	new AIS

	Fix log message that could crash daemon

	Don't show joined time for non-members.

2005-11-07  David Teigland  <teigland@redhat.com>

	Every file should #include the headers containing the prototypes for it's global functions. Signed-off-by: Adrian Bunk <bunk@stusta.de>

	dlm_find_lockspace_name is now the static one

	Remove some unused functions, make others static. Signed-off-by: Adrian Bunk <bunk@stusta.de>

2005-11-07  James Parsons  <jparsons@redhat.com>

	Fixes bz172464; adds WTI RPS10 agent to build

2005-11-04  Lon Hohberger  <lhh@redhat.com>

	Fix for 172441 from jparsons

2005-11-03  Lon Hohberger  <lhh@redhat.com>

	Fix #172401

2005-11-03  David Teigland  <teigland@redhat.com>

	don't use patches any more

	not sure why these are still here

2005-11-02  Lon Hohberger  <lhh@redhat.com>

	Fix rest of 172178

2005-11-01  Lon Hohberger  <lhh@redhat.com>

	Fix bugs 172177, 172178

2005-11-01  Alasdair G. Kergon  <agk@redhat.com>

	test commit

2005-10-31  David Teigland  <teigland@redhat.com>

	do mount option munging on a copy of gfs's hostdata buffer

	build mount.gfs2 and umount.gfs2

	Write our own reduced option parsing routine and don't bother using parse_opts() from util-linux/mount -- no need for util-linux at all now.

2005-10-31  Alasdair G. Kergon  <agk@redhat.com>

	test checkin

2005-10-31  David Teigland  <teigland@redhat.com>

	split depends line

2005-10-31  Lon Hohberger  <lhh@redhat.com>

	Apply patch from Axel Thimm to fix bz172066

2005-10-28  David Teigland  <teigland@redhat.com>

	On unmount just leave the lockspace and exit, user space umount.gfs will leave the mount group

	umount helper

	need EXPORT_SYMBOL_GPL

	Pass the correct mount options.

	Accept connections for mount requests from mount.gfs.  Do mount processing when we get this request instead of waiting for a mount uevent from the kernel.  Return hostdata string to mount.gfs that's passed to gfs through mount(2).  jid/id/first values previously set in sysfs now passed in hostdata.

	Remove "do mount" uevent message to user space and waiting for "mounted" reply.  Now assumes that gfs mount helper has done everything already.

2005-10-27  Lon Hohberger  <lhh@redhat.com>

	Ensure rgmanager doesn't block SIGSEGV when debug is not enabled.

2005-10-27  David Teigland  <teigland@redhat.com>

	default to 1 vote if no value given in cluster.conf

	untested interaction with lock_dlmd added

2005-10-24  David Teigland  <teigland@redhat.com>

	The start of a mount.gfs2 program that is called by mount(8).  This allows us to do things in user space (like interact with the cluster infrastructure) before mount(2) is called.  None of the clustering bits have been added here yet.
	The mount(8) source is a real mess and it's not simple to integrate
	an fs-specific helper without duplicating a pile of the mount(8)
	code within the helper program.  Currently the Makefile downloads
	a modified version of util-linux, builds util-linux/mount and then
	compiles mount.gfs2 using util-linux/mount/libmount.a.  A better
	solution may require a lot of cleanup in util-linux/mount, unfortunately.

	Add comment with Ken's quota summary.

	move quota sync and refresh to sysfs

2005-10-24  Jonathan Brassow  <jbrassow@redhat.com>

	- millennium latency fix for 2.6

2005-10-21  Lon Hohberger  <lhh@redhat.com>

	Fix #171253

2005-10-18  Lon Hohberger  <lhh@redhat.com>

	Mono-NFS server resource agent

2005-10-17  Lon Hohberger  <lhh@redhat.com>

	Add logging library

	Mono-NFS server support (e.g. one NFS server per cluster, active-passive).

	Add support for inheritance in the form "type%attribute" instead of just attribute so as to avoid confusion.
	Fix 150346 - Clustat usability problems
	Fix 170859 - VIPs show up on multiple members.
	Fix 171034 - Missing: Monitoring for local and cluster file systems in...
	Fix 171036 - RFE: Log messages in resource agents

2005-10-13  David Teigland  <teigland@redhat.com>

	get block size from sb instead of defunct statfs

	comment out bits that used "statfs" entry in sysfs that's now been removed... need to find another way of getting at least some of that info

	/sys/fs instead of /sys/kernel

	base dir in sysfs is now /sys/fs/gfs2

	register gfs under /sys/fs instead of /sys/kernel. requires the kernel to be patched with fs_subsys.patch

	declares fs_subsys for /sys/fs/

	Port plock management from lock_dlm kernel module to lock_dlm userland daemon.  Simpler as it runs over cman comms instead of dlm range locks.

2005-10-12  David Teigland  <teigland@redhat.com>

	use ALIGN instead of MAKE_MULT8

	last checkin for list_for_each_entry_safe_reverse was incomplete

	Use list_for_each_entry_safe_reverse. Requires the kernel to be patched with list-safe-reverse.patch.

	adds list_for_each_entry_safe_reverse to list.h

	Add a couple comments.

2005-10-11  David Teigland  <teigland@redhat.com>

	Showing extended statfs info in sys set a couple people off, just removing it instead of wasting my time arguing with people. We can try to put it back later on its own.

	file WHATS_NEW was initially added on branch STABLE.

	use list macro

	use list_for_each

2005-10-10  David Teigland  <teigland@redhat.com>

	refresh for latest -mm

	remove some log_debug's

	add a static

2005-10-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Slightly better error handling.

	Pull slightly updated openais tarball.

2005-10-07  David Teigland  <teigland@redhat.com>

	withdraw if the lock module returns LM_OUT_ERROR

	missing include

2005-10-06  David Teigland  <teigland@redhat.com>

	if the lock module returns LM_OUT_ERROR, withdraw from the cluster

	When the dlm returns an error, return LM_OUT_ERROR to gfs instead of panicking; gfs can then try to withdraw.

	define LM_OUT_ERROR for a lock module to return

2005-10-06  Benjamin Marzinski  <bmarzins@redhat.com>

	Update gfs2_tool to make use of sysfs instead of ioctls where appropriate.

2005-10-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Set the version number

	Don't default to 0 votes, it's annoying.

2005-10-05  Lon Hohberger  <lhh@redhat.com>

	Don't build clufindhostname; it's not even in the tree

2005-10-05  David Teigland  <teigland@redhat.com>

	need smp_lock.h for lock_kernel()

	don't include the kernel's lm_interface.h, print lm flags value, don't try to interpret

2005-10-04  Lon Hohberger  <lhh@redhat.com>

	Incorporate patch from 165447

	Clustat partial rewrite (still needs updated XML output)

2005-10-04  David Teigland  <teigland@redhat.com>

	update FIXME comment

	Add comment explaining how queue_empty() is used.

	Use kref structs and operations to do glock reference counting instead of our own counter.

2005-10-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Stick a version number in the pipe protocol so we can protect ourself from future incarnations of tools.

	Don't die if we get SIGPIPE

	Add DLM_LKF_FORCEUNLOCK so device.c doesn't have to muck about with locks that are in progress.

2005-09-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Lock ourself in memory

	Don't send two config change events for a "cman_tool expected -e". Tidy kill message.

	Use inet_ntop() to print IP addresses so the look nicer.

	"cman_tool status" prints the multicast address too.

	Use slightly more RFC-compliant multicast address.

	Install the AIS keygen program.

2005-09-28  David Teigland  <teigland@redhat.com>

	move shrink and statfs_sync from ioctl to sysfs

	handle sysfs dirs for both gfs1 and gfs2

	update to work with new sysfs organization (doesn't work for gfs1 yet)

	add \n

	missed the sys_fs_uninit at unmount

2005-09-27  David Teigland  <teigland@redhat.com>

	add a couple basic sysfs attributes

2005-09-27  Benjamin Marzinski  <bmarzins@redhat.com>

	gfs2 was unable to truncate files if they were opened with write permissions, but the process later changed uids to an uid that didn't have write permission. POSIX says that if you had the permissions when you opened the file, you don't loose them when you change uids.
	gfs2 no longer checks permissions before truncating a file in gfs2_setattr.  I
	don't know what this check was ever added (It didn't exist in gfs 6.0). Since I
	don't know why the check was added, I can't say for certain that it is
	unessential.  However, I can't see any reason to do it, so I deleted it.

2005-09-27  David Teigland  <teigland@redhat.com>

	The fs kobject is now passed into the lock module at mount time. It's ignored by nolock and gulm. Kobject added to gfs1 so the same lock module can operate with both gfs1 and gfs2.

	Pass the kobject for the fs into lm_mount() so the lock module's kobject can appear below it in sysfs.

2005-09-27  Patrick Caulfield  <pcaulfie@redhat.com>

	rename "commskey" to "keyfile" as that's slightly better. remove redundant entry

	Don't overwrite AIS node addresses just because a nodeid matches Keep nodes in ID order

2005-09-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix usage message

2005-09-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy multicast code and use a suitable (ip4 or 6) default if none is specified.

	Allow CCS version to go forward between cman_tool join & startup, but not backward. Don't put an incarnation number on a node newly arrived from CCS.

	Add uS to the log timestamp

	Updating ccs_tool's editconf commands for new cman schema (note: the old schema will still work [nodeids permitting] but the new one is slightly simplified)

2005-09-22  Benjamin Marzinski  <bmarzins@redhat.com>

	add watchdog.o to the rgmanager object files, to fix undefined reference to watchdog_init.

	switched 'deamon' to 'daemon' in uninstall rule.

2005-09-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Cope with node names in CCS that we can't resolve (provided they have a node ID) and warn if odd things happen.

2005-09-21  David Teigland  <teigland@redhat.com>

	move a bunch of stuff from ioctl to sysfs

	minor fixups

2005-09-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't try and do floating point maths in the preprocessor.

	Use a temp variable for the node address, to avoid potential alignment problems.

	new AIS version

	byteswap the header too

	Need to return earlier if the socket failed to connect.

	Refresh cluster FD before each select.

	If any of the queues have cached message in then return an fd for /dev/zero from cman_get_fd() - that way it will be guaranteed to be active for read so we will get called back to flush those queues.
	Also, use the new GETNODECOUNT call to get the nodecount rather than getting the
	whole node list.

	Missing comma & comment.

2005-09-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Updated patch that works rather better.

2005-09-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Patch for clvmd so that it can be used with libcman. With a dynamic libcman, the same clvmd should be able to run with a kernel or userland cmand depending on the library installed.
	When libcman is packaged I will apply this to the main clvmd sources

	Add CMAN_REASON_PORTOPENED callback reason.

2005-09-16  Stanko Kupcevic  <kupcevic@redhat.com>

	Fixed bz167217, and handling of DOWNed interfaces

2005-09-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix up the port notification and add new new PORTOPENED notification because we can.

2005-09-16  Stanko Kupcevic  <kupcevic@redhat.com>

	Added watchdog that reboots if clurgmgrd crashes

2005-09-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Use ccs as the repository of config & node information (that is, after all, why it is there!) rather than passing it around in extraneous cluster messages.
	This also has the effect that we can re-read CCS if a node joins the cluster with
	a higher config version than us, making "cman_tool version" redundant. That
	should please some people.

2005-09-14  A. J. Lewis  <alewis@redhat.com>

	Initial commit of fsck for GFS2  o this is based on the fsck for GFS1 with changes to handle the ondisk    format changes introduced in GFS2  o This is a work in progress - it will not throw errors on a clean    filesystem, but it has not been extensively tested yet, so be careful.

2005-09-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Strip down barriers so they use the VS features of AIS.

2005-09-14  Benjamin Marzinski  <bmarzins@redhat.com>

	fixed acl code so that acls are displayed when enabled, and not displayed when disabled.  Also cleaned up the intenting of my last checkin.

	When you copy an suid root file to gfs, you start a transaction on the write and then make a vfs call that eventaully tries to start another transaction for changing the file attributes.  This cause gfs to print a warning and not get the attributes right.
	After this change, if you already have a transaction started in
	gfs2_setattr_simple, instead of failing the warning assert, you simply use
	the existing transaction.

2005-09-12  Stanko Kupcevic  <kupcevic@redhat.com>

	Fixed bz167769: fs.sh doesn't do 10 & 20 OCF_CHECK_LEVEL checking

2005-09-08  A. J. Lewis  <alewis@redhat.com>

	 o Make sure the link counts of directories are properly incremented

2005-09-08  David Teigland  <teigland@redhat.com>

	remove bio counters that were kept by the diaper device

2005-09-07  David Teigland  <teigland@redhat.com>

	remove extra tab

	put back previous insmod printk

	we dumped the gfs endian conversions and use le everywhere

2005-09-06  David Teigland  <teigland@redhat.com>

	misc style stuff

	define GFS2_FSNAME_LEN to use in place of 256

	fill in the standard stuff to send plock_get to user space

	apply same fixes here from gfs comments: enums, better assert

	replace PRIx64 with llx

	tidy line breaks

	remove "get_cookie" ioctl, not used any more

	tidy recurse_check

	replace more defines with enums

	more trivia, replace define with enum

2005-09-05  David Teigland  <teigland@redhat.com>

	more gfs2_assert munging

	more munging of gfs2_assert

	get rid of glock_hold/glock_put, use gfs2_glock_hold/put everywhere

	Don't reset atomic statistics counters to zero when they roll into negative numbers, just cast to unsigned.  AFAICT 'gfs2_tool counters' shouldn't need any change.

	Pass all gfp flags to gfs2_holder_get() instead of having GFP_KERNEL added to what the caller provides.

	Replace TRUE/FALSE with 1/0.  This is a really unfortunate blow to code comprehension but kernel lords are always right.

	slim down the printk's in assertions

2005-09-03  David Teigland  <teigland@redhat.com>

	patch from Mike Christie replacing PRI defines

	don't need to include smp_lock.h

	no more oopses_ok

	no more oopses_ok option

	remove oopses_ok option since a panic results regardless, no difference remove unused todo option in assert macro

2005-09-02  David Teigland  <teigland@redhat.com>

	replace gfs's switchable endian conversion functions with plain old le conversions

2005-09-01  Lon Hohberger  <lhh@redhat.com>

	Add VMWare ESX server fencing from Zach Lowry

	Ensure proper linking

	Fix Joe Orton's comments re: calling ld instead of gcc -shared...

2005-09-01  Patrick Caulfield  <pcaulfie@redhat.com>

	comment & message tweaks

	Today's openais tarball has some important fixes in it.

	Don't untar the ais source on every build

2005-09-01  David Teigland  <teigland@redhat.com>

	remove old patches

	update for use on -mm kernels

	update for new plock header

	update kernel patch generating target

2005-09-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Temporarily enforce static node IDs until this is sorted out.

2005-09-01  David Teigland  <teigland@redhat.com>

	revert accidental change

	use macro to define sysfs attributes

	Allow "id" for the lockspace/fs to be set through sysfs; used for matching plock responses with right ls/fs (plock requests and responses for all fs's multiplexed through one device)

	Get plock requests from kernel through misc device. For the moment just pass back "ok" immediately.

	Pass plock requests to user space lock_dlmd through reads on misc device, lock_dlmd passes back results through writes on the same device.

	get to compile on 2.6.13

2005-08-31  Lon Hohberger  <lhh@redhat.com>

	Fix 167216 -- ip.sh script errors

2005-08-31  David Teigland  <teigland@redhat.com>

	do nothing in withdraw (instead of BUG) until the dm hooks are ready

	use sysfs instead of procfs for list/freeze/withdraw margs/lockdump are not implemented yet

	Replace the procfs hooks for list/freeze/withdraw with sysfs hooks. The margs/lockdump hooks require something different and are left unimplemented for the moment.

	fix compiler warning about ignoring return value of inode_setattr

2005-08-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Configure AIS bit using CCS

2005-08-30  David Teigland  <teigland@redhat.com>

	These will replace proc.[ch] and do the same thing through sysfs.

2005-08-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove send_queued_events() as it's not used any more.

	Add IPv6 support, with pre-release AIS code.

2005-08-30  David Teigland  <teigland@redhat.com>

	follow_link now returns void*

2005-08-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Cope with large (>PIPE_BUF) messages coming back from the daemon.

	Line up heading

2005-08-25  David Teigland  <teigland@redhat.com>

	clear node struct before every cman_get_node

2005-08-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Only ask for POLLOUT notification unless we have something to send.

2005-08-25  David Teigland  <teigland@redhat.com>

	memset node struct to 0 before cman_get_node

	comment out CMAN_CMD_ADD_KEYFILE which isn't in header yet

2005-08-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Add support for AIS security key.

	Add support for AIS security key. Tidy IP specifications. Kill cmand if we fail to set its parameters properly.

2005-08-22  David Teigland  <teigland@redhat.com>

	remove PRI/SCN defines that aren't used

	hold configfs subsys lock while accessing the children list

2005-08-19  David Teigland  <teigland@redhat.com>

	Add printk log levels by replacing printk with one of: fs_info, fs_warn, fs_err.  This also lets us do the standard prefix "GFS2: fsid=%s:" in the macro instead of repeating it everywhere.

2005-08-18  David Teigland  <teigland@redhat.com>

	select configfs

	use linux/jhash.h instead of our own

	member_sysfs.c has been decimated and is no longer related to members, move what's left into lockspace.c

	update

	use new schedule_timeout_interruptible

	remove temp defn of kzalloc xattr_acl.h no longer exists, don't include move to schedule_timeout_interruptible, remove set_current_state try to tidy breaks in long lines in daemon.c

2005-08-17  David Teigland  <teigland@redhat.com>

	munge whitespace to match upstream so patches are sane

	dlm_our_nodeid now from config.h

	functions no longer exist

	rmdir, not unlink, to remove node from lockspace

	fix problem with the previous change for multiple addresses

	support more than 1 address per node, up to DLM_MAX_ADDR_COUNT (3)

	- when weight isn't set, it should default to 1 - check for error from looking up a node's weight

	set node weights (now through configfs)

	Move setting of the lockspace id from configfs back to sysfs where it's simpler and cleaner.

2005-08-16  David Teigland  <teigland@redhat.com>

	Configure node addresses through configfs instead of ioctls.

	don't compile dlm_tool, configfs changes mean it won't be working for a while

	Configure lockspace id and members through configfs instead of sysfs.

	Configure lockspace id and members through configfs instead of sysfs. (Compiling requires <linux/configfs.h> which is in -mm kernels.)

	depends on IPV6

2005-08-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Unbind connections when they die. Recalculate quorum when we join.

	Clear struct before calling cman_get_node()

	Clear node struct before passing it into cman_get_node()

	Return node addresses.

2005-08-11  David Teigland  <teigland@redhat.com>

	remove empty kerneldoc headers copyright artwork

	copyright artwork

	remove comment I added

	cool down on the copyright artwork

	remove functions unused now that diaper is gone

	gfs2_ip2v(ip, NO_CREATE) -> gfs2_ip2v_lookup(ip) gfs2_ip2v(ip, CREATE)    -> gfs2_ip2v(ip)

2005-08-10  Patrick Caulfield  <pcaulfie@redhat.com>

	small Makefile fixes

	library commits that go with the last lot. I'm not sure why CVS missed them out.

	Build cman against openAIS's libtotem_pg. This is still pretty unstable stuff so be warned.
	For the moment it downloads a prepackaged/patched version of openais from
	my web site. This /will/ change.

	There's still a lot of work to do on this code but is basically works with a few
	caveats:

	1. Barriers are completely untested and may not work at all.
	2. Don't start several nodes up at the same time, they might get the same
	   node ID(!) unless you used static node IDs
	3. Some of the info returned by cman_tool is wrong.
	4. The exec path for cmand is hard coded (in the Makefile) to ../daemon/cmand
	   so you must currently always run cman_tool from the dev directory unless
	   you change it.

2005-08-10  David Teigland  <teigland@redhat.com>

	Remove diaper code, add a FIXME in the place where we need to hook into dm for withdraw.

	replace 0x7FFFFFFFull with MAX_NON_LFS in size checks

	c99 initializers

	fix whitespace damage where lines start with 1-7 spaces followed by a tab

	replace 256 with defined MAX_LINE fix whitespace damage

	replace kmalloc/kzalloc with kcalloc where appropriate

	use kzalloc instead of kmalloc+memset (FIXME: kzalloc added to gfs2.h since it's only in mm at the moment)

	asm headers after linux

	convert vma2state from macro to static inline function

	convert lops.h macros into static inline functions

	comment to link flags to struct member

	Remove context dependent path names.  Requested by Al Viro. If they're important we can try to put them back once gfs is accepted.

2005-08-09  David Teigland  <teigland@redhat.com>

	remove another { } block

	- remove empty kerneldoc headers - tidy util.h and remove some unused bits - remove Ren & Stimpy quote due to complaint

	get rid of fixed_div64.h -- the existing do_div() works fine in my tests, and do_mod() isn't needed since do_div() returns the modulus.

	Use wait_event() in do_lock_wait() instead of managing the waitqueue ourselves.  I have some doubt that the log spinlock really needs to be held while testing the atomic counter, but I'm not certain enough to drop it.

	style munging: get rid of { } blocks within functions more line break and over-80 cleanups

	replace the hash functions with linux/jhash.h get rid of unused get_time()

	Get rid of RETRY_MALLOC entirely, although the one place it couldn't be worked around still has a loop.

2005-08-08  David Teigland  <teigland@redhat.com>

	remove { } creating code block within function due to complaint

	callers of inode_create() can deal with error, don't need RETRY_MALLOC

	Remove all memory debugging per lkml comments; a pity, this stuff was nice and simple.  Maybe we can try to put it back once gfs is merged.

	gfs2_disk_hash.h contains gfs2_disk_hash() and crc table that's been removed from gfs2_ondisk.h

	for gfs2_disk_hash() use the kernel's crc32_le() instead of our own function and crc table

2005-08-05  David Teigland  <teigland@redhat.com>

	replace gfs2_sort() with sort() from linux/sort.h

	gfs2_random() is not used, remove it.

2005-08-03  David Teigland  <teigland@redhat.com>

	drop unnecessary casts of void pointers

	spaces to tab

	Excerpt from Ken Preslan's "ramblings".

2005-08-02  David Teigland  <teigland@redhat.com>

	__user annotation in gfs2_readlink()

	__user annotations for proc functions

	adding static to a bunch of stuff found by sparse, and a __user

	add static to acl_get()

2005-08-02  Adam Manthei  <amanthei@redhat.com>

	Add support for Dell PowerEdge 1855 to fence_drac (bz 150563).  When using the DRAC/MC firmware, an addition parameter is required to specify the module/blade in the PE 1855.

2005-08-01  A. J. Lewis  <alewis@redhat.com>

	Update fsck in HEAD of CVS with changes made to RHEL4 and STABLE branches - large forward-port of changes   * Whitespace changes   * Set error variable before use   * Remove duplicate allocation code   * Don't use the BH_DATA macro when assigning   * set error before using it   * Display messages before, during, and after clearing journals    o Currently displays a '.' every 10 journals cleared - this messes with the      log_info message when -v is used, but I'm not going to worry about it for      now   * Update Makefile   * Fix for bug #160525    - The fsck wasn't handling extended attributes properly - if it found      one, it would read an invalid variable instead of the one pointing to      the eattr block.   * Create log_at_* macros   o log_at_* only prints the message if the default level equals the priority of     the print request   * use log_at_notice for '.' printing in journal "replay"   * Turn some non-static functions static   * Add newline to message   * Add a function to write out a new superblock    o writes out the superblock contained in sbp->sb   * Prevent new mounters by changing the lock protocol    o Change the lock protocol from lock_* -> fsck_* on startup    o Change it from fsck_* -> lock_* on teardown    o Currently requires gfs_tool to fix if the fsck fails partway through   * Fix minor warning in super.c   * Fix for bz #160835 - fsck erroneously reporting bitmap corruption    o converting free metadata -> free data should not generate errors    o this adjusts the way the fsck checks the bitmaps so it does not, it      just notified the user that the block is getting converted from      free metadata to free data.   * Fix up build_metalist to work properly   nbh wasn't getting zeroed properly in the loop that was using it,   resulting in bad values getting passed in if check_metalist didn't set it.   * fix up check_eattr* calls and add debug info   check_eattr_indir and check_eattr_leaf weren't setting bh properly   added some log_info/log_debug calls to help track down what's going on

2005-08-01  David Teigland  <teigland@redhat.com>

	Go back to schedule_timeout() in the daemons.  We want to wake up more often than the timeout, which schedule_timeout() typically does.  msleep won't return until the timeout at a minimum which makes unmount take a long time.

	inline instead of __inline__

	more tidying, removing old or unnecessary comments

2005-07-29  Lon Hohberger  <lhh@redhat.com>

	fix 164627

	fix 162501

2005-07-29  David Teigland  <teigland@redhat.com>

	Add a comment with Ken's explanation of the diaper device.

	In conversation, simply refer to "GFS", not "GFS2".

2005-07-29  Jonathan Brassow  <jbrassow@redhat.com>

	- s/uint32_t/sector_t for get_region_size return

	- Fix cmirror bugs
	- Only allow one machine to perform resync work
	  There must be a race in there somewhere when allowing multiple
	  simultaneous recoveries...  This side-steps that issue.  Besides
	  one machine moving the heads is probably better than all.

	- when a resync is done, we must mark it in the clean list as well
	  as the sync list.  Otherwise, the log will always tell us there
	  is recovery to be done - even if there isn't.

	- Only suspend the server on cluster events - not dm suspends.  If
	  we flush the clients before returning from the suspend, the server
	  will do nothing anyway.

	- fix typo

	- clean up logging

	- take the code that connects to cman out of the init function and
	  do it on first mirror activation.  This way, you don't have to
	  have cman running in order to load the module...  Makes mirror
	  activation a bit slower, but speeds up module loading.

2005-07-28  Adam Manthei  <amanthei@redhat.com>

	fix for bz 161352
	Adds support for latest ilo firmware version (1.75).  Changes were also
	added to make sure that power status of the machine is being properlly
	checked after power change commands have been issued.  Before, it was
	assumed to work through the messages recieved in the xml response.  As a
	result, systems with APCI  enabled would soft power off leaving, systems
	running instead of properlly fencing them.

	A new option, ribcl,  was added to the agent to force the protocol to use
	when trying to send the power off command.  Setting this value to "2.21"
	might be required to work around some versions of ilo on machines with APCI
	enabled.  If left blank, the protocol version is autodetected.

2005-07-28  Lon Hohberger  <lhh@redhat.com>

	Fix 159767

	Fix 163651

2005-07-28  David Teigland  <teigland@redhat.com>

	remove trailing whitespace

	replace spaces with tabs

	add file for kernel patch

	include gfs2.txt in kernel patch

	depend stuff

	The max num_glockd was lowered from 32 to 16 when we switched to using the kthread routines.

	To avoid compile warning, replace get_v2ip(aspace) = NULL with set_v2ip(aspace, NULL).  Not sure how Ken overlooked this one when replacing all the others...

2005-07-27  Adam Manthei  <amanthei@redhat.com>

	o make init.d/fenced exit with WARNING instead of FAILED when using   gulm cluster management (bz 159685) o more initscript clean ups (bz 155478)

2005-07-27  Chris Feist  <cfeist@redhat.com>

	file dm-log.h was initially added on branch RHEL4.

	file dm-cmirror-xfr.h was initially added on branch RHEL4.

	file dm-cmirror-xfr.c was initially added on branch RHEL4.

	file dm-cmirror-server.h was initially added on branch RHEL4.

	file dm-cmirror-server.c was initially added on branch RHEL4.

	file dm-cmirror-common.h was initially added on branch RHEL4.

	file dm-cmirror-cman.h was initially added on branch RHEL4.

	file dm-cmirror-cman.c was initially added on branch RHEL4.

	file dm-cmirror-client.c was initially added on branch RHEL4.

	file Makefile was initially added on branch RHEL4.

	file uninstall.pl was initially added on branch RHEL4.

	file release.mk.input was initially added on branch RHEL4.

	file defines.mk.input was initially added on branch RHEL4.

	file configure was initially added on branch RHEL4.

	file TODO was initially added on branch RHEL4.

	file README was initially added on branch RHEL4.

2005-07-27  David Teigland  <teigland@redhat.com>

	include "locking/harness/lm_interface.h"

	generate new kernel patches

	adds gfs2 to kernel build

	used to generate kernel patch where we need <linux/dlm.h>

	quotes around lm_interface include

	get lm_interface.h from .

	get lm_interface.h from ../harness

	typo bug "&atomic_read()", remove &

	add 2005 to copyright

	reorder/indent for readability

	remove unused options

	remove define parens

	fix typo bug from list macro conversion

2005-07-26  David Teigland  <teigland@redhat.com>

	remove/change comments that are out of date or unnecessary

2005-07-26  Daniel Phillips  <phillips@redhat.com>

	add interface to specify initial socket as ascii fdnumber to avoid exporting sys_socket and sys_connect

2005-07-26  David Teigland  <teigland@redhat.com>

	replace __inline__ with inline

	use msleep() instead of schedule_timeout()

	Only allow one of the lock_dlm threads to do blocking callbacks. It appears that gfs2 will wait for a completion callback within a blocking callback, so one thread must always be available to do completions.

2005-07-25  David Teigland  <teigland@redhat.com>

	use kthread functions

	don't build unused debug header

	use list_for_each_entry

	munging to fix lines over 80 and other odd line breaks (leave a bunch over 80 that can't be trivially fixed)

	depends on SYSFS Signed-off-by: Adrian Bunk <bunk@stusta.de>

2005-07-22  David Teigland  <teigland@redhat.com>

	Remove ENTER/RETURN macros used for profiling and tracing debugging.

2005-07-21  David Teigland  <teigland@redhat.com>

	remove more define parens remove GFS2_RELEASE_NAME

	remove parens from defined values, fix lines over 80

	function type and name on same line is preferred style

	cleanup and tidying - remove parens around defined values - use tabs where appropriate - prune excessive commenting   (some of which may not apply to gfs2)

	Carry out Ken's instructions from gfs2_ondisk.h to change the ondisk format: make mh_type and mh_format into uint16_t make de_name_len and de_type into uint8_t

2005-07-20  Lon Hohberger  <lhh@redhat.com>

	Fix 159637

2005-07-20  David Teigland  <teigland@redhat.com>

	fix mistake from converting to list_for_each

2005-07-20  Jonathan Brassow  <jbrassow@redhat.com>

	- do not call completion on every suspend, it increments a counter   which causes wait_for_completion()'s to proceed w/o waiting.

2005-07-19  Jonathan Brassow  <jbrassow@redhat.com>

	- don't call complete() on failure_completion if we are in "core" mode.

2005-07-19  David Teigland  <teigland@redhat.com>

	tidying and filling out comments

	function type and name on same line, use list_for_each_entry

	kernel people like function type and name on same line

	Significant cleanup, lots of style stuff

2005-07-15  David Teigland  <teigland@redhat.com>

	wait to add second mounter until gfs's initial recovery is done on first mounter (gfs does others_may_mount)

	- simplify a bunch of old junk - wait for all recoveries to complete before processing any joins/leaves

	global "joining" var needs to be per lockspace

	add

2005-07-14  Patrick Caulfield  <pcaulfie@redhat.com>

	interesting typo.

2005-07-14  David Teigland  <teigland@redhat.com>

	use a constant message size between libgroup and groupd

	-n used with gnbd commands

2005-07-13  Jonathan Brassow  <jbrassow@redhat.com>

	- add cluster "core" log support

	- cluster mirror is working again, but requires patches to kernel

2005-07-12  Lon Hohberger  <lhh@redhat.com>

	fix 157327

2005-07-12  Patrick Caulfield  <pcaulfie@redhat.com>

	file saClm.h was initially added on branch STABLE.

	file saAis.h was initially added on branch STABLE.

	file clm.c was initially added on branch STABLE.

2005-07-12  Lon Hohberger  <lhh@redhat.com>

	Apply patch from Eric Kerin to fix #162824, fix #162936

2005-07-12  Jonathan Brassow  <jbrassow@redhat.com>

	- Bring back up to sync with latest mirror changes 	- New function added (*is_remote_recovering)() 	- resturcture log dev failure detection
	- Need to add pre/post suspend support

2005-07-11  Lon Hohberger  <lhh@redhat.com>

	Fix type causing verify-all to not work properly

2005-07-08  Lon Hohberger  <lhh@redhat.com>

	\Fix 162805\

2005-07-06  Jonathan Brassow  <jbrassow@redhat.com>

	- last commit before major changes... don't want to loose this.

2005-07-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix device refcounting

2005-07-06  Adam Manthei  <amanthei@redhat.com>

	add fence_drac to default build

2005-07-05  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	added a warning.

2005-06-30  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	same sort of compiler fixes that i did in userspace.

2005-06-30  David Teigland  <teigland@redhat.com>

	Last change was not correct, it's a second mount we need to delay completing until first_done.

	When we're the first mounter, wait for "first_done" (set by others_may_mount) before completing the start.

	add "first_done" sysfs file for dlm_controld to be notified of gfs's others_may_mount()

2005-06-28  Adam Manthei  <amanthei@redhat.com>

	o man page for fence_drac o updates to usage to include ccs options

	Support for Dell Remot Access Card III/XT
	This replaces the racadm call with direct access to the telnet interface of
	the DRAC.  This will require the user to first enable the telnet interface.
	The update has been tested on the following hardware.  A more comprehensive
	list needs to be created.

	The following agent has been tested on:

	 Model                DRAC Version    Firmware
	 -------------------  --------------  ----------------------
	 PowerEdge 750        DRAC III/XT     3.20 (Build 10.25)

2005-06-27  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	gcc4 hates me. This fixes an occasional bug where services cannot login to gulm.

2005-06-27  David Teigland  <teigland@redhat.com>

	ack stop callbacks

	Add new phase to wait for application acks following a stop callback.

2005-06-23  David Teigland  <teigland@redhat.com>

	fix Makefiles for install

	When a lockspace on a remote node is not found for a recovery status request, we need to treat this as if it did exist and has a 0 recovery status.

	Need to release the list of root rsb's when recovery is aborted early.

	incorrect logic in telling kernel when join/leave was complete

	file INSTALL was initially added on branch STABLE.

2005-06-22  David Teigland  <teigland@redhat.com>

	If recover_locks() on an rsb doesn't find any locks to recover, we need to clear the NEW_MASTER flag since it won't be cleared by dlm_recovered_lock().  Also add an assert that NEW_MASTER is set in dlm_recovered_lock().

	need to copy the rsb's hash into the remove message

	Per-lockspace option for dlm to run without using a resource directory. What would be the directory node for a resource, is statically assigned to be the master node instead. - no directory lookups are done which speeds up most new requests - the first node to lock a resource is now unlikely to be the master   for it, slowing down other cases - combined with directory weights, the dlm can be configured to run   as a "lock server" where the lock master has a weight of 1 and   all others have a weight of 0

	file VERSION was initially added on branch STABLE.

	file COPYING was initially added on branch STABLE.

2005-06-21  Benjamin Marzinski  <bmarzins@redhat.com>

	Adding Fabio Massimo Di Nitto's patch to keep up with changes in the kernel inode structure.

2005-06-21  David Teigland  <teigland@redhat.com>

	get to compile on 2.6.12

	dlm builds on 2.6.12

2005-06-17  Lon Hohberger  <lhh@redhat.com>

	Don't use _syscall macro, patch from Adam Conrad

2005-06-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Add some (hopefully helpful) comments

2005-06-16  David Teigland  <teigland@redhat.com>

	Resolve potential recovery problems in dealing with an rsb prior to the master nodeid being confirmed.  This simplifies the handling of the master confirmation in general, too.

2005-06-15  Patrick Caulfield  <pcaulfie@redhat.com>

	use umask so that permissions on /etc/cluster/cluster.conf are -rw-r-----

2005-06-15  Jonathan Brassow  <jbrassow@redhat.com>

	- use umask so that permissions on /etc/cluster/cluster.conf are -rw-r-----
	Thanks to Fabio Massimo Di Nitto for spotting this.

2005-06-15  David Teigland  <teigland@redhat.com>

	New way of controlling the dlm, no longer mirrors groupd callbacks.

	different sysfs hooks for controlling the dlm

	Big rework of lockspace control/management.  Simplifies things significantly and removes a lot of code.

2005-06-15  Jonathan Brassow  <jbrassow@redhat.com>

	- fix for bug 157094
	A mysterious error being generated when trying to do a broadcast (sendto):
	ccsd[1704]: Unable to perform sendto: Cannot assign requested address

	On certain clusters (seems to be when ccs tries using IPv6), this error
	could show up 9 out of 10 times.  When the error was received, the
	broadcast attempt would fail.  This caused the attempt to grab any
	possibly updated cluster.conf files to abort.

	Waiting a moment, closing the socket, reopening the socket, and retrying
	the broadcast seems to solve the issue.  (It has work 100+ times so far.)

	I'm not entirely certain what is causing the initial try to fail - perhaps
	the underlying subsystem is not quite ready...  In any case, I have never
	seen a second attempt fail.

2005-06-14  Lon Hohberger  <lhh@redhat.com>

	Fix bug in ip.sh which would match 10.1.1.1 as being the same as 10.1.1.111

2005-06-14  Daniel Phillips  <phillips@redhat.com>

	Initial add, ddraid

2005-06-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Put saved messages on the right lists

2005-06-10  Lon Hohberger  <lhh@redhat.com>

	Add Patrick's initial fence_xen to fence Xen virtual machines.

2005-06-09  David Teigland  <teigland@redhat.com>

	Replace test_bit(), set_bit(), clear_bit() of rsb flags with rsb_flag(), rsb_set_flag(), rsb_clear_flag() which use the less expensive non-atomic bit operations. c.f. include/net/sock.h

2005-06-09  Patrick Caulfield  <pcaulfie@redhat.com>

	cmand depends on commands.o not commands.c

2005-06-08  David Teigland  <teigland@redhat.com>

	Use ccs to get a node's optional weight value.

	default weight is 1 not 0

	Use node weights in directory node mapping.  A node is responsible for a portion of the directory equal to it's weight divided by the sum of weights from all nodes.  By default a node has a weight 1. All nodes with weight 1 is the standard old behavior.  If all nodes have weight 0, all revert to weight 1.

2005-06-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix crash with barriers, caused by overtidying.

	ccs.h is not really a dependancy

2005-06-07  Lon Hohberger  <lhh@redhat.com>

	Add patch from Frederik Schueler to remove implicit dependency on rdisc

2005-06-06  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Added some diagnostic messages for when clients/slaves cannot connect to a LT.  They're under the Network2 verbosity setting.

2005-06-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Move a bit more stuff around. Fix Makefile dependancies

2005-06-03  Patrick Caulfield  <pcaulfie@redhat.com>

	A bit more tidying.

	Fix some comments

2005-06-03  David Teigland  <teigland@redhat.com>

	This patch makes needlessly global code static. Signed-off-by: Adrian Bunk <bunk@stusta.de>

	look through correct list (members_gone, not members) for recovering node when gfs does recovery_done

	adjust some log_error() messages and open syslog when daemonized

	Add two comments in set_master() explaining how things work.

	When an outstanding lookup is re-processed after recovery, the MASTER_WAIT flag needs to be cleared first or the lkb will be made to wait on the rsb's lookup list, i.e. waiting for itself.  Also add a FIXME comment describing a related recovery scenario we don't yet handle correctly.

	All lookups outstanding when recovery happens need to be resent after recovery.  The RESEND flag was not being set on these lkb's, through, so the lookups were never being resent.

	when freeing locks for withdraw, don't try to free fake lvb's

2005-06-02  David Teigland  <teigland@redhat.com>

	correctly interpret the return value of do_barrier

	don't need to include lvb_table.h

2005-06-01  A. J. Lewis  <alewis@redhat.com>

	 o Fix for fenced portion of bz #155478

2005-06-01  Patrick Caulfield  <pcaulfie@redhat.com>

	I always miss one of 'em.

	move everything around! split cman into several files:
	cnxman.[ch]	Comms
	membership.[ch]	Membership thread
	commands.[ch]	Processes commands from libcman
	barrier.[ch]	Barrier code
	logging.[ch]	Logging
	daemon.[ch]	Daemon control. the select loop & messaging.

2005-06-01  David Teigland  <teigland@redhat.com>

	recovery timer can't be global, it must be per-lockspace

2005-06-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Add option for 2-node cluster. Fix create help. Fix buffer overflow if output filename was longer than input filename.

2005-06-01  David Teigland  <teigland@redhat.com>

	fix calculation of previous low nodeid

	look through correct list for failed nodes needing recovery

2005-06-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Use sockaddr_storage rather than sockaddr_in6

2005-06-01  David Teigland  <teigland@redhat.com>

	start group id's at 1 instead of 0

	close fd's of dead clients

	- include everything that needs sending in the standard message struct   instead of having extra data follow the msg struct - fix up how to_nodeid is handled in messages so it gets byte swapped   like the other fields

2005-06-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix potential SMP race

2005-06-01  David Teigland  <teigland@redhat.com>

	remove repeated include of module.h header

	munging to match upstream correction of export symbol lvb_operations

	Work around gcc-2.95.x macro expansion bug (from akpm)

2005-05-31  David Teigland  <teigland@redhat.com>

	kobject was being freed too early in withdraw

	use correct list field in group struct

	only print debug lines to stderr when -D is used

	remove noisy debug line

	remove temp debug bits, add 'dump' option to get debug log from groupd

	new file

	bits for withdraw

	only print debug info to stderr when -D is used

	changes to debug logging

2005-05-31  Patrick Caulfield  <pcaulfie@redhat.com>

	Fail if the nodename maps to the loopback device.

2005-05-30  David Teigland  <teigland@redhat.com>

	export dlm_lvb_operations symbol so dlm_device module can use it

2005-05-27  David Teigland  <teigland@redhat.com>

	tidy error handling

	don't depend on leave state here, always go to groupd

2005-05-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Bring forward some fixes from the kernel-based cman.

2005-05-27  David Teigland  <teigland@redhat.com>

	option to list only one group option to connect to groupd as a client for debugging

	a lot of fixes, use messages instead of barriers from libcman

	changes to debugging output, don't try another leave if one is in progress

	Set ls_first for gfs when a spectator is first to mount so gfs can bail out if there are any journals.  ls_first still always set for first participant that mounts.

	install daemon

2005-05-27  Ken Preslan  <kpreslan@redhat.com>

	o  Fix a bug I introduced that would keep GFS from replaying a journal on    first mount. o  Fix a race where an incore inode could be dealloced twice. o  Other munging.

	Fix errors on rebuilds.

2005-05-26  Lon Hohberger  <lhh@redhat.com>

	Don't assume child nodes exist just because someone asks for them

	Ask for node name instead of for the existence of children from ccs

2005-05-26  David Teigland  <teigland@redhat.com>

	restart events after a delay

	tidying, do ifdefs around debugfs functions in a consistent way

	fix-dlm-extern-lvb_table.patch

	fix-dlm-without-debug.patch

	dlm needs 2.6.12, don't build until that's out

2005-05-25  Lon Hohberger  <lhh@redhat.com>

	Make magma_ucman deliver CE_SHUTDOWN when it should; make magma_tool ignore SIGPIPE so it can trap for closed sockets.

2005-05-25  Jonathan Brassow  <jbrassow@redhat.com>

	- Teigland's patch to make CCS skip clustering and just read the local cluster.conf

2005-05-25  David Teigland  <teigland@redhat.com>

	memcpy all the data after cman_get_nodes

	copy all the data from cman_get_nodes

2005-05-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't lose the port number

2005-05-25  David Teigland  <teigland@redhat.com>

	use libcman to check if victim has rejoined

	Need to check the cn_member field to tell if a node is a member, not just that it's in the list returned from libcman.

	not doing patches

	list new daemons that need to be started

	clean and install in group dir

	install groupd and group_tool

	build in lock_dlm

	add makefile

	don't build cman-kernel

	build src2 instead of src

	remove cman-kernel usage

	don't build deprecated cman and sm dirs look for libs and lib headers within the cluster tree

	get libdlm.h from the correct place within the tree

2005-05-25  Ken Preslan  <kpreslan@redhat.com>

	o  Allow the appropriate FS-specific mount options to be changed on remount    (BZ 156780). o  Fix statfs when in spectator mode. o  Cheat to make permission() faster. o  Simplify truncate code. o  Get rid of unnecessary RO flag. o  Update man pages. o  Other munging.

2005-05-24  Jonathan Brassow  <jbrassow@redhat.com>

	- fix SEG FAULT

2005-05-24  David Teigland  <teigland@redhat.com>

	Dynamic journal ids, done here using a simple message through libcman (may want to use dlm locks for this again sometime.)

	avoid double free of rsb's lvb when clearing lockspace

2005-05-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Use getaddrinfo rather than the (obsolete) gethostbyname2 call.

2005-05-24  David Teigland  <teigland@redhat.com>

	zero padding for id

	complete some missing bits; verify cluster name at mount, verify fence domain is joined at mount, support spectator option

	simplify code in the mount path

	fix uninitialized pointer in daemon, handle get_groups properly in lib when there are none to return

	align text

	recognize get_group request in daemon, use memcpy for info data, print debug state in group listing

	munge group data returned in query

2005-05-23  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	fixup man page.

2005-05-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Only print "waiting for cman" if verbose flag is set.

	deprecated.

	Add a userland-cman plugin for magma. I've only tested this with ccsd. Lon, you might like to check this !

2005-05-23  David Teigland  <teigland@redhat.com>

	implement group_get_group() to get info for single group

	make spectator and withdraw options visible through sysfs

	Implement join/leave info: a small string of app-specific data that an app can provide when joining or leaving that can be read by the other members.

	some byte-swapping calls were still commented out remove unused length field in message

	remove devel files

	replace with new version of lock_dlm in devel/

	put back flags to ignore certain messages, other minor stuff

2005-05-20  David Teigland  <teigland@redhat.com>

	initial bits to report group listing

	fix leave

	re-enable byte-swapping of messages

2005-05-20  Patrick Caulfield  <pcaulfie@redhat.com>

	unregister_lockspace() now works.

2005-05-20  David Teigland  <teigland@redhat.com>

	the call to process_recover_msg() had been commented out during porting and never uncommented

	- remove the group struct when we're done leaving - don't reference ev struct after it may have been freed

	various fixes completing switch to libgroup

	return 0 on success from group_join/leave

	build fence_tool

	add comment

	join/leave now just send messages to fenced which must already be running

	changing things so group_join/group_leave are initiated by fence_tool messages

	munging

2005-05-19  Chris Feist  <cfeist@redhat.com>

	Changes to the way the local build works:
	Instead of running a make install from the top level into a 'build'
	directory we now just configure each package with the proper include
	directories for header files and libraries.  This should help prevent
	accidently using files that are locally installed on the system (instead
	of the files in CVS).

	This should also make it easier for external people to build from HEAD.

	Please let me know if there are problems or something doesn't work
	quite right.

2005-05-19  David Teigland  <teigland@redhat.com>

	better debug output

	clear old recovery flags (LOCKS_VALID) when recovery begins

	don't build fence_tool, not updated yet

	new version using libgroup and libcman

	add missing make_args

2005-05-19  Ken Preslan  <kpreslan@redhat.com>

	o  Changed the lookup so it doesn't need to take the new inode's glock.    This simplifies it a lot. o  Other cleanup.

	Fix BZ158133. Fix an oops that occurs when an acl is set that consists of nothing but a header.

	munge

	Fix BZ158133. Fix an oops that occurs when an acl is set that consists of nothing but a header.

2005-05-18  Chris Feist  <cfeist@redhat.com>

	Added LDFLAGS variable in Makefile so dlm_tool will build if libdlm_lt is not installed.

2005-05-18  David Teigland  <teigland@redhat.com>

	missed new file

	add group_leave arg

	add daemon and dlm_tool

	fix sprintf's

	really use libgroup

	use libgroup

	add Makefile

2005-05-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Add dummy struct to keep compilation clean.

	Missed header, sorry.

2005-05-18  David Teigland  <teigland@redhat.com>

	don't add duplicate local addresses

	add \n to printk's

	change read_lock to read_unlock

2005-05-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Build against dlm-kernel/src2 This (temporarily I hope) disables the query interface as dlm2 only has the base locking primitives ATM.

	Improve "can't connect to cman" error.

2005-05-17  David Teigland  <teigland@redhat.com>

	remove unused function

	add _GPL to EXPORT_SYMBOL

2005-05-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Use a different method for findin broadcast addresses. interfaces of the for "eth0:0" are now usable.

2005-05-16  David Teigland  <teigland@redhat.com>

	don't add connection if accept fails

	lib interface for groupd

2005-05-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't allow name= as a fence argument as it causes problems.

2005-05-13  David Teigland  <teigland@redhat.com>

	daemonize

2005-05-13  Lon Hohberger  <lhh@redhat.com>

	Fix for example.conf

2005-05-12  Lon Hohberger  <lhh@redhat.com>

	Fix arg swap problem when reading from stdin

	Fix arg parsing

2005-05-12  David Teigland  <teigland@redhat.com>

	no parens around defined values

	don't want .orig from patch

	change debug message

	end files with \n

	remove trailing white space

	- remove a couple FIXME questions - call confirm_master() in grant_after_purge() in case the node   became master of the rsb during recovery and had locks waiting   for master confirmation before being processed

	fix up some comments

	- get all lines under 80 - replace printk with log_print() - remove unused function

	remove the timeout in wait_function which was for debugging, and don't print all rsb's when clearing the recover_list

	Move recover_rsbs() to the main recovery section, requires a new status barrier after recover_locks().

	dlm_recover_members_wait() and dlm_recover_directory_wait() moved to recover.c; wait_status functions are now static

	Wait until all locks are recovered before doing lvb recovery. This simplifies the process and doesn't waste time running the lvb recovery routine multiple times on some rsb's.

	spinlock fix from patrick

2005-05-12  Ken Preslan  <kpreslan@redhat.com>

	Fix bug #129468 Serialize the block mapping code so a writepage() call can't see the file tree in an inconsistant state.

2005-05-11  Ken Preslan  <kpreslan@redhat.com>

	Refix a problem with the rename lock.  Don't associate it with rename transactions.

2005-05-11  Lon Hohberger  <lhh@redhat.com>

	fix targetted relocation bug when running with gulm

	Bull PAP + Bull IPMI-over-LAN support

2005-05-11  Ken Preslan  <kpreslan@redhat.com>

	Fix a couple of rename() bugs.

2005-05-11  Lon Hohberger  <lhh@redhat.com>

	Fix API change: we no longer get Logged_out after Fenced

2005-05-10  Ken Preslan  <kpreslan@redhat.com>

	gfs2_jadd and gfs2_grow.

	o  Add back code to support gfs2_grow and gfs2_jadd. o  Start checking for dirty journals when freezing again.

2005-05-10  Lon Hohberger  <lhh@redhat.com>

	Fix fd leak, change resource-group -> service, fix node ID display

	Fix file descriptor leak in services.c

2005-05-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Refill the nodes write queue once we are woken up after -EAGAIN.

2005-05-10  David Teigland  <teigland@redhat.com>

	use cman barriers again

	adjust size of write, remove prints

2005-05-09  Lon Hohberger  <lhh@redhat.com>

	Fix 157248

2005-05-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Address numbers start at 1

	Add options to cman_dispatch() so that callers can filter out non-interesting messages. These will be saved on a list and sent when the user is again interested in them.
	This is used by the query functions, they prevent and DATA or EVENT messages
	being dispatched while waiting for (eg) barriers to complete.

2005-05-09  David Teigland  <teigland@redhat.com>

	send a status request to every member at the start of recovery just to establish lowcomms connections with everyone

	make purge_queue() more general purpose, no functional change

	Tiny code change to implement significant optimization: if a node receives a lookup and is the master itself, process the lookup as a request and return a request reply.

	- big reordering of functions in lock.c to avoid declaring some   prototypes at the start - add inline to a bunch of lock.c functions - make lock_rsb/unlock_rsb lock.h inlines

2005-05-07  Ken Preslan  <kpreslan@redhat.com>

	Update.

	Fix problem of writepage() needing to map blocks at weird times when another process might be changing the metadata tree.  Added some locking so the writepage never sees an inconsistent tree.
	Plus some cleanups in the recusive glocking code.

	Add "gfs2_tool getargs" to get the gfs-specific mount arguments used to mount a filesystem.

2005-05-06  Ken Preslan  <kpreslan@redhat.com>

	Clean up journaled data code and metadata I/O code.

2005-05-06  David Teigland  <teigland@redhat.com>

	ignore start events if lockspace is running to avoid an assert failure

	NEW_MASTER flag wasn't being cleared on rsb's remastered locally

	move is_master() to lock.h and use it in recover.c

2005-05-06  Ken Preslan  <kpreslan@redhat.com>

	Unlock the page when erroring out of writepage().

	Fix a misinitialization in the diaper device.

2005-05-05  Lon Hohberger  <lhh@redhat.com>

	Arbitrary resource tree patch

2005-05-05  Ken Preslan  <kpreslan@redhat.com>

	Munge.

	Fix broken makefile.

2005-05-05  David Teigland  <teigland@redhat.com>

	status replies include a new "rcom_config" struct that is used to verify config params (like lvb length) are the same between nodes

2005-05-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Add the new commands to the ccs_tool man page. and fix a bad example.

2005-05-05  David Teigland  <teigland@redhat.com>

	improve comments and remove log_print about partial messages

	tidy a few things

2005-05-05  Patrick Caulfield  <pcaulfie@redhat.com>

	If we failed to resolve the broadcast address, print the interface. 100:1 it will always read "lo".

2005-05-05  David Teigland  <teigland@redhat.com>

	fix a couple remaining over-80 lines

2005-05-05  Ken Preslan  <kpreslan@redhat.com>

	o  Honor "data=ordered" for truncates o  Partially completed truncates now resume after a crash o  Fix a big performance problem caused by a mis-initialization in the    diaper code. o  Be smarter about deallocations when "data=ordered" is used. o  Misc munging

2005-05-04  Benjamin Marzinski  <bmarzins@redhat.com>

	Heres my fix of a fix of a fix. I wasn't initializing a list that needed to be initialized.

2005-05-04  David Teigland  <teigland@redhat.com>

	byte swapping wrong size in rcom struct

2005-05-04  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove some unnecessary includes. InitParser before doing a create. It doesn't seem to be necessary now...but.

2005-05-04  David Teigland  <teigland@redhat.com>

	specify lvblen when creating lockspace, 32 bytes

	kernel apps must specify the lvb size they'd like (multiple of 8 bytes) user apps continue to have a fixed size of 32 bytes

	do a schedule/retry when kernel_sendmsg() returns -EAGAIN, a work-around until write_space() works on the socket

	style stuff, mainly making lines under 80

	make the waitqueue usage more standard

2005-05-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Move cluster_conf into ccs_tool

2005-05-03  David Teigland  <teigland@redhat.com>

	- changes to debug messages - increase size of tmp buffer in midcomms - null terminate string of nodeids from sysfs

2005-05-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Check in the source rather than a  binary, sigh

	Add command-line utility for managing cluster.conf files.

2005-05-03  David Teigland  <teigland@redhat.com>

	skip barriers for now

	improve debug logging

2005-05-03  Benjamin Marzinski  <bmarzins@redhat.com>

	This fixes bz # 156635. A variable that I allocated statically in my fix for 155597 needed to be allocated dynamically.

2005-04-29  Ken Preslan  <kpreslan@redhat.com>

	Don't do write_inode if we're PF_MEMALLOC. Munging.

	munge.

	Fix ACL leak.

2005-04-29  Benjamin Marzinski  <bmarzins@redhat.com>

	Fix for bz #155597. GFS used to be able to write over a portion of the log while it was still needed. The fixes that.

2005-04-29  Lon Hohberger  <lhh@redhat.com>

	Fix frim Birger

2005-04-29  David Teigland  <teigland@redhat.com>

	need del_timer_sync() with the new timer-based dlm_wait_function() that was recommended

2005-04-28  David Teigland  <teigland@redhat.com>

	patch from Steve Dake to avoid using clm library

	ast_queue_lock can be a spinlock

2005-04-28  Ken Preslan  <kpreslan@redhat.com>

	Add back NFS support.

2005-04-27  Ken Preslan  <kpreslan@redhat.com>

	Get rid of an osi_.

2005-04-27  Lon Hohberger  <lhh@redhat.com>

	Fix timeouts for 32-way bull machines

2005-04-27  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	gcc4-isms

	fixup libs

2005-04-27  David Teigland  <teigland@redhat.com>

	- need to lock_rsb/unlock_rsb in recover_locks() because   dlm_recover_process_copy() may operate on the same rsb before   we're done - in recover_locks() we should only add the rsb to the recover_list   if there were locks recovered for it, it was added unconditionally - need to break from dlm_recover_locks() if recover_locks()   returned an error, we weren't checking the return value CVS ----------------------------------------------------------------------

	spell out DLM at the top

	- check if lvb alloc failed - move new code for async convert into send_convert (cleaner)

2005-04-27  Patrick Caulfield  <pcaulfie@redhat.com>

	events are not REPLYs.

	Allow cman_tool to override the node name when joining.

2005-04-27  David Teigland  <teigland@redhat.com>

	- set lkid in user's lksb earlier so they don't see 0 - do async (ack-less) remote down-conversions

2005-04-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Use local libcman

2005-04-27  David Teigland  <teigland@redhat.com>

	go back to schedule_timeout() instead of msleep() in dlm_scand, not sure what the msleep was doing

	- dynamically adjust the delay when polling a node for its status,   starting with 20 ms and adding 20 each time. - add to debug message the time recovery took

	don't wrap wait_event in an infinite loop and use a timer

	also return -EBUSY for convert if lkb_wait_type is non-zero

	put the '*' just to the left of the structure field

2005-04-27  Ken Preslan  <kpreslan@redhat.com>

	Fuzzy statfs(): When statfs() is called, the return value is the state of the whole filesystem was in sometime in the last X seconds plus any local changes. This algorithm is very similar to the way we do quotas.  X is a tunable parameter, statfs_quantum.  (The default is 60 seconds.)  A statfs() call now requires no network or disk I/O.

2005-04-26  Ken Preslan  <kpreslan@redhat.com>

	Add some new block types.

	Rearrange some assignments to work with gcc4.

2005-04-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Use local libcman

2005-04-26  David Teigland  <teigland@redhat.com>

	make scan/toss_secs dlm_config values, get rid of empty lockspace_exit

	was hoping to avoid this, but search on every lkid we create to verify it's not in use

2005-04-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Undo some of the "tidying" done by indent.

	Use rwlock rather than rw_semaphore

2005-04-26  David Teigland  <teigland@redhat.com>

	depends on INET, select IP_SCTP

2005-04-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove some redundant stuff. change uint*_t to __u*

2005-04-26  David Teigland  <teigland@redhat.com>

	misc other formatting and tidying from reviews

	newlines

	some misc tidying, use printk log levels

	- get rid of parentheses around defined values - use the kernel.h max_t() instead of our own MAX()

	clean up some spots where we don't need error handling, complete the error handling in some other places

	use msleep and ssleep instead of schedule_timeout

	"But, in any case you might as well move the label 'top' inside the if just before the for loop, since the only place you ever  goto top you've just set ri->next to NULL, so you know you are going to end up inside the if in any case, no need to actually do the test every time." Jesper Juhl

2005-04-26  Ken Preslan  <kpreslan@redhat.com>

	Remove some debug code.

	GFS2.  Still a work in progress.  But it should be faster.

2005-04-25  David Teigland  <teigland@redhat.com>

	update FIXME comment

	read_lock will do when creating root_list

	move some recovery-related functions from lock.c to recover.c

	more fixes

	adjust

	Initial untested code for recovering conversions between PR and CW.

	reduce debug noise

	In-progress down-conversions should just be completed at the start of recovery.  Note that PR/CW conversions need work.

	return an error if no local addr's are set

	free rsb's on toss list during recovery so they don't need to be recovered; wasn't freeing lvb's on rsb's

	- grant_after_purge only on master rsb's - dlm_message_in is done before saving on requestqueue (not again after) - reject finish events with incorrect event_nr - don't set lkb_status directly when receiving new master-copy lock   during recovery; add_lkb wants to set that itself - hold/put lkb needed around unlock/cancel processing in   dlm_recover_waiters_pre (match correct refcounting in normal case) - copy args to lkb in receive_unlock/cancel only after locking the   rsb (like we now do with validate_args) - return errors instead of asserting in some spots - copy args to lkb only after the range/lvb alloc which may fail - don't scan for rsb's to free while the ls is being recovered

2005-04-24  Ken Preslan  <kpreslan@redhat.com>

	Quit yer whining.

	Let there be compilation!

	Rearrange order so it actually compiles.

2005-04-23  David Teigland  <teigland@redhat.com>

	Pass nodeid/addr info directly from node_ioctl.c to lowcomms where it's used, removing the extra staging of the info in member.c where it's not relevant.  Also a little lowcomms tidying.

2005-04-22  Lon Hohberger  <lhh@redhat.com>

	msg_init isn't ready yet; remove for now

2005-04-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Make debugging comfigurable without a recompile. Read config variables (those that were in /proc) from CCS.

	Lots more comments in libcman.h Rename cman_get_join_count() to cman_get_subsys_count() to avoid confusion.

2005-04-22  David Teigland  <teigland@redhat.com>

	Fix one of the big fixme's: immediately after finding the lkb in dlm_lock() and dlm_unlock() we were checking and filling in the lkb's fields all without the rsb locked.  We now pass the necessary input args down to the next stage so they can be safely saved in the lkb after the rsb is locked.

	remove some complexity

	get rid of DLM_RELEASE_NAME

	update description of dlm.h flags

	remove query bits that were commented out of device code

	seems EXPORT_SYMBTAB isn't used any more

2005-04-21  Lon Hohberger  <lhh@redhat.com>

	Fix GCC4 warnings

2005-04-21  Patrick Caulfield  <pcaulfie@redhat.com>

	argv[0] should be "cmand" not "cman"

2005-04-21  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	install symlinks to the .so make .a with ar not ld
	 - patch via Fabio M. Di Nitto

2005-04-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't leave debugging on by default.

	libcman to go with userland cman daemon

	Userland cman daemon.

2005-04-21  David Teigland  <teigland@redhat.com>

	- remove hierarchical sections that were commented out so it can all   be added together - clear up naming inconsistency lkid/remid parent_lkid/parent_remid

	remove sbf flag

2005-04-20  Lon Hohberger  <lhh@redhat.com>

	Add NBB1600 support + fix IPS800[CE] support

2005-04-20  Patrick Caulfield  <pcaulfie@redhat.com>

	zero the difference between a sockaddr_* and a sockaddr_storage

	use lvm_operations array to determine whether the LVB was updated or not.

2005-04-20  David Teigland  <teigland@redhat.com>

	Move the __lvb_operations table into lvb_table.h so it can be included by device.c

	use long to save pointer val

	pack_rcom_lock/receive_rcom_lock_args was missing lkb_status and astaddr's

	use prefered inline

	Improve logic that delays and reduces fencing.  When fenced is recovering for a failed node, the 'post_fail_delay' is used to give victims some time to rejoin the cluster and avoid being fenced.  If this happens once, then it's likely to happen again and the 'post_join_delay' is more appropriate, so fenced switches to the 'post_join_delay' value (if it's larger which is usually the case.)
	The common situation where this helps is when multiple nodes fail causing
	the cluster to lose quorum and then the failed nodes all rejoin the
	cluster at about the same time.  The rejoining nodes are more likely
	to all avoid being fenced if fenced uses the larger post_join_delay.

	lock_dlm now exits, and pool doesn't

	a couple updates

	queries are waiting until after the first round

	remove print formats we're not using

	patches used by 'make patches' to generate complete dlm.patch

	update make patches

	build stuff

2005-04-19  Lon Hohberger  <lhh@redhat.com>

	Fix options description

2005-04-19  David Teigland  <teigland@redhat.com>

	unmount bits

	recover_done, not done is sysfs file name

	don't confuse lock_dlm's uevents as ours

	misc fixes

	userspace version of kernel's list.h

	lock_dlm daemon manages mount-group membership in userspace

	wasn't closing fd's for sysfs files

	include groupd.h

	process group manager

	preparing to build from linux/drivers/dlm/

	update copyrights

	- make functions static - add dlm_ prefix to some functions - remove stuff not being used

	byte swapping

2005-04-18  Benjamin Marzinski  <bmarzins@redhat.com>

	fixed bug that caused gnbd_monitor to only successfully monitor a device until it failed once. Also, made it so gnbd_monitor didn't wait for all the users of a failed device to close it before trying to reimport it.

2005-04-18  David Teigland  <teigland@redhat.com>

	use correct libcman

	can now use openais

	most of the byteswapping

	dlm_member gone

	dlm_node.h replaces dlm_member.h add empty byte swapping functions

	node ioctl changes

	simplify the ioctl bits now that they're only used for setting node addresses, and rename to node_ioctl since it's no longer related to lockspace membership

2005-04-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Add DLM_SBF_LVBUPDATED, needed by userland i/f

	Seperate out device.c into its own module that only depends on the external DLM interfaces.

2005-04-15  David Teigland  <teigland@redhat.com>

	cancel waiting locks; remove last lkb ref in both revert/remove_lock so they're consistent

	reject invalid event_nr's on start

	add missing wake_up

	fix bug in recover_master_copy

2005-04-14  Ken Preslan  <kpreslan@redhat.com>

	Fix bug #154902: Replace the function that gets confused on certain device sizes with a different function -- a new and improved one, that always knows what it's doing.

2005-04-14  Lon Hohberger  <lhh@redhat.com>

	Fix bonding link detection (port from clumanager 1.2.26)

2005-04-14  David Teigland  <teigland@redhat.com>

	don't do useful work in an assert macro

2005-04-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Set unlock artarg

2005-04-14  David Teigland  <teigland@redhat.com>

	a couple fixes

	next version of lock_dlm, a bunch of stuff is moved to userspace

	quit waiting for fenced to join (-w) after 10 seconds if fenced hasn't even begun joining yet; usually means fenced has exited

2005-04-13  Adam Manthei  <amanthei@redhat.com>

	Changes to the init scripts.  BZ's 153739 and 153741.

2005-04-13  Jonathan Brassow  <jbrassow@redhat.com>

	- remove cmirror target

2005-04-13  David Teigland  <teigland@redhat.com>

	clear up confusing names

	update lvb recovery function

	misc recover fixes

	complete more of the bits that are replacing rebuild.c

2005-04-12  David Teigland  <teigland@redhat.com>

	changes for debugfs

	misc minor updates

	comment out noisy logging

	refcount fixes, now requires post 2.6.11 version of kref_put

	same schedules that were added to the RHEL4 branch so serviced doesn't chew up CPU

2005-04-11  David Teigland  <teigland@redhat.com>

	outline for last recovery stage that replaces rebuild.c

	new rcom routines that use normal lowcomms get/commit_buffer

	change to per-ls the list of lkb's waiting for reply, split a couple reply-processing functions to remove some duplicated recovery code

2005-04-08  David Teigland  <teigland@redhat.com>

	couple fixes and thread to free rsbs

2005-04-08  Jonathan Brassow  <jbrassow@redhat.com>

	- typos

	- no cman on upgrade.

	- commit changes so I don't loose them.

2005-04-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Get userland working again.

2005-04-08  David Teigland  <teigland@redhat.com>

	several fixes

2005-04-07  Benjamin Marzinski  <bmarzins@redhat.com>

	Modified gnbd so that it can be used with multipath easier. When you export a gnbd, it will try to grap a unique id from the underlying device with scsi_id.  If it can't it will use the gnbd name as the unique id.  It is possible to override this with -u.  gnbd_import can get the unique id of a device it has with the -d option.

2005-04-07  David Teigland  <teigland@redhat.com>

	bunch of fixes

2005-04-06  David Teigland  <teigland@redhat.com>

	better way of returning some errors, more recovery bits

	bug fixes

	fix some bugs

	copy other hash function from gfs which works as well, but without the big table

2005-04-05  David Teigland  <teigland@redhat.com>

	don't need cluster link

	add file

2005-04-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Say something if sendmsg fails.

2005-04-05  David Teigland  <teigland@redhat.com>

	remove files

	changes to existing code corresponding to new lock.c

	add files

	some fixes from testing

2005-04-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Add a test prog that got lost

2005-04-04  David Teigland  <teigland@redhat.com>

	backup recent work

2005-03-31  David Teigland  <teigland@redhat.com>

	back up work

2005-03-31  Ken Preslan  <kpreslan@redhat.com>

	Start including gfs_debug in the build.

2005-03-30  David Teigland  <teigland@redhat.com>

	backup recent work

	an example of using dlm_tool

2005-03-29  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix a couple of memory leaks Initialise idr_members lock

2005-03-29  David Teigland  <teigland@redhat.com>

	Add version number to the start of all dlm messages to help with future upgrading.  This change is incompatible with previous versions of the dlm.

	simplify dlm_astd handling by removing the wait_queue; and avoids a possible hang when shutting down dlm threads

2005-03-28  David Teigland  <teigland@redhat.com>

	add error message

	error message

	couple fixes

	use info from cman to do set_local/set_node calls into the dlm

	couple fixes

	include event_nr in done message to groupd

	another small bit for rsb refcounts

2005-03-26  David Teigland  <teigland@redhat.com>

	On Fri, Mar 25, 2005 at 03:22:38PM -0800, Daniel McNeil wrote:
	Looking at the code, the problem is a race condition between
	dlm_astd() and release_lockspace().  dlm_astd can pull an
	lkb off the ast_queue and still be processing it while the
	release_lockspace() is running calls dlm_dir_clear() and
	then kfree()s ls->ls_dirtbl.  When dlm_astd() calls
	release_rsb() it leads to a dlm_dir_remove() which accesses
	the freed ls_dirtbl which is freed.  With slab debug, this
	leads a spinning write_lock() and a hung umount.  My machines
	are 2 cpu systems which also might expose the race condition.

	The fix is below and is fairly simple, just do the astd_suspend()
	in release_lockspace() before the dlm_dir_clear() and kfree().
	That way astd won't be process lkb on the astqueue will it
	is being freed.

2005-03-25  David Teigland  <teigland@redhat.com>

	more work, largely refcounting related

2005-03-24  Lon Hohberger  <lhh@redhat.com>

	Fix timeout bugs

2005-03-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove redundant struct member

	Fix memory leak if a joining node fails.

2005-03-24  David Teigland  <teigland@redhat.com>

	more work

2005-03-23  David Teigland  <teigland@redhat.com>

	version 2 of the central locking logic, eventually to replace locking.c and lockqueue.c

2005-03-21  Lon Hohberger  <lhh@redhat.com>

	add init.d to install set

	fix warning

	Use service instead of resourcegroup as root resource to match the UI and user expected behavior / terminology

	Fix various bugzillas (see ChangeLog)

2005-03-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix usage message for -n

	man pages are wnderful things - when you read them. Use hstrerror rather than strerror to print errros from gethostbyname2_r

	Use correct errno when reporting errors from gethostbyname2_r

	Set join time on local node

2005-03-18  Benjamin Marzinski  <bmarzins@redhat.com>

	added man page for gnbd_serv

	Syncing head with RHEL4 branch. Added fix for 151321. gnbd now defaults to getting the node name from the cluster manager Added Bastian Blanks patchs to the man pages

2005-03-18  David Teigland  <teigland@redhat.com>

	change sleep(1) to sleep(5) between a failed fence and a retry

2005-03-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't return an error on normal, synchronous, non-threaded unlock

2005-03-18  David Teigland  <teigland@redhat.com>

	use ls_debug_list for debugfs

	fix release and convert actions; use persistent flag on locks

	dlm_astd in wait_event_interruptible wasn't being woken by kthread_stop(), so quit using a wait_queue.

2005-03-18  Ken Preslan  <kpreslan@redhat.com>

	Fix precedence error.

2005-03-17  David Teigland  <teigland@redhat.com>

	a simple daemon to listen/talk to dlm in the kernel, connecting it with the userland group manager

	deal with some errors better

	hooks things up to debugfs

	making nodeid an int consistently

2005-03-16  David Teigland  <teigland@redhat.com>

	moving lock dumps to debugfs, copying previous proc.c and ipoib_fs.c

2005-03-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Increase size of gethostbyname_r buffer and improve error if it fails.

2005-03-16  David Teigland  <teigland@redhat.com>

	increase DLM_ADDR_LEN to 256 bytes -- must be at least as large as sockaddr_storage (128)

	need the sockaddr struct, not a pointer

	more addr length fixes

	- use the new timeout variety of wait_event - only copy length of sockaddr_storage to lowcomms

	remove usage of proc

2005-03-15  David Teigland  <teigland@redhat.com>

	cman doesn't provide proc entries

2005-03-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Slightly more sensible error returns for some join functions too.

	Replace the old nodeids array with idr_ routines.

	Don't need -lpthread

	Better error messages

2005-03-15  David Teigland  <teigland@redhat.com>

	fix output in /sys/kernel/dlm/<name>/members

	split some functions into another file so they can be shared

2005-03-14  Lon Hohberger  <lhh@redhat.com>

	Fix 151095

2005-03-14  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	soft link libs for lon

2005-03-14  Lon Hohberger  <lhh@redhat.com>

	add resource rule printout to rg_test

	Clusterfs.sh / fs.sh fixups

	Show stdin options with -h

2005-03-14  David Teigland  <teigland@redhat.com>

	complete lock code

2005-03-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Make the _sync calls available to non-pthread applications.

2005-03-14  David Teigland  <teigland@redhat.com>

	command line interface for libdlm operations create/release/lock/unlock

	Use sysfs for lockspace control.  And set_id is a new action instead of being part of start.

	Use sysfs for lockspace control.  dlm-member ioctl's now only used for node id/addr settings.

2005-03-12  Ken Preslan  <kpreslan@redhat.com>

	Change it so a spectator has a 's' instead of the jid in its fsid.

2005-03-11  Ken Preslan  <kpreslan@redhat.com>

	Add a new "flags" parameter to lm_mount() of the lock module interface. When the flag LM_MFLAG_SPECTATOR flag is passed in to the lock module, GFS is asking to join the filesystem's lockspace, but it doesn't want to modify the filesystem.  The lock module shouldn't assign a journal to the FS mount.  It shouldn't send recovery callbacks to the FS mount.  If the node dies or withdraws, all locks can be wipped immediately.
	If the lock module doesn't implement the flag, GFS will work as expected
	except that the mount will reserve a journal it will never use.

	Add and implement a "spectator" mount option to GFS to take advantage
	of the spectator mount flag.  When the mount option is used, the FS
	looks just like a RO filesystem.  The difference is you can have lots and
	lots of them.

2005-03-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Build libcman

	Remove unused variable

	Don't try to add too many addresses.

2005-03-11  David Teigland  <teigland@redhat.com>

	make the weight arg optional

	copy ast_queue fix from src files

	When shutting down a lockspace we can remove lkb's from the ast_queue without holding the ast_queue_lock.  The dlm_astd thread is suspended, but it's possible that queue_ast() could be called by someone which modifies the ast_queue.  We now do the correct locking.

	copy cancel fix from src/

2005-03-10  Ken Preslan  <kpreslan@redhat.com>

	Munged printk() ordering.

	Add "debug" mount option.  Causes gfs_assert_warn() and gfs_lm_withdraw() to BUG().

2005-03-10  Patrick Caulfield  <pcaulfie@redhat.com>

	lowcomms for the new src2 DLM. This uses SCTP for transport and therefore should support multihome systems transparently.

2005-03-10  David Teigland  <teigland@redhat.com>

	misc small bits, handle >1 local addr.

	When gfs does an lm_cancel() we need to do a dlm cancel if that's where the lock is blocked.  We were doing nothing.  Changes also to deal correctly with the ast result from a dlm cancel and the potential for a cancel to return an error.

	Fix problems with cancelation.  We weren't dealing with waiting locks being canceled, and we weren't sending back an adequate result for a remote unlock to deal with a cancel.

2005-03-09  Lon Hohberger  <lhh@redhat.com>

	Properly cast

	Change to arch-dependent char instead of uint8_t

2005-03-09  A. J. Lewis  <alewis@redhat.com>

	 o Slight modification to fsck man page for new fsck

2005-03-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix dependancies for join_ccs.o

	Clean transitionreason after a state transition has finished.

2005-03-08  David Teigland  <teigland@redhat.com>

	fix small things to get working

2005-03-07  A. J. Lewis  <alewis@redhat.com>

	 o continue instead of breaking on errors in scan_inode_list()  o Clear inode's metadata bitmaps when clearing the inode itself  o Make sure the variable you're using for the block number is valid

2005-03-07  Lon Hohberger  <lhh@redhat.com>

	Fix 150481, part 2

2005-03-07  Ken Preslan  <kpreslan@redhat.com>

	Compiling is always nice.

2005-03-07  Lon Hohberger  <lhh@redhat.com>

	Misc. bugfixes

2005-03-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Set close-on-exec flag on DLM file descriptors

2005-03-07  David Teigland  <teigland@redhat.com>

	matching dlm_nodeid_addr/dlm_addr_nodeid

	standard copyright

	device node stuff for ioctl, largely copied from dm

	#define misc name

	Program for managing dlm membership in dlm-kernel/src2.

	New dlm development that won't be functional with gfs for a while. - Removing kcl_ calls to cman and replacing with control ioctls.

	If node isn't found in sm_members report an error and don't oops. This may be a valid condition, but it's not clear from the info.

2005-03-04  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Was storing entries under the same name, this prevented withdraw from working when there was more than one filesystem mounted. Fixed.

2005-03-04  Lon Hohberger  <lhh@redhat.com>

	Fix for multiple simultaneous leaves not being handled properly

2005-03-04  David Teigland  <teigland@redhat.com>

	Ignore any NEWLOCKS or NEWLOCKIDS messages from a previous instance of recovery.

2005-03-04  Ken Preslan  <kpreslan@redhat.com>

	Linux 2.6.11.

2005-03-03  Ken Preslan  <kpreslan@redhat.com>

	Bastian Blank <bastian@waldi.eu.org>'s manpage munging.

2005-03-03  A. J. Lewis  <alewis@redhat.com>

	 o Fix the (d)inode_hash_insert() fxns (fixes bz #149706)

	 o Update to latest ondisk.h from the s.r.c. gfs kernel source

2005-03-03  Ken Preslan  <kpreslan@redhat.com>

	Forward-port Tadpol's 146711 fix.

2005-03-03  Lon Hohberger  <lhh@redhat.com>

	Add -h for clustat / clusvcadm

2005-03-03  A. J. Lewis  <alewis@redhat.com>

	 o increment link count when dealing with bad '.' & '..' entries  o Clears up the spurious "Found unused inode marked in-use" msgs    (bz #150207)  o Make sure disk is synced at end, handle link count for l+f better  o Changing GFS_METATYPE_EA -> ED - handles metadata change in GFS 6.1    (bz #150208)

2005-03-03  Lon Hohberger  <lhh@redhat.com>

	Fix build problem.

2005-03-03  Benjamin Marzinski  <bmarzins@redhat.com>

	Fixed 146672.  While it is still possible to see this bug,  the problem that I saw every time it happened to me was that the process in gfs_log_dump() got starved waiting for the sd_log_lock semaphore. This fix changes sd_log_lock into a rw_semaphore, and uses down_write and up_write instead of down and up. read write semaphores are totally fair, so gfs_log_dump() can't get starved

2005-03-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy printks

	Replace the array of connections with functions from linux/idr.h

	If we are a new master, don't try to rejoin an old node.

2005-03-02  Lon Hohberger  <lhh@redhat.com>

	Fix part 2 of #150079

	Zero out cm_addrs when reading /proc/cluster/services for a member list

2005-03-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Set the socket priority to INTERACTIVE to ensure that our messages don't get queued behind anything else

2005-03-02  Lon Hohberger  <lhh@redhat.com>

	Implement basic recovery policy handling

	#149522 #150067.  Part of #149735.  See ChangeLog.

2005-03-01  Jonathan Brassow  <jbrassow@redhat.com>

	- fix senario where a server dying could leave clients with regions marked   that the new server would not know about, allowing for simultaneous   writes and re-syncing operations.  (Results in corruption).
	- Use mempool in places where memory allocation failures would make us
	  unhappy.

	- Some code clean-up

	- Other bug fixes that I can't remember.

2005-03-01  Lon Hohberger  <lhh@redhat.com>

	Add support for Bull NovaScale machines via ipmi-over-lan and PAP management console

2005-03-01  Daniel Phillips  <phillips@redhat.com>

	Poptize csnap-server, mksnapstore the rest of the way

2005-03-01  Lon Hohberger  <lhh@redhat.com>

	Misc. fixes; see changelog.

2005-02-28  A. J. Lewis  <alewis@redhat.com>

	 o Convert remaining (f)printf's to log_*  o Check malloc and memset return codes, more error reporting - should help    with bz#149706

2005-02-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't send sequence number of zero, it causes trouble.

2005-02-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Get rid of spurious "up" in barrier error path.

2005-02-25  David Teigland  <teigland@redhat.com>

	remove "lkb xxxx exists" message which can flood the console/log. it only occurs during a rare recovery condition

	Add a bunch of schedule() calls to potentially-long loops in recovery routines.

	checkin removing unfencing wasn't complete, sorry

2005-02-24  David Teigland  <teigland@redhat.com>

	Remove unfencing since it needs to be reworked and won't be ready for the next release.

2005-02-24  Adam Manthei  <amanthei@redhat.com>

	uses -t option to cman_tool to time out wait operations

2005-02-23  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	reduced things down to a single ASSERT.  passing back error codes and retrying instead. (most of the error codes will cause gfs to withdraw/assert now instead.) Removed the gulm interface from kernel space.  Its broken, and it doesn't look like anyone was using it anyways.

2005-02-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Need this too.

	Add ioctl32 support. Thanks to Bastian Blank

2005-02-23  A. J. Lewis  <alewis@redhat.com>

	 o Release buffers after use  o Fix double free or corruption after pass 5 (bz#149262)

2005-02-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Add -t option to join/leave/wait, specifies the maximum amount of time that the operation will wait before giving up (waiting that is). Also cman_tool join -w will retry if it fails ENOTCONN (ie the node did not join a cluster). See the man page for some wrinkles.

	Put some locking round membership_task so we don't try to wake up a process that has gone away.

2005-02-23  David Teigland  <teigland@redhat.com>

	When locks on the convert queue are granted, we need to try again to grant locks from the beginning of the convert queue.  Locks at the beginning may not be grantable because of locks at the end.  But, granting locks at the end (permitted when using the NOORDER flag) may make earlier locks grantable.  Specifically, we have the following situation when running "gfs_tool freeze" in parallel on three machines:
	Granted 1 PR
	        2 PR
	        3 PR

	* nodeid 3 converts PR->CW

	Granted 1 PR
	        2 PR
	Convert 3 PR->CW

	* nodeid 2 converts PR->CW
	  granted mode is demoted to avoid conversion deadlock

	Granted 1 PR
	Convert 2 NL->CW
	        3 PR->CW

	* nodeid 1 converts PR->CW
	  granted mode is demoted to avoid conversion deadlock

	Granted
	Convert 1 NL->CW
	        2 NL->CW
	        3 PR->CW

	* conversions for 1 and 2 are blocked by 3's PR
	* conversion for 3 is granted

	Granted 3 CW
	Convert 1 NL->CW
	        2 NL->CW

	* other conversions are now grantable, we must try to grant them again

2005-02-23  Jonathan Brassow  <jbrassow@redhat.com>

	- break the cluster mirror file into separate files

	- commit changes to dm-log_cluster.c before its break-up

2005-02-22  A. J. Lewis  <alewis@redhat.com>

	 o  adjust the gfs ondisk format number

	   Check that a device has been passed in (bz #149261)    Fix spelling of "Succeeded" (bz #149267)    Handle mistyped responses to queries more gracefully (bz#149278)

2005-02-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove kjoin.c as it's not used and won't even compile any more.

2005-02-22  Daniel Phillips  <phillips@redhat.com>

	Add libpopt command line args parsing to mksnapstore, csnap-server Argh!  popt doesn't know about long long!

2005-02-22  David Teigland  <teigland@redhat.com>

	Recognize and resolve a second form of conversion deadlock.  When it happens, you'll see the following in dlm_locks output: grant queue: empty convert queue: NL->EX, PR->EX
	Fixes bz 148861

2005-02-21  Adam Manthei  <amanthei@redhat.com>

	remove the in_cluster() checking in stop.  should no longer be needed since the start() case now waits to make sure that the node is in the cluster before returning.

	o added "-w" option to cman_tool join (bz #147828) o commented out CMAN_TRANSITION_RESTARTS o need mechanism for timing out "wait" parameter

2005-02-21  Patrick Caulfield  <pcaulfie@redhat.com>

	I was trying to be too economical with code in cman_tool wait, ISQUORATE & GETMEMBERS can't really be conflated like that because they return different sorts of things.

2005-02-21  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	If a local client logged into gulm, and the client got the nodelist before the local gulm connected to a Master gulm, the local client would not get updates when the full list was received. This fixes that.

2005-02-19  Adam Manthei  <amanthei@redhat.com>

	partial fix to cman init script to address bug #147828. still need to figure out why 'wait' isn't working like I expect.

2005-02-18  Chris Feist  <cfeist@redhat.com>

	Added forgetten line in configure script which caused --sharedir to be ignored.

2005-02-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Display "mantis-friendly" membership state in /proc/cluster/status

2005-02-18  David Teigland  <teigland@redhat.com>

	"The attached patch makes it possible to ask fence_tool to not wait for quorum and just die in this case. This makes it easier to call fence_tool join in init scripts without the problem of a blocked startup."  Bastian Blank

	ignore fence_tool's Q option

2005-02-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Deal with failed joinconf more sensibly. (that message may have to go though) Quick-quit out of the read/dispatch loop if a node goes down so we can process it in a timely manner.

2005-02-17  David Teigland  <teigland@redhat.com>

	remove some non-critical printk's

	Make dlm_recoverd thread a permanent fixure of each lockspace. The wake_up oopses I get when they're dynamic get in the way of other tests.  This is already in the RHEL4 branch.

2005-02-16  Jonathan Brassow  <jbrassow@redhat.com>

	- commit man page changes from Bastian Blank

2005-02-16  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	is deprecated, not depercated fenced wants -O make sure lock replies goto clients. Better reaction to error packet in LT.

2005-02-16  David Teigland  <teigland@redhat.com>

	The current manpages are written in plain nroff which is not parsable by many scripts.  The attached patch converts the manpages in the fence package to the man macro package. From Bastian Blank

2005-02-16  Patrick Caulfield  <pcaulfie@redhat.com>

	This fixes the socket leak in the case where a primary connection was closed due to EOF on the socket, the secondary did not get closed.

2005-02-16  David Teigland  <teigland@redhat.com>

	We were ignoring blocking callbacks for locks being converted which caused us to skip some that were necessary. Fixes bz 147798 (along with similar dlm fix)

	Blocking asts were being ignored for all locks being converted which resulted in some necessary basts being skipped.  In particular, after a failed NOQUEUE conversion, gfs could be left holding a lock and getting no callback for it while others were left waiting.
	This changes things so that a bast message is ignored if the lock is
	being converted and NOQUEUE isn't set, or if the locks is being
	unlocked.  Fixes bz 147798.

2005-02-15  A. J. Lewis  <alewis@redhat.com>

	 o Count blocks used by inodes and update them if counted doesn't match ondisk  o convert free metadata to free blocks in pass5

2005-02-15  Daniel Phillips  <phillips@redhat.com>

	Add snapshot store expansion

2005-02-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Remember to tell SM if we get down to one node.

2005-02-15  David Teigland  <teigland@redhat.com>

	list fence_tool

	document the wait (-w) option

	The current manpages are written in plain nroff which is not parsable by many scripts.  The attached patch converts the manpages in the fence package to the man macro package. From Bastian Blank

	remove stray line

	don't complain when we see fence_tool's -w option

	Add option to fence_tool to wait for the node to complete its join and be a member of the fence domain.  Two options: fence_tool join -w fence_tool join; fence_tool wait

2005-02-14  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	removed an unused func. made a log_err print out the value of ocde instead of just complaining about it. flipped a message out of lgm_Always and into lgm_locking.

2005-02-14  Jonathan Brassow  <jbrassow@redhat.com>

	- replace an instance of ccs_get with ccs_get_list

	- missing break statement, thanks to Bastian Blank

2005-02-14  A. J. Lewis  <alewis@redhat.com>

	 o convert (f)printf to log_* in fs_dir.c  o Fix link counting when reattaching '..' in pass3

2005-02-14  Patrick Caulfield  <pcaulfie@redhat.com>

	On sparc & s390 do biarch checking at runtime. This paves the way for AMD64 builds if anyone has one they'd like to try ;-)
	Thanks to Bastian Blank for most of this.

	Display node name in /proc/cluster/status

2005-02-14  David Teigland  <teigland@redhat.com>

	document -w and -q options for join

	remove multihome setup from man page

2005-02-11  A. J. Lewis  <alewis@redhat.com>

	Fixed number of times it's necessary to run fsck to completely clean fs  o debugging, fix a bug in leaf handling, and clear check another error    case for .. dirents  o fs_mkdir was grabbing in use blocks - fixed this problem  o Make sure journaled data gets set to the correct metatype and format  o Make sure the leaf info is current before writing it out in metawalk.c  o Fix allocation and expanding of l+f directory  o Fix entry counting when splitting leaves  o Convert dir_info list storage from a flat list to a hash table.

2005-02-11  Jonathan Brassow  <jbrassow@redhat.com>

	- add -V and -h to ccs_test

2005-02-11  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	put the info that i thought was in the man pages in there.

2005-02-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't start the transition timer if we're doing the shortcut single-node endtrans. Also get rid of duplicate leave message

2005-02-11  David Teigland  <teigland@redhat.com>

	We add NL locks to a resource to implement gfs's hold_lvb().  When we request these NL locks, use the EXPEDITE flag so the NL request will be granted immediately.

	When a conversion request has been sent to a remote master, that remote master fails, and the sender becomes the new master of the resource, the requested lkb needs to be moved from the converting queue back to the granted queue prior to processing the conversion request locally.
	Previously, we were leaving the lkb on the converting queue.  The
	specific problem I observed from this happened when the conversion
	was NOQUEUE and returned -EAGAIN.  When an unlock for the lkb
	happened later on, dlm_unlock would find an incorrect status in the
	lkb of CONVERTING, return an error and trigger an assertion failure.

	don't do a dlm_lock_dump when an assertion fails

	cman_tool now picks as the local nodename whatever name has been entered for the local node in cluster.conf.  If the node is represented in cluster.conf by a FQDN, then that's the nodename it will have.  If the node is represented in cluster.conf by a hostname without domain, then that's the nodename that it will have.  This should fix bz 146320.
	(As always, the network interface associated with the nodename is the one
	cman will use.)

2005-02-11  Chris Feist  <cfeist@redhat.com>

	Merged changes from RHEL4 branch to fix building if not installing.

2005-02-10  Patrick Caulfield  <pcaulfie@redhat.com>

	man page for cman_tool leave -w

	Add a -w (wait) option to "cman_tool leave". If the cluster is in transition then the leave ioctl returns -EBUSY which causes the leave operation to fail.
	If you add -w to the command-line then cman_tool will wait and retry the
	operation until it either gets a proper error or the leave completes
	sucessfully.

	This is probably what's really needed by the shutdown script.

2005-02-10  David Teigland  <teigland@redhat.com>

	Clean up changes from last commit related to bz 143487. fence_node -O <nodename>  is used to force a ccs connection, and a clustername arg is not used.

2005-02-09  Jonathan Brassow  <jbrassow@redhat.com>

	- fence_node has been change to work better with gulm (143487) - Two new options have been added   -c <cluster_name>   -O
	The -O overrides the quorum requirement.  It requires the use of -c,
	due to the fact that CCS may be in a transitional phase that only
	solidifies when the cluster is quorate.

	Although I haven't tested it, this may allow a person to
	fence_node -O -c someone_else_cluster someone_else_node... a
	feature? a bug?

2005-02-09  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Removed a bunch of unused global vars. (well, externs to atleast)
	Fixed bug 147602 - gulm doesn't allow 5 servers
	silly me, ment <=5 not <5.

2005-02-09  Benjamin Marzinski  <bmarzins@redhat.com>

	fixed journal corruption mentioned in bug 146672. If the latest entry written to the log before a crash was the at the segment before the last dump entry, the last dump entry would be overwritten on journal replay. Changed the checks in check_seg_usage to avoid this.

2005-02-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Be a bit smarter about when to schedule() when reading lots of data (usually during recovery)

2005-02-09  David Teigland  <teigland@redhat.com>

	remove unused "bulk lookup" function

	Similar bug to the one fixed the other day.  If recovery is aborted during rebuild_rsbs_send(), some rsb's could be left on the recover_list.  This triggers the recently added assertion during the next recovery cycle.   We now clear the recover_list if rebuild_rsbs_send() is aborted.

	- exit with an error if an invalid votes value is found - fix error in the votes value check in the two-node case. we were   exiting with an error when no votes value was specified instead   of accepting that the default of 1 is correct

2005-02-08  David Teigland  <teigland@redhat.com>

	- liblvm2clusterlock.so has moved from /lib to /usr/lib so we need:   LVM2/scripts/clvmd_fix_conf.sh /usr/lib
	- no longer need manual devmap_mknod.sh for DM

	- remove info on cman using mulitple interfaces on multihomed nodes
	  since it's out for now

	remove three log_debug lines that are called so frequently during recovery that they blow away other interesting messages in the debug log

2005-02-08  Lon Hohberger  <lhh@redhat.com>

	fix #146924

2005-02-08  David Teigland  <teigland@redhat.com>

	In rcom_send_message, return an error from midcomms_send_message instead of panicking.  Returning an error from both functions is valid when nodes fail during recovery.  Also switch some log_error to log_debug so they don't go to the console.

2005-02-07  Lon Hohberger  <lhh@redhat.com>

	Include rg name in clustat -x output

2005-02-07  A. J. Lewis  <alewis@redhat.com>

	Large batch of changes - mainly dealing with ExHash directory handling.
	 o Fix a spot where a pointer not getting set to NULL would segfault later
	 o Fix entry checking - large number of changes - still some issues
	 o Make exhash leaf entry removal work correctly
	 o If we find a bad .. entry in pass3, relink it to the treewalk parent
	 o Mark exhash directories with bad height or depth invalid
	 o Correctly create directories and handle dirs with height > 0
	 o Track leaf pointer counts and error directories they don't match depth

2005-02-07  Patrick Caulfield  <pcaulfie@redhat.com>

	use $(CC) for linking. don't install header executable

2005-02-07  David Teigland  <teigland@redhat.com>

	remove utils_srt.c

	- Assert that the recover_list is empty at the start of dlm_dir_clear.   If there's anything incorrectly left on that list from a previous   aborted recovery, we'll find it here and not with an odd oops later.
	- Change log_debug() for normal locking operations to log_debug1() where
	  DLM_DEBUG1 isn't set by default.  This way abnormal or infrequent
	  conditions from log_debug() aren't quickly blown away.

	- Don't call dlm_locks_dump() when DLM_ASSERT fails.

	- In rcom_send_message(), only test/clear the READY flag when doing a
	  synchronous request.  It's not used for async requests and because
	  these async requests can be called from different threads it could
	  lead to incorrect assertion failures.

	- In rcom_send_message() get rid of the RECCOMM_WAIT flag which was
	  only used as a sanity check.  Given that rcom_send_message can be
	  called from multiple threads and only synchronous calls are serialized,
	  an async caller could change the flag for the sync request and cause
	  the reply message to be discarded.

	If recovery was aborted during restbl_rsb_update(), some rsb's could be left on the recover_list.  This would cause an oops later when the next recovery sequence used the recover_list.  Now we clear that list if we abort the recovery.
	It seems unlikely people have seen this since it requires a node to fail
	at just the right time while other nodes are doing recovery.

2005-02-03  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Partial workthrough of log messages.  Some moving, some changing. mostly changed `errors' that gulm can handle to not use log_err
	Some corrections to the estimated lock space size calculation.
	Still needs more work, but its closer.  Once this gets more accurate
	will use it for th highwater mark instead of lock count. But not yet.

	Added out going queues to the local connect in LTPX. Fixes bug 146670.
	Might need to add read penalties, but works for me without, so holding
	off on that.

	Removed a util_* that hasn't been used in quite some time, but was
	still being compiled and linked in.

2005-02-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Check quit_threads in a few more places so we don't get blocked when trying to leave the cluster.

2005-02-02  A. J. Lewis  <alewis@redhat.com>

	 o Started working on interactive UI  o More interactive updates and fixed inode updating for exhash directories in met  o Make '-y' and '-n' options to the fsck work correctly in query()

2005-02-02  Patrick Caulfield  <pcaulfie@redhat.com>

	If a joining node is removed by the time it has become a provisional member then remember to decrement cluster_members.

	Default for releasing userland lockspaces is "1", ie get rid on any master locks that do no have local holders.

	Use #defined constant rather than a plain number

2005-02-02  David Teigland  <teigland@redhat.com>

	need copytobin

2005-02-02  Ken Preslan  <kpreslan@redhat.com>

	Add some more fields to the lockdump print out.

	When running the "gfs_tool <something> <mountpoint>" commands (e.g. lockdump, freeze, withdraw, ...), do better processing of device mapper device names.

2005-02-02  Chris Feist  <cfeist@redhat.com>

	Added slibdir into the toplevel make so we don't touch /usr/lib

2005-02-01  Ken Preslan  <kpreslan@redhat.com>

	Probable fix for BZ#146711. Don't try to update the head of the log if we're already shutdown.

2005-02-01  A. J. Lewis  <alewis@redhat.com>

	 o Check for dups when looking at inodes for the first time  o Don't mark the resource index and journal index during initialization  o Details about new fsck added to FEATURES

2005-02-01  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Handful of little cleaning things I ran across hunting a bug. Mostly just removing code that was never called.

2005-02-01  A. J. Lewis  <alewis@redhat.com>

	 o Remove a number of unused macros  o Make version strings conform to the standard; update usage string

	Out with the old, in with the new.
	This is a completely rewritten filesystem checker for GFS.  Performance
	characteristics are significantly improved.  The design follows the 5-pass
	fsck design found in "Fsck - The UNIX File System Check Program"
	by McKusick & Kowalkski (1994)
	  - http://citeseer.ist.psu.edu/mckusick94fsck.html

2005-02-01  Chris Feist  <cfeist@redhat.com>

	Updated copyright code

2005-02-01  Patrick Caulfield  <pcaulfie@redhat.com>

	dlm_release_lockspace uses force==1 by default, so the LS gets freed even if there are remote locks mastered on this node (but not if there are local locks).

2005-02-01  David Teigland  <teigland@redhat.com>

	undo last change (enforce matching nodename/cluster.conf) so we can find a less disruptive way to do it

	cman_tool now reports an error if the nodename doesn't match exactly what's in cluster.conf.  See bz 146320 for more info.

2005-01-31  Lon Hohberger  <lhh@redhat.com>

	Kill clufindhostname; its functionality isn't used, and can be provided by things like host(1)

	Clean up lock spaces so we can unload dlm module

	Use {libdir} for {slibdir} if no slibdir specified

	Use {libdir} for {slibdir} if no slibdir specifed on configure's command line

2005-01-31  Patrick Caulfield  <pcaulfie@redhat.com>

	Make heartbeat thread exit whren "quit_threads" gets set. This also mean moving the heartbeat timer control into that thread (quite sensibly) and also clearing wake_flags when membership thread quits.
	fixes bz#146327

2005-01-28  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	pending plocks on gulm can now be interrupted.

2005-01-28  Lon Hohberger  <lhh@redhat.com>

	Merge from RHEL4 branch

2005-01-28  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	fix for bug 146479, was not properly pushing posix range lock information into the VFS.  Am now.

2005-01-28  Patrick Caulfield  <pcaulfie@redhat.com>

	If we get a position JOINACK then ignore any negative ones that come afterwards and we know there's a node that will join us. If it dies for any reason, the timer will restart.
	This should speed up parallel join somewhat.

	Don't starve processes that are filling buffers. FIxes bz#143448

2005-01-27  Ken Preslan  <kpreslan@redhat.com>

	Fix a bug in a memset().

	Don't let stale/invalid data leak up to userspace on a read() from a withdrawn filesystem.

	Change diaper so it doesn't return errors if the filesystem is already shutdown.  This makes things a lot quieter.

	Don't complain about uninit()ing busy log buffers if we're shutdown.

	Don't complain if we stall trying to make a log reservation.

2005-01-27  David Teigland  <teigland@redhat.com>

	There are a couple of potential problems this should fix related to an overlap of dlm_recoverd in ls_nodes_reconfig (changing the ls_nodes list) for recovery event N and dlm_recvd in dlm_dir_rebuild_send (reading ls_nodes list) for recovery event N-1.
	We now wait, in dlm_ls_stop(), for dlm_recoverd to detect and abort
	recovery event N-1.  This ensures that when all nodes receive
	dlm_ls_start() and begin recovery event N, that no other nodes are
	still working on recovery event N-1 in any way.

	There's still the chance that a stray/delayed message (in particular a
	RECOVERNAMES request) pertaining to event N-1 will be delivered while all
	nodes are working on event N.  There's an added check that should
	prevent this from causing any trouble for all practical purposes.

	One other possible problem is dlm_ls_stop clearing the status bits right
	before ls_nodes_reconfig sets them.  Doing this after dlm_recoverd
	is suspended makes it safe.

	I don't know which, if any, of these potential problems have actually
	been observed; none of them are very likely.  But, I think there's
	a fair chance that the first problem matches bz 145831.

2005-01-26  Jonathan Brassow  <jbrassow@redhat.com>

	- ccs(7) not ccs(8)

2005-01-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't call nodeid2con() if we're shutting down, it might allocate a new con.
	There's an off-chance this might fix bz#143449

	Change a BUG() into a printk, it's not really /that/ serious an anomoly.

	Put some more validation on integers passed in from the commandline.

2005-01-26  David Teigland  <teigland@redhat.com>

	ignore any wakeup that arrives after the serviced thread exits

	return an error in process_join_stop instead of asserting

2005-01-25  Lon Hohberger  <lhh@redhat.com>

	Index of error messages

	Merge from RHEL4 branch: man pages, error documentation + indexing

	Clean up negative memory-leak testing

	Merge from RHEL-4 branch: internal test cases, make-check target, actually install man pages

	Fix memory leaks as a result of not cleaning up libxml2; move test functions into test.c

	Internal consistency check tests for rgmanager's tree/list.

2005-01-25  David Teigland  <teigland@redhat.com>

	improve chances that withdraw won't get stuck by: - not trying to stop the lock_dlm threads which might be blocked   permanently in gfs - abandoning the locks on the null list (like we abandon all the rest)

2005-01-24  Adam Manthei  <amanthei@redhat.com>

	regex fix for gulm and cman check of /etc/cluster/cluster.conf (https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=146036)
	-               if ! grep -qE "<[\t ]*gulm[\t ]*.*>"
	+               if ! grep -qE "<[[:space:]]*gulm([[:space:]]|[>]|$)"

2005-01-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Split the removal of a node out of STARTTRANS as they can get interrupted/overruled and all sorts of things.
	There is now a seperate NODEDOWN message which, well you can guess what it does.
	The first node to spot the daed node still starts the transition as before.

2005-01-24  David Teigland  <teigland@redhat.com>

	Change all log_all() to either log_debug() or log_error() since log_all recently became log_debug.

	Fix dlm_astd hang in bz 145090.  Have dlm_astd skip lkb's in the ast queue that belong to non-running/in-recovery lockspaces.  Previously, dlm_astd would block on the lockspace's in_recovery semaphore ahead of the lockspace (and the semaphore) being freed.

2005-01-24  Patrick Caulfield  <pcaulfie@redhat.com>

	If we get an old STARTTRANS(REMNODE) then still remove the node from our list because someone saw it die.

2005-01-21  Ken Preslan  <kpreslan@redhat.com>

	Cleanup.

2005-01-21  Lon Hohberger  <lhh@redhat.com>

	Add make check, ra-api-1-modified.dtd for validating ra metadata

2005-01-21  David Teigland  <teigland@redhat.com>

	include time in debug output

2005-01-20  Adam Manthei  <amanthei@redhat.com>

	o fixed broken regex o make gulm check happen on start only

2005-01-20  Lon Hohberger  <lhh@redhat.com>

	file nfs-tests was initially added on branch RHEL4.

	Include bonded-ethernet link detection

2005-01-20  Adam Manthei  <amanthei@redhat.com>

	start gulm when --use_ccs is used only if <gulm> is defined in /etc/cluster/cluster.conf (https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=145458)

	don't start cman if <gulm> is defined in /etc/cluster/cluster.conf (https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=145453)

	o cleaned up some man of the man pages o removed more fence_rib references o removed fence_rib and fence_racksaver from bin/Makefile

	Initial cut of drac fencing agent used at Oracle World. Use at your own risk.

2005-01-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Grr, got me patches & cvs all mixed up again.

	remove_joiner() now also informs the poor node that it's join has been preempted and it must try again.

	Return an error from several ioctls if they are called when we are not part of a cluster.

2005-01-20  David Teigland  <teigland@redhat.com>

	improve an error message

2005-01-19  Daniel Phillips  <phillips@redhat.com>

	Add index buffer dirtying, block freeing to snapshot delete.  More cleanups. Fix bug in excess btree level trimming.

2005-01-19  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Forgot to update gio.

	stop being wavery on where tags go.

2005-01-19  Lon Hohberger  <lhh@redhat.com>

	Fix build bug on slackware

2005-01-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove param from remove_joiner() as that part of the patch hasn't been committed yet. Sorry.

	Set threads to SCHED_FIFO scheduling policy.

2005-01-19  David Teigland  <teigland@redhat.com>

	'fence_tool monitor' will print debug logging from fenced

	send all debug logging over local socket so fence_tool can monitor at any time while running

2005-01-19  Daniel Phillips  <phillips@redhat.com>

	BTree snapshot delete refactored and cleaned up, tree collapsing added, a few coalescing bugs fixed.

2005-01-18  Jonathan Brassow  <jbrassow@redhat.com>

	- fix the CCS archive -> xml conversion for the gulm section
	I was converting to the old way the servers were listed, i.e:
	<servers>
	  foo
	</servers>

	instead of:

	<lockserver name="foo"/>

2005-01-18  Lon Hohberger  <lhh@redhat.com>

	amd64 fix

2005-01-18  Jonathan Brassow  <jbrassow@redhat.com>

	- better error reporting when there are multiple concurrent updates - fix bug 145393 second ccs update attempt (from another node) fails if update file is /etc/cluster/cluster.conf

2005-01-18  Ken Preslan  <kpreslan@redhat.com>

	Unbreak the user tools.

2005-01-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Another remove_joiner() needed - this time if the new node does not respond to JOINCONF

2005-01-18  David Teigland  <teigland@redhat.com>

	document new actions wait, status, nodes, services

	add cman_tool actions status|nodes|services to display /proc/cluster/status|nodes|services

2005-01-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Check for valid LKB in find_lock_by_id() rather than later on when we've already assumed it's a valid array index.

2005-01-18  Daniel Phillips  <phillips@redhat.com>

	BTree one-pass delete is now incremental with leaf/node coalescing Phew, what a struggle that was. NB: csnap server currently set up only for unit testing of delete code; will stay broken for a few more days.

2005-01-18  Adam Manthei  <amanthei@redhat.com>

	Apply Derek Anderson's patch to resolve bug 144514: (fence_sanbox2: failure path locks user out of admin mode)
	Index: fence_sanbox2.pl
	===================================================================
	RCS file: /cvs/cluster/cluster/fence/agents/sanbox2/fence_sanbox2.pl,v
	retrieving revision 1.1
	diff -u -p -r1.1 fence_sanbox2.pl
	--- fence_sanbox2.pl    24 Aug 2004 16:05:37 -0000      1.1
	+++ fence_sanbox2.pl    18 Jan 2005 00:29:06 -0000
	@@ -161,6 +161,9 @@ $t->print("show port $opt_n");
	 if (!((($opt_o =~ /disable/i) && ($text =~ /AdminState\ *Offline/i)) ||
	     (($opt_o =~ /enable/i) && ($text =~ /AdminState\ *Online/i))))
	 {
	+  # Get out of admin mode before failing
	+  $t->print("admin end");
	+  $t->waitfor('/\>/');
	   fail "failed: could not change state to $opt_o\n";
	 }

2005-01-17  Lon Hohberger  <lhh@redhat.com>

	Fix magma plugin names + installation paths to match LIBDIR/magma

	Use libdir/magma for plugins

2005-01-17  Patrick Caulfield  <pcaulfie@redhat.com>

	return error if ioctl(GETNODE) called before we are a cluster member.

	Remove some redundant code. Don't try to double-free connection if bind() fails.

2005-01-17  David Teigland  <teigland@redhat.com>

	remove double \n

	log more info to syslog to help people see why nodes are fenced

2005-01-14  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	relocated some tags to attributes.  Easier for the gui to work and we're about about chewy, gui goodness.

	grab more of the login request for services so if the protocl version mismatches we can print out the name of the server that did this. hopefully help with some debugging.

2005-01-14  David Teigland  <teigland@redhat.com>

	- don't ignore the completion callback for a canceled lock - extend the info logged for cancel

2005-01-14  Ken Preslan  <kpreslan@redhat.com>

	Copyright/GPL.

2005-01-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Add wait options to cman_tool to help with script synchronisation.
	cman_tool join -w  (join & wait until a cluster member)
	cman_tool join -wq (join & wait until cluster is quorate)

	cman_tool wait     (wait until a cluster member)
	cman_tool wait -q  (wait until cluster is quorate)

2005-01-14  Ken Preslan  <kpreslan@redhat.com>

	Print a better message when versions mismatch.

2005-01-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Sanity-check the votes, so that expected_votes doesn't get silly.

2005-01-14  Ken Preslan  <kpreslan@redhat.com>

	Start using the new generic permission checking code in 2.6.10.

2005-01-14  David Teigland  <teigland@redhat.com>

	- Leave the lockspace when gfs does a withdraw.  For now we abandon   all the lock_dlm memory associated with the lockspace. - Fix a memory leak in unmount where nodes list was not freed.

2005-01-14  Ken Preslan  <kpreslan@redhat.com>

	Update patches.

2005-01-14  David Teigland  <teigland@redhat.com>

	fix freeing name string before printing it in syslog

	in startup check add a loop around the cman GETNODE ioctl since it may return an error

2005-01-13  Lon Hohberger  <lhh@redhat.com>

	Fix for 44945

2005-01-13  Jonathan Brassow  <jbrassow@redhat.com>

	- fix bug with update when absolute path was specified.

2005-01-13  Adam Manthei  <amanthei@redhat.com>

	having init.d/cman load the dlm module makes lon happy

	o cleaned up init.d script to remove excessive `cman_tool join` and   `cman_tool leave` calls.
	o added a config paramater to control time to wait before deciding
	  that it can't join the cluster (CMAN_CLUSTER_TIMEOUT)

2005-01-13  Jonathan Brassow  <jbrassow@redhat.com>

	- add ccs_tool man page

	- warn every 30 sec (vs 10) if ccsd can not connect to cluster   infrastructure.

	- ccs_tool now handles the update process.   - allows for much better (and easier) error reporting

2005-01-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Add SAF AIS lock API support Contributed by Stanley Wang of Intel. Thanks (and sorry for the delay).

	Don't commit with debugging enabled. !

	If the cluster gets down to 1 node and the last leaver left with "remove" then carry on working.
	bz#144309

	If we get nominated as master, remove any joining node we may have. With luck, this will finally nail bz#133512

2005-01-13  Ken Preslan  <kpreslan@redhat.com>

	Some 2.6.10 stuff.

	Incore printing / profiling / tracing library.

	Profiling/tracing stuff.

2005-01-12  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	bleh, forgot man page.

	use lockserver instead of server.  less confusing.

	gulm will now parse the server list from ccsd as 	<gulm> 		<server name="foo"/> 		<server name="bar"/> 		<server name="baz"/> 	</gulm> instead of a single server line.

	stop gulm_tool from printing its errors to syslog.

	fix for bug 144909 clients report quorate=false when master goes away.

2005-01-12  Jonathan Brassow  <jbrassow@redhat.com>

	- sync with changes made to RHEL4 branch

2005-01-12  Ken Preslan  <kpreslan@redhat.com>

	Fix statfs bug.

2005-01-12  Adam Manthei  <amanthei@redhat.com>

	on shutdown, use gulm_tool to determine node liveliness rather than nodeinfo

2005-01-11  Adam Manthei  <amanthei@redhat.com>

	pid file is now in /var/run/cluster/ccsd.pid, not /var/run/sistina/ccsd.pid

	syncing w/ RHEL4 branch

	diff -u -p -r1.1 Makefile --- cluster/fence/agents/bladecenter/Makefile   25 Oct 2004 16:23:03 -0000      1.1 +++ cluster/fence/agents/bladecenter/Makefile   11 Jan 2005 22:38:27 -0000 @@ -19,7 +19,7 @@ include ${top_srcdir}/make/defines.mk
	 all: $(TARGET)

	-fence_apc: fence_apc.pl
	+fence_bladecenter: fence_bladecenter.pl
	        : > $(TARGET)
	        awk "{print}(\$$1 ~ /#BEGIN_VERSION_GENERATION/){exit 0}" $(SOURCE) >> $(TARGET)
	        echo "\$$FENCE_RELEASE_NAME=\"${RELEASE}\";" >> $(TARGET)

	move the ordering of the scripts.  lock_gulmd needs to be called before clvm2.
	        S20 ccsd
	        S21 cman
	        S22 lock_gulmd
	        S23 fenced
	        S24 clvmd

	Add Magma to the list of services that are ignore on shutdown. Without this exclusion, init.d/lock_gulmd will refuse to stop while ccsd is connected

2005-01-11  Lon Hohberger  <lhh@redhat.com>

	Fix bug that mantis saw; we shouldn't log in with newlines

2005-01-11  David Teigland  <teigland@redhat.com>

	use die() macro so prog_name is prefixed to error messages

	yesterday's signal changes broke "fence_tool leave" which requires we watch for SIGTERM

2005-01-11  Adam Manthei  <amanthei@redhat.com>

	o makes usage of ccs configurable o adds parameter to GULM_OPTS for passing commandline opts to lock_gulmd o will not shutdown a server if there are clients logged into it and no   other servers are running o reports if the node needs to be fenced before it can log in

2005-01-10  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	print node name and ip on the protocol mismatch error message.

	added a way to query gulms current running config from gulm_tool

	Added a warning for if you didn't --cluster_name before you --use_ccs. Added a line to the startup banner telling which cluster we belong to.

	previous method of not calling out to ccsd more than once had issues to say the least.  This should be a bit cleaner.

2005-01-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Clean the queued_messages list at shutdown. Should fix bz#143538

2005-01-10  David Teigland  <teigland@redhat.com>

	use sigsuspend instead of pause as the reliable way to wait for a signal http://www.gnu.org/software/libc/manual/html_node/Sigsuspend.html#Sigsuspend this should fix bz 133420

	change -s to -n in syslog message

	Use ccs_get_list instead of ccs_get to prevent infinite looping when there's one element in the list.  fixes bz 144322

2005-01-07  Jonathan Brassow  <jbrassow@redhat.com>

	IF YOU USE CCS, YOU WILL WANT TO READ THIS:
	There have been changes to ccs_get.
	ccs_get use to operate as follows:
	- A query that resulted in a single match would return that match
	  every time.
	- A query that resulted in multiple matches would iterate over the
	  matches given subsequent calls, terminating with null, and then
	  continuing from the beginning.

	This made things very hard if you were expecting a list but there
	was only one match.  You ended up waiting for a 'null' that never
	happened.

	ccs_get now operates as follows:
	- Subsequent queries of the same request will simply interate
	  repetitively over the matches - never returning null.

	A new function has been added, 'ccs_get_list'.  It takes the same
	arguments as 'ccs_get', but operates as follows:
	- Subsequent queries of the same request will return the matched
	  items, followed by null, then repeat.

2005-01-07  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	I ran into some weird race with having gulm load info from ccsd more than once while ccsd was trying to figgure out if it was in a quorate cluster or not. Solution is not to ask ccsd for info more than once.

2005-01-07  Adam Manthei  <amanthei@redhat.com>

	mention fence_bladecenter in man page for fence_xcat

	New man page now reads:
	fence_rib(8)                                         fence_rib(8)

	NAME
	       fence_rib - I/O Fencing agent for Compaq Remote Insight Lights Out card


	DESCRIPTION

	       fence_rib is deprecated.  fence_ilo should be used instead


	SEE ALSO
	       fence_ilo(8)

	diff -u -p -r1.3 Makefile --- Makefile    13 Sep 2004 17:04:45 -0000      1.3 +++ Makefile    7 Jan 2005 18:45:53 -0000 @@ -22,7 +22,6 @@ all:         cd manual && ${MAKE} all         cd mcdata && ${MAKE} all         cd rackswitch && ${MAKE} all -       cd rib && ${MAKE} all         cd sanbox2 && ${MAKE} all         cd vixel && ${MAKE} all         cd wti && ${MAKE} all @@ -39,7 +38,6 @@ copytobin:         cd manual && ${MAKE} copytobin         cd mcdata && ${MAKE} copytobin         cd rackswitch && ${MAKE} copytobin -       cd rib && ${MAKE} copytobin         cd sanbox2 && ${MAKE} copytobin         cd vixel && ${MAKE} copytobin         cd wti && ${MAKE} copytobin @@ -56,7 +54,6 @@ clean:         cd manual && ${MAKE} clean         cd mcdata && ${MAKE} clean         cd rackswitch && ${MAKE} clean -       cd rib && ${MAKE} clean         cd sanbox2 && ${MAKE} clean         cd vixel && ${MAKE} clean         cd wti && ${MAKE} clean

	fence_rib is deprecated by fence_ilo

	diff -u -p -r1.1 fence_brocade.pl --- fence_brocade.pl    24 Jun 2004 08:53:13 -0000      1.1 +++ fence_brocade.pl    7 Jan 2005 17:55:40 -0000 @@ -43,7 +43,7 @@ sub usage      print "  -a <ip>          IP address or hostname of switch\n";      print "  -h               usage\n";      print "  -l <name>        Login name\n"; -    print "  -n <num>         Port number to disable\n"; +    print "  -n <num>         Port number to operate on\n";      print "  -o <string>      Action:  disable (default) or enable\n";      print "  -p <string>      Password for login\n";      print "  -q               quiet mode\n";

2005-01-07  David Teigland  <teigland@redhat.com>

	Log the name of the node fencing is deferred to or say "prior member" if the name isn't known.  fixes bz 144170

2005-01-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Make all nodes print a message saying why another node left the cluster, so that tracing a fence is a little easier.
	bz#144386

2005-01-06  Patrick Caulfield  <pcaulfie@redhat.com>

	If bind() failes then NULl con->sock too, so the tidy up doesn't cause an oops. fix for bz#144144

	Move find_minor_from_proc before it's first use.

	Don't loop ourself to death if we run out of memory.

2005-01-06  Jonathan Brassow  <jbrassow@redhat.com>

	- fix for bug #137021 ccs doesn't find most recent cluster.conf
	This boiled down to a timing issue.  ccsd processes request serially (broadcast, or otherwise).

	When cman_tool was started, it issued a connect.  While not yet quorate, ccsd must broadcast to see if there are any more recent versions of the config file.  This happens as part of the connect.  select is used to set a timeout on just how long it waits for replies.

	2 problems were encountered.  1) the timeout was not being properly reset after the select returned.  2) everyone uses the same timeout

	What results is that if a connect is issued simultaneously on every node, they first try to process the connect - then any broadcast requests.  Because they all have the same timeout, they never recieve broadcast responses from their peers (because they are also stuck processing connects).

	The current solution is to add a random component to the timeout and make sure to set the timeout properly after the select returns.

2005-01-05  Jonathan Brassow  <jbrassow@redhat.com>

	- forward port bug fix 133254

2005-01-05  Benjamin Marzinski  <bmarzins@redhat.com>

	Fixed gnbd_export remove error message for bug 143131. Now it will print the correct errno.  Note, this doesn't fix the bug.

2005-01-05  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Wasn't calling ccs_disconnect() when reading config from ccs. Do that now. Fixes rbz144286

2005-01-05  Ken Preslan  <kpreslan@redhat.com>

	Reworked gfs_printf().

	Add new file.

	Update patch.

2005-01-05  David Teigland  <teigland@redhat.com>

	Release rsb's semaphore before queue_ast() since queue_ast() can free the rsb at any time. Patch from Daniel McNeil <daniel@osdl.org>

2005-01-05  Ken Preslan  <kpreslan@redhat.com>

	Get rid of -P option.  It should be replace with CLVM labeling later.

2005-01-05  Jonathan Brassow  <jbrassow@redhat.com>

	- if a lockfile can not be created, print that ccsd is already running.

2005-01-04  Jonathan Brassow  <jbrassow@redhat.com>

	- some cmirror changes that have been sitting around.

	- report better errors (especially in the event that magma plugins aren't   found)

2005-01-04  Lon Hohberger  <lhh@redhat.com>

	Report a usable reason when clu_connect fails.

	Kill a bunch of assertions.  Return EINVAL when we try to access functions from a nonexistent plugin

	Put in decent errno values for cp_connect so callers can find out what happened when it failed.

2005-01-04  Patrick Caulfield  <pcaulfie@redhat.com>

	NULL some pointers when we shutdown.

	Use sock_create_kern() rather than sock_alloc() for 2.6.10

2005-01-04  Ken Preslan  <kpreslan@redhat.com>

	o  Changed GFS ioctls so purely incore binary structures aren't used.    This should allow mixing of different versions of gfs userspace and    kernelspace without too much trouble. o  Update the user tools that use those ioctls. o  Cleaned up gfs_tool.

2005-01-03  Ken Preslan  <kpreslan@redhat.com>

	Dave's changes to allow "gfs_tool [freeze|unfreeze|withdraw]" to work on CLVM devices.

2005-01-03  Lon Hohberger  <lhh@redhat.com>

	Fix segfault if rgmanager wasn't running

2004-12-23  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	So here is a bit of code that finishes up the withdraw support for gulm.  It abuses the way callbacks on locks work to give something that can alert other mounters that a journal needs replaying. It works.  I don't like it.  It feels kludgy.  I am going to see if I can come up with something beter, but this at least will let people play with withdraw in a cluster.

	moved a message from Always to locking.

2004-12-23  Jonathan Brassow  <jbrassow@redhat.com>

	- add ccs_tool to Makefile
	This will likely switch from a script to a C-program soon, as functionality
	is added.

2004-12-23  Adam Manthei  <amanthei@redhat.com>

	Jon changed the verbosity of ccsd.  -v doesn't need to be on by default anymore.

2004-12-23  Jonathan Brassow  <jbrassow@redhat.com>

	- remove log_msg_always - make log_msg always print - remove -v option
	I was making the mistake of thinking that the user should control the
	daemons output by using (or not using) -v.  However, the more correct
	way is to print everything to the log and let the user sort through
	it by defining syslog preferences.

2004-12-22  Adam Manthei  <amanthei@redhat.com>

	make the daemon more verbose in the script since the default logging is not very helpfull.

2004-12-22  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	updated the patch for last lock_gulm.ko commit.

	Most of the witdraw code.  Still lacking a bit to notify other mounters that the withdrawn journal needs replaying.  But at least people can start playing with the withdraw and not assert.

	code to allow expiration of a subset of locks.  This will be used by the witdraw code.

2004-12-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Make MAX_RETRIES /proc settable. Make some KILL messages reliable.

	Don't hold the res_lock for quite so long. Well, it works for Daniel McNeil.

2004-12-22  Ken Preslan  <kpreslan@redhat.com>

	Fixed a reference leak of lock module in-use counts that was caused by filesystems withdrawing.

	Fix a case where the resource index isn't propery released on error.

2004-12-21  Jonathan Brassow  <jbrassow@redhat.com>

	- fix bug 128662, ccs_test connect <clustername>: connects to local   ccsd regardless
	  There was a remaining end case with this bug.  A machine could
	  broadcast, forcing all other nodes to load their config files.
	  So, if you wanted a different config file on another machine
	  (besides what was local at the time of the broadcast), you
	  would have to kill and restart ccsd.  This is no-longer
	  necessary.

	- fix bug: 128422 (ccsd grabs network config silently if local is bad)
	  Now, if the local config file is bad, ccsd errors out - giving the
	  user the output from the parser as well as the steps to take to
	  fix the problem.

2004-12-21  Adam Manthei  <amanthei@redhat.com>

	remove /dev/misc/dlm-control if the major/minor number of the device node conflist with the kernel assignments as reported by /proc/msic.
	This resolves bug #138491

2004-12-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Be a lot quieter on the console

	If a transition gets usurped by another node, always tidy up old joining nodes. Also, prevent a CHECK transition from usurping a real one as that's just a waste of everyone's time.

2004-12-20  Chris Feist  <cfeist@redhat.com>

	Added install of init script in top level Makefile.

	Fixed a problem which wouldn't uninstall the initscript.

	Updated toplevel Makefile to install init script.

	Added install/uninstall to main Makefile for init script.

	Added option to install init scripts.

2004-12-20  Jonathan Brassow  <jbrassow@redhat.com>

	- minor updates to ccs_tool

2004-12-18  Ken Preslan  <kpreslan@redhat.com>

	Add code to implement "gfs_tool withdraw /mountpoint".

	o  Add facility to stop all block I/O from a filesystem by setting a    bit.  The number of outstanding I/O is also kept track of, so it's    possible to wait until all in-flight I/O has finished. o  Used this new code to allow GFS to abort a filesystem at arbitrary    points in time.  GFS sets the bits to stop I/O, waits for all    in-flight I/O to stop, and then calls a new lock module function,    lm_withdraw, to ask the lock module to leave the lockspace.    (Basically, perform all recovery steps for the filesystem except    fencing.) o  Switch the places that see unrecoverable I/O errors or filesystem    consistency problems to withdraw from the cluster instead of    panicking. o  Get rid of most of the assert calls that panic the system in favor    of printing warnings or withdrawing from the cluster.  There is    still some ongoing work that needs to be done.  Mostly in the area    of making sure that resources are freed appropriately in error cases    that (now) don't panic the machine. o  At the moment, it's usually possible to cleanly unmount the    filesystem after it has withdrawn itself from the cluster.  There    are still some cases where the filesystem is unmountable or the    withdraw causes oopses.  These are bugs that can and will be fixed. o  The lm_withdraw() functions for lock_gulm and lock_dlm still need    to be written.  Right now they just panic the machine.  :-)

2004-12-17  Jonathan Brassow  <jbrassow@redhat.com>

	- fix a problem where if the working path was set (via ccs_set_state()),   lookups could fail.

2004-12-17  Adam Manthei  <amanthei@redhat.com>

	initial stab at init.d script

2004-12-17  Jonathan Brassow  <jbrassow@redhat.com>

	- fix bug 143165, 134604, and 133254 - update related issues   These all seem to be related to the same issue, that is, remote   nodes were erroneously processing an update as though they were   the originator - taking on some tasks that didn't belong to them.
	  This was causing connect failures, version rollbacks, etc.

	- fix a problem with ccs_tool update which was causing a connection
	  to be left open.

2004-12-17  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- lock tables are supposed to register themselves are LT%03d, not %03d

2004-12-16  Jonathan Brassow  <jbrassow@redhat.com>

	- add log_msg_always macro, which prints a msg of priority NOTICE   regardless of whether -v was specified.
	- Try to give reasons for update failures.

	- replace instances of sistina with "cluster"
	  (e.g. /var/run/sistina -> /var/run/cluster)

	- add beginning of update/upgrade tool

2004-12-16  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- SIGTERM is ignored.  Update man page describing this.

2004-12-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix a few join related bugs. Many of which are related to #142853 and # 1335212. I'm not fully convinced that these are all sorted yet though.
	Also, when we get a "leave remove" message, try to reduce quorum far enough
	so that activity continues.

2004-12-15  Lon Hohberger  <lhh@redhat.com>

	Make script actually work.  Fire wall ports are corrected, but the iptables commands need revisiting.

	Unbreak init script

	Display all cluster members if we're not part of the RG manager group.

	src/daemons/Makefile: Remove debugging compiler flag

	- include/resgroup.h: Remove unnecessary states/requests.  Add handle_start_remote_req, rg_doall,  and svc_status protos.  Add FORWARD define for when a request can be carried out - just not locally. - include/reslist.h: Add protos for res_condstop/res_condstart and resource_delta/resource_tree_delta functions - src/clulib/rg_string.c: Change to match states/requests in resgroup.h - src/daemons/groups.c: Don't even bother evaluating disabled resource groups.  Handle CONDSTOP and CONDSTART requests in the script exec path for changed resources.  Handle online resource and group configuration changes (e.g. after a SIGHUP).  Add rg_doall for queueing an event on all resource groups and optionally waiting for completion. - src/daemons/main.c: Handle SIGHUP - flag for reconfiguration.  Move status checks queueing in to the main loop (used to happen automatically from within rg_threads -- this caused problems with reconfiguration). - src/daemons/restree.c: Fix misc bug preventing resources without a recover function being treated as though they had a recover function. - src/daemons/rg_locks.c: Rename __ccs_mutex to _ccs_mutex so as not to upset glibc developers. - src/daemons/rg_state.c: Add svc_advise_stop to clean up _svc_stop function a bit.  Misc cleanups in the start/stop functions.  Move report of started RG into svc_start so it doesn't appear multiple times in different places (causing appearance of a RG being started twice on one node...).  Add svc_status function as part of rg_thread cleanup.  Return FORWARD from svc_stop/etc when we don't own the resource group. - src/daemons/rg_thread.c: Change thread model to have worker threads exit for a given RG instead of hanging around.  This greatly simplifies the code paths and reduces memory consumption when running mlocked. - src/utils/clustat.c: Change reporting of "no members" to "this node". Just because one node hasn't joined a SG doesn't mean others haven't.

2004-12-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't use a large(ish) static buffer for the membership state.
	Might fix bz#142865

2004-12-14  Ken Preslan  <kpreslan@redhat.com>

	More comments from ben.m.cahill@intel.com.

2004-12-14  Benjamin Marzinski  <bmarzins@redhat.com>

	oops. switched long variable to unsigned long so that the gnbd device size doesn't get screwed up on large devices. fixes rbz 142870

2004-12-13  Lon Hohberger  <lhh@redhat.com>

	Fix up circleping to work properly.

2004-12-13  David Teigland  <teigland@redhat.com>

	When rebuilding an lkb on a new master, the lockqueue_flags value was being skipped.  This could cause many problems in just the right circumstances, although no actual bug reports are an obvious case of this.

2004-12-11  David Teigland  <teigland@redhat.com>

	add sections on setting panic_on_oops and sources of more info

	document the optional nodeid setting

2004-12-11  Jonathan Brassow  <jbrassow@redhat.com>

	- Add message (that prints when -v flag is used with ccsd) that   reports when the cluster is quorate and will allow connections.
	- Change "cluster not quorate. refusing connection." back to
	  log_msg from log_err.  This is done since fenced will now
	  often query ccs before the cluster is quorate.  It is not
	  an error, it's just waiting for the cluster to become
	  quorate...

	- Fix a problem Dave was seeing.  If you do a ccs_test connect, before
	  starting ccsd, it will appear to stall indefinitely while doing retries.

	  The function in the ccs library responsible for talking to ccsd
	  must setup a connection from a privilaged port.  Sometimes, the
	  first port it tries to bind to may be in use, so it move on to
	  the next.  This is necessary.  However, I was not properly
	  checking the error return codes.  So, an ECONNREFUSED was being
	  interpretted as "Hey, try another port in a little bit."  Only,
	  after erroneously trying all the privilaged ports does it error
	  out - which is why it appears to stall indefinitely.

2004-12-10  Ken Preslan  <kpreslan@redhat.com>

	TASK_INTERRUPTIBLE -> TASK_UNINTERRUPTIBLE.

	Munge.

	Get rid of the kernel patch.  Not a battle worth fighting.  Sigh.

2004-12-10  Lon Hohberger  <lhh@redhat.com>

	Fix relocate on more-preferred-member-boot; fix minor bugs in building alloc.c

2004-12-10  David Teigland  <teigland@redhat.com>

	- slight correction in description of expected_votes - leave votes="1" out of standard node descriptions - add a section on specifying node votes

	A node gets 1 vote by default when no votes value is specified. Remove votes="1" in the examples since it's unnecessary and we don't specify any other values when using the default.

	add -D debugging option

	add debugging output for -D and a check to see if ccs connect works

2004-12-09  Patrick Caulfield  <pcaulfie@redhat.com>

	lkb_dequeue s/b res_lkb_dequeue

2004-12-09  David Teigland  <teigland@redhat.com>

	prefix output with prog name

2004-12-08  Daniel Phillips  <phillips@redhat.com>

	Whoops.

	- Fixed struct client pointer stability bug in server too - Merged Ben's lock handling functions

	Fix struct client pointer stability bug in server too

2004-12-08  David Teigland  <teigland@redhat.com>

	update from src files

	update from src files

	use dlm alt modes for LM_FLAG_ANY

	Two new flags that can be used for gfs's ANY flag: ALTPR and ALTCW. ALTXX means a lock is requested in XX mode if the ordinary request mode cannot be granted.  If neither can be granted, the ordinary mode applies.  The ALTMODE flag is returned if the alternate mode was granted.

2004-12-08  Daniel Phillips  <phillips@redhat.com>

	Turn off tracing, remove server crash simulation

	- bug fix: remove premature optimization that breaks when  blocksize < chunksize - Add client in-flight retry on reconnect or failover - fix synchronizing bugs in kernel failover - Add a level of indirection to client vector so array compaction on   client disconnection works properly (Ben had a different fix for this) - agent: don't retry connect if server connection fails, wait for new server

2004-12-07  David Teigland  <teigland@redhat.com>

	slight correction on how leave remove works

2004-12-06  Ken Preslan  <kpreslan@redhat.com>

	Got rid of some unused LM flags.

	Fix bug #141821.  KNFSD could call into GFS to do a lookup on ".." of the root directory.  GFS wasn't handling this correctly.

2004-12-06  David Teigland  <teigland@redhat.com>

	minor update

	don't leave if gfs is mounted

	Re-order some initialization so that ccs errors will be caught and reported before fenced forks into the background.

2004-12-03  Ken Preslan  <kpreslan@redhat.com>

	More excellent comments from ben.m.cahill@intel.com.

2004-12-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't send a KILL message if a node has the wrong generation number, try to work it out amicably with a CHECK transition instead.

	Add send/recv API to libcman, and some comments to libcman.h

2004-12-03  David Teigland  <teigland@redhat.com>

	clean up join_ccs code

2004-12-03  Ken Preslan  <kpreslan@redhat.com>

	D'oh.  Missed some files.

	o  Add "oopses_ok" mount option.  This allows GFS to oops instead of    panic on assertion failures.  This will hopefully allow easier debugging    in some situations.  But, using this option will make it possible    for a GFS oops on one machine to forever stall the filesystem on all    other machines in the cluster.  Use will *extreme* care. o  Start working utility functions to allow better error handling.

2004-12-02  Benjamin Marzinski  <bmarzins@redhat.com>

	added the stack overflow fix to head (rbz139863) gfs_glock_nq_m(), nq_m_sync(), and gfs_glock_nq_m_atime() no longer have arrays on the stack.

2004-12-02  Ken Preslan  <kpreslan@redhat.com>

	Declare the RO array in gfs_sort() staticly instead of dynamicly on the stack.  :-(

	Fix a spot where we weren't propagating away errors.

	Update.

2004-12-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Make sure transitionreason gets set if inherit mastership from a dead master node.

2004-12-02  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	add servicelist to man

	spell generation correctly in prints. add servicelist to usage() reoder lock stats.

2004-12-02  David Teigland  <teigland@redhat.com>

	- update cluster startup tips, including new fenced delay/options - include cluster.conf update procedure from a linux-cluster mail

	add fence_tool

	Add an msleep(500) to dlm_recoverd in an attempt to avoid the same invalid wakeup we've seen before.

	add fence_tool man page

	A bunch of improvements: - Wait for the cluster to be quorate before starting or killing fenced.   Waiting here lets the join/leave be cancelled easily (not the case   if it blocks in SM). - Unfence ourselves before joining the fence domain.  Can be skipped   with -S. - Accept the c/j/f fenced options and pass them on to fenced when we   exec it (since fence_tool is the usual way of starting fenced.) - Get rid of -t timeout option which isn't useful now that we have   the c/j/f options for fenced.

	ignore the S option that fence_tool uses and may be inherited with the other args

2004-12-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Clear joining_node after a client-end transition

2004-12-01  David Teigland  <teigland@redhat.com>

	only do lvb recovery when a node is removed from the lockspace

2004-12-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy up the node_id assigning code. With the changes made a while ago, a lot of this has become redundant and has been replaced with something much smaller and tidier. With luck it'll work too.

2004-12-01  David Teigland  <teigland@redhat.com>

	lvb sequence number should be incremented by dlm_unlock

2004-12-01  Daniel Phillips  <phillips@redhat.com>

	Turn off tracing output, remove extraneous debug output

	- Csnap server now has journalling and recovery, it seems to work - The buffer layer is now a separate compilation unit, Alasdair should be happy. - Kernel client has failover recovery and lock upload support - Miscellaneous bugfixes

2004-12-01  David Teigland  <teigland@redhat.com>

	DEBUG2 should be off by default

	Use sequence numbers to restore the most recent lvb copy during recovery when none of the locks have a definitive copy.

	zero the lvb when it's invalid since the dlm will not necessarily do that any more

	new cluster.conf tag names

	another tag name change

2004-11-30  Jonathan Brassow  <jbrassow@redhat.com>

	- updated fence_devices/device, but forgot nodes/node

	- updates to reflect change in cluster.conf tags

	- updates to reflect tag name changes in cluster.conf

	- update docs to reflect tag name changes in cluster.conf

	- updates for new cluster.conf tags

	- update example cluster.conf to reflect changes in tag names

2004-11-30  Chris Feist  <cfeist@redhat.com>

	Added fence_bladecenter.8 & fenced.8 to the install script for fence manpages.

2004-11-30  Lon Hohberger  <lhh@redhat.com>

	Reflect jparsons's changes to cluster.conf structure

2004-11-30  Patrick Caulfield  <pcaulfie@redhat.com>

	header->flags needs to be byteswapped since I made it an int.

2004-11-30  David Teigland  <teigland@redhat.com>

	begin ccs requests with /cluster instead of //cluster

	ccs request began //nodes/ instead of //cluster/nodes/ Both work but the later is consistent with the other uses.

	missed clearing VALNOTVALID flag in unlock case

	Add -u option to unfence the node.  Does nothing if unfencing isn't supported by the agent.

	- add code to support unfence option - change default post-join-delay to 6 sec

	more helpful error message

2004-11-25  Jonathan Brassow  <jbrassow@redhat.com>

	- remove some print statements and refine todo list

2004-11-24  David Teigland  <teigland@redhat.com>

	don't include old license dir

	munge usage wording

	Fix some problems in the recently added lvb and valnotvalid flag recovery.

	add content

	Update per recent changes and new preferred option: -n <nodename>

	While waiting for a manual ack, also check to see if the node has rejoined the cman cluster -- if it has, take that as an ack.  This new check is a no-op when using gulm.
	nodename="hostname" is now the preferred node-specific manual
	fencing data instead of ipaddr="hostname".  (The ipaddr form is still
	recognized.)

	Similarly, fence_manual -n <nodename> and fence_ack_manual -n <nodename>.
	(-s <ip> is still recognized for fence_ack_manual)

	(There has been some discussion about a possible new name for this agent,
	although fence_manual would remain an alias for any new name.)

2004-11-23  Ken Preslan  <kpreslan@redhat.com>

	More comments from ben.m.cahill@intel.com.

2004-11-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy the language, fix a few typos, and update it a little.

2004-11-23  David Teigland  <teigland@redhat.com>

	remove warning and a couple unnecessary type casts

2004-11-22  Jonathan Brassow  <jbrassow@redhat.com>

	- make the "in_sync" flag log based (rather than module-based) this   way, different mirror sets can have their own state of in-sync or   not.
	- fix bug that allowed different nodes to have different views of
	  who the master is.

2004-11-22  Ken Preslan  <kpreslan@redhat.com>

	When updating the atime, don't demote the glock back to shared unless someone else is asking for it.

2004-11-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Make command-line options override CCS rather than the other way round. That really annoyed me.

	Remove some redundant code.

	Tweaks to init script

2004-11-22  David Teigland  <teigland@redhat.com>

	The VALNOTVALID flag was being incorrectly cleared during recovery in cases where it was already set prior to recovery.

	The lvb wasn't being copied into the master-copy lkb on unlocks, so when the unlock entailed an lvb write, an old value was used. This solves the problem of gfs's cached stat values being wrong.

2004-11-20  Jonathan Brassow  <jbrassow@redhat.com>

	- a little clean-up - basic optimization (test)

2004-11-19  Lon Hohberger  <lhh@redhat.com>

	Re-enable support for specifying target nodes for enable/disable/etc.

	- Read configuration data before joining the service group - Forward disable requests to the correct member

2004-11-19  Ken Preslan  <kpreslan@redhat.com>

	Get rid of unneeded return value.

2004-11-19  Lon Hohberger  <lhh@redhat.com>

	Add checks to make sure the nfs daemons are running.

2004-11-19  Ken Preslan  <kpreslan@redhat.com>

	o  Clean up some memory allocation code o  Munge comments

	Clean up the statfs code some.

2004-11-19  Patrick Caulfield  <pcaulfie@redhat.com>

	If a nodes dies after beiung sent a JOINCONF then remove it from all nodes in the cluster, not just us.
	Might fix 133512

	Clean joining_nodeid in a few places. Also mark a joining nodeid dead before cancelling a transition.
	Should (probably) fix 139958

2004-11-19  David Teigland  <teigland@redhat.com>

	Allow delays of -1 to indicate forever.

	Three config options for fence deamon can be set in cluster.conf or on command line.  The "delay" option added earlier is replaced by "post_join_delay" and the default is 3s.  It's the length of time we would wait after adding a new node before fencing any victims (if there are any.)  This helps to avoid spurious fencing on cluster startup.
	"post_fail_delay" is the number of seconds we will wait before
	fencing a failed node.  This provides a chance for it to rejoin
	the cluster and avoid being fenced.  The default is 0s which is
	equivalent to past behavior.

	"clean_start" if 1 indicates that all nodes should be assumed in
	a clean state to start.  Any nodes in an unknown state when the
	fence domain is formed and enabled will not be fenced.  This can
	be dangerous to enable.  The default is 0.

	These can optionally be added to cluster.conf in the section
	<fence_daemon post_join_delay="x" ...>
	</fence_damon>

2004-11-19  Ken Preslan  <kpreslan@redhat.com>

	Many more good comments from ben.m.cahill@intel.com.

2004-11-18  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	switched = to += so I can add paths to LIBS

	if a plock IS_SETLKW, then it is a *blocking* request.

2004-11-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Change dead_node_lock to a spinlock and don't hold it for nearly as long. Don't cancel join if we get a WAIT after an ACK. This speeds up bulk rejoins quite a lot and also gets rid of some scary messages.
	Add a BUG() and printks that may help in tracking down 133512

2004-11-17  Chris Feist  <cfeist@redhat.com>

	Fixed problems w/ make uninstall not working w/ rgmanager.

	Uninstall script didn't uninstall gnbd.h properly.

2004-11-17  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	The compiler is generally better at knowing when to try to inline functions than I am.  And it gets confused when I am wrong.

2004-11-17  Ken Preslan  <kpreslan@redhat.com>

	Missed a use of the async flag that was just removed.

	o  Fix things so a freeze call requesting the transaction lock can't    cancel a recovery process requesting the transaction lock. o  All our lock modules are now asynchronous.  Get rid of support for    sync modules.

	Get rid of unneeded file.

2004-11-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix some comments

	Add a compatibility layer (conditionally compiled in) for using a 32bit libdlm on systems with a 64bit kernel.

2004-11-17  David Teigland  <teigland@redhat.com>

	Add more intelligence to fence daemon to avoid fencing nodes when we detect conditions where it might be likely.
	When fence victims are added following a node /joining/ the fence
	domain (rather than the usual of victims added following a node
	failing), it's a good clue that other nodes may be in the process
	of joining the cluster and therefore unfairly marked for fencing.

	When this is detected, delaying for a configurable number of seconds
	before doing the actual fence operation can allow victim nodes some
	time to join the cluster and avoid being fenced.  The default delay
	in this event is now at 3s, but increasing it to 10s may be better.

	It can optionally be set in cluster.conf by adding:

	<fence_daemon delay="10">
	</fenced_damon>

2004-11-17  Jonathan Brassow  <jbrassow@redhat.com>

	- add cmirror target - fix rgmanager referencing magma-plugins/make/release.mk.input for the   tarballs target

	- forgot the uninstall script

	- cluster mirror

	- fix seg fault that occurs when querying ccs with desc that is too large   rbz134608

2004-11-16  Ken Preslan  <kpreslan@redhat.com>

	o  Fix bug #133368.  Change the code to trigger calls to lm_cancel() on    LM_FLAG_PRIORITY requests instead of LM_FLAG_NOEXP requests. o  Don't call lm_cancel() as often.

2004-11-16  Lon Hohberger  <lhh@redhat.com>

	- Add support for "-o" option to control on/off/reboot. - Add support for RPC/TPS/IPS series switches from WTI.

	Use -n instead of -p for port number.  Ignore case for options read from stdin.  Actually handle -v argument.

	Add support for the widely-used RPS-10M-HD modules.  (2 node clusters ONLY)

2004-11-16  Ken Preslan  <kpreslan@redhat.com>

	Formatting munge.

2004-11-16  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix broadcast.

	Fix debug print

	Undo last check-in for this file that came from a bogus tree. wrists have been slapped.

2004-11-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Make the API a little more consistent. nodeid==0 always means (this node) and GETALLMEMBERS can be called witha NULL parameter to get the number of nodes.

	use GET_ALL_MEMBERS to return number of nodes in the cluster as it's consistent with the get_members call.

2004-11-15  David Teigland  <teigland@redhat.com>

	We should wait for the fence domain join to complete before allowing a gfs mount, and not allow a mount if the node is in the domain but leaving.

	Bug in names_equal() caused nodes to never be identified as "first victims".  Now that this is fixed, people may start noticing their nodes being fenced when they're not in the cluster and a new fence domain is started.

2004-11-12  David Teigland  <teigland@redhat.com>

	fix can_avert_fence() function, was using cman api incorrectly

2004-11-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Udev script (goes in /etc/udev/rules.d) for creating DLM devices.

2004-11-11  Lon Hohberger  <lhh@redhat.com>

	Clean up bad mallocdbg stuff

2004-11-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Make the default lockspace AUTOFREE so that it gets deleted when the last user closes it.

	Add a flag to userland lockspaces that will cause them to be deleted when the last user closes the device.

	Get rid of suprious ASSERT in dlm_unlock that broke cancellations. Remove locking from a routine that is only ever called from ASSERT, it only causes the ASSERT to deadlock without producing any debug info :)

	Decrement the module count if returning -EEXIST from dlm_new_lockspace().

2004-11-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix refcounting error.

	Return the LVB "INVALID" state to users when the LVB has been invalidated.

	Byteswap (if appropriate) new rl_flags field.

	When comparing node states, "JOINING" is effectively the same as "DEAD", so don't screw up a cluster transition for that small semantic difference.
	Should close #133512

2004-11-10  David Teigland  <teigland@redhat.com>

	add a log_debug line

	freeing a value before using in debug print

	add an extra line to syslog to help track what's happening

2004-11-09  Chris Feist  <cfeist@redhat.com>

	Fixed name of tarball to install.

	Created a .PHONY tag for srpms.

	No error if srpms already exists.

2004-11-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't try to reconnect when we get EOF on a socket.

2004-11-09  Ken Preslan  <kpreslan@redhat.com>

	Add some locking to the recent list and forward pointer when tearing down the RG list.  It's not strictly necessary, since there will be no one allocating during the tear-down.  But...

	Fix my stupidity.

	o  Fix bug #135684.  Change code to make sure a RG is part of the "recent"    list before removing it from that list.  Thanks to    alexander.laamanen@tecnomen.com o  Other allocator cleanups.

2004-11-09  Chris Feist  <cfeist@redhat.com>

	Updated location of srpms.

2004-11-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Remember to assign parent during RSB rebuild.

	Tidied up the userland/kernel interface so that all the data transfer happens in the read/write path rather having some copy_*_user side-effects. Also tidy the dlm_*_wait() calls so they share code with the normal calls.
	This breaks kernel/userland compatibilty. You must upgrade both kernel and
	userland (libdlm) together!

	Move lowcomms_close() outside of the spinlock, as it may want to sleep.

2004-11-08  David Teigland  <teigland@redhat.com>

	these changes should fix the rare problem of waking a recoverd thread that's already exited

2004-11-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Only overwrite the user's LVB if the lockop has changed it

2004-11-04  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Fix lock_gulm.ko for nonSMP kernels.  Silly me, spinlock_t has no size when nonSMP.  Tried to malloc an array of zero length.  Don't do that any more.  Thanks to Graham Wood for helping me hunt this one down.

2004-11-04  Chris Feist  <cfeist@redhat.com>

	Moved specfiles to proper name.

	Moved GFS-kernel.spec.in to gfs-kernel.spec.in

	Fixed directory locations

	Added spec file.

	Fixed dlm.spec.in

	Added spec file for dlm-kernel

	Added spec file for fence

2004-11-04  David Teigland  <teigland@redhat.com>

	Set the VALBLK flag on the NL locks used for gfs's hold_lvb.  Not mixing lvb/non-lvb locks makes the recovery effects more sensible although no different in the end.

	Allocate an lvb for a new master rsb during recovery if any VALBLK locks exist, even NL.  This is a minor incremental change in lvb recovery.

2004-11-04  Patrick Caulfield  <pcaulfie@redhat.com>

	lowcomms_close can be called when atomic, so we can't use nodeid2con (which uses a semaphore). Get the connection directly instead. This should be safe because lowcomms_close is called during early recovery.

	Keep a local copy of cbinfo->isoob as cbinfo can be freed before reaching the while -- causing an oops.

2004-11-03  Chris Feist  <cfeist@redhat.com>

	Changed srpm building location.

2004-11-03  Lon Hohberger  <lhh@redhat.com>

	Fix changes WRT bash 3.  Use the 'ip' command instead of ifcfg for now. Don't arping if ipv6.

	No longer needed.

	Don't free old block if realloc fails

2004-11-03  David Teigland  <teigland@redhat.com>

	update from src files

	remove 2.6.8.1 patches

	missed a couple spots when removing rcom stats

2004-11-02  Lon Hohberger  <lhh@redhat.com>

	Clear out references to mallocdbg.  Remove mallocdbg files. Fully clean up memory before exiting.  Make sure we free *everything* we allocate.
	Add fixed-size alloc/free file.

	Remove mallocdbg references.

	Remove mallocdbg files + refs.  Give ourselves ways to free/clear out all internal state (msg_shutdown(), clist_purgeall(), etc.).

2004-11-02  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- get lock_gulm.patch uptodate with source.

2004-11-02  Patrick Caulfield  <pcaulfie@redhat.com>

	Add some locking around queue traversal.

2004-11-02  David Teigland  <teigland@redhat.com>

	Add a semaphore to serialize recovery with mount-group portion of unmount.  This avoids a potential hang during unmount where both the recovery and unmount threads believe the other will call kcl_start_done() to complete the recovery.  Unlikely this has been seen in practice, but possible.

	remove rcom debugging code that we're not using

	allow max nodes to be set from /proc/cluster/lock_dlm/max_nodes

2004-11-02  Chris Feist  <cfeist@redhat.com>

	Fixed variable in rpm spec file.

	Added rpm spec file.

	Fixes in the script to build srpms. Fixes in the misc. spec files.

2004-11-01  Chris Feist  <cfeist@redhat.com>

	Added rpm spec file for gnbd

	Fixes to the scripts for building SRPMS.

	RPM spec file for magma.

	Added a script for building srpms from the individual components.

2004-11-01  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	By default, gulm determins the name of the machine it is on with gethostbyname(). Then it looks up an ip from this name to use as its IP.
	There are now three ways to override these defaults.  --name will use the
	name given instead of what is in gethostbyname().  --ip will use that
	address for this machine. (don't be stupid and set it to a value that isn't
	configured to this machine.)  And --ifdev will lookup the ip from the
	configured network device.  --ip overrides --ifdev.

	These options are only available form the command line options.

	Fix __you_cannot_kmalloc_that_much by switching the large kmallocs to vmallocs.

2004-10-31  Daniel Phillips  <phillips@redhat.com>

	Added kernel snapshot read lock upload for failover Added kernel worker daemon recovery for failover

2004-10-29  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Allow gulm services to lock core.  Locked core will ignore the shutdown requests.  gulm services that lock core must logout to unlock core.  currently anything from kernel space locks core.

	Fixed an end case weirdism.  Given a cluster with three servers, and at least two clients.  Kill the Master, a Slave, and all but one client.  Wait for the remaining Slave to become Arbitrating, and completely fence all dead nodes.  After all killed nodes reboot, restart lock_gulmd as concurrently as possible.  The journals for the mounted clients will not get replyed.  The Problem.  The lock_gulmd on the Slaves log into the Arbitrator, Arbit becomes Master.  Lock_gulmd on killed Clients logs into Master before lock_gulmd on old Clients.  This makes the bit of info about the killed Clients being killed get lost.  So the old Clients do not see this when they return.  So they do not know that there are journals that need replaying.  Once the new Clients mount, they replay and things continue. If they do not mount, portions of the file system are blocked by expired locks.  The fix.  The current design of the cluster manager portion of gulm makes this overly complex.  Without changing the design, either a new daemon needs to be written, whoes purpose is simply to sweep the lockspace when nodes expire.  Looking for the locks with lvbs that are storing jid mappings and twisting them so that the module knows to replay them.  New daemon is icky, so not doing that.  Changing the design of gulm at this point is icky too.  Gulm is being maintained because it is a known code base.  Changing the design would break this.  So not doing that.  Since all that needs to be done is to fiddle one byte, given known values of other bytes in a lock, I just added a function to the lock server code.  A bit kludgy putting it there, but it is the least intrusive solution.

2004-10-29  Jonathan Brassow  <jbrassow@redhat.com>

	- ensure that the config_version is an integer

2004-10-29  David Teigland  <teigland@redhat.com>

	allow drop_locks_count of zero to disable drop callbacks altogether

2004-10-28  Ken Preslan  <kpreslan@redhat.com>

	More comments from ben.m.cahill@intel.com.

2004-10-28  Chris Feist  <cfeist@redhat.com>

	Fixed configure script so it would configure rgmanager.

2004-10-28  Jonathan Brassow  <jbrassow@redhat.com>

	- change a log_msg to log_err, so that the error is printed even if the user does not specify the -v

	- fix problem that generated a circular dependency

2004-10-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Example of using libcman

	First cut of a libcman - comments welcome

	Add userland API to get the cluster name/ID

	Tidy the userland API so it takes nodeid 0 to mean "us"

2004-10-28  David Teigland  <teigland@redhat.com>

	Cached null locks that had been used with plocks were being freed too early, before the the unlock completion ast.

2004-10-27  Ken Preslan  <kpreslan@redhat.com>

	Fix minor permissions issue.

2004-10-27  Lon Hohberger  <lhh@redhat.com>

	Prune tree when a child type is not allowed

2004-10-27  Ken Preslan  <kpreslan@redhat.com>

	Fix bug #126952
	Now, GFS freezes and unfreezes a filesystem by reading and writing to
	/proc/fs/gfs instead of doing ioctl()s directly on GFS files.  This
	fixes a bug where a process trying to unfreeze a filesystem would end
	up blocking behind another process holding a lock on the mountpoint
	and waiting for the filesystem to be unfrozen.  This bug has always
	been present, but it's much more visible in the 2.6 code.

	Note that the arguments to "gfs_tool [un]freeze" need to be exactly
	what's found in /proc/mounts now.

	Also, "gfs_tool margs <mountargs>" replaces the old way of specifying
	extra mount arguments: "echo <mountargs> > /proc/fs/gfs".

	Whitespace munging.

2004-10-27  Lon Hohberger  <lhh@redhat.com>

	* Pass SHAREDIR to build. * Support 'forbid' flag to prevent resource children.

2004-10-27  Chris Feist  <cfeist@redhat.com>

	Removing accidetally include defines.mk

	Added makefile

	Updated configure scripts to include a share directory (required by rg_mamanger)

2004-10-27  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Fixed some queue jumping.  If the lock was held shared, and a new request for shared came along, the new request would succeed, even if there was another request in the conflict queues that came prior to it.

2004-10-27  Lon Hohberger  <lhh@redhat.com>

	Removed.  Replaced by clusterfs.sh/netfs.sh

2004-10-27  Chris Feist  <cfeist@redhat.com>

	Fixed rgmanger build process

2004-10-27  Lon Hohberger  <lhh@redhat.com>

	Add preliminary netfs (NFS) and clusterfs (e.g. GFS) resource agents. Add verify-all support to all file system agents.

2004-10-27  Chris Feist  <cfeist@redhat.com>

	Added make directory for rgmanager

	Changed the build process for rgmanager so it more closely resembles the other directories in cluster.

2004-10-27  Ken Preslan  <kpreslan@redhat.com>

	Stop compiler warnings.

2004-10-27  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- If a node remounts on the jid while we are replaying thier journal,   don't be mean and mark the jid as being free when we finish. - for real, remove the gulm_jid.h file.

2004-10-26  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- removed node locks.  The things they worked around in the past do   not need working around anymore. - remove gulm_jid.h works better if in gulm.h (not to mention some   bits were wrong.)

2004-10-26  Chris Feist  <cfeist@redhat.com>

	Updated version number

	Added a target to edit the release numbers when preparing tarballs.

2004-10-26  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- stop multiple local jid list scans on the same fs from trampling   each other.

2004-10-26  Patrick Caulfield  <pcaulfie@redhat.com>

	warning - large checkin.
	Change to using kernel_sendmsg & kvecs instead of sock_sendmsg & iovecs.
	This makes the code a lot neater in places and gets rid of some potential
	user/kernel address confusion.

	Oh, and it only works on 2.6.8 upwards.

2004-10-26  Lon Hohberger  <lhh@redhat.com>

	Fix x86_64 build warnings

	Fix warning on x86_64

2004-10-26  David Teigland  <teigland@redhat.com>

	A little optimization I've intended to do forever: get rid of the node list search in name_to_nodeid.  Add a nodeid array to just index into.

2004-10-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Add priority to cman sockets

2004-10-26  Lon Hohberger  <lhh@redhat.com>

	Copy changes to old cman plugin.

	Fix bug feist was seeing during builds on x86_64

	Change to match magma API changes (clu_members_lost->memb_lost)

	Take out unnecessary printfs.  Change to match with new memb_lost/gained functions in magma.

	(1) Split up thread and non-thread libraries so applications which do not need pthreads can operate without linking against it. (2) Provide mutual exclusion/sleep hack around default-plugin's locking functions. (3) Change clu_members_lost/clu_members_gained to memb_lost/memb_gained to match up with other functions. (4) Add cp_connect function. (5) Add thread_test program for exercising multithreaded locking using magma's clu_lock/clu_unlock functions. (6) Clean up warnings in cluster_cmd

	Ensure we wait for the AST during the unlock as well as the lock.  Simplify when we assign/free the lksb in the lock function.

2004-10-25  Lon Hohberger  <lhh@redhat.com>

	Make all the different libdlm targets use -fPIC during builds for proper symbol relocation on x86_64

2004-10-25  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- sometimes when starting multiple gulm server for the first time,   some may drop out due to GenID conflicts.  At times other than this   startup case, this is what we want.  But when we are just starting   up like this, we'd rather that the server give it another try.   So they do that now.

2004-10-25  Adam Manthei  <amanthei@redhat.com>

	bug 137035 -- add support for configurable ssl port locations to fence_ilo bug 137037 -- Add support for perl-Crypt-SSLeay package to fence_ilo

	man page for fence_bladecenter

	Yet another method for fencing the IBM bladecenter.  This method requires that the bladecenter is running with firmware new enough that provides a telnet interface to the management module.  This effectivley deprecates fence_xcat and is now the preferred fencing agent for the IBM bladecenter.

2004-10-25  Lon Hohberger  <lhh@redhat.com>

	Per Patrick's comments: open/create lockspace when first lock is taken instead of at init time.

2004-10-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Remember to free connections[0] if initialisation fails.

	Don't deref freed skb. Thanks Ben.

	Close any created listening sockets "listen_for_all" fails

	Only wake astd when there is work for it to do. Also make the wake condition consistent with the check for work

2004-10-22  Lon Hohberger  <lhh@redhat.com>

	Add cp_connect() function to library.  Make cptester only use cp_* functions.

	Use libdlm_lt with cman and sm plugins (removes dependency on dlm_pthread_*).  Also make all the return value semantics match.

2004-10-22  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- update the patch.

2004-10-22  Benjamin Marzinski  <bmarzins@redhat.com>

	removed unneeded variable

	Updated gnbd-kernel patches for 2.6.9

2004-10-22  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- Updated lcok_gulm for the 2.6.9 kernel.

2004-10-22  Chris Feist  <cfeist@redhat.com>

	Added cman-kernel patches for the new 2.6.9 kernel.

2004-10-22  David Teigland  <teigland@redhat.com>

	update

	update from src files

	Change the default drop-locks value to 50,000.  Both the drop locks value and period are now configurable through proc.

2004-10-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Revert 1.40 as it causes astd to spin for some reason I haven't fathomed yet.

2004-10-22  David Teigland  <teigland@redhat.com>

	Update to the new plock lm interface and 2.6.9.  This fixes the problem where the dlm and vfs locks could get out of sync.

2004-10-22  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Don't requeue front on conflict with priority flag. Else there is a race with multiple lock requests with priority flag that deadlocks request.

2004-10-22  Ken Preslan  <kpreslan@redhat.com>

	Update to 2.6.9.  (Lock_dlm and lock_gulm are broken until updated by their owners.)

2004-10-22  Daniel Phillips  <phillips@redhat.com>

	Fix csnap_create so that csnap_destroy recovers dm devices on error Fiddle with command line arg order, really needs proper arg parsing

2004-10-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Add some (optional) stats collecting.

	Don't call wake_astd when we're doing a remote unlock.

	Add lock ORPHAN state, and associated query. Locks go into this state when they are marked PERSISTENT and the user process exits without unlocking.
	Thanks to Stanley Wang of Intel for most of this.

2004-10-21  David Teigland  <teigland@redhat.com>

	mention how to use a different port for cman

	udp, not tcp

2004-10-20  Ken Preslan  <kpreslan@redhat.com>

	Update patch.

	Stuff all of the assert message into the panic call.

2004-10-20  Chris Feist  <cfeist@redhat.com>

	Removed a debug line from the Makefile, which is not necessary anymore

2004-10-20  David Teigland  <teigland@redhat.com>

	We need to call process_requestqueue() when finishing a first recovery (upon joining the lockspace).  Although rare, it's possible to get dir lookups from other nodes prior to our own finish.  These need to be taken off the requestqueue and processed.  Hung gfs mounts are one evidence of this bug.

2004-10-19  Benjamin Marzinski  <bmarzins@redhat.com>

	Fixed gnbd_import and gnbd_export so that -r with no devices returns an error. This still needs to be fixed in the 6.0 code

2004-10-19  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- Added command to gulm_tool to query the services that have connected   to a given gulm_core.

2004-10-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Changed the protocol header to include the source port number so it can be passed to an application. I've moved things around in the header so if you try to use an old cman with this one they should just not see each other.
	Also widen the flags to an int32 so we don't havd to do that ugly shifting
	when checking them...it also keeps the structure aligned correctly.

2004-10-19  David Teigland  <teigland@redhat.com>

	a "minimum gfs" howto that I wrote up a long time ago: one dedicated gnbd server and two gnbd clients as gfs nodes, haven't actually walked through and tested it, so...

	A slight variation on one of the recovery special cases wasn't handled correctly; add small fix and extend comment description.

	the journalid code inherited the hold_lvb changes for gfs; it's not necessary so skip

	update per build improvements by cfeist and anticipating a 2.6.9 kernel

2004-10-19  Daniel Phillips  <phillips@redhat.com>

	Agents now instantiate servers using a dlm-based protocol

2004-10-19  Chris Feist  <cfeist@redhat.com>

	Misspelled the module_dir in the previous checkin.  (It was moduledir)

	Modified the 'make all' command to install the files into the cluster/build directory.  This allows one to do 'make all' and build everything w/o actually installing files somewhere on the system.

	Removed old includes from the kernel.  Added an include for ${incdir} in case inc dir is not /usr/include

2004-10-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Add a loopback to the comms layer so that clients can send messages to themselves or other clients on the same node.
	Note that, by default, broadcats sends will still /not/ be copied to the
	local system unless MSG_BCASTSELF is added to the flags.

	Compile two DLM libraries, one that needs pthreads, and one that doesn't

2004-10-15  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- i know they're unused, but it hurt my brain less if they're atleast   correct.

2004-10-15  Daniel Phillips  <phillips@redhat.com>

	Add agent.c and sendagent.c

2004-10-15  Jonathan Brassow  <jbrassow@redhat.com>

	- fix for bug rbz134282 (bad handling of port number specification)

2004-10-15  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- stop printing out lock ids in different formats.  its confusing.

	Here's a patch to fix a gulm_tool bug that allows a user to enter the commands `gulm_tool nodelistcrap $server` and `gulm_tool nodeinfocrap $server $node`.   patch from adam manthei.

2004-10-14  Daniel Phillips  <phillips@redhat.com>

	Sigh.  Get the gfs bits out of the patch

	Teach diff about dm-csnap.c and dm-csnap.h

2004-10-14  Patrick Caulfield  <pcaulfie@redhat.com>

	A simple DLM "hello world" example from Daniel.

	Improve support for PERSISTENT locks, and make the lkid checking a bit more paranoid.

2004-10-14  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- This removes the limit of 300 jid mappings.

	- get builds with --prefix working.

2004-10-13  Ken Preslan  <kpreslan@redhat.com>

	Don't align the glock hash buckets.  The gfs_sbd structure is now about 10 times smaller.

	Formatting.

	o  Fix bug #135249 with a lot of help from Dave Teigland.  Ever since the    create transaction was broken into two transactions, it was possible    for the second transaction to happen without having to allocate disk    space.  When this happened, GFS wasn't locking the resource index before    searching it.  Add the correct locking. o  Other munging.

2004-10-13  Patrick Caulfield  <pcaulfie@redhat.com>

	add DLM_SBF_VALNOTVALID so that the examples compile again. It's not implemented yet, but will be.

	Quick overview of the libdlm function calls.

	Dear, oh dear this was out of date. This should be a lot better but please report anything still amiss.

	Fix lock modes constants that were incorrect.

	Simple LVB test prog

2004-10-13  David Teigland  <teigland@redhat.com>

	use simpler kthread routines for serviced

2004-10-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Open the default lockspace if dlm_get_fd() is called before any other locking operations. Make sure that any routines calling pthreads are surrounded by #ifdef _REENTRANT so a non-pthread library can still be built.

2004-10-13  David Teigland  <teigland@redhat.com>

	fix dependency

2004-10-13  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- VFS does weird things with the error results, so before we try to   return a gulm error code, flip it to -1.   This fixes bz#132772

	- don't return positive error codes on loc module mount failures.   does not fix bz#132772

2004-10-12  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- plug leaky memory.

2004-10-12  Ken Preslan  <kpreslan@redhat.com>

	I killed a bunch of people once.

2004-10-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Move pingtest into userspace and check for invalidated LVBs
	Also some cosmetic changes to the other tests that were lying around
	in this directory when I typed "cvs commit"

2004-10-12  David Teigland  <teigland@redhat.com>

	another shot at correctly stopping dlm_recoverd thread when shutting down the lockspace, the kthread routines aren't much help in this situation

2004-10-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't free "othercon" connections when they are closed as they might still be busy in the read loop.

2004-10-11  Lon Hohberger  <lhh@redhat.com>

	Handle default value in RA parameters

	Remove references to handlers for RAs.  They're not needed.

2004-10-11  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- don't logout on kill -TERM

2004-10-11  Patrick Caulfield  <pcaulfie@redhat.com>

	Quit rx loop if the thread is closing down.

2004-10-11  David Teigland  <teigland@redhat.com>

	Avoid doing a synchronous unlock in unhold_lvb by just letting the lock_dlm thread delete the lock struct when the unlock completes. This prevents a possible deadlock between lock_dlm threads where one is doing recovery and the other is doing a gfs callback which can do an unhold_lvb.

2004-10-09  Ken Preslan  <kpreslan@redhat.com>

	o  Support for immutable and append-only files with a lot of help from    Anton Nekhoroshikh <anton@hq.310.ru> o  Use intents to help with O_EXCL creates instead of the kludge we were    using before. o  Other cleanups.

2004-10-08  Lon Hohberger  <lhh@redhat.com>

	More doxygen stuff

2004-10-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Close the lowcomms sockets during recovery rather than as soon as cman notices the node has died. This should help synchronise things a bit better and (hopefully) avoid spurious disconnect/reconnect events that could happen.

	Forgot to set node_state when a node is killed via STARTTRANS

2004-10-07  Ken Preslan  <kpreslan@redhat.com>

	Print a message before, as well as after, trying to mount the lock protocol.

2004-10-07  Daniel Phillips  <phillips@redhat.com>

	Add "manual" csnap server failover

2004-10-07  Ken Preslan  <kpreslan@redhat.com>

	Munging capitalization and other stuff.

2004-10-07  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- Initalize entire sockaddr6 for binding.

	- Fixed tiny memory leak in config parsing.

	- was double decrementing the expired holders counter.   stopped that.

2004-10-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy the close_connection() routine. in addition add a parameter telling it whether to close an attched "othercon" or not as close_connection() is often called to shut down in the event of an error and we only want to close down "this" socket, not others that may be busy.

2004-10-07  Daniel Phillips  <phillips@redhat.com>

	Updated design document with details on server failover

2004-10-06  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- the kernel side of things for getting the posix range F_GETLK cmd.

	- the kludging required server side to get something that posix can   use for the F_GETLK command.

	- try to be a bit clearer about how you can name thigns in the servers   list and what gulm does with that.

2004-10-06  Daniel Phillips  <phillips@redhat.com>

	Remove out of date 2.4.26 kernel patch csnap-agent now accepts multiple local connections, with polling (and so multiple csnap devices on one node works again).

2004-10-06  David Teigland  <teigland@redhat.com>

	sync up flags with dlm.h

2004-10-06  Ken Preslan  <kpreslan@redhat.com>

	More comments from ben.m.cahill@intel.com.

2004-10-05  Lon Hohberger  <lhh@redhat.com>

	More comments

	Add Doxyfile.  Add lots of Doxygen-readable comments to code.

2004-10-05  Ken Preslan  <kpreslan@redhat.com>

	A patch from ben.m.cahill@intel.com to install the gfs_mount man page.

	Fix a few bugs in the eattr/acl code. Other munging.

	Break compound assert into two.

	Munge.

	blerg.

	A command line tool that's a bit smarter about reading a GFS filesystem than gfs_edit is.

2004-10-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Update highest_nodeid at the client-end of a transition too. There is a tiny chance this could have been causing some memory corruption crashes.

	JOINING timeout should go back to JOINWAIT rather than giving up.

2004-10-04  Lon Hohberger  <lhh@redhat.com>

	Remove MAX_MSG_SIZE limitation

2004-10-04  Daniel Phillips  <phillips@redhat.com>

	Move development to 2.6.8.1 Replaced csnap-2.6.7 patch by csnap-2.6.8.1

	Renamed service.c to agent.c Added unlink for non-abstract named sockets Cleanups in dm-csnap.c client

2004-10-04  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- fiddled with a few comments. - make the dir that pid lock files go into now. - add name and ip to the cmdline arg help.

2004-10-04  Patrick Caulfield  <pcaulfie@redhat.com>

	Though Id checked this in last week.
	Cope with sparsely allocated (and large) nodeIds. Gets rid of the
	"max_connections" config variable

2004-10-04  David Teigland  <teigland@redhat.com>

	update from src files

	lock_dlm needs to return EAGAIN itself

	we must provide the correct astarg to dlm_unlock now that NULL is valid

2004-10-04  Daniel Phillips  <phillips@redhat.com>

	Get rid of startup race by having csnap server fork its own daemon after successfully binding to port, instead of letting shell do it.

	Change to named socket for device control connection

2004-10-01  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	*sigh* :wq

	- fix inaccuracies in the counters.

2004-10-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Kernel check for max nodeid too. in case anyone bypasses cman_tool

2004-10-01  Daniel Phillips  <phillips@redhat.com>

	Target now asks for connection when it needs one Service.c now looks more like a failover daemon The real devspam.c data checking utility checked in

2004-09-30  Patrick Caulfield  <pcaulfie@redhat.com>

	I am an idiot

	Honour the wanted_nodeid when we are the first node in the cluster.

	Don't say "we are leaving the cluster" when we never actually join it.

	Sanity check the nodeID

	Make sure the nodeids array is increased enough to cope with very large increments in the nodeid. I don't know why anyone would want to add a node id "1000" to a cluster with 10 nodes in it, but it shouldn't oops when you do :)

2004-09-30  David Teigland  <teigland@redhat.com>

	always take the ast arg from dlm_unlock(), even when NULL

2004-09-30  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- must remember to decrement holder count when removing holders from   list.

2004-09-29  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- changes to match last change in userspace.

2004-09-29  Daniel Phillips  <phillips@redhat.com>

	Now works with unmodified device mapper, hack removed

	Create virtual device by execing dmsetup Add example code for establishing connections

2004-09-28  Daniel Phillips  <phillips@redhat.com>

	Socket-over-socket control interface now functional

2004-09-28  Lon Hohberger  <lhh@redhat.com>

	Port from clumanager 1.2.x: potential fix for #114388

2004-09-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Wait for membershipd to shutdown before starting to clean up.
	This should ensure that the LEAVE message will get sent.

	Get rid of REMOTEMEMBER

	the kernel's interface numbers start at 1, not zero. So we need to increment "number" before passing it into cman.

	Remove state REMOTEMEMBER as it's not been used for ages. I've started the enum at 1 so that the other don't move though...
	Also cope better with dodgy networks during join. Send JOINREQ messages
	until we get a JOINACK or we timeout rather than just sulking.

2004-09-27  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- removed unused function.

2004-09-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Make /proc/cluster/status a bit more consistent in its output, and also show a little more when when not in a cluster.

2004-09-27  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- removed some code that wasn't called anymore. - added some static initializers.

2004-09-27  Patrick Caulfield  <pcaulfie@redhat.com>

	Print "left cluster" reasons as text.

	Tidy daemon shutdown so that membership is always responsible for sending LEAVE messages and will only do them duting its shutdown.
	There are still a few send_leave() calls in other places but these
	are all just before a panic.

	Only stop recoverd if it is running

2004-09-25  Daniel Phillips  <phillips@redhat.com>

	Actually commit (cvs, why are you so broken?)

2004-09-24  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- have magma use the new quorate info.

	- update the gulm lib to reflect new quorate info.

	- fixing an ism of gulm's gfs-only past.  There was not a way for   services on clients to truely know if the gulm servers were in   quorate or not.  So there is a new message that gets pushed out when   quorum is gained or lost.   this is related to bz #129879

2004-09-24  Daniel Phillips  <phillips@redhat.com>

	Added devspam.c device data verification utility Added socket-over-socket connection passing, not tested yet!

2004-09-24  David Teigland  <teigland@redhat.com>

	use down_interruptible, fcntl may return EINTR

2004-09-23  Lon Hohberger  <lhh@redhat.com>

	First pass at resource tree deltas (tested).

2004-09-23  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- these build again. (forgot to update them with library.)

2004-09-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Free unused direntry structs when releasing a lockspace.

2004-09-23  David Teigland  <teigland@redhat.com>

	An agent's error message should now be recorded in syslog (worked in my test).  Not sure why WIFEXITED didn't work as expected.

2004-09-22  Benjamin Marzinski  <bmarzins@redhat.com>

	fixed printing issue for 6.1

2004-09-22  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	Basic posix range locks work in gulm now.  Lots of changes required to the gulm lock module to get this working.
	In order to get the plock code in place, the main lock request
	pathways were rebuilt.  This made the code cleaner, as there were
	some pretty darn scary things going on before.  The down side to this
	is that I changed the lock pathways for everything.  The basics do
	seem to work though.

	Much of the non-working bits of the jid code were removed.  So we're
	still stuck at max cluster size of 300.  Will deal with this later.

	Through the course of this, I found some files with code I wasn't
	using. They got removed.

	Some code was moved around.  Some was pulled out of where it was
	randomly shoved originally, and put into its own file.

	There is most likely some other cleanup type things that can still
	be done.


	Mount/unmount on two nodes has been tested.
	~5 minute runs with make_panic has been tested.
	Couple of plocks can be grabed and released.
	There have been NO recovery tests done yet.

2004-09-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Add module ownership to various structures so we don't get unloaded whilst busy.
	Might fix bz 133142  but I want to do some more testing first.

	Fix bug in debugging routine. I hope we don't need it any more though...

	Use C99 initialisers. Also include module reference in file_ops.

2004-09-21  Benjamin Marzinski  <bmarzins@redhat.com>

	even though you now fence nodes by their cluster name, not their IP address, fence_gnbd still needed an 'ipaddr' parameter, and the man page still said that you should use hostname or IP address.  'ipaddr' is now deprecated, and a warning is printed when it's used.  The new parameter is 'nodename'.  The man page was also updated.

2004-09-21  Ken Preslan  <kpreslan@redhat.com>

	Make an assert be more verbose.

	Do better asserting in glock_hold().

2004-09-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Yet another one of those "I can't beleive we've not seen it before" bugs.
	When we close a connection lowcomms now removes any pending writes to
	that node from the writequeue too. I bet this has been responsible for
	some wierd behaviour in the past...

2004-09-21  David Teigland  <teigland@redhat.com>

	change the way we check for local plock conflicts

2004-09-21  Patrick Caulfield  <pcaulfie@redhat.com>

	Always return non-zero exit code if we hit an error.

2004-09-21  Benjamin Marzinski  <bmarzins@redhat.com>

	Updated patches to 2.6.8.1

2004-09-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix that deadlock that's been there for ages but only ever pops its head up when you're looking for some other bug.

	Tidy.

2004-09-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Add (untested) SELinux support

	Be a bit more paranoid about creating the DLM device node. If it doesn't exist but the lockspace does, then look up the minor in /proc/misc and create it.

2004-09-17  David Teigland  <teigland@redhat.com>

	get rid of "dir entry exists" messages

	add a couple syslog messages when nodes are fenced

2004-09-16  Jonathan Brassow  <jbrassow@redhat.com>

	- fix for bug rbz 132680
	When an update was issued, the new conf got written to all nodes, but the
	daemon did not pick it up in memory until a request was made.  So, if
	an additional update was done from another node before a request was
	made and it failed, the current in-memory (stale) version was rewritten
	to disk.

2004-09-15  Jonathan Brassow  <jbrassow@redhat.com>

	- remove unneeded print - add debugging line

2004-09-15  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- The first pass at getting range locking for gulm.  This is server changes   only.  So far the basics seem to work.  gulm should be implementing range   locks that are compatible to what posix range locks expect.  Gulm is lazy   about merging ranges though, but this shouldn't affect the usage any.

2004-09-15  Jonathan Brassow  <jbrassow@redhat.com>

	- fix make clean so it cleans up binaries in bin dirs - add pthread_detach to ccsd (cluster_mgr.c) - print select failure in ccsd if not EINTR

2004-09-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Add support for allocated node IDs, both on the command-line and from CCS

	Add support for assigned nodeids so that people can have permanent node IDs assigned in cluster.conf if they really want it.
	Also tidied the joinconf code so that the validation is in a seperate routine.
	Yes, I know I should have seperated these out into two commits. Sorry.

2004-09-15  David Teigland  <teigland@redhat.com>

	Put a lock around start and exit of dlm_recoverd thread. This should fix the oops I got waking a dlm_recoverd that wasn't there.

2004-09-14  Benjamin Marzinski  <bmarzins@redhat.com>

	there was a problem with running two gnbd_clusterd processes at the same time.  This fixes that problem.

2004-09-14  Adam Manthei  <amanthei@redhat.com>

	fix typos that Erling found.

	move some functions around so that the script compiles

2004-09-14  Lon Hohberger  <lhh@redhat.com>

	Update tasks

2004-09-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove ourself from the waitqueue when told to quit.

2004-09-14  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- added --use_ccs to --help

	- added --use_ccs to man page.

2004-09-14  Ken Preslan  <kpreslan@redhat.com>

	This should be a fix for bug #126531.
	The issue has to do with the fact that GFS locking is only invoked by
	a mmap during the page fault.  There is no way for GFS to know that
	the process causing the page fault has finished reading or writing to
	the page for now.  The way GFS has worked in the past is that as soon
	as the page fault has completed, the lock protecting the file is
	available to be demoted or dropped at the request of a callback from
	another machine.  This means that a newly faulted-in page could get
	yanked out from under a process before it gets a chance to do
	sufficient work on the page.

	This checking provides a way for the page fault code to make a
	machine be greedy with a lock for a certain period of time.  This
	means that after the fault, GFS will ignore callbacks for a certain
	period of time.  After that time, GFS will respond to any callbacks
	that have arrived and then mark the file's lock as being able to be
	made greedy again.  The code is setup so that the amount of time that
	the lock is marked greedy is dependent on how much page faults traffic
	there is on that file.  When there is a lot of traffic, the time
	increases.  When there is a little traffic, the time decreases.

	Whitespace munging.

2004-09-13  Jonathan Brassow  <jbrassow@redhat.com>

	- fix memory leak + other minor anoyances

2004-09-13  Lon Hohberger  <lhh@redhat.com>

	Zero out struct sockaddr_in6 structures before using...

2004-09-13  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- from the top, its lib/libgulm.a now. - clear out socket_in6 before using them.

	- from the top, its src/lock_gulmd and src/gulm_tool now.

	- moved the option parsing code to where it was a while ago.  I didn't make   any comments last time as why I moved it to where it was, so while I   imagin I had good reason, I cannot recall what ti was.  So putting it   back, but leaving crumbs just in case. - If you want gulm to get configs from ccs, you must pass the --use_ccs   option. The code that auto-detected ccs is broken, and I've got bigger   things to do for now.  I'll deal with this again later. - added some command line options to override the auto-detect for node name   and ip.  They're going to remain mostly undocumented for a while yet.

2004-09-13  Lon Hohberger  <lhh@redhat.com>

	Remove MAX_MSG_SIZE limitation

2004-09-13  Adam Manthei  <amanthei@redhat.com>

	man page updates for the fence_rib and fence_ilo agents.

	adding the Net::SSLeay version of the fence_rib agent.  This should be used by those with iLO interfaces instead of the fence_rib (stunnel) version of the agent.

	Add ribcl version 2.0 support to fence_rib.
	Note that later versions of the iLO firmware may not work well with stunnel,
	Therefor it is better to use fence_ilo which uses the Net::SSLeay perl module
	instead.

2004-09-13  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- cleaned up the makefile as per aj req.

2004-09-13  Lon Hohberger  <lhh@redhat.com>

	dumb was requiring libxml2 to build for no reason

2004-09-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Remove distracting comment to which the answer was "no, it doesn't"

2004-09-13  Lon Hohberger  <lhh@redhat.com>

	Periodic status checks, updated resource agents, misc. bugfixes

2004-09-13  A. J. Lewis  <alewis@redhat.com>

	 o allow CFLAGS to be added to from the command line

2004-09-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Allow a bit more flexibility in how nodes are specified in cluster.conf You can now use fully-qualified host names as well as abbreviated host names. If you do use FQDNs in there then uname must return the full name too OR you can override the hostname by using -n on the command-line.
	For cman, I recommend NOT using full hostnames in cluster.conf

	There is a small chance that rem_node could be NULL when passed into process_cnxman_message if people are doing silly join/leave test loops :)

2004-09-11  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- temporarily remove ccs from gulm.  Its way not working.  Need to figure   out why, but tired of people telling about it not working when I already   know.

2004-09-10  Ken Preslan  <kpreslan@redhat.com>

	Add a missing -Wall.

2004-09-10  A. J. Lewis  <alewis@redhat.com>

	 o CFLAGS+= instead of CFLAGS= so you can add options from the cmdline

2004-09-10  Adam Manthei  <amanthei@redhat.com>

	From Lazar Obradovic:
	this is a patch to allow fence_ibmblade to use udp port other than
	standard snmp (udp/161).

	Main reason for this is that IBM BladeCenter MM supports only 3 hosts
	and not hostgroups per community, and only 3 communities, which puts a
	limit to maximum of 9 nodes in a cluster.

	This is somewhat inconvinient, so, as a workaround, one can install a
	udp forwarder on some node(s) (preferably outside cluster) and use only
	its address in IBM BladeMM configuration. Port Forwarder will probably
	have to use some other port that standard snmp, not to block snmp access
	of "relay" node, so that's what this patch is all about.

2004-09-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Make sure we wake the membership thread before waiting for it to complete

	Make all node removal happen in remove_node(). This has the nice side effect that kernel listeners get notified of all nodes that ar removed :-)

2004-09-09  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- use safer naming for the dump files that go into /tmp.

2004-09-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Clear the use_count if shut down with "force"

	Free cluster ref if we fail to start.

	Don't get blinkered when in NEWCLUSTER modes...there may still be things out there!
	or, (in sensible language)

	Also send JOINREQ message when in NEWCLUSTER as well as STARTING states.

2004-09-08  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- found some stuff I forgot to remove.

2004-09-08  Ken Preslan  <kpreslan@redhat.com>

	Great comments from ben.m.cahill@intel.com.

2004-09-08  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- turned off a couple debugging things.

	- The first 'half' of range lock support for gulm.  Doesn't actually do   range locks, but all of the io for them should be there. - Adds support for finer grained uniqueness of lock holders.  Very easy to   use this to provide per process locks. (magma plug for gulm now does   this.) - Everything should work as before.  Only notable changes should be the   libgulm.h and output of dump files.

2004-09-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix a subtle bug in the node IDs code where a node could get a different node ID than last time if all the other members who knew about it before have also been down in the meantime.
	It also fixes a possible issue wherere nodes didn't have the same information
	about DEAD nodes, as only MEMBER nodes were propogared at join time.

	Now, MEMBER & DEAD nodes details are distributed so that the whole node view
	should be completely consistent across the cluster.

	Tweak the way NEWCLUSTER works in an attempt to prevent the splits that can happen if a new nodes all try to join/form a cluster at the time.
	Based on an idea by dct, this sends NEWCLUSTER messages out repeatedly
	after a time of patient watching and waiting. there then could be
	a tie-break based on the IP addresses.

	This is for bz #126991.

2004-09-08  Ken Preslan  <kpreslan@redhat.com>

	Added "cmd" argument to lm_plock().

2004-09-07  Lon Hohberger  <lhh@redhat.com>

	OCF Actions + Autostart param addition

2004-09-07  Ken Preslan  <kpreslan@redhat.com>

	Dave pointed out that I screwed up plocks.

2004-09-07  David Teigland  <teigland@redhat.com>

	- if a first start was aborted after getting past node setup, the   nodes would be left over for the subsequent start -- need to clear them - remove some unused code from nodes file and tidy clearing nodes list

	use kthread routines

2004-09-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Improve (I think) the usage message. Well, it's more verbose anyway.

2004-09-06  David Teigland  <teigland@redhat.com>

	gfs needs a positive error from plock_get if there's a conflict

2004-09-06  Patrick Caulfield  <pcaulfie@redhat.com>

	Change cman_tool kill to take a node name instead of a node number. This is more useful and more intuitive and more consistent.

	Rename "local_nodeid" so it doesn't clash with kernel's internal use.

2004-09-06  David Teigland  <teigland@redhat.com>

	use kthread routines

	remove a couple log_debug's

2004-09-03  Daniel Phillips  <phillips@redhat.com>

	Initial add, csnap code and docs

2004-09-03  Jonathan Brassow  <jbrassow@redhat.com>

	- this should get rid of the ENETUNREACH problems... as well as the   CONNREFUSED that AJ was seeing.
	The new 'struct sockaddr_storage' structure I was using was not being
	memset before being populated.  So, there were some extra fields at
	the end that were not right.  Specifically, strace showed:

	NORMAL (no failure):
	sendto(11, "\7\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0", 20, 0, {sa_family=AF_INET6, sin6_port=htons(50007), inet_pton(AF_INET6, "ff02::3:1", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, 28) = 20

	BAD (returns ENETUNREACH):
	sendto(10, "\7\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0", 20, 0, {sa_family=AF_INET6, sin6_port=htons(50007), inet_pton(AF_INET6, "ff02::3:1", &sin6_addr), sin6_flowinfo=34, sin6_scope_id=4144328704}, 28) = -1 ENETUNREACH (Network is unreachable)

	So, it appears that sin6_flowinfo and sin6_scope_id were crap.

2004-09-03  Ken Preslan  <kpreslan@redhat.com>

	The -mm kernel that includes our flock patch.

2004-09-03  David Teigland  <teigland@redhat.com>

	update from src files

	Changes to how dlm flags are used based on dlm changes. Change the way we deal with gfs's "hold_lvb" requirement: use a separate NL lock to represent a "held lvb" instead of replacing unlocks with conversions to NL.  This way unlocks from gfs are always handled consistently, with a corresponding dlm unlock.

	Change the lock granting logic to mirror the behavior of VMS.  The effect of QUECVT and EXPEDITE flags have also been changed to match VMS.  A couple new flags have been added to allow for non-vms-like behavior that's required when using range locks.

2004-09-03  Ken Preslan  <kpreslan@redhat.com>

	o Fix the BLKGETSIZE64 ioctl for Linux 2.6. o Use lseek() to to determine the device size if BLKGETSIZE64 and   BLKGETSIZE fail.

	Get rid of a couple more 2TB checks.

2004-09-02  Jonathan Brassow  <jbrassow@redhat.com>

	- a couple minor updates to multicast code   - add a '-t' option for specifying ttl, default is still 1 (IPv4)   - use 224.0.2.5 (IPv4) and ff02::3:1 (IPv6) as default multicast addrs

2004-09-01  Jonathan Brassow  <jbrassow@redhat.com>

	- correctly specify the libdir in configure as /usr/lib - add IPv6 support to ccsd - add multicast support to ccsd - make the ccsd port numbers configurable - update ccsd man page - make the config file location tunable - make pid (lockfile) location tunable - still debating whether to turn on the option

2004-09-01  Ken Preslan  <kpreslan@redhat.com>

	Get rid of some pool crap. Get rid of an arbitrary 2TB limit that was there to keep 2.4 from screwing up.

	Ben Cahill's new man page.

	Update patches.

2004-08-31  Ken Preslan  <kpreslan@redhat.com>

	Rework patch to fit with Trond's comments.

2004-08-31  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- fixed a few ickys. - added some tests.

2004-08-31  Ken Preslan  <kpreslan@redhat.com>

	Print out PIDs.

2004-08-30  Ken Preslan  <kpreslan@redhat.com>

	Fix s_maxbytes.

2004-08-30  Lon Hohberger  <lhh@redhat.com>

	Fix build

	        * src/resources/*: Add status/monitor actions to metadata         * include/list.h: Update to fix compiler warnings.  This is not         complete; it's better to add a 'field' to structures requiring         list specs.         * src/clulib/vft.c: Remove unnecessary pthread locks.         * src/daemons/*: Misc. code cleanups.

2004-08-30  Ken Preslan  <kpreslan@redhat.com>

	Patches for a kernel that supports the new plock interface.

2004-08-27  Ken Preslan  <kpreslan@redhat.com>

	Rearrange some asserts.

	Munge.

	Reimplemented the flock patch to work similarly to the new way plocks will work in 2.8.9.  The FS acquires the VFS flock from its code.

	Helper scripts for "gfs_tool lockdump".

2004-08-26  Jonathan Brassow  <jbrassow@redhat.com>

	- use indexing rather than ccs list handling to retrieve node names   That way fence_init will not fail in the single node case.

2004-08-26  Adam Manthei  <amanthei@redhat.com>

	I forgot to add Lazar Obradovic's fencing agents to the bin Makefile. Thanks go to anton@hq.310.ru for pointing that out.

2004-08-26  Patrick Caulfield  <pcaulfie@redhat.com>

	So /that's/ why it was up there...

	A couple of endian fixes. mixed-endian clusters now seem to pass a cursory test.

	Don't send HELLO as soon as the kthread is started as that might b e too early.

	Fix stupid cut & paste bug with IPV6 multicast.

2004-08-25  Lon Hohberger  <lhh@redhat.com>

	Unbreak gulm.

2004-08-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Get rid of some debugging info that is no longer relevant (or even compiles). Also fix some that is.

	pack the comms structures. They are already well-aligned but the compiler does exceed its orders slightly in this case.

	use REPLYEXP for ISLISTENING messages

2004-08-25  David Teigland  <teigland@redhat.com>

	change the order in which we set up join/leave values so another thread can't see the SEVENT flag set before the pointer is set.

2004-08-24  Adam Manthei  <amanthei@redhat.com>

	Fencing agents contributed by Lazar Obradovic <laza@yu.net> for    o Qlogic SAN Box2    o IBM Blade Center (requires SNMP support.  Can be used instead of                        the xcat fencing agent)

2004-08-24  Patrick Caulfield  <pcaulfie@redhat.com>

	Be a little less ACK-happy during transition. ACKs can now be embedded in data messages so, where we know there will be a reply there is no need for a separate ACK.

	Run dlm_recoverd only when we need to do recovery.

	Return the lockid to userland as soon as we know it.

2004-08-24  David Teigland  <teigland@redhat.com>

	patches for 2.6.8.1

	use kthread routines to start/stop ast thread

2004-08-23  Ken Preslan  <kpreslan@redhat.com>

	Update to 2.6.8.1.

2004-08-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Use seq_file for /proc/cluster/services so we don't crash the kernel if there are more than a few lockspaces/GFS mounts etc.

	Setting a bad example...

2004-08-23  David Teigland  <teigland@redhat.com>

	Use a recovery daemon per lockspace.  This avoids deadlock when nodes recover multiple lockspaces in different orders.

2004-08-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Update libdlm doc.

2004-08-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Also include the pid in LKB rebuild

	Add PID to a lock which can be returned using the Query API.
	Thanks to Jeff Orlin for most of this code.

2004-08-19  Jonathan Brassow  <jbrassow@redhat.com>

	- forgot to remove eattr from the Makefile

	- don't need the gfs_eattr man page, as the tool no longer exists

2004-08-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy LVB handling

2004-08-19  David Teigland  <teigland@redhat.com>

	a couple error messages

2004-08-18  Patrick Caulfield  <pcaulfie@redhat.com>

	Change AF_ number to 30 so it doesn't conflict with bluetooth. TIPC also uses this number and you're unlikely to be using both together.

	Create /dev/misc with reasonable permissions.

	Don't hang lkbs off the ownerqueue list as we don't have any control over their lifetime. Now that LKBs are destroyed before the ASTs are run this causes real problems.
	The ownerqueue is now strung through the lock_info structs themselves
	and we free those up when we can see that the lkb has been removed
	by the DLM core.

	This (for me) fixes Lon's SMP oops and also the dlmlock hang/oops
	mentioned in bugzilla #130148

2004-08-18  David Teigland  <teigland@redhat.com>

	if the first start is cancelled by a stop before finishing, reset the last_start value (same as with dlm and fence services) and discard nodes saved from initial invalidated start.

	Use a separate DELAY_RECOVERY flag to postpone join/leave processing during recovery.  This leaves the DELAY flag used only for retries when joins/leaves conflict.  The interference between recoveries and delayed join/leave processing could lead to stalled recovery or a timer oops.

	some spacing cleanup

2004-08-17  Benjamin Marzinski  <bmarzins@redhat.com>

	Forgot to update kernel stuff.

2004-08-17  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix userspace LVBs (thanks, Jeff) Fix assert when creating sublocks - if we get asked to create a sublock on a master node then that's quite correct.

	Remove duplicate check.

2004-08-16  Benjamin Marzinski  <bmarzins@redhat.com>

	updated Makefile so that it make distclean works

2004-08-16  Jonathan Brassow  <jbrassow@redhat.com>

	- it wasn't a good idea to add rm -f /lib/libmagma* to the make file

2004-08-15  Benjamin Marzinski  <bmarzins@redhat.com>

	Oops. Forgot to update the man pages.

2004-08-14  Benjamin Marzinski  <bmarzins@redhat.com>

	Bunch of gnbd fixes.  The big one is that gnbd_monitor works like it's supposed to... Or at least if it doesn't, it's a bug, as opposed to just not being done. Most of the changes are under the covers, so accept for a more verbose gnbd_monitor list, all the UIs are the same.

2004-08-13  Lon Hohberger  <lhh@redhat.com>

	Temporary sledgehammer lock fix

	Clean up build

	Change cflags to make it build on newer compilers for now

2004-08-13  Jonathan Brassow  <jbrassow@redhat.com>

	- cman_tool.8 was still referenced in the cman_tool directory

2004-08-13  Lon Hohberger  <lhh@redhat.com>

	Initial checkin of rgmanager

2004-08-13  David Teigland  <teigland@redhat.com>

	update from src files

2004-08-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Knock the "I'm not getting out of bed for a message that small" size down to 20 bytes as the recovery code is quite capable of sending 21 byte messages.

2004-08-13  David Teigland  <teigland@redhat.com>

	update from src files

	use the force=2 option for dlm_release_lockspace() to disregard any existing locks

	remove assertion that's not correct when multiple lock requests are in progress on the same resource at once (e.g. plocks from lock_dlm).

	moved to man dir

	install man dir

	move cman_tool.8 into man dir, add Makefile to install

	man page for cluster.conf

2004-08-12  Lon Hohberger  <lhh@redhat.com>

	Remove crc32.c & build req. on it.

2004-08-12  Jonathan Brassow  <jbrassow@redhat.com>

	- move some stuff around. - fix brokenness when update occur simultaneously - more error checking

2004-08-12  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't update the bastaddr/param for a convert until the conversion has actually completed.. Patch from Jeff Orlin.
	Don't remove convert cancels from the list of locks owned by this process.

2004-08-12  David Teigland  <teigland@redhat.com>

	previous fix incomplete, one other copy to zero

	when a recovery interrupts first start, the last_start value needs to be reset to 0 too to avoid assertion failure

	copy the current config_version into the cl_version struct in GET_VERSION.

	"cman_tool version -r <config>" can be used to update the config version of all cluster members.

	more refining of whether we deliver or skip bast delivery

2004-08-11  Patrick Caulfield  <pcaulfie@redhat.com>

	I think it would be a really nice idea to actually pass the flags into the kernel, rather than ignoring them, don't you ?

	If the dlm_unlock() call fails, the put the lock back on the ownerqueue so it gets unlocked wen the device is closed.

	Don't grant locks that have are waiting for unlock.

	Don't deliver blocking ASTs to locks that are in progress.

2004-08-11  David Teigland  <teigland@redhat.com>

	- rebuild_freemem() was being called too early - the grantqueue must be checked for NOREBUILD locks when deciding   if an rsb should be remastered

	better format for lock dump on assert

	change flag name to reflect expanded use

	basts don't apply to the "plock update" lock, so don't provide a bast function.  also use the delete_lp routine to free it.

2004-08-10  Benjamin Marzinski  <bmarzins@redhat.com>

	link to the pthread library because magma needs it now.

2004-08-10  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't cleanr li_flags after setting the FIRSTLOCK bit

	Put some locking around the lockspace list. Tidy up how the user_ls gets freed.

	Fix a couple of error paths so they set errno.

	Use re-entrant gethostbyname2_r as we are juggling two hostent structures at the same time when starting multicast. previously the multicast address overwrite the local address as gethostbyname uses a static buffer.

	reinstate copy of lock name that got lost in the last change.

2004-08-10  David Teigland  <teigland@redhat.com>

	Make sure plock lp is off all lists before deleting, doesn't appear to fix bug, though.  Only allow one lock_dlm thread to do process recoveries when they pile up.

2004-08-10  Adam Manthei  <amanthei@redhat.com>

	fix a regex that ernoeously allowed the agent to access devices it shouldn't when using non admin users (see bug #129521)

	Fix for bug #129521
	o modifies regex's so that non-admin accounts can navigate the menus
	o better invalid user/passwd detection

2004-08-09  Lon Hohberger  <lhh@redhat.com>

	Fix mutex deadlocks around cluster lock/unlock calls

2004-08-09  Patrick Caulfield  <pcaulfie@redhat.com>

	Return error if we can't start all the listening sockets.

	Set return code if we can't leave the cluster.

	Userspace side of last checkin - sync routines for locking.
	Make sure this new library is only installed when you have the matching kernel
	changes available too.

	The "lets get all the API changes done in one day" checkin. Add Jeff (sorry, I've forgotten your last name)'s sync API call for userspace along with a separate  astarg for blocking ASTs

	Use new ioctl interface to start the cluster.

	Replaced setsockopts with ioctls.

2004-08-06  Lon Hohberger  <lhh@redhat.com>

	Make ccsd give element name back with relevant cdata

2004-08-06  David Teigland  <teigland@redhat.com>

	plain make in cluster dir doesn't work, but make install should

2004-08-05  Lon Hohberger  <lhh@redhat.com>

	Remove old message encapsulation pieces and dependency on crc32.c

2004-08-05  Jonathan Brassow  <jbrassow@redhat.com>

	- take a stab at the cluster.conf.5 man page

	- incorrect synopsis

	- ccs is located in 7 not 8

	ccs is located in 7, not 8

2004-08-05  David Teigland  <teigland@redhat.com>

	When granting locks, ignore locks on the wait queue that are also on the lockqueue.

	remove another assert

	A bunch of fixes related to dir lookup's, EEXIST errors from lookups, EINVAL errors from requests.  Most prevalent when doing lots of flocks or plocks.

2004-08-05  Jonathan Brassow  <jbrassow@redhat.com>

	- misc prog for magma.

2004-08-04  Jonathan Brassow  <jbrassow@redhat.com>

	- the sm plugin for magma seems to emit CE_NULL instead of CE_MEMB_CHANGE   when a node leaves or joins...  Therefore, we must reread the membership   list even when receiving CE_NULL.

	- allow ccs to reload config file if the node is quorate (covers the   case were ccs needs a restart)
	- return EINVAL if a cluster name is specified that is different than
	  the one that is loaded.

2004-08-04  David Teigland  <teigland@redhat.com>

	try to clear up the build steps

2004-08-04  Patrick Caulfield  <pcaulfie@redhat.com>

	Example init script for cman/dlm/fence/clvm

	Change the initialisation order, so if we get into the kernel twice by some strange behaviour, the error is less alarming.

2004-08-03  Benjamin Marzinski  <bmarzins@redhat.com>

	Removed the dependency on "all" from the "uninstall" target

2004-08-03  Jonathan Brassow  <jbrassow@redhat.com>

	- add cmd to remove old libs that were located in /lib (as part of the   uninstall target)

2004-08-03  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- this is the opteron stack bug fix here too.   don't think any one has seen it on this code. but it hurts nothing to   just put the fix in right away.

2004-08-03  Patrick Caulfield  <pcaulfie@redhat.com>

	Always copy ast bits, even on convert (kernel vesion).

	Always copy AST parameters, even for converts.

	Remove some redundant code. sockaddr_cl no longer contains anything that kcl_get_node_by_addr can use.

2004-08-03  David Teigland  <teigland@redhat.com>

	- when processing a combined delete and completion ast, do the deletion   first.  This avoids the next request coming and and finding the rsb   between the ast and the release_rsb which can lead to other problems. - return -EEXIST from a dir lookup when the node looking up the res   is already the master.  A request needs to be processed differently   when this happens. There are larger problems related to both of these, but these changes are legitimate even after the bigger changes that will make them less important.  For now, this should allow some tests to run successfully or at least better.

2004-07-30  Patrick Caulfield  <pcaulfie@redhat.com>

	Do the parameter overrides correctly. Thanks for spotting that, Jeff!

2004-07-29  David Teigland  <teigland@redhat.com>

	update from src files

2004-07-28  David Teigland  <teigland@redhat.com>

	The lock counter used for DROPLOCKS callback wasn't accurate.  It now tracks the "locks held" value reported by gfs_tool counters.  These callbacks don't keep a lid on the number of locks but slows the growth anyway.  They now operate above 10,000 locks, delivered once a minute.

	Send a DROPLOCKS callback to gfs once every minute while the number of outstanding local locks is over 20,000.  Doesn't appear to be too effective but it might be in some cases.

	retry calls to ccs_connect if they return an error

2004-07-27  Jonathan Brassow  <jbrassow@redhat.com>

	- specifying a cluster name is only valid when the force command is used.

2004-07-27  Lon Hohberger  <lhh@redhat.com>

	Cleanup of useless variable

2004-07-27  David Teigland  <teigland@redhat.com>

	print the actual error value ccs returns

2004-07-27  Jonathan Brassow  <jbrassow@redhat.com>

	- must zero out rset variable before populating.

2004-07-26  Jonathan Brassow  <jbrassow@redhat.com>

	- when cman shuts down (as when cman_tool leave happens) close the connection   and attempt to reinitiate connection.
	This may be what is causing rbz128571.

	- multicast option is not ready yet.  Fail if it is specified.

	- add some man pages

2004-07-26  David Teigland  <teigland@redhat.com>

	Add locking around ls_requestqueue as it's accessed by both dlm_recoverd and dlm_recvd.

	tidy DLM_ASSERT statements

	Do reference counting on lockspace structs.  Looping mount/umount operations on multiple nodes would quickly result in a ls struct being freed while dlm_recoverd was still finishing a previous recovery on it.

2004-07-26  Patrick Caulfield  <pcaulfie@redhat.com>

	Clear the "cluster_is_quorate" flag at shutdown

2004-07-23  Jonathan Brassow  <jbrassow@redhat.com>

	- sometimes getsockopt would report that bcast was enabled when it wasn't.   Since it doesn't hurt to set the flag regardless, we now set the bcast   flag w/o checking to see if it is enabled already.

2004-07-23  David Teigland  <teigland@redhat.com>

	die if we cannot talk with ccs when starting up

2004-07-23  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix race on islistening queries.

	Pass the unqualified name into the kernel, so the cluster node name never has domain names attached to it.

2004-07-23  David Teigland  <teigland@redhat.com>

	- clvmd_fix_conf.sh usage was wrong - add info about building modules outside kernel tree - cluster.xml has changed to cluster.conf

	When a request completion is received in lock_dlm during recovery, the lock must be demoted to NL and rerequested in the originally requested mode after recovery completes (only NOEXP requests can be completed for gfs during recovery.)
	When a lock was rerequested, the QUECVT flag was always being set even
	though the lock may also have the EXPEDITE (gfs's PRIORITY) flag set.
	It's illegal to use EXPEDITE and QUECVT together, so we now only set
	QUECVT if EXPEDITE isn't.  An assertion fails if both flags are used.

	remove a printk that can be annoying

	fenced was not correctly matching fqdn's from cman and basic hostnames from ccs

2004-07-22  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- decent start of documenting cmdline args and config file for gulm.   still needs some work.

	- gulm will now get its configs from ccsd.   I'll be adjusting man pages next so syntax will be there.

2004-07-22  Jonathan Brassow  <jbrassow@redhat.com>

	- update configure scripts to set %{libdir} to /usr/lib
	- make ccs use magma and magmamsg
	- change from using /etc/cluster/cluster.xml to /etc/cluster/cluster.conf

	- put in a forgotten unlock in an error condition in magma

2004-07-22  Patrick Caulfield  <pcaulfie@redhat.com>

	Get rid of zero-initialisers as the compiler (or is it the linker? I always forget) does this for us.
	Include the quorate state in HELLO messages.

2004-07-22  David Teigland  <teigland@redhat.com>

	update from src files

	- Improve/fix the way we lock the rootres list.  The two rwsem's we   were using still weren't sufficient for cases where release_rsb was   called while traversing the root list.  Replace the two sems with   one new "ls_root_lock".  I hope this fixes the rootres list corruption   I was seeing.  It's much saner locking in any case.
	- Add some log_debug() statements for cases where dlm_unlock() returns
	  an EINVAL error so we can figure out what went wrong if the lock_dlm
	  assert fails.

	- Have next_move() detect the case where a first start on the ls is
	  interrupted by a recovery event.  I expect this will fix the related
	  assert failure that was reported, although I've can't reproduce to
	  confirm.

	on assert failure dump dlm's debug buffer

	An unlock request is waiting for a reply from a master node.  That master node fails causing a recovery event.  As of yesterday we simply treat these unlock requests as completed and don't rebuild them during recovery.  Before queueing the completion ast for these unlock requests the lkb must be removed from the rsb queue and the lockqueue.  An assertion failure was caused by not doing this.

	add BUG() to assertion

	initialize cluster_is_quorate to 0

2004-07-21  David Teigland  <teigland@redhat.com>

	update from src files

2004-07-21  Patrick Caulfield  <pcaulfie@redhat.com>

	neaten up some bits by calling send_kill() rather than building up our own KILL message.

2004-07-21  David Teigland  <teigland@redhat.com>

	if remote_stage2() gets a request, it should return EINVAL if: - no rsb exists for the named resource - the rsb exists but the nodeid is -1 - the rsb exists with some remote master specified The last case wasn't recognized and was causing an assertion failure. (The last two cases together are equivalent to res_nodeid != 0.)

2004-07-21  Patrick Caulfield  <pcaulfie@redhat.com>

	A couple of endian fixes.

2004-07-21  David Teigland  <teigland@redhat.com>

	In-progress unlock requests interrupted by a recovery event weren't always handled correctly.  I also no longer get failed dir removals during recovery.

2004-07-20  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- reshaped the way i was building the lock key names.  This new method   avoids a limit of 8 bytes for node names.

	- CFLAGS in make/defines.mk is ignored if you don't use += in the Makefiles

2004-07-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Distinguish between not being able to get the cluster ACTIVE state, and the cluster actually being active.

2004-07-20  Ken Preslan  <kpreslan@redhat.com>

	Suiddir support suggested by anton@hq.310.ru.

2004-07-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy up temp nodeids after a transition.

2004-07-20  David Teigland  <teigland@redhat.com>

	tidy a bit of code that decides if a new master should be looked up. makes it easier to experiment with new code in this area.

	if deserialise_lkb finds the lkb already exists, advance the pointer so we can correctly read the next item and print a debug message so we know if this is actually happening.

	pass the dlm_header into add_to_requestqueue so we can print the cmd

	recycle dir entries when rebuilding res directory instead of freeing and immediately reallocating thousands of them.

2004-07-20  Patrick Caulfield  <pcaulfie@redhat.com>

	Don't clear the temp_nodeid until we've /really/ finished with it. should finally nail #126526

	Fix race where two reads/accepts could arrive in quick sucession but only the first would be serviced. This fix does both reads AND accepts as opposed to the last one which only did reads.
	I reckon this should fix bug #126758

2004-07-20  David Teigland  <teigland@redhat.com>

	print rsb in remote_stage2 assertion

2004-07-20  Jonathan Brassow  <jbrassow@redhat.com>

	- remember to closedir()

2004-07-19  Patrick Caulfield  <pcaulfie@redhat.com>

	Install man page

	Man page for cman_tool

	Print error if no nodeIDs are passed to "cman_tool kill"

	Tidy up accept path a bit.

2004-07-17  Ken Preslan  <kpreslan@redhat.com>

	Reordered munging of modes on inode create.

2004-07-16  David Teigland  <teigland@redhat.com>

	update from src files

	- the new MASTER rsb flag wasn't being set during recovery when   an rsb from a departed node was remastered; this prevented the   dir entry for the rsb from eventually being removed which made   all further requests on that rsb invalid
	- take dirtbl lock when clearing dir during recovery even though
	  it's not strictly necessary

	- save dir nodeid in release_rsb instead of calculating it twice

2004-07-16  Patrick Caulfield  <pcaulfie@redhat.com>

	If there's anything left to read after recvmsg, then make sure we get it.

	oops, remove annoying (and badly formatted) debug prints

	Validate nodeIDs

2004-07-16  David Teigland  <teigland@redhat.com>

	dlm_unlock_stage2: copy new lvb from lkb before granting new locks to ensure they get the latest copy.

	Three different problems resulting from recent change to quit doing a convert-to-NL on a gfs unlock: - dlm_unlock wasn't passing VALBLK flag to write lvb on unlock - wake/complete for synchronous (internal) unlocks rather than gfs callback - lm_hold_lvb() wasn't preserving lvb contents since a dlm_unlock would   free the lkb and rsb.  Now if there's an lvb to preserve, convert to NL   on a lm_unlock() and do dlm_unlock on lm_unhold_lvb().

2004-07-15  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix some small odd bugs in startup conditions: - when taking over as master, make sure we always get a nodeid for the new node   in a NEWNODE transition - Fix some potential oopses in error messages - Allow a JOINACK_NAK message to come after a JOINACK_ACK in case the ACKing   node has to back down as master.

2004-07-15  Lon Hohberger  <lhh@redhat.com>

	Fix breakage in SM plugin when querying group membership w/o logging in; install in /usr

2004-07-15  David Teigland  <teigland@redhat.com>

	the recently changed version of release_rsb() checks the new RESFL_MASTER flag to decide if a dir_remove is necessary.  rsb's remastered during recovery weren't having this flag set.

	get rid of the _recovery version of dir_lookup which only related to sequence numbers

	remove "resdata" from function names since we've renamed things

	- /proc/cluster/dlm_dir to dump resource directory - change 5s constant for recovery wait timer into config.recover_timer - simplify logic that decides if dir removal is needed - add more detail to some log_debug statements - a call to release_rsb() was missing in remote_stage2 after successful   lookup of rsb with nodeid of -1 (where einval is returned) - change log_debug to log_all in dir removal errors which should now   be very uncommon (if they occur at all) - add a call to schedule between an einval reply and a repeat dir lookup

2004-07-15  Jonathan Brassow  <jbrassow@redhat.com>

	- couple changes to make files

2004-07-14  Patrick Caulfield  <pcaulfie@redhat.com>

	Clean up the temp nodeIDs list at shutdown.

2004-07-14  David Teigland  <teigland@redhat.com>

	- change in the way name_to_directory_nodeid works.  get rid of the bitmask   step and just do a modulus on the hash value.  the bitmask introduced an   imbalance with some node counts that could cause a more heavily weighted   node to be more prone to run out of memory (esp during recovery.)
	- change the way we handle the case where a granted message arrives before
	  the reply to the original request.  take the request out of the queue
	  right away and assign the remote lkid instead of waiting for the delayed
	  reply.  this is a rare circumstance but removes potential for problems.

2004-07-13  Jonathan Brassow  <jbrassow@redhat.com>

	- add targets to the make file for updating subtrees to latest tags.

2004-07-13  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- <can't say anything nice>

2004-07-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Make DLM_LSF_NOCONVGRANT the default for userland lockspaces.

2004-07-13  David Teigland  <teigland@redhat.com>

	update from src files

2004-07-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Missed a couple of files from the last tidying commit

	Remove resdir sequence number from all structs as it's no longer used.

2004-07-13  David Teigland  <teigland@redhat.com>

	Change the way lm_dlm_unlock() works.  We previously demoted to NL on a lm unlock and then did a dlm_unlock() on the lm put_lock.  Now do a full dlm_unlock() for each lm unlock.  This avoids some odd problems in some gfs tests.  We can reintroduce a convert-to-NL optimization later on if need be.

2004-07-13  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix an obscure but potentially nasty race on the resource directory.

2004-07-12  Ken Preslan  <kpreslan@redhat.com>

	Change the way a switch statement works to prevent GCC from doing stupid stuff on a PPC box.
	[ Arkadiusz Miskiewicz <arekm@pld-linux.org> ]

2004-07-12  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- removed the unneeded utils_verb_flags stuff from lock_gulm.ko

2004-07-12  David Teigland  <teigland@redhat.com>

	mess with tabs (unaligned in cvsweb...)

	remove stray printk

	Naming changes.  Get rid of struct typedefs and gd_ prefix.  Improve some of the structure names.  Use consistent hash table method for rsb/lkb/dir lists.

2004-07-09  Benjamin Marzinski  <bmarzins@redhat.com>

	Fixed some login structure size issues, so that gnbd clients and servers can be different architectures. 32 bit servers can now have 64 bit clients, etc. Also cleaned up code to get rid of compile warnings on 64 bit machies.

2004-07-09  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- fixes bug #126970   ifelseifelseifelse doesn't work without the elses.

2004-07-09  David Teigland  <teigland@redhat.com>

	a recent checkin incorrectly switched unlock_stage2 to reference an lkb after it was potentially freed.

	- set lkb nodeid to -1 when it's created.  this prevents an assert during   recovery on an lkb for which the rsb master is being looked up   (recent shift in assigning lkb nodeid exposed this) - add print_lkb/print_rsb to some existing asserts

	in dlm_lock_stage1 set lkb nodeid to the rsb's nodeid only after the rsb is certain to have the correct nodeid itself.

	- in unlock get the rsb after holding the in_recovery lock otherwise an   in-progress request is not redirected after recovery - add an assert

	pjc found spot where lock struct wasn't being freed

2004-07-09  Adam Manthei  <amanthei@redhat.com>

	diff -u -r1.3 fence_apc.pl --- fence_apc.pl        8 Jul 2004 22:06:34 -0000       1.3 +++ fence_apc.pl        9 Jul 2004 01:01:52 -0000 @@ -34,7 +34,7 @@                               # should be more than 1  my $open_wait = 5;           # Seconds to wait between each telnet attempt  my $telnet_timeout = 20;     # Seconds to wait for matching telent response -my $debuglog = '/tmp/apclog' # Location of debugging log when in verbose mode +my $debuglog = '/tmp/apclog';# Location of debugging log when in verbose mode  $opt_o = 'reboot';           # Default fence action.

2004-07-09  Benjamin Marzinski  <bmarzins@redhat.com>

	added -fPIC to the makefiles, so the cman.so, gulm.so, etc.. would compile on x86_64

2004-07-09  Adam Manthei  <amanthei@redhat.com>

	o added support for APC 79XX
	o additional error checking for masterswitch setups.  Not specifying a
	  a switch # to operate on will cause an error if there is more than
	  one switch present.

	o whitespace cleanup

2004-07-08  Patrick Caulfield  <pcaulfie@redhat.com>

	Stop users calling dlm_[ls_]_pthread_init() more than once. Reset fd flags on return from dlm_dispatch().

	Add timeout feature for resdir entries so they don't go away as soon as the last lock is dequeued. You can configure the time using a config entry, set this to zero to get the old behaviour

2004-07-07  Patrick Caulfield  <pcaulfie@redhat.com>

	Fix assertion.

2004-07-07  David Teigland  <teigland@redhat.com>

	loosen assertion to allow us to send an rsb lookup to ourselves this can legitimately happen during recovery by resend_cluster_requests

	update from src files

	- when an assertion fails dump all rsb's and lkb's to console

	- when a dlm_unlock() removes the last lkb from an rsb, reset the   master nodeid in the rsb to -1 to force a subsequent dlm_lock() to   look up the potentially new master.  Add find_rsb_to_unlock() for this   which holds a lock to make the test and set atomic wrt new dlm_lock()'s. - lots of assertions added - lots of log_debug()'s added (/proc/cluster/dlm_debug)

2004-07-06  David Teigland  <teigland@redhat.com>

	remove and clean up some debugging

	- Patrick's fix to set rsb nodeid to -1 during unlock crept into a   previous checkin. - Modify release_rsb() to cope with -1 nodeids and properly remove   resource directory entries.

2004-07-05  Patrick Caulfield  <pcaulfie@redhat.com>

	Tidy atomic decrement.

	Add support for more VMS-like locking mode where new locks will not be granted if there are already locks waiting for conversion.
	This is enabled per lockspace and is OFF by default.

	Fix a couple of 64bit compiler warnings.

	Add in more architectures. Note: this is /not/ a list of supported architectures, in fact very few other than i386 have been tested (and then not for some time). But fixes for other architectures are welcomed.

2004-07-05  David Teigland  <teigland@redhat.com>

	minor changes to resource directory lookups. - increment rd entry's seq number safely by holding the rd lock - don't pass rd structs to callers since there's no reference counting   on them; just return the nodeid and seq values instead.  safer and   cleaner approach. - add debugging code which will be reduced when current problems are   sorted out (strname used for debug prints will be removed)

2004-07-03  Benjamin Marzinski  <bmarzins@redhat.com>

	Fixed some annoying bugs.  Previously, when you unimported a gnbd (with gnbd_import -R or -r) you could try to kill a gnbd_recvd process that was already dead.. This would result in you killing the pid -1, and bad things happening.
	Also, gnbd_monitor wasn't accepting connections, which was causing commands
	to hang. This problem was introduced in fixing an earlier bug.

	Both these issues are fixed.

2004-07-02  Jonathan Brassow  <jbrassow@redhat.com>

	- work around broken exit

2004-07-02  David Teigland  <teigland@redhat.com>

	fix log message

	better log message

	include directory sequence numbers in prints

	another warning and assertion

	a bunch of assertions to catch errors early on

2004-07-02  Benjamin Marzinski  <bmarzins@redhat.com>

	Changed the /dev/gnbd_ctl node I make from major 11 to major 10, which is what misc devices are. I don't know why I haven't seen any issues with this until now.... As far as I can tell, gnbd_import shouldn't have been working at all. If anyone has been seeing
	gnbd_recvd[8311]: ERROR [gnbd_recvd.c:190] cannot open gnbd control device : No such device or address

	messages, they should go away now.

2004-07-01  Lon Hohberger  <lhh@redhat.com>

	Rename variables/macros/structures to not use leading __

2004-07-01  Patrick Caulfield  <pcaulfie@redhat.com>

	Make sure that the backout time for a "NEWCLUSTER" message is less than the joinwait time.

2004-07-01  Benjamin Marzinski  <bmarzins@redhat.com>

	initialize the polls array.  This will make sure that gnbd_monitor realizes that there is free space to add a new connection.

	updated gnbd kernel patch to include recent changes

2004-06-30  Ken Preslan  <kpreslan@redhat.com>

	Bring patch uptodate with the sources.

2004-06-29  Jonathan Brassow  <jbrassow@redhat.com>

	- change log code to not print log_msg if verbose is not set. - fix problem where ccsd exits if cman_tool leave is performed.
	If a cman_tool leave occurs, ccsd will drop into non-quorate mode -
	disallowing connections unless they are forced - which should only
	be done by cluster managers.

2004-06-29  Lon Hohberger  <lhh@redhat.com>

	Make dumb driver act like there's a real, one-node cluster.

2004-06-29  Benjamin Marzinski  <bmarzins@redhat.com>

	missing "_" in gnbd_monitor... caused gnbd_import to fail with uncached devices

	devfs was set to use /dev/gnbd/<minor>, but gnbd_import sets the gnbds cluster unique name in /dev/gnbd/<name>.. This was causing problems for devfs users. The devfs links for gnbd devices will now be in /dev/gnbd_minor/<minor> These should never be used, since this device name is not consistent across the cluster.

2004-06-29  David Teigland  <teigland@redhat.com>

	update from src files

	Fix the way we do lkb deletions.  The DELAST flag is removed and a delete arg is passed to queue_ast() when the lkb should be deleted following the ast delivery.  In the past, setting the the DELAST flag on an lkb could result in it being detected by an in-progress deliver_ast() and the lkb being deleted early.  I'm hopeful this was the cause of the oopses we'd see in process_asts().

	include lockspace.h

2004-06-28  Benjamin Marzinski  <bmarzins@redhat.com>

	fixed obvious error.. If the gnbd_ctl device wasn't present, I was trying to remove it, causing:
	gnbd_import: ERROR cannot remove /dev/gnbd_ctl : No such file or directory

2004-06-28  Michael Conrad Tadpol Tilstra  <mtilstra@redhat.com>

	- this is the idea I have for having gulm use ccs.  This code here   compiles, but has not been tested.  Further, gulm will not use ccs,   unless you compile with -DREADYFORCCS   I am a little leary about some of the string fiddling I did, which is why   I want to test it first.  But being that I'm going on vacation soon, I   wanted to leave you all with this code.  Feel free to play, but do no be   suprised by bugs. - fiddled with the symbols exported by libgulm.

2004-06-28  Lon Hohberger  <lhh@redhat.com>

	Display node IDs as 64-bit hex

	Fix wrong-side of ipv6 addr->node ID assignment

	Fix build problems breaking open(/usr/lib/magma/plugins, O_DIRECTORY...)

	Fix build problems; fix plugins to not use cml_free

2004-06-28  Adam Manthei  <amanthei@redhat.com>

	Addresses an issue that was seen w/ the APC Masterswitch.  logins can fail if the APC is logged into too fast.  This update does two things to reduce the likelihood of this bug:
	1. It trys to logout cleanly instead of just closing the telnet connection
	2. retrys twice upon login failure.

	There is a bug in the APC that will cause it to reset itself from time to
	time.  There doesn't appear to be anything that we can do about that though.

	Thanks (and blame! :) go to Erling for helping resolve the issue.

2004-06-28  Lon Hohberger  <lhh@redhat.com>

	Magma plugins API fixes for GuLM, CMAN, CMAN/SM

2004-06-28  Patrick Caulfield  <pcaulfie@redhat.com>

	Some older systems need explicit -lpthread

2004-06-28  David Teigland  <teigland@redhat.com>

	allocate name space for max length, not actual length sm_ioctl's copy_from_user always copies the max length in register

	use copy_from_user to get the register name always copy in max name length and then find string len

	put lockfile in /var/lock/ by default

	some tidying and improve error messages

2004-06-26  David Teigland  <teigland@redhat.com>

	change build/install order

2004-06-25  Ken Preslan  <kpreslan@redhat.com>

	Switch to using a fixed version of OGFS' shell sort.

	Make sure the VFS ACL code is compiled in if GFS in enabled.

2004-06-25  Benjamin Marzinski  <bmarzins@redhat.com>

	The GNBD clients and servers now distinguish eachother via nodename, instead of IP.  This was keeping gnbd from working smoothly with gulm on machines with one ip interface for lock traffic and one for block traffic. Also it removes some ipv4 to ipv6 headaches.  The clients now connect to the server via ipv4 or ipv6.. ipv6 prefferentially.  You can force a connection from the client to the sever to go over a specific path by using the ip address instead of the hostname. A bunch of code cleaning.. removing duplicated functions and such. Two related issues that still need to be done.. The server only accepts ipv4 connections now, but this is trivial to fix, and fence_gnbd needs a parameter switch, from ipaddr to nodename.  These will get checked in shortly.

2004-06-25  Jonathan Brassow  <jbrassow@redhat.com>

	- check in patch for making links correctly in make file
	~ patch by Arkadiusz Miskiewicz

2004-06-25  David Teigland  <teigland@redhat.com>

	ChangeSet@1.1683.1.1, 2004-06-25 11:19:18+01:00, patrick@jeltz.pjc.net   Fix oops in dlm_query.

2004-06-25  Patrick Caulfield  <pcaulfie@redhat.com>

	Create /dev/misc if it doesn't exist.

2004-06-25  David Teigland  <teigland@redhat.com>

	ChangeSet@1.1684, 2004-06-24 23:22:05+08:00, teigland@redhat.com   DLM: fix compile error (undefined proc_ls_name) if PROCLOCKS config is off
	ChangeSet@1.1681.1.1, 2004-06-24 05:14:16-05:00, pcaulfie@tng2-1.lab.msp.redhat.com
	  membership.c:
	    Save or create a temp nodeid for a new node that joined via a NOMINATE message.
	    should fix bug #126526
	  cnxman.c:
	    endian fix for temp nodeids
	  cnxman-private.h:
	    Prototype for new_temp_nodeid()

2004-06-25  Ken Preslan  <kpreslan@redhat.com>

	HCH's suggested cleanups to the GFS mount/unmount code.

2004-06-24  Jonathan Brassow  <jbrassow@redhat.com>

	- you meant clu_fence not cp_fence, I assume.

2004-06-24  Lon Hohberger  <lhh@redhat.com>

	Fixes from Ben Marzinski

2004-06-24  Jonathan Brassow  <jbrassow@redhat.com>

	- update make files

	- make gnbd buildable outside kernel

	- add ability to compile outside kernel
	- requires dlm-kernel and cman-kernel are installed

2004-06-24  Lon Hohberger  <lhh@redhat.com>

	Replace missing clu_fence() API call.

2004-06-24  Jonathan Brassow  <jbrassow@redhat.com>

	- targets to build outside the kernel.
	- requires that cman-kernel has been installed

2004-06-24  David Teigland  <teigland@redhat.com>

	ChangeSet@1.1682, 2004-06-24 13:34:54+08:00, teigland@redhat.com   DLM: newly added log_debug() in next_move() used gr pointer after freeing

2004-06-24  Alasdair G. Kergon  <agk@redhat.com>

	initial checkin

	Initial checkin.
